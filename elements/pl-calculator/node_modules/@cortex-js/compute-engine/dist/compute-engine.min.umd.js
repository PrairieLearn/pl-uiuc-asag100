/** Compute Engine 0.35.1 */
    (function(global,factory){typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'],factory):(global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.ComputeEngine = {}));})(this, (function (exports) { 'use strict';
var ComputeEngine=(()=>{var au=Object.defineProperty;var fy=Object.getOwnPropertyDescriptor;var py=Object.getOwnPropertyNames;var dy=Object.prototype.hasOwnProperty;var k=(n,e)=>()=>(n&&(e=n(n=0)),e);var yr=(n,e)=>{for(var t in e)au(n,t,{get:e[t],enumerable:!0})},my=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of py(e))!dy.call(n,r)&&r!==t&&au(n,r,{get:()=>e[r],enumerable:!(i=fy(e,r))||i.enumerable});return n};var it=n=>my(au({},"__esModule",{value:!0}),n);function uu(n,e){var t=Math.abs(n),i=Math.abs(e);return n===0?Math.log(i):e===0?Math.log(t):t<3e3&&i<3e3?Math.log(n*n+e*e)*.5:(n=n/2,e=e/2,.5*Math.log(n*n+e*e)+Math.LN2)}var on,$n,gy,hy,br,xy,ie,Fi=k(()=>{on=Math.cosh||function(n){return Math.abs(n)<1e-9?1-n:(Math.exp(n)+Math.exp(-n))*.5},$n=Math.sinh||function(n){return Math.abs(n)<1e-9?n:(Math.exp(n)-Math.exp(-n))*.5},gy=function(n){var e=Math.PI/4;if(-e>n||n>e)return Math.cos(n)-1;var t=n*n;return t*(t*(t*(t*(t*(t*(t*(t/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-1/2)},hy=function(n,e){var t=Math.abs(n),i=Math.abs(e);return t<3e3&&i<3e3?Math.sqrt(t*t+i*i):(t<i?(t=i,i=n/e):i=e/n,t*Math.sqrt(1+i*i))},br=function(){throw SyntaxError("Invalid Param")};xy=function(n,e){var t={re:0,im:0};if(n==null)t.re=t.im=0;else if(e!==void 0)t.re=n,t.im=e;else switch(typeof n){case"object":if("im"in n&&"re"in n)t.re=n.re,t.im=n.im;else if("abs"in n&&"arg"in n){if(!Number.isFinite(n.abs)&&Number.isFinite(n.arg))return ie.INFINITY;t.re=n.abs*Math.cos(n.arg),t.im=n.abs*Math.sin(n.arg)}else if("r"in n&&"phi"in n){if(!Number.isFinite(n.r)&&Number.isFinite(n.phi))return ie.INFINITY;t.re=n.r*Math.cos(n.phi),t.im=n.r*Math.sin(n.phi)}else n.length===2?(t.re=n[0],t.im=n[1]):br();break;case"string":t.im=t.re=0;var i=n.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),r=1,o=0;i===null&&br();for(var s=0;s<i.length;s++){var a=i[s];a===" "||a==="	"||a===`
`||(a==="+"?r++:a==="-"?o++:a==="i"||a==="I"?(r+o===0&&br(),i[s+1]!==" "&&!isNaN(Number(i[s+1]))?(t.im+=parseFloat((o%2?"-":"")+i[s+1]),s++):t.im+=parseFloat((o%2?"-":"")+"1"),r=o=0):((r+o===0||isNaN(Number(a)))&&br(),i[s+1]==="i"||i[s+1]==="I"?(t.im+=parseFloat((o%2?"-":"")+a),s++):t.re+=parseFloat((o%2?"-":"")+a),r=o=0))}r+o>0&&br();break;case"number":t.im=0,t.re=n;break;default:br()}return isNaN(t.re)||isNaN(t.im),t},ie=class n{constructor(e,t){this.re=0,this.im=0;var i=xy(e,t);this.re=i.re,this.im=i.im}sign(){var e=this.abs();return new n(this.re/e,this.im/e)}add(e,t){var i=new n(e,t);return this.isInfinite()&&i.isInfinite()?n.NAN:this.isInfinite()||i.isInfinite()?n.INFINITY:new n(this.re+i.re,this.im+i.im)}sub(e,t){var i=new n(e,t);return this.isInfinite()&&i.isInfinite()?n.NAN:this.isInfinite()||i.isInfinite()?n.INFINITY:new n(this.re-i.re,this.im-i.im)}mul(e,t){var i=new n(e,t);return this.isInfinite()&&i.isZero()||this.isZero()&&i.isInfinite()?n.NAN:this.isInfinite()||i.isInfinite()?n.INFINITY:i.im===0&&this.im===0?new n(this.re*i.re,0):new n(this.re*i.re-this.im*i.im,this.re*i.im+this.im*i.re)}div(e,t){var i=new n(e,t);if(this.isZero()&&i.isZero()||this.isInfinite()&&i.isInfinite())return n.NAN;if(this.isInfinite()||i.isZero())return n.INFINITY;if(this.isZero()||i.isInfinite())return n.ZERO;e=this.re,t=this.im;var r=i.re,o=i.im,s,a;return o===0?new n(e/r,t/r):Math.abs(r)<Math.abs(o)?(a=r/o,s=r*a+o,new n((e*a+t)/s,(t*a-e)/s)):(a=o/r,s=o*a+r,new n((e+t*a)/s,(t-e*a)/s))}pow(e,t){var i=new n(e,t);if(e=this.re,t=this.im,i.isZero())return n.ONE;if(i.im===0){if(t===0&&e>0)return new n(Math.pow(e,i.re),0);if(e===0)switch((i.re%4+4)%4){case 0:return new n(Math.pow(t,i.re),0);case 1:return new n(0,Math.pow(t,i.re));case 2:return new n(-Math.pow(t,i.re),0);case 3:return new n(0,-Math.pow(t,i.re))}}if(e===0&&t===0&&i.re>0&&i.im>=0)return n.ZERO;var r=Math.atan2(t,e),o=uu(e,t);return e=Math.exp(i.re*o-i.im*r),t=i.im*o+i.re*r,new n(e*Math.cos(t),e*Math.sin(t))}sqrt(){var e=this.re,t=this.im,i=this.abs(),r,o;if(e>=0){if(t===0)return new n(Math.sqrt(e),0);r=.5*Math.sqrt(2*(i+e))}else r=Math.abs(t)/Math.sqrt(2*(i-e));return e<=0?o=.5*Math.sqrt(2*(i-e)):o=Math.abs(t)/Math.sqrt(2*(i+e)),new n(r,t<0?-o:o)}exp(){var e=Math.exp(this.re);return this.im,new n(e*Math.cos(this.im),e*Math.sin(this.im))}expm1(){var e=this.re,t=this.im;return new n(Math.expm1(e)*Math.cos(t)+gy(t),Math.exp(e)*Math.sin(t))}log(){var e=this.re,t=this.im;return t===0&&e>0,new n(uu(e,t),Math.atan2(t,e))}abs(){return hy(this.re,this.im)}arg(){return Math.atan2(this.im,this.re)}sin(){var e=this.re,t=this.im;return new n(Math.sin(e)*on(t),Math.cos(e)*$n(t))}cos(){var e=this.re,t=this.im;return new n(Math.cos(e)*on(t),-Math.sin(e)*$n(t))}tan(){var e=2*this.re,t=2*this.im,i=Math.cos(e)+on(t);return new n(Math.sin(e)/i,$n(t)/i)}cot(){var e=2*this.re,t=2*this.im,i=Math.cos(e)-on(t);return new n(-Math.sin(e)/i,$n(t)/i)}sec(){var e=this.re,t=this.im,i=.5*on(2*t)+.5*Math.cos(2*e);return new n(Math.cos(e)*on(t)/i,Math.sin(e)*$n(t)/i)}csc(){var e=this.re,t=this.im,i=.5*on(2*t)-.5*Math.cos(2*e);return new n(Math.sin(e)*on(t)/i,-Math.cos(e)*$n(t)/i)}asin(){var e=this.re,t=this.im,i=new n(t*t-e*e+1,-2*e*t).sqrt(),r=new n(i.re-t,i.im+e).log();return new n(r.im,-r.re)}acos(){var e=this.re,t=this.im,i=new n(t*t-e*e+1,-2*e*t).sqrt(),r=new n(i.re-t,i.im+e).log();return new n(Math.PI/2-r.im,r.re)}atan(){var e=this.re,t=this.im;if(e===0){if(t===1)return new n(0,1/0);if(t===-1)return new n(0,-1/0)}var i=e*e+(1-t)*(1-t),r=new n((1-t*t-e*e)/i,-2*e/i).log();return new n(-.5*r.im,.5*r.re)}acot(){var e=this.re,t=this.im;if(t===0)return new n(Math.atan2(1,e),0);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).atan():new n(e!==0?e/0:0,t!==0?-t/0:0).atan()}asec(){var e=this.re,t=this.im;if(e===0&&t===0)return new n(0,1/0);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).acos():new n(e!==0?e/0:0,t!==0?-t/0:0).acos()}acsc(){var e=this.re,t=this.im;if(e===0&&t===0)return new n(Math.PI/2,1/0);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).asin():new n(e!==0?e/0:0,t!==0?-t/0:0).asin()}sinh(){var e=this.re,t=this.im;return new n($n(e)*Math.cos(t),on(e)*Math.sin(t))}cosh(){var e=this.re,t=this.im;return new n(on(e)*Math.cos(t),$n(e)*Math.sin(t))}tanh(){var e=2*this.re,t=2*this.im,i=on(e)+Math.cos(t);return new n($n(e)/i,Math.sin(t)/i)}coth(){var e=2*this.re,t=2*this.im,i=on(e)-Math.cos(t);return new n($n(e)/i,-Math.sin(t)/i)}csch(){var e=this.re,t=this.im,i=Math.cos(2*t)-on(2*e);return new n(-2*$n(e)*Math.cos(t)/i,2*on(e)*Math.sin(t)/i)}sech(){var e=this.re,t=this.im,i=Math.cos(2*t)+on(2*e);return new n(2*on(e)*Math.cos(t)/i,-2*$n(e)*Math.sin(t)/i)}asinh(){var e=this.im;this.im=-this.re,this.re=e;var t=this.asin();return this.re=-this.im,this.im=e,e=t.re,t.re=-t.im,t.im=e,t}acosh(){var e=this.acos();if(e.im<=0){var t=e.re;e.re=-e.im,e.im=t}else{var t=e.im;e.im=-e.re,e.re=t}return e}atanh(){var e=this.re,t=this.im,i=e>1&&t===0,r=1-e,o=1+e,s=r*r+t*t,a=s!==0?new n((o*r-t*t)/s,(t*r+o*t)/s):new n(e!==-1?e/0:0,t!==0?t/0:0),u=a.re;return a.re=uu(a.re,a.im)/2,a.im=Math.atan2(a.im,u)/2,i&&(a.im=-a.im),a}acoth(){var e=this.re,t=this.im;if(e===0&&t===0)return new n(0,Math.PI/2);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).atanh():new n(e!==0?e/0:0,t!==0?-t/0:0).atanh()}acsch(){var e=this.re,t=this.im;if(t===0)return new n(e!==0?Math.log(e+Math.sqrt(e*e+1)):1/0,0);var i=e*e+t*t;return i!==0?new n(e/i,-t/i).asinh():new n(e!==0?e/0:0,t!==0?-t/0:0).asinh()}asech(){var e=this.re,t=this.im;if(this.isZero())return n.INFINITY;var i=e*e+t*t;return i!==0?new n(e/i,-t/i).acosh():new n(e!==0?e/0:0,t!==0?-t/0:0).acosh()}inverse(){if(this.isZero())return n.INFINITY;if(this.isInfinite())return n.ZERO;var e=this.re,t=this.im,i=e*e+t*t;return new n(e/i,-t/i)}conjugate(){return new n(this.re,-this.im)}neg(){return new n(-this.re,-this.im)}ceil(e){return e=Math.pow(10,e||0),new n(Math.ceil(this.re*e)/e,Math.ceil(this.im*e)/e)}floor(e){return e=Math.pow(10,e||0),new n(Math.floor(this.re*e)/e,Math.floor(this.im*e)/e)}round(e){return e=Math.pow(10,e||0),new n(Math.round(this.re*e)/e,Math.round(this.im*e)/e)}equals(e,t){var i=new n(e,t);return Math.abs(i.re-this.re)<=n.EPSILON&&Math.abs(i.im-this.im)<=n.EPSILON}clone(){return new n(this.re,this.im)}toString(){var e=this.re,t=this.im,i="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(e)<n.EPSILON&&(e=0),Math.abs(t)<n.EPSILON&&(t=0),t===0?i+e:(e!==0?(i+=e,i+=" ",t<0?(t=-t,i+="-"):i+="+",i+=" "):t<0&&(t=-t,i+="-"),t!==1&&(i+=t),i+"i"))}toVector(){return[this.re,this.im]}valueOf(){return this.im===0?this.re:null}isNaN(){return isNaN(this.re)||isNaN(this.im)}isZero(){return this.im===0&&this.re===0}isFinite(){return isFinite(this.re)&&isFinite(this.im)}isInfinite(){return!(this.isNaN()||this.isFinite())}};ie.ZERO=new ie(0,0);ie.ONE=new ie(1,0);ie.I=new ie(0,1);ie.PI=new ie(Math.PI,0);ie.E=new ie(Math.E,0);ie.INFINITY=new ie(1/0,1/0);ie.NAN=new ie(NaN,NaN);ie.EPSILON=1e-15});function Ke(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=V-i.length,t&&(o+=li(t)),o+=i;s=n[e],i=s+"",t=V-i.length,t&&(o+=li(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function vn(n,e,t){if(n!==~~n||n<e||n>t)throw Error(fi+n)}function No(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=V,r=0):(r=Math.ceil((e+1)/V),e%=V),o=Ge(10,V-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==Ge(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==Ge(10,e-3)-1,s}function Rs(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=lu.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function Ny(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/Fs(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=vr(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}function q(n,e,t,i){var r,o,s,a,u,l,c,f,p,d=n.constructor;e:if(e!=null){if(f=n.d,!f)return n;for(r=1,a=f[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=V,s=e,c=f[p=0],u=c/Ge(10,r-s-1)%10|0;else if(p=Math.ceil((o+1)/V),a=f.length,p>=a)if(i){for(;a++<=p;)f.push(0);c=u=0,r=1,o%=V,s=o-V+1}else break e;else{for(c=a=f[p],r=1;a>=10;a/=10)r++;o%=V,s=o-V+r,u=s<0?0:c/Ge(10,r-s-1)%10|0}if(i=i||e<0||f[p+1]!==void 0||(s<0?c:c%Ge(10,r-s-1)),l=t<4?(u||i)&&(t==0||t==(n.s<0?3:2)):u>5||u==5&&(t==4||i||t==6&&(o>0?s>0?c/Ge(10,r-s):0:f[p-1])%10&1||t==(n.s<0?8:7)),e<1||!f[0])return f.length=0,l?(e-=n.e+1,f[0]=Ge(10,(V-e%V)%V),n.e=-e||0):f[0]=n.e=0,n;if(o==0?(f.length=p,a=1,p--):(f.length=p+1,a=Ge(10,V-o),f[p]=s>0?(c/Ge(10,r-s)%Ge(10,s)|0)*a:0),l)for(;;)if(p==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,f[0]==rt&&(f[0]=1));break}else{if(f[p]+=a,f[p]!=rt)break;f[p--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return j&&(n.e>d.maxE?(n.d=null,n.e=NaN):n.e<d.minE&&(n.e=0,n.d=[0])),n}function bt(n,e,t){if(!n.isFinite())return bp(n);var i,r=n.e,o=Ke(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+li(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+li(-r-1)+o,t&&(i=t-s)>0&&(o+=li(i))):r>=s?(o+=li(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+li(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=li(i))),o}function qs(n,e){var t=n[0];for(e*=V;t>=10;t/=10)e++;return e}function Os(n,e,t){if(e>_y)throw j=!0,t&&(n.precision=t),Error(pp);return q(new n(Ds),e,1,!0)}function yt(n,e,t){if(e>fu)throw Error(pp);return q(new n(Ps),e,t,!0)}function hp(n){var e=n.length-1,t=e*V+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function li(n){for(var e="";n--;)e+="0";return e}function xp(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/V+4);for(j=!1;;){if(t%2&&(o=o.times(e),lp(o.d,s)&&(r=!0)),t=sn(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),lp(e.d,s)}return j=!0,o}function up(n){return n.d[n.d.length-1]&1}function yp(n,e,t){for(var i,r,o=new n(e[0]),s=0;++s<e.length;){if(r=new n(e[s]),!r.s){o=r;break}i=o.cmp(r),(i===t||i===0&&o.s===t)&&(o=r)}return o}function pu(n,e){var t,i,r,o,s,a,u,l=0,c=0,f=0,p=n.constructor,d=p.rounding,m=p.precision;if(!n.d||!n.d[0]||n.e>17)return new p(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:NaN);for(e==null?(j=!1,u=m):u=e,a=new p(.03125);n.e>-2;)n=n.times(a),f+=5;for(i=Math.log(Ge(2,f))/Math.LN10*2+5|0,u+=i,t=o=s=new p(1),p.precision=u;;){if(o=q(o.times(n),u,1),t=t.times(++c),a=s.plus(xe(o,t,u,1)),Ke(a.d).slice(0,u)===Ke(s.d).slice(0,u)){for(r=f;r--;)s=q(s.times(s),u,1);if(e==null)if(l<3&&No(s.d,u-i,d,l))p.precision=u+=10,t=o=a=new p(1),c=0,l++;else return q(s,p.precision=m,d,j=!0);else return p.precision=m,s}s=a}}function ci(n,e){var t,i,r,o,s,a,u,l,c,f,p,d=1,m=10,g=n,h=g.d,x=g.constructor,y=x.rounding,v=x.precision;if(g.s<0||!h||!h[0]||!g.e&&h[0]==1&&h.length==1)return new x(h&&!h[0]?-1/0:g.s!=1?NaN:h?0:g);if(e==null?(j=!1,c=v):c=e,x.precision=c+=m,t=Ke(h),i=t.charAt(0),Math.abs(o=g.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)g=g.times(n),t=Ke(g.d),i=t.charAt(0),d++;o=g.e,i>1?(g=new x("0."+t),o++):g=new x(i+"."+t.slice(1))}else return l=Os(x,c+2,v).times(o+""),g=ci(new x(i+"."+t.slice(1)),c-m).plus(l),x.precision=v,e==null?q(g,v,y,j=!0):g;for(f=g,u=s=g=xe(g.minus(1),g.plus(1),c,1),p=q(g.times(g),c,1),r=3;;){if(s=q(s.times(p),c,1),l=u.plus(xe(s,new x(r),c,1)),Ke(l.d).slice(0,c)===Ke(u.d).slice(0,c))if(u=u.times(2),o!==0&&(u=u.plus(Os(x,c+2,v).times(o+""))),u=xe(u,new x(d),c,1),e==null)if(No(u.d,c-m,y,a))x.precision=c+=m,l=s=g=xe(f.minus(1),f.plus(1),c,1),p=q(g.times(g),c,1),r=a=1;else return q(u,x.precision=v,y,j=!0);else return x.precision=v,u;u=l,r+=2}}function bp(n){return String(n.s*n.s/0)}function Ms(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%V,t<0&&(i+=V),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=V;i<r;)n.d.push(+e.slice(i,i+=V));e=e.slice(i),i=V-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),j&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function Ty(n,e){var t,i,r,o,s,a,u,l,c;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),gp.test(e))return Ms(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(by.test(e))t=16,e=e.toLowerCase();else if(yy.test(e))t=2;else if(Ey.test(e))t=8;else throw Error(fi+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=xp(i,new i(t),o,o*2)),l=Rs(e,t,rt),c=l.length-1,o=c;l[o]===0;--o)l.pop();return o<0?new i(n.s*0):(n.e=qs(l,c),n.d=l,j=!1,s&&(n=xe(n,r,a*4)),u&&(n=n.times(Math.abs(u)<54?Ge(2,u):U.pow(2,u))),j=!0,n)}function Sy(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:vr(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/Fs(5,t)),e=vr(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function vr(n,e,t,i,r){var o,s,a,u,l=1,c=n.precision,f=Math.ceil(c/V);for(j=!1,u=t.times(t),a=new n(i);;){if(s=xe(a.times(u),new n(e++*e++),c,1),a=r?i.plus(s):i.minus(s),i=xe(s.times(u),new n(e++*e++),c,1),s=a.plus(i),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,l++}return j=!0,s.d.length=f+1,s}function Fs(n,e){for(var t=n;--e;)t*=n;return t}function Ep(n,e){var t,i=e.s<0,r=yt(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ft=i?4:1,e;if(t=e.divToInt(r),t.isZero())Ft=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ft=up(t)?i?2:3:i?4:1,e;Ft=up(t)?i?1:4:i?3:2}return e.minus(r).abs()}function du(n,e,t,i){var r,o,s,a,u,l,c,f,p,d=n.constructor,m=t!==void 0;if(m?(vn(t,1,pi),i===void 0?i=d.rounding:vn(i,0,8)):(t=d.precision,i=d.rounding),!n.isFinite())c=bp(n);else{for(c=bt(n),s=c.indexOf("."),m?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(c=c.replace(".",""),p=new d(1),p.e=c.length-s,p.d=Rs(bt(p),10,r),p.e=p.d.length),f=Rs(c,10,r),o=u=f.length;f[--u]==0;)f.pop();if(!f[0])c=m?"0p+0":"0";else{if(s<0?o--:(n=new d(n),n.d=f,n.e=o,n=xe(n,p,t,i,0,r),f=n.d,o=n.e,l=fp),s=f[t],a=r/2,l=l||f[t+1]!==void 0,l=i<4?(s!==void 0||l)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||l||i===6&&f[t-1]&1||i===(n.s<0?8:7)),f.length=t,l)for(;++f[--t]>r-1;)f[t]=0,t||(++o,f.unshift(1));for(u=f.length;!f[u-1];--u);for(s=0,c="";s<u;s++)c+=lu.charAt(f[s]);if(m){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)c+="0";for(f=Rs(c,r,e),u=f.length;!f[u-1];--u);for(s=1,c="1.";s<u;s++)c+=lu.charAt(f[s])}else c=c.charAt(0)+"."+c.slice(1);c=c+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)c="0"+c;c="0."+c}else if(++o>u)for(o-=u;o--;)c+="0";else o<u&&(c=c.slice(0,o)+"."+c.slice(o))}c=(e==16?"0x":e==2?"0b":e==8?"0o":"")+c}return n.s<0?"-"+c:c}function lp(n,e){if(n.length>e)return n.length=e,!0}function Iy(n){return new this(n).abs()}function By(n){return new this(n).acos()}function wy(n){return new this(n).acosh()}function Ay(n,e){return new this(n).plus(e)}function ky(n){return new this(n).asin()}function Cy(n){return new this(n).asinh()}function Ry(n){return new this(n).atan()}function My(n){return new this(n).atanh()}function Dy(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=yt(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?yt(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=yt(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(xe(n,e,o,1)),e=yt(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(xe(n,e,o,1)),t}function Py(n){return new this(n).cbrt()}function Oy(n){return q(n=new this(n),n.e+1,2)}function Ly(n,e,t){return new this(n).clamp(e,t)}function qy(n){if(!n||typeof n!="object")throw Error(Ls+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,pi,"rounding",0,8,"toExpNeg",-Er,0,"toExpPos",0,Er,"maxE",0,Er,"minE",-Er,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=cu[t]),(i=n[t])!==void 0)if(sn(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(fi+t+": "+i);if(t="crypto",r&&(this[t]=cu[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(dp);else this[t]=!1;else throw Error(fi+t+": "+i);return this}function Fy(n){return new this(n).cos()}function Vy(n){return new this(n).cosh()}function vp(n){var e,t,i;function r(o){var s,a,u,l=this;if(!(l instanceof r))return new r(o);if(l.constructor=r,cp(o)){l.s=o.s,j?!o.d||o.e>r.maxE?(l.e=NaN,l.d=null):o.e<r.minE?(l.e=0,l.d=[0]):(l.e=o.e,l.d=o.d.slice()):(l.e=o.e,l.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){l.s=1/o<0?-1:1,l.e=0,l.d=[0];return}if(o<0?(o=-o,l.s=-1):l.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;j?s>r.maxE?(l.e=NaN,l.d=null):s<r.minE?(l.e=0,l.d=[0]):(l.e=s,l.d=[o]):(l.e=s,l.d=[o]);return}if(o*0!==0){o||(l.s=NaN),l.e=NaN,l.d=null;return}return Ms(l,o.toString())}if(u==="string")return(a=o.charCodeAt(0))===45?(o=o.slice(1),l.s=-1):(a===43&&(o=o.slice(1)),l.s=1),gp.test(o)?Ms(l,o):Ty(l,o);if(u==="bigint")return o<0?(o=-o,l.s=-1):l.s=1,Ms(l,o.toString());throw Error(fi+o)}if(r.prototype=I,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=qy,r.clone=vp,r.isDecimal=cp,r.abs=Iy,r.acos=By,r.acosh=wy,r.add=Ay,r.asin=ky,r.asinh=Cy,r.atan=Ry,r.atanh=My,r.atan2=Dy,r.cbrt=Py,r.ceil=Oy,r.clamp=Ly,r.cos=Fy,r.cosh=Vy,r.div=$y,r.exp=jy,r.floor=Uy,r.hypot=Gy,r.ln=zy,r.log=Zy,r.log10=Wy,r.log2=Hy,r.max=Jy,r.min=Yy,r.mod=Qy,r.mul=Xy,r.pow=Ky,r.random=eb,r.round=nb,r.sign=tb,r.sin=ib,r.sinh=rb,r.sqrt=ob,r.sub=sb,r.sum=ab,r.tan=ub,r.tanh=lb,r.trunc=cb,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function $y(n,e){return new this(n).div(e)}function jy(n){return new this(n).exp()}function Uy(n){return q(n=new this(n),n.e+1,3)}function Gy(){var n,e,t=new this(0);for(j=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return j=!0,new this(1/0);t=e}return j=!0,t.sqrt()}function cp(n){return n instanceof U||n&&n.toStringTag===mp||!1}function zy(n){return new this(n).ln()}function Zy(n,e){return new this(n).log(e)}function Hy(n){return new this(n).log(2)}function Wy(n){return new this(n).log(10)}function Jy(){return yp(this,arguments,-1)}function Yy(){return yp(this,arguments,1)}function Qy(n,e){return new this(n).mod(e)}function Xy(n,e){return new this(n).mul(e)}function Ky(n,e){return new this(n).pow(e)}function eb(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:vn(n,1,pi),i=Math.ceil(n/V),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(dp);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=V,i&&n&&(r=Ge(10,V-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=V)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<V&&(t-=V-i)}return s.e=t,s.d=a,s}function nb(n){return q(n=new this(n),n.e+1,this.rounding)}function tb(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function ib(n){return new this(n).sin()}function rb(n){return new this(n).sinh()}function ob(n){return new this(n).sqrt()}function sb(n,e){return new this(n).sub(e)}function ab(){var n=0,e=arguments,t=new this(e[n]);for(j=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return j=!0,q(t,this.precision,this.rounding)}function ub(n){return new this(n).tan()}function lb(n){return new this(n).tanh()}function cb(n){return q(n=new this(n),n.e+1,1)}var Er,pi,lu,Ds,Ps,cu,fp,Ft,j,Ls,fi,pp,dp,mp,sn,Ge,yy,by,Ey,gp,rt,V,vy,_y,fu,I,xe,U,To,_n=k(()=>{Er=9e15,pi=1e9,lu="0123456789abcdef",Ds="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ps="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",cu={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Er,maxE:Er,crypto:!1},j=!0,Ls="[DecimalError] ",fi=Ls+"Invalid argument: ",pp=Ls+"Precision limit exceeded",dp=Ls+"crypto unavailable",mp="[object Decimal]",sn=Math.floor,Ge=Math.pow,yy=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,by=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ey=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,gp=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,rt=1e7,V=7,vy=9007199254740991,_y=Ds.length-1,fu=Ps.length-1,I={toStringTag:mp};I.absoluteValue=I.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),q(n)};I.ceil=function(){return q(new this.constructor(this),this.e+1,2)};I.clampedTo=I.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(fi+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};I.comparedTo=I.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,u=o.s,l=n.s;if(!s||!a)return!u||!l?NaN:u!==l?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-l:0;if(u!==l)return u;if(o.e!==n.e)return o.e>n.e^u<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return i===r?0:i>r^u<0?1:-1};I.cosine=I.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+V,i.rounding=1,t=Ny(i,Ep(i,t)),i.precision=n,i.rounding=e,q(Ft==2||Ft==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};I.cubeRoot=I.cbrt=function(){var n,e,t,i,r,o,s,a,u,l,c=this,f=c.constructor;if(!c.isFinite()||c.isZero())return new f(c);for(j=!1,o=c.s*Ge(c.s*c,1/3),!o||Math.abs(o)==1/0?(t=Ke(c.d),n=c.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Ge(t,1/3),n=sn((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new f(t),i.s=c.s):i=new f(o.toString()),s=(n=f.precision)+3;;)if(a=i,u=a.times(a).times(a),l=u.plus(c),i=xe(l.plus(c).times(a),l.plus(u),s+2,1),Ke(a.d).slice(0,s)===(t=Ke(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(q(a,n+1,0),a.times(a).times(a).eq(c))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(q(i,n+1,1),e=!i.times(i).times(i).eq(c));break}return j=!0,q(i,n,f.rounding,e)};I.decimalPlaces=I.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-sn(this.e/V))*V,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};I.dividedBy=I.div=function(n){return xe(this,new this.constructor(n))};I.dividedToIntegerBy=I.divToInt=function(n){var e=this,t=e.constructor;return q(xe(e,new t(n),0,1,1),t.precision,t.rounding)};I.equals=I.eq=function(n){return this.cmp(n)===0};I.floor=function(){return q(new this.constructor(this),this.e+1,3)};I.greaterThan=I.gt=function(n){return this.cmp(n)>0};I.greaterThanOrEqualTo=I.gte=function(n){var e=this.cmp(n);return e==1||e===0};I.hyperbolicCosine=I.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/Fs(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=vr(s,1,o.times(e),new s(1),!0);for(var u,l=n,c=new s(8);l--;)u=o.times(o),o=a.minus(u.times(c.minus(u.times(c))));return q(o,s.precision=t,s.rounding=i,!0)};I.hyperbolicSine=I.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=vr(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/Fs(5,n)),r=vr(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),l=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(l))))}return o.precision=e,o.rounding=t,q(r,e,t,!0)};I.hyperbolicTangent=I.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,xe(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};I.inverseCosine=I.acos=function(){var n=this,e=n.constructor,t=n.abs().cmp(1),i=e.precision,r=e.rounding;return t!==-1?t===0?n.isNeg()?yt(e,i,r):new e(0):new e(NaN):n.isZero()?yt(e,i+4,r).times(.5):(e.precision=i+6,e.rounding=1,n=new e(1).minus(n).div(n.plus(1)).sqrt().atan(),e.precision=i,e.rounding=r,n.times(2))};I.inverseHyperbolicCosine=I.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,j=!1,t=t.times(t).minus(1).sqrt().plus(t),j=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};I.inverseHyperbolicSine=I.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,j=!1,t=t.times(t).plus(1).sqrt().plus(t),j=!0,i.precision=n,i.rounding=e,t.ln())};I.inverseHyperbolicTangent=I.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?q(new o(r),n,e,!0):(o.precision=t=i-r.e,r=xe(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};I.inverseSine=I.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=yt(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};I.inverseTangent=I.atan=function(){var n,e,t,i,r,o,s,a,u,l=this,c=l.constructor,f=c.precision,p=c.rounding;if(l.isFinite()){if(l.isZero())return new c(l);if(l.abs().eq(1)&&f+4<=fu)return s=yt(c,f+4,p).times(.25),s.s=l.s,s}else{if(!l.s)return new c(NaN);if(f+4<=fu)return s=yt(c,f+4,p).times(.5),s.s=l.s,s}for(c.precision=a=f+10,c.rounding=1,t=Math.min(28,a/V+2|0),n=t;n;--n)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(j=!1,e=Math.ceil(a/V),i=1,u=l.times(l),s=new c(l),r=l;n!==-1;)if(r=r.times(u),o=s.minus(r.div(i+=2)),r=r.times(u),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),j=!0,q(s,c.precision=f,c.rounding=p,!0)};I.isFinite=function(){return!!this.d};I.isInteger=I.isInt=function(){return!!this.d&&sn(this.e/V)>this.d.length-2};I.isNaN=function(){return!this.s};I.isNegative=I.isNeg=function(){return this.s<0};I.isPositive=I.isPos=function(){return this.s>0};I.isZero=function(){return!!this.d&&this.d[0]===0};I.lessThan=I.lt=function(n){return this.cmp(n)<0};I.lessThanOrEqualTo=I.lte=function(n){return this.cmp(n)<1};I.logarithm=I.log=function(n){var e,t,i,r,o,s,a,u,l=this,c=l.constructor,f=c.precision,p=c.rounding,d=5;if(n==null)n=new c(10),e=!0;else{if(n=new c(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new c(NaN);e=n.eq(10)}if(t=l.d,l.s<0||!t||!t[0]||l.eq(1))return new c(t&&!t[0]?-1/0:l.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(j=!1,a=f+d,s=ci(l,a),i=e?Os(c,a+10):ci(n,a),u=xe(s,i,a,1),No(u.d,r=f,p))do if(a+=10,s=ci(l,a),i=e?Os(c,a+10):ci(n,a),u=xe(s,i,a,1),!o){+Ke(u.d).slice(r+1,r+15)+1==1e14&&(u=q(u,f+1,0));break}while(No(u.d,r+=10,p));return j=!0,q(u,f,p)};I.minus=I.sub=function(n){var e,t,i,r,o,s,a,u,l,c,f,p,d=this,m=d.constructor;if(n=new m(n),!d.d||!n.d)return!d.s||!n.s?n=new m(NaN):d.d?n.s=-n.s:n=new m(n.d||d.s!==n.s?d:NaN),n;if(d.s!=n.s)return n.s=-n.s,d.plus(n);if(l=d.d,p=n.d,a=m.precision,u=m.rounding,!l[0]||!p[0]){if(p[0])n.s=-n.s;else if(l[0])n=new m(d);else return new m(u===3?-0:0);return j?q(n,a,u):n}if(t=sn(n.e/V),c=sn(d.e/V),l=l.slice(),o=c-t,o){for(f=o<0,f?(e=l,o=-o,s=p.length):(e=p,t=c,s=l.length),i=Math.max(Math.ceil(a/V),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=l.length,s=p.length,f=i<s,f&&(s=i),i=0;i<s;i++)if(l[i]!=p[i]){f=l[i]<p[i];break}o=0}for(f&&(e=l,l=p,p=e,n.s=-n.s),s=l.length,i=p.length-s;i>0;--i)l[s++]=0;for(i=p.length;i>o;){if(l[--i]<p[i]){for(r=i;r&&l[--r]===0;)l[r]=rt-1;--l[r],l[i]+=rt}l[i]-=p[i]}for(;l[--s]===0;)l.pop();for(;l[0]===0;l.shift())--t;return l[0]?(n.d=l,n.e=qs(l,t),j?q(n,a,u):n):new m(u===3?-0:0)};I.modulo=I.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?q(new i(t),i.precision,i.rounding):(j=!1,i.modulo==9?(e=xe(t,n.abs(),0,3,1),e.s*=n.s):e=xe(t,n,0,i.modulo,1),e=e.times(n),j=!0,t.minus(e))};I.naturalExponential=I.exp=function(){return pu(this)};I.naturalLogarithm=I.ln=function(){return ci(this)};I.negated=I.neg=function(){var n=new this.constructor(this);return n.s=-n.s,q(n)};I.plus=I.add=function(n){var e,t,i,r,o,s,a,u,l,c,f=this,p=f.constructor;if(n=new p(n),!f.d||!n.d)return!f.s||!n.s?n=new p(NaN):f.d||(n=new p(n.d||f.s===n.s?f:NaN)),n;if(f.s!=n.s)return n.s=-n.s,f.minus(n);if(l=f.d,c=n.d,a=p.precision,u=p.rounding,!l[0]||!c[0])return c[0]||(n=new p(f)),j?q(n,a,u):n;if(o=sn(f.e/V),i=sn(n.e/V),l=l.slice(),r=o-i,r){for(r<0?(t=l,r=-r,s=c.length):(t=c,i=o,s=l.length),o=Math.ceil(a/V),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=l.length,r=c.length,s-r<0&&(r=s,t=c,c=l,l=t),e=0;r;)e=(l[--r]=l[r]+c[r]+e)/rt|0,l[r]%=rt;for(e&&(l.unshift(e),++i),s=l.length;l[--s]==0;)l.pop();return n.d=l,n.e=qs(l,i),j?q(n,a,u):n};I.precision=I.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(fi+n);return t.d?(e=hp(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};I.round=function(){var n=this,e=n.constructor;return q(new e(n),n.e+1,e.rounding)};I.sine=I.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+V,i.rounding=1,t=Sy(i,Ep(i,t)),i.precision=n,i.rounding=e,q(Ft>2?t.neg():t,n,e,!0)):new i(NaN)};I.squareRoot=I.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,u=s.e,l=s.s,c=s.constructor;if(l!==1||!a||!a[0])return new c(!l||l<0&&(!a||a[0])?NaN:a?s:1/0);for(j=!1,l=Math.sqrt(+s),l==0||l==1/0?(e=Ke(a),(e.length+u)%2==0&&(e+="0"),l=Math.sqrt(e),u=sn((u+1)/2)-(u<0||u%2),l==1/0?e="5e"+u:(e=l.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),i=new c(e)):i=new c(l.toString()),t=(u=c.precision)+3;;)if(o=i,i=o.plus(xe(s,o,t+2,1)).times(.5),Ke(o.d).slice(0,t)===(e=Ke(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(q(o,u+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(q(i,u+1,1),n=!i.times(i).eq(s));break}return j=!0,q(i,u,c.rounding,n)};I.tangent=I.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=xe(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,q(Ft==2||Ft==4?t.neg():t,n,e,!0)):new i(NaN)};I.times=I.mul=function(n){var e,t,i,r,o,s,a,u,l,c=this,f=c.constructor,p=c.d,d=(n=new f(n)).d;if(n.s*=c.s,!p||!p[0]||!d||!d[0])return new f(!n.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?n.s/0:n.s*0);for(t=sn(c.e/V)+sn(n.e/V),u=p.length,l=d.length,u<l&&(o=p,p=d,d=o,s=u,u=l,l=s),o=[],s=u+l,i=s;i--;)o.push(0);for(i=l;--i>=0;){for(e=0,r=u+i;r>i;)a=o[r]+d[i]*p[r-i-1]+e,o[r--]=a%rt|0,e=a/rt|0;o[r]=(o[r]+e)%rt|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=qs(o,t),j?q(n,f.precision,f.rounding):n};I.toBinary=function(n,e){return du(this,2,n,e)};I.toDecimalPlaces=I.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(vn(n,0,pi),e===void 0?e=i.rounding:vn(e,0,8),q(t,n+t.e+1,e))};I.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=bt(i,!0):(vn(n,0,pi),e===void 0?e=r.rounding:vn(e,0,8),i=q(new r(i),n+1,e),t=bt(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};I.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=bt(r):(vn(n,0,pi),e===void 0?e=o.rounding:vn(e,0,8),i=q(new o(r),n+r.e+1,e),t=bt(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};I.toFraction=function(n){var e,t,i,r,o,s,a,u,l,c,f,p,d=this,m=d.d,g=d.constructor;if(!m)return new g(d);if(l=t=new g(1),i=u=new g(0),e=new g(i),o=e.e=hp(m)-d.e-1,s=o%V,e.d[0]=Ge(10,s<0?V+s:s),n==null)n=o>0?e:l;else{if(a=new g(n),!a.isInt()||a.lt(l))throw Error(fi+a);n=a.gt(e)?o>0?e:l:a}for(j=!1,a=new g(Ke(m)),c=g.precision,g.precision=o=m.length*V*2;f=xe(a,e,0,1,1),r=t.plus(f.times(i)),r.cmp(n)!=1;)t=i,i=r,r=l,l=u.plus(f.times(r)),u=r,r=e,e=a.minus(f.times(r)),a=r;return r=xe(n.minus(t),i,0,1,1),u=u.plus(r.times(l)),t=t.plus(r.times(i)),u.s=l.s=d.s,p=xe(l,i,o,1).minus(d).abs().cmp(xe(u,t,o,1).minus(d).abs())<1?[l,i]:[u,t],g.precision=c,j=!0,p};I.toHexadecimal=I.toHex=function(n,e){return du(this,16,n,e)};I.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:vn(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(j=!1,t=xe(t,n,0,e,1).times(n),j=!0,q(t)):(n.s=t.s,t=n),t};I.toNumber=function(){return+this};I.toOctal=function(n,e){return du(this,8,n,e)};I.toPower=I.pow=function(n){var e,t,i,r,o,s,a=this,u=a.constructor,l=+(n=new u(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new u(Ge(+a,l));if(a=new u(a),a.eq(1))return a;if(i=u.precision,o=u.rounding,n.eq(1))return q(a,i,o);if(e=sn(n.e/V),e>=n.d.length-1&&(t=l<0?-l:l)<=vy)return r=xp(u,a,t,i),n.s<0?new u(1).div(r):q(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new u(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Ge(+a,l),e=t==0||!isFinite(t)?sn(l*(Math.log("0."+Ke(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(j=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=pu(n.times(ci(a,i+t)),i),r.d&&(r=q(r,i+5,1),No(r.d,i,o)&&(e=i+10,r=q(pu(n.times(ci(a,e+t)),e),e+5,1),+Ke(r.d).slice(i+1,i+15)+1==1e14&&(r=q(r,i+1,0)))),r.s=s,j=!0,u.rounding=o,q(r,i,o))};I.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=bt(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(vn(n,1,pi),e===void 0?e=r.rounding:vn(e,0,8),i=q(new r(i),n,e),t=bt(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};I.toSignificantDigits=I.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(vn(n,1,pi),e===void 0?e=i.rounding:vn(e,0,8)),q(new i(t),n,e)};I.toString=function(){var n=this,e=n.constructor,t=bt(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};I.truncated=I.trunc=function(){return q(new this.constructor(this),this.e+1,1)};I.valueOf=I.toJSON=function(){var n=this,e=n.constructor,t=bt(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};xe=(function(){function n(i,r,o){var s,a=0,u=i.length;for(i=i.slice();u--;)s=i[u]*r+a,i[u]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(i[a]!=r[a]){u=i[a]>r[a]?1:-1;break}return u}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,u){var l,c,f,p,d,m,g,h,x,y,v,E,_,N,T,B,O,Y,H,we,qe=i.constructor,Fe=i.s==r.s?1:-1,ce=i.d,oe=r.d;if(!ce||!ce[0]||!oe||!oe[0])return new qe(!i.s||!r.s||(ce?oe&&ce[0]==oe[0]:!oe)?NaN:ce&&ce[0]==0||!oe?Fe*0:Fe/0);for(u?(d=1,c=i.e-r.e):(u=rt,d=V,c=sn(i.e/d)-sn(r.e/d)),H=oe.length,O=ce.length,x=new qe(Fe),y=x.d=[],f=0;oe[f]==(ce[f]||0);f++);if(oe[f]>(ce[f]||0)&&c--,o==null?(N=o=qe.precision,s=qe.rounding):a?N=o+(i.e-r.e)+1:N=o,N<0)y.push(1),m=!0;else{if(N=N/d+2|0,f=0,H==1){for(p=0,oe=oe[0],N++;(f<O||p)&&N--;f++)T=p*u+(ce[f]||0),y[f]=T/oe|0,p=T%oe|0;m=p||f<O}else{for(p=u/(oe[0]+1)|0,p>1&&(oe=n(oe,p,u),ce=n(ce,p,u),H=oe.length,O=ce.length),B=H,v=ce.slice(0,H),E=v.length;E<H;)v[E++]=0;we=oe.slice(),we.unshift(0),Y=oe[0],oe[1]>=u/2&&++Y;do p=0,l=e(oe,v,H,E),l<0?(_=v[0],H!=E&&(_=_*u+(v[1]||0)),p=_/Y|0,p>1?(p>=u&&(p=u-1),g=n(oe,p,u),h=g.length,E=v.length,l=e(g,v,h,E),l==1&&(p--,t(g,H<h?we:oe,h,u))):(p==0&&(l=p=1),g=oe.slice()),h=g.length,h<E&&g.unshift(0),t(v,g,E,u),l==-1&&(E=v.length,l=e(oe,v,H,E),l<1&&(p++,t(v,H<E?we:oe,E,u))),E=v.length):l===0&&(p++,v=[0]),y[f++]=p,l&&v[0]?v[E++]=ce[B]||0:(v=[ce[B]],E=1);while((B++<O||v[0]!==void 0)&&N--);m=v[0]!==void 0}y[0]||y.shift()}if(d==1)x.e=c,fp=m;else{for(f=1,p=y[0];p>=10;p/=10)f++;x.e=f+c*d-1,q(x,a?o+x.e+1:o,s,m)}return x}})();I[Symbol.for("nodejs.util.inspect.custom")]=I.toString;I[Symbol.toStringTag]="Decimal";U=I.constructor=vp(cu);Ds=new U(Ds);Ps=new U(Ps);To=U});function Ip(n){if(!gu){let t=`^[${["Zyyy","Zinh","Arab","Armn","Beng","Bopo","Cyrl","Deva","Ethi","Geor","Grek","Gujr","Guru","Hang","Hani","Hebr","Hira","Kana","Knda","Khmr","Laoo","Latn","Mlym","Mymr","Orya","Sinh","Taml","Telu","Thaa","Thai","Tibt"].map(i=>`\\p{Script=${i}}`).join("")}]*$`;gu=new RegExp(t,"u")}return gu.test(n)}function ze(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)||Nr.test(n)?!0:Ip(n)?/^[\p{XIDS}_]\p{XIDC}*$/u.test(n):!1}function jn(n){return typeof n!="string"?"not-a-string":n===""?"empty-string":n.normalize()!==n?"expected-nfc":/[\u200E\u200F\u2066-\u2069\u202A-\u202E]/.test(n)?"unexpected-bidi-marker":Nr.test(n)?"valid":/\p{XIDC}/u.test(n)&&xb.test(n)?"unexpected-mixed-emoji":Ip(n)?ze(n)?"valid":ze(n[0])?"invalid-char":"invalid-first-char":"unexpected-script"}var gu,fb,pb,db,mb,gb,Tp,hb,Sp,Bp,xb,Nr,di=k(()=>{fb="\\u{FE0F}",pb="\\u{20E3}",db="\\u{200D}",mb="\\p{RI}\\p{RI}",gb="(?:[\\u{E0020}-\\u{E007E}]+\\u{E007F})",Tp=`(?:\\p{EMod}|${fb}${pb}?|${gb})`,hb="(?:(?=\\P{XIDC})\\p{Emoji})",Sp=`(?:${hb}${Tp}*|\\p{Emoji}${Tp}+|${mb})`,Bp=`(?:${Sp})(${db}${Sp})*`,xb=new RegExp(`(?:${Bp})+`,"u"),Nr=new RegExp(`^(?:${Bp})+$`,"u")});function wp(n){return typeof n!="string"?!1:mi.includes(n)}var $s,hu,js,Us,xu,yu,mi,Tr=k(()=>{$s=["number","finite_number","complex","finite_complex","imaginary","real","finite_real","rational","finite_rational","integer","finite_integer","non_finite_number"],hu=["indexed_collection","list","tuple"],js=[...hu,"collection","set","record","dictionary"],Us=["scalar",...$s,"boolean","string"],xu=["value",...js,...Us],yu=["expression","symbol","function",...xu],mi=["any","unknown","nothing","never","error",...yu]});function Io(n,e){return e==="any"||n==="never"?!0:n==="unknown"||e==="unknown"?!1:n===e?!0:yb[e].includes(n)}function w(n,e){if(typeof n=="string"&&(n=F(n)),typeof e=="string"&&(e=F(e)),e==="any")return!0;if(e==="never")return!1;if(e==="error")return n==="error";if(e==="nothing")return n==="nothing";if(n==="nothing")return!1;if(e==="unknown")return!0;if(n==="unknown")return!1;if(typeof e=="string")return typeof n=="string"?Io(n,e):n.kind==="value"?typeof n.value=="boolean"?e==="boolean":typeof n.value=="number"?Number.isInteger(n.value)?Io("integer",e):Io("number",e):typeof n.value=="boolean"?Io("boolean",e):typeof n.value=="string"?Io("string",e):!1:n.kind==="union"?n.types.every(t=>w(t,e)):n.kind==="intersection"?n.types.some(t=>w(t,e)):n.kind==="negation"?!w(n.type,e):n.kind==="numeric"?!!w(n.type,e):e==="number"?Ap(n):e==="symbol"?bu(n):e==="expression"?bb(n):e==="function"?Dp(n):e==="scalar"?kp(n):e==="value"?Mp(n):e==="indexed_collection"?Rp(n):e==="collection"?Cp(n):e==="tuple"?n.kind==="tuple":e==="list"?n.kind==="list":e==="set"?n.kind==="set":e==="record"?n.kind==="record":e==="dictionary"?n.kind==="dictionary":!1;if(e.kind==="union")return typeof n!="string"&&n.kind==="union"?n.types.every(t=>e.types.some(i=>w(t,i))):e.types.some(t=>w(n,t));if(e.kind==="expression"){if(n==="symbol")return!0;if(typeof n=="string")return!1;if(n.kind==="expression")return e.operator==="Symbol"?bu(n):n.operator===e.operator;if(n.kind==="symbol")return!0}if(typeof n=="string")return!1;if(e.kind==="reference"){if(n.kind==="reference")return n.name===e.name;if(e.alias===!0&&e.def)return w(n,e.def)}if(n.kind==="union")return n.types.some(t=>w(t,e));if(n.kind==="intersection"&&e.kind==="intersection")return e.types.every(t=>n.types.some(i=>w(i,t)));if(n.kind==="intersection")return n.types.every(t=>w(t,e));if(e.kind==="intersection")return e.types.every(t=>w(n,t));if(n.kind==="signature"&&e.kind==="signature"){if(!w(n.result,e.result))return!1;if(n.optArgs||n.variadicArg){if(e.args){if(!n.args||n.args.length!==e.args.length)return!1;for(let t=0;t<e.args.length;t++)if(!w(e.args[t].type,n.args[t].type))return!1}else if(n.args)return!1;if(e.optArgs){if(!n.optArgs||n.optArgs.length!==e.optArgs.length)return!1;for(let t=0;t<n.optArgs.length;t++)if(!w(e.optArgs[t].type,n.optArgs[t].type))return!1}else if(n.optArgs)return!1;if(e.variadicArg){if(!n.variadicArg||n.variadicMin!=e.variadicMin||!w(e.variadicArg.type,n.variadicArg.type))return!1}else if(n.variadicArg)return!1}else{if(e.args&&!n.args)return!1;let t=0;if(e.args){if(n.args.length<e.args.length)return!1;for(;t<e.args.length;){if(!w(e.args[t].type,n.args[t].type))return!1;t+=1}}if(e.optArgs){if(t>=n.args.length)return!0;for(let i=0;i<e.optArgs.length;i++){if(!w(e.optArgs[i].type,n.args[t].type))return!1;if(t+=1,t>=n.args.length)return!0}}if(e.variadicArg){if(t>=n.args.length&&e.variadicMin===0)return!0;if(e.variadicMin>0&&t+e.variadicMin>n.args.length)return!1;for(;t<n.args.length;){if(!w(e.variadicArg.type,n.args[t].type))return!1;t+=1}}}return!0}if(n.kind==="record"&&e.kind==="record"){for(let t of Object.keys(e.elements))if(!(t in n.elements)||!w(n.elements[t],e.elements[t]))return!1;return!0}if(n.kind==="dictionary"&&e.kind==="dictionary")return w(n.values,e.values);if(e.kind==="indexed_collection")return n.kind==="indexed_collection"||n.kind==="list"?w(n.elements,e.elements):n.kind==="tuple"?n.elements.every(t=>w(t.type,e.elements)):!1;if(e.kind==="collection"){if(n.kind==="collection"||n.kind==="indexed_collection"||n.kind==="list")return w(n.elements,e.elements);if(n.kind==="tuple")return n.elements.every(t=>w(t.type,e.elements));if(n.kind==="set")return w(n.elements,e.elements);if(n.kind==="dictionary")return w(F(`tuple<string, ${te(n.values)}>`),e.elements);if(n.kind==="record")return w(F(`tuple<$string, ${te(ve(...Object.values(n.elements)))}>`),e.elements)}if(n.kind==="tuple"&&e.kind==="tuple"){if(n.elements.length!==e.elements.length)return!1;for(let t=0;t<n.elements.length;t++){let i=n.elements[t],r=e.elements[t];if(!w(i.type,r.type)||i.name!==r.name)return!1}return!0}if(e.kind==="list"&&n.kind==="list"){if(!w(n.elements,e.elements))return!1;if(e.dimensions){if(!n.dimensions||n.dimensions.length!==e.dimensions.length)return!1;for(let t=0;t<n.dimensions.length;t++)if(e.dimensions[t]!==-1&&n.dimensions[t]!==e.dimensions[t])return!1}return!0}if(n.kind==="symbol"&&e.kind==="symbol")return n.name===e.name;if(n.kind==="numeric"&&e.kind==="numeric")return!(!w(n.type,e.type)||(n.lower??-1/0)<(e.lower??-1/0)||(n.upper??1/0)>(e.upper??1/0));if(e.kind==="set"&&n.kind==="set")return!!w(n.elements,e.elements);if(n.kind==="negation"&&e.kind==="negation")return w(n.type,e.type);if(e.kind==="negation")return!w(n,e.type);if(e.kind==="value"&&n.kind==="value")return e.value===n.value;if(n.kind==="value"){if(typeof n.value=="boolean")return w("boolean",e);if(typeof n.value=="number")return Number.isInteger(n.value)?w("integer",e):w("real",e);if(typeof n.value=="string")return w("string",e)}return!1}function Ap(n){return typeof n=="string"?$s.includes(n):n.kind==="value"?typeof n.value=="number":n.kind==="numeric"}function kp(n){return Ap(n)?!0:typeof n=="string"?Us.includes(n):n.kind==="value"?["string","boolean","number"].includes(typeof n.value):!1}function Cp(n){return Rp(n)?!0:typeof n=="string"?js.includes(n):["collection","set","record","dictionary"].includes(n.kind)}function Rp(n){return typeof n=="string"?!1:["indexed_collection","list","tuple"].includes(n.kind)}function Mp(n){return kp(n)||Cp(n)}function Dp(n){return n==="function"||typeof n!="string"&&n.kind==="signature"}function bb(n){return typeof n=="string"&&["expression","symbol","function"].includes(n)||Mp(n)||Dp(n)||bu(n)?!0:typeof n=="string"?!1:n.kind==="expression"}function bu(n){return n==="symbol"?!0:typeof n=="string"?!1:n.kind==="symbol"?!0:n.kind==="expression"?n.operator==="Symbol":!1}var yb,Nn=k(()=>{Tn();Tr();gi();an();yb={number:$s,non_finite_number:[],finite_number:["finite_complex","finite_real","finite_integer","finite_rational"],complex:["finite_complex","imaginary","finite_real","finite_rational","finite_integer","non_finite_number"],finite_complex:["imaginary","finite_real","finite_rational","finite_integer"],imaginary:[],real:["rational","integer","finite_real","finite_rational","finite_integer","non_finite_number"],finite_real:["finite_rational","finite_integer"],rational:["finite_rational","finite_integer","integer","non_finite_number"],finite_rational:["finite_integer"],integer:["finite_integer","non_finite_number"],finite_integer:[],any:mi,unknown:[],nothing:[],never:[],error:[],value:xu,scalar:Us,collection:js,indexed_collection:hu,list:[],set:[],tuple:[],record:[],dictionary:[],function:[],symbol:[],boolean:[],string:[],expression:yu}});function te(n,e=0){if(typeof n=="string")return n;let t="";switch(n.kind){case"value":typeof n.value=="string"?t=`"${n.value}"`:typeof n.value=="boolean"?t=n.value?"true":"false":t=n.value.toString();break;case"reference":t=n.name;break;case"negation":t=`!${te(n.type,Op)}`;break;case"union":t=n.types.map(u=>te(u,Lp)).join(" | ");break;case"intersection":t=n.types.map(u=>te(u,qp)).join(" & ");break;case"expression":t=`expression<${Pp(n.operator)}>`;break;case"symbol":t=`symbol<${Pp(n.name)}>`;break;case"numeric":Number.isFinite(n.lower)&&Number.isFinite(n.upper)?t=`${n.type}<${n.lower}..${n.upper}>`:Number.isFinite(n.lower)?t=`${n.type}<${n.lower}..>`:Number.isFinite(n.upper)?t=`${n.type}<..${n.upper}>`:t=`${n.type}`;break;case"list":if(n.dimensions&&w(n.elements,"number")){if(n.dimensions===void 0)n.elements==="number"&&(t="tensor");else if(n.dimensions.length===1)n.elements==="number"?n.dimensions[0]<0?t="vector":t=`vector<${n.dimensions[0]}>`:n.dimensions[0]<0?t=`vector<${te(n.elements)}>`:t=`vector<${te(n.elements)}^${n.dimensions[0]}>`;else if(n.dimensions.length===2){let u=n.dimensions;n.elements==="number"?u[0]<0&&u[1]<0?t="matrix":t=`matrix<${u[0]}x${u[1]}>`:u[0]<0&&u[1]<0?t=`matrix<${te(n.elements)}>`:t=`matrix<${te(n.elements)}^(${u[0]}x${u[1]})>`}}if(!t){let u=n.dimensions?n.dimensions.length===1?`^${n.dimensions[0].toString()}`:`^(${n.dimensions.join("x")})`:"";t=`list<${te(n.elements)}${u}>`}break;case"record":t=`record<${Object.entries(n.elements).map(([u,l])=>`${u}: ${te(l)}`).join(", ")}>`;break;case"dictionary":t=`dictionary<${te(n.values)}>`;break;case"set":t=`set<${te(n.elements)}>`;break;case"collection":t=`collection<${te(n.elements)}>`;break;case"indexed_collection":t=`indexed_collection<${te(n.elements)}>`;break;case"tuple":if(n.elements.length===0)t="tuple";else if(n.elements.length===1){let[u]=n.elements;t=`tuple<${Sr(u)}>`}else t="tuple<"+n.elements.map(u=>Sr(u)).join(", ")+">";break;case"signature":let r=n.args?n.args.map(u=>Sr(u)).join(", "):"",o=n.optArgs?n.optArgs.map(u=>Sr(u)+"?").join(", "):"",s=n.variadicArg?n.variadicMin===0?`${Sr(n.variadicArg)}*`:`${Sr(n.variadicArg)}+`:"";t=`(${[r,o,s].filter(u=>u).join(", ")}) -> ${te(n.result)}`;break;default:t="error"}return e>0&&e>wb(n.kind)?`(${t})`:t}function Sr(n){return n.name?`${n.name}: ${te(n.type)}`:te(n.type)}function Pp(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)?n:`\`${n}\``}function wb(n){switch(n){case"negation":return Op;case"union":return Lp;case"intersection":return qp;case"list":return Eb;case"record":return vb;case"dictionary":return _b;case"set":return Nb;case"collection":case"indexed_collection":return Tb;case"tuple":return Sb;case"signature":return Ib;case"value":return Bb;default:return 0}}var Op,Lp,qp,Eb,vb,_b,Nb,Tb,Sb,Ib,Bb,gi=k(()=>{Nn();Op=3,Lp=1,qp=2,Eb=4,vb=5,_b=6,Nb=7,Tb=8,Sb=9,Ib=10,Bb=11});function Ab(n,e){if(n===e)return 0;if(n.length===0)return e.length;if(e.length===0)return n.length;let t=Array.from({length:n.length+1},(r,o)=>o),i=new Array(n.length+1);for(let r=1;r<=e.length;r++){i[0]=r;for(let o=1;o<=n.length;o++){let s=n[o-1]===e[r-1]?0:1;i[o]=Math.min(t[o]+1,i[o-1]+1,t[o-1]+s)}[t,i]=[i,t]}return t[n.length]}function Gs(n,e){let i=null,r=1/0,o=n.length;for(let s of e){if(Math.abs(o-s.length)>7)continue;let a=Ab(n,s);if(a===0)return s;a<=7&&a<r&&(r=a,i=s)}return i}var Eu=k(()=>{});var zs,Fp=k(()=>{zs=class{input;pos=0;line=1;column=1;tokens=[];constructor(e){this.input=e}saveState(){return{pos:this.pos,line:this.line,column:this.column,tokens:[...this.tokens]}}restoreState(e){this.pos=e.pos,this.line=e.line,this.column=e.column,this.tokens=e.tokens}error(e){throw new Error(`Lexer error at line ${this.line}, column ${this.column}: ${e}`)}peek(e=0){let t=this.pos+e;return t<this.input.length?this.input[t]:""}advance(){let e=this.input[this.pos++];return e===`
`?(this.line++,this.column=1):this.column++,e}match(e){if(this.input.slice(this.pos,this.pos+e.length)===e){for(let t=0;t<e.length;t++)this.advance();return!0}return!1}isEOF(){return this.pos>=this.input.length}skipWhitespace(){for(;!this.isEOF()&&/\s/.test(this.peek());)this.advance()}readIdentifier(){let e="";for(;!this.isEOF()&&/[a-zA-Z0-9_]/.test(this.peek());)e+=this.advance();return e}readVerbatimString(){if(!this.match("`"))return"";let e="";for(;!this.isEOF()&&this.peek()!=="`";)this.match("\\`")?e+="`":this.match("\\\\")?e+="\\":e+=this.advance();return this.isEOF()&&this.error("Unterminated verbatim string"),this.advance(),e}readStringLiteral(){let e=this.advance(),t="";for(;!this.isEOF()&&this.peek()!==e;)this.match("\\"+e)?t+=e:this.match("\\\\")?t+="\\":t+=this.advance();return this.isEOF()&&this.error("Unterminated string literal"),this.advance(),t}readNumber(){let e="";if((this.peek()==="-"||this.peek()==="+")&&(e+=this.advance()),this.match("0x")||this.match("0X")){for(e+="x";!this.isEOF()&&/[0-9a-fA-F]/.test(this.peek());)e+=this.advance();return"0"+e}if(this.match("0b")||this.match("0B")){for(e+="b";!this.isEOF()&&/[01]/.test(this.peek());)e+=this.advance();return"0"+e}for(;!this.isEOF()&&/[0-9]/.test(this.peek());)e+=this.advance();if(this.peek()==="."&&/[0-9]/.test(this.peek(1)))for(e+=this.advance();!this.isEOF()&&/[0-9]/.test(this.peek());)e+=this.advance();if(this.peek()==="e"||this.peek()==="E")for(e+=this.advance(),(this.peek()==="+"||this.peek()==="-")&&(e+=this.advance());!this.isEOF()&&/[0-9]/.test(this.peek());)e+=this.advance();return e}createToken(e,t){return{type:e,value:t,position:this.pos-t.length,line:this.line,column:this.column-t.length}}nextToken(){if(this.skipWhitespace(),this.isEOF())return this.createToken("EOF","");let e=this.pos,t=this.peek();if(this.match("->"))return this.createToken("->","->");if(this.match(".."))return this.createToken("..","..");if(this.match("+\u221E")||this.match("+oo"))return this.createToken("PLUS_INFINITY",this.input.slice(e,this.pos));if(this.match("-\u221E")||this.match("-oo"))return this.createToken("MINUS_INFINITY",this.input.slice(e,this.pos));if(this.match("+infinity"))return this.createToken("PLUS_INFINITY","+infinity");if(this.match("-infinity"))return this.createToken("MINUS_INFINITY","-infinity");if(/[a-zA-Z_]/.test(t)){let i=this.readIdentifier();switch(i){case"true":return this.createToken("TRUE",i);case"false":return this.createToken("FALSE",i);case"nan":return this.createToken("NAN",i);case"infinity":return this.createToken("INFINITY",i);case"oo":return this.createToken("INFINITY",i);default:return this.createToken("IDENTIFIER",i)}}switch(t){case"|":return this.advance(),this.createToken("|","|");case"&":return this.advance(),this.createToken("&","&");case"!":return this.advance(),this.createToken("!","!");case"^":return this.advance(),this.createToken("^","^");case"(":return this.advance(),this.createToken("(","(");case")":return this.advance(),this.createToken(")",")");case"<":return this.advance(),this.createToken("<","<");case">":return this.advance(),this.createToken(">",">");case"[":return this.advance(),this.createToken("[","[");case"]":return this.advance(),this.createToken("]","]");case",":return this.advance(),this.createToken(",",",");case":":return this.advance(),this.createToken(":",":");case"?":return this.advance(),this.createToken("?","?");case"*":return this.advance(),this.createToken("*","*");case"+":return/[0-9]/.test(this.peek(1))?this.createToken("NUMBER_LITERAL",this.readNumber()):(this.advance(),this.createToken("+","+"));case"x":return/[0-9]/.test(this.peek(1))?(this.advance(),this.createToken("x","x")):(this.advance(),this.createToken("x","x"))}if(t==='"'||t==="'")return this.createToken("STRING_LITERAL",this.readStringLiteral());if(t==="`")return this.createToken("VERBATIM_STRING",this.readVerbatimString());if(/[0-9]/.test(t)||t==="-"&&/[0-9]/.test(this.peek(1))){let i=this.readNumber();return this.peek()==="x"&&/[0-9]/.test(this.peek(1)),this.createToken("NUMBER_LITERAL",i)}if(t==="\u221E")return this.advance(),this.createToken("INFINITY","\u221E");this.error(`Unexpected character: ${t}`)}tokenize(){let e=[];for(;!this.isEOF();){let t=this.nextToken();if(t&&(e.push(t),t.type==="EOF"))break}return e}peekToken(){if(this.tokens.length===0){let e=this.nextToken();e&&this.tokens.push(e)}return this.tokens[0]||this.createToken("EOF","")}consumeToken(){if(this.tokens.length===0){let e=this.nextToken();if(e)return e}return this.tokens.shift()||this.createToken("EOF","")}matchToken(e){return this.peekToken().type===e?(this.consumeToken(),!0):!1}expectToken(e){let t=this.consumeToken();return t.type!==e&&this.error(`Expected ${e}, got ${t.type}`),t}}});var Zs,Vp=k(()=>{Fp();Tr();Zs=class{lexer;typeResolver;current;constructor(e,t){this.lexer=new zs(e),this.typeResolver=t?.typeResolver??{forward:()=>{},resolve:()=>{},get names(){return[]}},this.current=this.lexer.consumeToken()}error(e,t){this.errorAtToken(this.current,e,t)}errorAtToken(e,t,i){let r=this.lexer.input,s=r.split(`
`)[e.line-1]||r,a=e.column,u=" ".repeat(Math.max(0,a-1))+"^",l=["","Invalid type",`|   ${s}`,`|   ${u}`,"|",`|   ${t}`];throw i&&l.push(`|   ${i}`),l.push(""),new Error(l.join(`
`))}advance(){let e=this.current;return this.current=this.lexer.consumeToken(),e}match(e){return this.current.type===e?(this.advance(),!0):!1}expect(e){return this.current.type!==e&&this.error(`Expected ${e}, got ${this.current.type}`),this.advance()}createNode(e,t={}){return{kind:e,position:this.current.position,line:this.current.line,column:this.current.column,...t}}parseType(){this.checkForNakedFunctionSignature();let e=this.parseUnionType();if(e||this.error("Expected a type"),this.current.type!=="EOF")if(this.current.type==="->"||this.current.type==="+"||this.current.type==="*"||this.current.type==="?")this.error("Function signatures must be enclosed in parentheses","For example `(x: number) -> number`");else if(this.current.type==="("){let t=this.lexer.input;t.includes("set(")||t.includes("collection(")||t.includes("list(")||t.includes("tuple(")?t.includes("set(")?this.error("Use `set<integer>` instead of `set(integer)`."):t.includes("collection(")?this.error("Use `collection<type>` instead of `collection(type)`.","For example `collection<number>`"):t.includes("list(")?this.error("Use `list<type>` instead of `list(type)`.","For example `list<number>`"):t.includes("tuple(")&&this.error("Use `tuple<type1, type2>` instead of `tuple(type1, type2)`.","For example `tuple<string, number>`"):this.error("Unexpected token after type")}else this.error("Unexpected token after type");return e}checkForNakedFunctionSignature(){if(this.current.type==="IDENTIFIER"){let e=this.lexer.saveState(),t=this.current;try{let i=this.current;if(this.advance(),this.current.type===":"){this.advance();let r=!1,o=0,s=10;for(;this.current.type!=="EOF"&&o<s;){if(this.current.type==="->"){r=!0;break}if(this.current.type==="+"||this.current.type==="*"||this.current.type==="?"){if(this.advance(),this.current.type==="->"){r=!0;break}o++}this.advance(),o++}r&&(this.lexer.restoreState(e),this.current=t,this.errorAtToken(i,"Function signatures must be enclosed in parentheses","For example `(z: string*) -> boolean`"))}this.lexer.restoreState(e),this.current=t}catch(i){if(this.lexer.restoreState(e),this.current=t,i instanceof Error&&i.message.includes("Function signatures must be enclosed"))throw i}}}parseUnionType(){let e=this.parseIntersectionType();if(!e)return;let t=[e];for(;this.match("|");){let i=this.parseIntersectionType();i||this.error("Expected type after |"),t.push(i)}return t.length===1?t[0]:this.createNode("union",{types:t})}parseIntersectionType(){let e=this.parsePrimaryType();if(!e)return;let t=[e];for(;this.match("&");){let i=this.parsePrimaryType();i||this.error("Expected type after &"),t.push(i)}return t.length===1?t[0]:this.createNode("intersection",{types:t})}parsePrimaryType(){if(this.match("!")){let e=this.parsePrimaryType();return e||this.error("Expected type after !"),this.createNode("negation",{type:e})}if(this.current.type==="("){let e=this.parseFunctionSignature();if(e)return e;if(this.match("(")){let t=this.parseUnionType();return t||this.error("Expected type after ("),this.expect(")"),this.createNode("group",{type:t})}}return this.parseListType()||this.parseTupleType()||this.parseRecordType()||this.parseDictionaryType()||this.parseSetType()||this.parseCollectionType()||this.parseExpressionType()||this.parseSymbolType()||this.parseNumericType()||this.parsePrimitiveType()||this.parseValue()||this.parseTypeReference()}parseFunctionSignature(){let e=this.lexer.saveState(),t=this.current,i=[];if(!this.match("("))return;try{if(!this.match(")")){do{let u=this.parseArgument();if(!u)throw new Error("Expected argument");i.push(u)}while(this.match(","));this.expect(")")}if(!this.match("->"))throw new Error("Expected -> for function signature")}catch(u){if(u instanceof Error&&u.message.includes("Invalid type"))throw u;this.lexer.restoreState(e),this.current=t;return}let r=this.parseUnionType();r||this.error("Expected return type after ->");let o=i.some(u=>u.modifier==="optional"),s=i.some(u=>u.modifier==="variadic_zero"||u.modifier==="variadic_one"),a=i.filter(u=>u.modifier==="variadic_zero"||u.modifier==="variadic_one").length;return o&&s&&this.error("Variadic arguments cannot be used with optional arguments"),a>1&&this.error("There can be only one variadic argument"),this.createNode("function_signature",{arguments:i,returnType:r})}parseArgument(){let e=this.parseNamedElement();if(!e)return;let t;return this.match("?")?t="optional":this.match("*")?t="variadic_zero":this.match("+")&&(t="variadic_one"),this.createNode("argument",{element:e,modifier:t})}parseNamedElement(){let e;if(this.current.type==="IDENTIFIER"||this.current.type==="VERBATIM_STRING"){let i=this.current;if(this.lexer.peekToken().type===":"){e=i.value,this.advance(),this.advance();let o=this.parseUnionType();return o?this.createNode("named_element",{name:e,type:o}):void 0}}let t=this.parseUnionType();if(t)return this.createNode("named_element",{name:void 0,type:t})}parseListType(){if(this.current.type==="IDENTIFIER"){let e=this.current,i=this.lexer.peekToken().type==="<";switch(e.value){case"list":return i?(this.advance(),this.parseListTypeImpl()):void 0;case"vector":return i?(this.advance(),this.parseVectorType()):(this.advance(),this.createNode("list",{elementType:this.createNode("primitive",{name:"number"}),dimensions:void 0}));case"matrix":return i?(this.advance(),this.parseMatrixType()):(this.advance(),this.createNode("matrix",{elementType:this.createNode("primitive",{name:"number"}),dimensions:[this.createNode("dimension",{size:-1}),this.createNode("dimension",{size:-1})]}));case"tensor":return i?(this.advance(),this.parseTensorType()):(this.advance(),this.createNode("list",{elementType:this.createNode("primitive",{name:"number"}),dimensions:void 0}));default:return}}}parseListTypeImpl(){let e=this.createNode("primitive",{name:"any"}),t;if(this.match("<")){if(t=this.parseDimensionWithX(),t||(t=this.parseDimensions()),!t){let i=this.parseUnionType();i&&(e=i,this.match("^")&&(t=this.parseDimensionWithX(),t||(t=this.parseDimensions())))}this.expect(">")}return this.createNode("list",{elementType:e,dimensions:t})}parseVectorType(){let e=this.createNode("primitive",{name:"number"}),t;if(this.match("<")){if(this.current.type==="NUMBER_LITERAL")t=parseInt(this.advance().value);else{let i=this.parseUnionType();i&&(e=i,this.match("^")&&(this.current.type==="NUMBER_LITERAL"?t=parseInt(this.advance().value):this.error("Expected number after ^")))}this.expect(">")}return this.createNode("vector",{elementType:e,size:t})}parseMatrixType(){let e=this.createNode("primitive",{name:"number"}),t;if(this.match("<")){if(t=this.parseDimensionWithX(),t||(t=this.parseDimensions()),!t){let i=this.parseUnionType();i&&(e=i,this.match("^")&&(t=this.parseDimensionWithX(),t||(t=this.parseDimensions())))}this.expect(">")}else t=[this.createNode("dimension",{size:null}),this.createNode("dimension",{size:null})];return this.createNode("matrix",{elementType:e,dimensions:t})}parseTensorType(){let e=this.createNode("primitive",{name:"number"});if(this.match("<")){let t=this.parseUnionType();t&&(e=t),this.expect(">")}return this.createNode("tensor",{elementType:e})}parseDimensions(){let e=[],t=this.parseDimension();if(t){for(e.push(t);this.match("x");){let i=this.parseDimension();i||this.error("Expected dimension after x"),e.push(i)}return e}}parseDimension(){if(this.match("?"))return this.createNode("dimension",{size:null});if(this.current.type==="NUMBER_LITERAL"){let e=parseInt(this.advance().value);return this.createNode("dimension",{size:e})}}parseDimensionWithX(){if(this.current.type==="NUMBER_LITERAL"){let e=[],t=parseInt(this.advance().value);if(e.push(this.createNode("dimension",{size:t})),this.current.type==="IDENTIFIER"&&this.current.value.startsWith("x")){let i=this.current.value,r=i.match(/x(\d+)/g);if(r&&r.join("")===i){this.advance();for(let o of r){let s=parseInt(o.substring(1));e.push(this.createNode("dimension",{size:s}))}}else(i==="x"||i.startsWith("x"))&&this.error("Expected a positive integer literal or `?` after x. For example: `2x3` or `2x?`")}if(e.length>1)return e}}parseTupleType(){if(this.current.type==="IDENTIFIER"&&this.current.value==="tuple"){if(this.lexer.peekToken().type!=="<")return;this.advance(),this.expect("<");let t=[];if(this.current.type!==">"){let i=this.parseNamedElement();i||this.error("Expected tuple element"),t.push(i);let r=i.name!==void 0;for(;this.match(",");){let o=this.parseNamedElement();o||this.error("Expected tuple element"),r&&!o.name&&this.error("All tuple elements should be named, or none. Previous elements were named, but this one isn't."),!r&&o.name&&this.error("All tuple elements should be named, or none. Previous elements were not named, but this one is."),t.push(o)}}return this.expect(">"),this.createNode("tuple",{elements:t})}}parseRecordType(){if(this.current.type==="IDENTIFIER"&&this.current.value==="record"){this.advance();let e=[];if(this.match("<")){if(this.current.type!==">")do{let t=this.parseRecordEntry();t||this.error("Expected record entry"),e.push(t)}while(this.match(","));this.expect(">")}return this.createNode("record",{entries:e})}}parseRecordEntry(){let e;if(this.current.type==="IDENTIFIER")e=this.advance().value;else if(this.current.type==="VERBATIM_STRING")e=this.advance().value;else return;this.expect(":");let t=this.parseUnionType();return t||this.error("Expected value type"),this.createNode("record_entry",{key:e,valueType:t})}parseDictionaryType(){if(this.current.type==="IDENTIFIER"&&this.current.value==="dictionary"){this.advance();let e=this.createNode("primitive",{name:"any"});if(this.match("<")){let t=this.parseUnionType();t&&(e=t),this.expect(">")}return this.createNode("dictionary",{valueType:e})}}parseSetType(){if(this.current.type==="IDENTIFIER"&&this.current.value==="set"){this.advance();let e=this.createNode("primitive",{name:"any"});if(this.match("<")){let t=this.parseUnionType();t&&(e=t),this.expect(">")}return this.createNode("set",{elementType:e})}}parseCollectionType(){if(this.current.type==="IDENTIFIER"){let e=this.current.value==="indexed_collection",t=this.current.value==="collection";if(e||t){this.advance();let i=this.createNode("primitive",{name:"any"});if(this.match("<")){let r=this.parseUnionType();r&&(i=r),this.expect(">")}return this.createNode("collection",{elementType:i,indexed:e})}}}parseExpressionType(){if(this.current.type==="IDENTIFIER"&&this.current.value==="expression"){if(this.lexer.peekToken().type!=="<")return;this.advance(),this.expect("<");let i=this.expect("IDENTIFIER").value;return this.expect(">"),this.createNode("expression",{operator:i})}}parseSymbolType(){if(this.current.type==="IDENTIFIER"&&this.current.value==="symbol"){if(this.lexer.peekToken().type!=="<")return;this.advance(),this.expect("<");let i=this.expect("IDENTIFIER").value;return this.expect(">"),this.createNode("symbol",{name:i})}}parseNumericType(){if(this.current.type==="IDENTIFIER"&&["real","finite_real","rational","finite_rational","integer","finite_integer"].includes(this.current.value)){let t=this.advance().value;if(this.match("<")){let i=this.parseValue();this.expect("..");let r=this.parseValue();return this.expect(">"),this.createNode("numeric",{baseType:t,lowerBound:i,upperBound:r})}return this.createNode("numeric",{baseType:t})}}parsePrimitiveType(){if(this.current.type==="IDENTIFIER"){let e=this.current.value;if(mi.includes(e))return this.advance(),this.createNode("primitive",{name:e})}}parseValue(){let e,t;switch(this.current.type){case"STRING_LITERAL":e=this.advance().value,t="string";break;case"NUMBER_LITERAL":e=parseFloat(this.advance().value),t="number";break;case"TRUE":this.advance(),e=!0,t="boolean";break;case"FALSE":this.advance(),e=!1,t="boolean";break;case"NAN":this.advance(),e=NaN,t="nan";break;case"INFINITY":case"PLUS_INFINITY":this.advance(),e=1/0,t="infinity";break;case"MINUS_INFINITY":this.advance(),e=-1/0,t="infinity";break;default:return}return this.createNode("value",{value:e,valueType:t})}parseTypeReference(){let e=this.current.type==="IDENTIFIER"&&this.current.value==="type";if(e&&this.advance(),this.current.type==="IDENTIFIER"){let t=this.current,i=this.advance().value;return this.typeResolver.resolve(i)?this.createNode("type_reference",{name:i,isForward:e}):e&&this.typeResolver.forward(i)?this.createNode("type_reference",{name:i,isForward:!0}):(e||this.errorAtToken(t,`Unknown type "${i}"`,"Syntax error. The type was not recognized."),this.createNode("type_reference",{name:i,isForward:e}))}}}});function $p(n,e){switch(n.kind){case"function_signature":return e.visitFunctionSignature(n);case"union":return e.visitUnionType(n);case"intersection":return e.visitIntersectionType(n);case"negation":return e.visitNegationType(n);case"group":return e.visitGroupType(n);case"list":return e.visitListType(n);case"vector":return e.visitVectorType(n);case"matrix":return e.visitMatrixType(n);case"tensor":return e.visitTensorType(n);case"tuple":return e.visitTupleType(n);case"record":return e.visitRecordType(n);case"dictionary":return e.visitDictionaryType(n);case"set":return e.visitSetType(n);case"collection":return e.visitCollectionType(n);case"expression":return e.visitExpressionType(n);case"symbol":return e.visitSymbolType(n);case"numeric":return e.visitNumericType(n);case"primitive":return e.visitPrimitiveType(n);case"type_reference":return e.visitTypeReference(n);case"value":return e.visitValue(n);default:throw new Error(`Unknown node kind: ${n.kind}`)}}var jp=k(()=>{});function Up(n,e){return new vu(e).buildType(n)}var vu,Gp=k(()=>{jp();vu=class{typeResolver;constructor(e){this.typeResolver=e??{forward:()=>{},resolve:()=>{},get names(){return[]}}}buildType(e){return $p(e,this)}visitFunctionSignature(e){let t=[],i=[],r,o;for(let u of e.arguments){let l=this.buildNamedElement(u.element);switch(u.modifier){case"optional":i.push(l);break;case"variadic_zero":r=l,o=0;break;case"variadic_one":r=l,o=1;break;default:t.push(l);break}}let s=this.buildType(e.returnType),a={kind:"signature",args:t.length>0?t:void 0,result:s};return i.length>0&&(a.optArgs=i),r&&(a.variadicArg=r,a.variadicMin=o),a}visitUnionType(e){return{kind:"union",types:e.types.map(i=>this.buildType(i))}}visitIntersectionType(e){return{kind:"intersection",types:e.types.map(i=>this.buildType(i))}}visitNegationType(e){return{kind:"negation",type:this.buildType(e.type)}}visitGroupType(e){return this.buildType(e.type)}visitListType(e){let t=this.buildType(e.elementType),i=e.dimensions?.map(r=>this.buildDimension(r));return{kind:"list",elements:t,dimensions:i}}visitVectorType(e){let t=this.buildType(e.elementType);return e.size!==void 0?{kind:"list",elements:t,dimensions:[e.size]}:{kind:"list",elements:t}}visitMatrixType(e){let t=this.buildType(e.elementType);if(e.dimensions){let i=e.dimensions.map(r=>this.buildDimension(r));return{kind:"list",elements:t,dimensions:i}}return{kind:"list",elements:t,dimensions:[-1,-1]}}visitTensorType(e){return{kind:"list",elements:this.buildType(e.elementType)}}visitTupleType(e){return{kind:"tuple",elements:e.elements.map(i=>this.buildNamedElement(i))}}visitRecordType(e){if(e.entries.length===0)return"record";let t={};for(let i of e.entries)t[i.key]=this.buildType(i.valueType);return{kind:"record",elements:t}}visitDictionaryType(e){let t=this.buildType(e.valueType);return this.isAnyType(t)?"dictionary":{kind:"dictionary",values:t}}visitSetType(e){let t=this.buildType(e.elementType);return this.isAnyType(t)?"set":{kind:"set",elements:t}}visitCollectionType(e){let t=this.buildType(e.elementType);return e.indexed?this.isAnyType(t)?"indexed_collection":{kind:"indexed_collection",elements:t}:this.isAnyType(t)?"collection":{kind:"collection",elements:t}}visitExpressionType(e){return{kind:"expression",operator:e.operator}}visitSymbolType(e){return{kind:"symbol",name:e.name}}visitNumericType(e){if(!e.lowerBound&&!e.upperBound)return e.baseType;let t=e.lowerBound?this.buildValue(e.lowerBound):-1/0,i=e.upperBound?this.buildValue(e.upperBound):1/0;return t===-1/0&&i===1/0?e.baseType:{kind:"numeric",type:e.baseType,lower:t,upper:i}}visitPrimitiveType(e){return e.name}visitTypeReference(e){let t=this.typeResolver.resolve(e.name);if(t)return t;if(e.isForward){let i=this.typeResolver.forward(e.name);if(i)return i}return e.name}visitValue(e){return{kind:"value",value:e.value}}buildNamedElement(e){let t=this.buildType(e.type);return e.name?{name:e.name,type:t}:{type:t}}buildDimension(e){return e.size??-1}buildValue(e){return e.value}isAnyType(e){return e==="any"||typeof e=="object"&&"kind"in e&&e.kind==="primitive"&&"name"in e&&e.name==="any"}}});function F(n,e){if(n!==void 0){if(hi(n))return n;if(typeof n=="string")try{let i=new Zs(n,{typeResolver:e}).parseType();return Up(i,e)}catch(t){throw new Error(`Failed to parse type "${n}": ${t instanceof Error?t.message:String(t)}`)}}}var Tn=k(()=>{Tr();gi();an();Eu();Vp();Gp()});function kb(n,e){return n===e?n:n==="nothing"||e==="nothing"?"nothing":n==="any"?e:e==="any"?n:n==="never"?e:e==="never"?n:n==="unknown"?e:e==="unknown"||w(n,e)?n:w(e,n)?e:Zp(n,e)}function Cb(n,e){return n===e?n:n==="any"||e==="any"?"any":n==="never"?e:e==="never"?n:n==="unknown"?e:e==="unknown"?n:n==="nothing"?e:e==="nothing"?n:w(n,e)?e:w(e,n)?n:Zp(n,e)}function Vi(...n){return n.length===0?"nothing":n.length===1?n[0]:n.reduce((e,t)=>kb(e,t))}function ve(...n){return n.length===0?"nothing":n.length===1?n[0]:n.reduce((e,t)=>Cb(e,t))}function Hs(n){return n=typeof n=="string"?F(n):n,typeof n!="string"&&n.kind==="signature"}function Mn(n){if(n){if(n==="function")return"any";if(typeof n!="string"&&n.kind==="signature")return n.result}}function Sn(n){if(n==="collection"||n==="indexed_collection"||n==="list"||n==="set"||n==="tuple"||n==="dictionary"||n==="record")return"any";if(typeof n!="string"){if(n.kind==="collection"||n.kind==="indexed_collection"||n.kind==="list"||n.kind==="set")return n.elements;if(n.kind==="tuple")return ve(...n.elements.map(e=>e.type));if(n.kind==="dictionary")return F(`tuple<string, ${n.values}>`);if(n.kind==="record")return F(`tuple<string, ${te(ve(...Object.values(n.elements)))}>`)}}function zp(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)}function hi(n){return typeof n=="string"?mi.includes(n):typeof n!="object"||!("kind"in n)?!1:n.kind==="signature"||n.kind==="union"||n.kind==="intersection"||n.kind==="negation"||n.kind==="tuple"||n.kind==="list"||n.kind==="record"||n.kind==="dictionary"||n.kind==="set"||n.kind==="function"||n.kind==="collection"||n.kind==="indexed_collection"||n.kind==="reference"}function Zp(n,e){return n===e?n:n==="any"||e==="any"?"any":n==="never"?e:e==="never"?n:n==="unknown"?e:e==="unknown"?n:n==="nothing"?e:e==="nothing"?n:Se(n,e,"non_finite_number")?"non_finite_number":Se(n,e,"finite_integer")?"finite_integer":Se(n,e,"integer")?"integer":Se(n,e,"finite_rational")?"finite_rational":Se(n,e,"rational")?"rational":Se(n,e,"finite_real")?"finite_real":Se(n,e,"real")?"real":Se(n,e,"imaginary")?"imaginary":Se(n,e,"finite_complex")?"finite_complex":Se(n,e,"complex")?"complex":Se(n,e,"finite_number")?"finite_number":Se(n,e,"number")?"number":Se(n,e,"list")?"list":Se(n,e,"record")?"record":Se(n,e,"dictionary")?"dictionary":Se(n,e,"set")?"set":Se(n,e,"tuple")?"tuple":Se(n,e,"indexed_collection")?"indexed_collection":Se(n,e,"collection")?"collection":Se(n,e,"scalar")?"scalar":Se(n,e,"value")?"value":Se(n,e,"function")?"function":Se(n,e,"expression")?"expression":"any"}function Se(n,e,t){return!!(w(n,t)&&w(e,t))}var an=k(()=>{Tn();Tr();gi();Nn()});var R,In=k(()=>{Nn();gi();Tn();an();R=class n{static unknown=new n("unknown");static number=new n("number");static non_finite_number=new n("non_finite_number");static finite_number=new n("finite_number");static finite_integer=new n("finite_integer");static finite_real=new n("finite_real");static string=new n("string");static dictionary=new n("dictionary");static setNumber=new n("set<number>");static setComplex=new n("set<complex>");static setImaginary=new n("set<imaginary>");static setReal=new n("set<real>");static setRational=new n("set<rational>");static setFiniteInteger=new n("set<finite_integer>");static setInteger=new n("set<integer>");type;static widen(...e){return new n(ve(...e.map(t=>t instanceof n?t.type:t)))}static narrow(...e){return new n(Vi(...e.map(t=>t instanceof n?t.type:t)))}constructor(e,t){typeof e=="string"?this.type=F(e,t):this.type=e}matches(e){return e instanceof n?w(this.type,e.type):w(this.type,e)}is(e){return w(this.type,e)&&w(e,this.type)}get isUnknown(){return this.type==="unknown"}toString(){return te(this.type)}toJSON(){return te(this.type)}[Symbol.toPrimitive](e){return e==="string"?this.toString():null}valueOf(){return te(this.type)}}});function Nu(n,e,t={}){let{contract:i=.125,step:r=1,power:o=2,atol:s=1e-16,rtol:a=s>0?0:Math.sqrt(Number.EPSILON),maxeval:u=1e6,breaktol:l=2}=t;if(!isFinite(e))return Nu(h=>n(1/h),1/e,{rtol:a,atol:s,maxeval:u,contract:Math.abs(i)>1?1/i:i,step:1/r,power:o});let c=r,f=Math.pow(1/i,o),p=n(e+c),d=[p],m=1/0,g=1;for(;g<u;){g+=1,c*=i,d.push(n(e+c));let h=f,x=1/0;for(let y=d.length-2;y>=0;y--){let v=d[y];d[y]=d[y+1]+(d[y+1]-d[y])/(h-1);let E=Math.abs(d[y]-v);x=Math.min(x,E),E<m&&(p=d[y],m=E),h*=f}if(x>l*m||!isFinite(x)||m<=Math.max(a*Math.abs(p),s))break}return[p,m]}var Jp=k(()=>{});function be(n){if(typeof n=="bigint")return n;if(typeof n=="number")return Number.isInteger(n)?n>=Number.MAX_SAFE_INTEGER&&n<=Number.MAX_SAFE_INTEGER?BigInt(n):be(n.toString()):null;if(n instanceof U)return n.isInteger()?be(n.toString()):null;let e=n.toLowerCase(),t=e.match(/([+-]?[0-9]*)(?:\.([0-9]+))?e([+-]?[0-9]+)$/);if(t){let o=parseInt(t[3])-(t[2]?t[2].length:0);if(o<0)return null;e=(t[1]??"")+(t[2]??"")+"0".repeat(o)}if(e.indexOf(".")>=0||!/^[+-]?[0-9]+$/.test(e))return null;try{return BigInt(e)}catch(r){return console.error(r.message),null}}var Vt=k(()=>{_n()});function Xp(n){if(Number.isInteger(n)&&n>=0&&n<Number.MAX_SAFE_INTEGER,n<=3)return{[n]:1};let e={},t=0;for(;n%2===0;)t+=1,n/=2;for(t>0&&(e[2]=t),t=0;n%3===0;)t+=1,n/=3;t>0&&(e[3]=t);let i=!1;for(;!i;){if(n===1)return e;let r=Math.sqrt(n);i=!0;for(let o=6;o<=r+6;o+=6){if(n%(o-1)===0){e[o-1]=(e[o-1]??0)+1,n/=o-1,i=!1;break}if(n%(o+1)===0){e[o+1]=(e[o+1]??0)+1,n/=o+1,i=!1;break}}}return e[n]!==void 0?e[n]+=1:e[n]=1,e}function Su(n){if(!Number.isInteger(n)||!Number.isFinite(n)||Number.isNaN(n)||n<=1)return!1;if(n<=Qp)return Tu.has(n);for(let e of Tu)if(n%e===0)return!1;return n<Yp&&Rb(n),Db(n,30)?void 0:!1}function Rb(n){if(n===1)return 1;if(n%2===0)return 2;if(n%3===0)return 3;if(n%5===0)return 5;let e=Math.floor(Math.sqrt(n)),t=7;for(;t<=e;){if(n%t===0)return t;if(n%(t+4)===0)return t+4;if(n%(t+6)===0)return t+6;if(n%(t+10)===0)return t+10;if(n%(t+12)===0)return t+12;if(n%(t+16)===0)return t+16;if(n%(t+22)===0)return t+22;if(n%(t+24)===0)return t+24;t+=30}return n}function Kp(n){if(n<=1)return!1;if(n<=Qp)return Su(Number(n));for(let e of Tu)if(n%BigInt(e)===BigInt(0))return!1;return n<Yp&&(n=Mb(n)),Pb(n,30)?void 0:!1}function Mb(n){if(n===BigInt(1))return BigInt(1);if(n%BigInt(2)===BigInt(0))return BigInt(2);if(n%BigInt(3)===BigInt(0))return BigInt(3);if(n%BigInt(5)===BigInt(0))return BigInt(5);let e=BigInt(Math.floor(Math.sqrt(Number(n)))),t=BigInt(7);for(;t<=e;){if(n%t===BigInt(0))return t;if(n%(t+BigInt(4))===BigInt(0))return t+BigInt(4);if(n%(t+BigInt(6))===BigInt(0))return t+BigInt(6);if(n%(t+BigInt(10))===BigInt(0))return t+BigInt(10);if(n%(t+BigInt(12))===BigInt(0))return t+BigInt(12);if(n%(t+BigInt(16))===BigInt(0))return t+BigInt(16);if(n%(t+BigInt(22))===BigInt(0))return t+BigInt(22);if(n%(t+BigInt(24))===BigInt(0))return t+BigInt(24);t+=BigInt(30)}return n}function Db(n,e){let t=0,i=n-1;for(;i%2===0;)i/=2,++t;e:do{let r=Math.pow(2+Math.floor(Math.random()*(n-3)),i)%n;if(!(r===1||r===n-1)){for(let o=t-1;o--;){if(r=r*r%n,r===1)return!1;if(r===n-1)continue e}return!1}}while(--e);return!0}function Pb(n,e){let t=0,i=n-BigInt(1);for(;i%BigInt(2)===BigInt(0);)i=i/BigInt(2),++t;e:do{let r=BigInt(2+Math.floor(Math.random()*(Number(n)-3)))**i%n;if(!(r===BigInt(1)||r===n-BigInt(1))){for(let o=t-1;o--;){if(r=r*r%n,r===BigInt(1))return!1;if(r===n-BigInt(1))continue e}return!1}}while(--e);return!0}var Yp,Tu,Qp,FN,Js=k(()=>{Vt();Yp=0x3ffffffffffe5,Tu=new Set([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999,2003,2011,2017,2027,2029,2039,2053,2063,2069,2081,2083,2087,2089,2099,2111,2113,2129,2131,2137,2141,2143,2153,2161,2179,2203,2207,2213,2221,2237,2239,2243,2251,2267,2269,2273,2281,2287,2293,2297,2309,2311,2333,2339,2341,2347,2351,2357,2371,2377,2381,2383,2389,2393,2399,2411,2417,2423,2437,2441,2447,2459,2467,2473,2477,2503,2521,2531,2539,2543,2549,2551,2557,2579,2591,2593,2609,2617,2621,2633,2647,2657,2659,2663,2671,2677,2683,2687,2689,2693,2699,2707,2711,2713,2719,2729,2731,2741,2749,2753,2767,2777,2789,2791,2797,2801,2803,2819,2833,2837,2843,2851,2857,2861,2879,2887,2897,2903,2909,2917,2927,2939,2953,2957,2963,2969,2971,2999,3001,3011,3019,3023,3037,3041,3049,3061,3067,3079,3083,3089,3109,3119,3121,3137,3163,3167,3169,3181,3187,3191,3203,3209,3217,3221,3229,3251,3253,3257,3259,3271,3299,3301,3307,3313,3319,3323,3329,3331,3343,3347,3359,3361,3371,3373,3389,3391,3407,3413,3433,3449,3457,3461,3463,3467,3469,3491,3499,3511,3517,3527,3529,3533,3539,3541,3547,3557,3559,3571,3581,3583,3593,3607,3613,3617,3623,3631,3637,3643,3659,3671,3673,3677,3691,3697,3701,3709,3719,3727,3733,3739,3761,3767,3769,3779,3793,3797,3803,3821,3823,3833,3847,3851,3853,3863,3877,3881,3889,3907,3911,3917,3919,3923,3929,3931,3943,3947,3967,3989,4001,4003,4007,4013,4019,4021,4027,4049,4051,4057,4073,4079,4091,4093,4099,4111,4127,4129,4133,4139,4153,4157,4159,4177,4201,4211,4217,4219,4229,4231,4241,4243,4253,4259,4261,4271,4273,4283,4289,4297,4327,4337,4339,4349,4357,4363,4373,4391,4397,4409,4421,4423,4441,4447,4451,4457,4463,4481,4483,4493,4507,4513,4517,4519,4523,4547,4549,4561,4567,4583,4591,4597,4603,4621,4637,4639,4643,4649,4651,4657,4663,4673,4679,4691,4703,4721,4723,4729,4733,4751,4759,4783,4787,4789,4793,4799,4801,4813,4817,4831,4861,4871,4877,4889,4903,4909,4919,4931,4933,4937,4943,4951,4957,4967,4969,4973,4987,4993,4999,5003,5009,5011,5021,5023,5039,5051,5059,5077,5081,5087,5099,5101,5107,5113,5119,5147,5153,5167,5171,5179,5189,5197,5209,5227,5231,5233,5237,5261,5273,5279,5281,5297,5303,5309,5323,5333,5347,5351,5381,5387,5393,5399,5407,5413,5417,5419,5431,5437,5441,5443,5449,5471,5477,5479,5483,5501,5503,5507,5519,5521,5527,5531,5557,5563,5569,5573,5581,5591,5623,5639,5641,5647,5651,5653,5657,5659,5669,5683,5689,5693,5701,5711,5717,5737,5741,5743,5749,5779,5783,5791,5801,5807,5813,5821,5827,5839,5843,5849,5851,5857,5861,5867,5869,5879,5881,5897,5903,5923,5927,5939,5953,5981,5987,6007,6011,6029,6037,6043,6047,6053,6067,6073,6079,6089,6091,6101,6113,6121,6131,6133,6143,6151,6163,6173,6197,6199,6203,6211,6217,6221,6229,6247,6257,6263,6269,6271,6277,6287,6299,6301,6311,6317,6323,6329,6337,6343,6353,6359,6361,6367,6373,6379,6389,6397,6421,6427,6449,6451,6469,6473,6481,6491,6521,6529,6547,6551,6553,6563,6569,6571,6577,6581,6599,6607,6619,6637,6653,6659,6661,6673,6679,6689,6691,6701,6703,6709,6719,6733,6737,6761,6763,6779,6781,6791,6793,6803,6823,6827,6829,6833,6841,6857,6863,6869,6871,6883,6899,6907,6911,6917,6947,6949,6959,6961,6967,6971,6977,6983,6991,6997,7001,7013,7019,7027,7039,7043,7057,7069,7079,7103,7109,7121,7127,7129,7151,7159,7177,7187,7193,7207,7211,7213,7219,7229,7237,7243,7247,7253,7283,7297,7307,7309,7321,7331,7333,7349,7351,7369,7393,7411,7417,7433,7451,7457,7459,7477,7481,7487,7489,7499,7507,7517,7523,7529,7537,7541,7547,7549,7559,7561,7573,7577,7583,7589,7591,7603,7607,7621,7639,7643,7649,7669,7673,7681,7687,7691,7699,7703,7717,7723,7727,7741,7753,7757,7759,7789,7793,7817,7823,7829,7841,7853,7867,7873,7877,7879,7883,7901,7907,7919]),Qp=7919;FN=[BigInt(4),BigInt(2),BigInt(4),BigInt(2),BigInt(4),BigInt(6),BigInt(2),BigInt(6)]});function Ir(n,e){if(n>=Number.MAX_SAFE_INTEGER)return[1,n];if(n===0)return[0,0];if(n===1)return[1,1];if(Number.isInteger(n)&&n>0&&n<Number.MAX_SAFE_INTEGER,e===2){let o=[[0,0],[1,1],[1,2],[1,3],[2,1],[1,5],[1,6],[1,7],[1,8],[3,1],[1,10],[1,11],[2,3],[1,13],[1,14],[1,15],[4,1],[1,17],[3,2],[1,19],[1,20]][n];if(o)return o}let t=Xp(n),i=1,r=1;for(let o of Object.keys(t)){let s=parseInt(o);i=i*Math.pow(s,Math.floor(t[o]/e)),r=r*Math.pow(s,t[o]%e)}return[i,r]}function un(n,e){if(n===0)return e;if(e===0||n===e)return n;if(!Number.isInteger(n)||!Number.isInteger(e))return NaN;for(;e!==0;)[n,e]=[e,n%e];return n<0?-n:n}function ji(n,e){return n*e/un(n,e)}function wu(n){if(!Number.isInteger(n)||n<0)return NaN;if(n>=170)return 1/0;let e=1;for(let t=2;t<=n;t++)e=e*t;return e}function nd(n){if(!Number.isInteger(n)||n<0)return NaN;if(n<0)return NaN;if(n<=1)return 1;let e=n;for(;n>2;)n-=2,e*=n;return e}function Au(n,e=Bu){return typeof n=="number"&&Math.abs(n)<=e?0:n}function td(n,e,t=.1){return(n(e-4*t)/280-4*n(e-3*t)/105+n(e-2*t)/5-4*n(e-t)/5+4*n(e+t)/5-n(e+2*t)/5+4*n(e+3*t)/105-n(e+4*t)/280)/t}function xi(n,e,t=1){if(t===0){let o=xi(n,e,-1),s=xi(n,e,1);return o===void 0||s===void 0?NaN:Math.abs(o-s)>1e-5?NaN:(o+s)/2}let[i,r]=Nu(n,e,{step:t>0?1:-1});return i}function*ku(){yield[0,1];for(let n=1;;n++)for(let e=0;e<=n;e++){let t=n-e;t!==0&&un(e,t)===1&&(yield[e,t],yield[-e,t])}}function*id(){yield[0,1];for(let n=1;;n++)for(let e=0;e<=n;e++){let t=n-e;t!==0&&un(e,t)===1&&(yield[e,t])}}function*rd(){yield[0,0];for(let n=1;;n++)for(let e=0;e<=n;e++){let t=n-e;if(t===0||un(e,t)!==1)continue;let i=e/t;for(let r=0;r<=n;r++){let o=n-r;if(o===0||un(r,o)!==1)continue;let s=r/o;yield[i,s],yield[-i,s],yield[i,-s],yield[-i,-s]}}}function*od(){yield 0;for(let n=1;;n++)yield n,yield-n}var Iu,Ob,Et,Bu,K,ed,$i,en=k(()=>{Jp();Js();Iu=21,Ob=53,Et=Math.floor(Math.log10(Math.pow(2,Ob))),Bu=1e-10,K=1e6,ed=1024,$i=1e4});function $t(n){return!!(typeof n=="number"||yi(n)||typeof n=="string"&&Un(n))}function yi(n){return n!==null&&typeof n=="object"&&"num"in n}function Br(n){return n!==null&&typeof n=="object"&&"sym"in n}function Mu(n){return n!==null&&typeof n=="object"&&"str"in n}function ad(n){return n!==null&&typeof n=="object"&&"dict"in n&&typeof n.dict=="object"&&!Array.isArray(n.dict)&&n.dict!==null}function wr(n){return n!==null&&typeof n=="object"&&"fn"in n&&Array.isArray(n.fn)&&n.fn.length>0&&typeof n.fn[0]=="string"}function Lb(n){return n!==null&&typeof n=="object"&&("fn"in n||"num"in n||"sym"in n||"str"in n)}function ud(n){return Lb(n)&&(n.latex!==void 0||n.wikidata!==void 0)}function se(n){return n==null?null:typeof n=="object"&&"str"in n?n.str:typeof n!="string"?null:n.length>=2&&n.at(0)==="'"&&n.at(-1)==="'"?n.substring(1,n.length-1):Un(n)||Bn(n)?null:n}function Du(n){if(n==null||se(n)!==null)return null;let e=S(n);return e?[e,...A(n).map(t=>Du(t)).filter(t=>t!==null)]:n}function S(n){return Array.isArray(n)?n[0]:n==null?"":wr(n)?n.fn[0]:""}function A(n){return Array.isArray(n)?n.slice(1):n!==void 0&&wr(n)?n.fn.slice(1):[]}function b(n,e){return Array.isArray(n)?n[e]??null:n===null||!wr(n)?null:n.fn[e]??null}function de(n){return n==null?0:Array.isArray(n)?Math.max(0,n.length-1):wr(n)?Math.max(0,n.fn.length-1):0}function Pu(n){return n==null?null:S(n)==="Hold"?b(n,1):n}function M(n){return typeof n=="string"&&Bn(n)?n.length>=2&&n.at(0)==="`"&&n.at(-1)==="`"?n.slice(1,-1):n:n==null?null:Br(n)?n.sym:null}function sd(n){let e=S(n);if(e==="KeyValuePair"||e==="Tuple"||e==="Pair"){let[t,i]=A(n),r=se(t);return r?[r,i??"Nothing"]:null}return null}function Ou(n){if(n===null)return null;if(ad(n))return n;let e=sd(n);if(e)return{[e[0]]:e[1]};if(S(n)==="Dictionary"){let t={},i=A(n);for(let r=1;r<de(n);r++){let o=sd(i[r]);o&&(t[o[0]]=Fb(o[1])??"Nothing")}return{dict:t}}return null}function Lu(n){return{dict:Object.fromEntries(Object.entries(n).map(([t,i])=>[t,Ru(i)??"Nothing"]))}}function qb(n){if(n=n.toLowerCase().replace(/[nd]$/,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,""),n==="nan")return NaN;if(/^(infinity|\+infinity|oo|\+oo)$/i.test(n))return 1/0;if(/^(-infinity|-oo)$/.test(n))return-1/0;if(/\([0-9]+\)/.test(n)){let[e,t,i,r]=n.match(/(.+)\(([0-9]+)\)(.*)$/)??[];n=t+i.repeat(Math.ceil(16/i.length))+(r??"")}return parseFloat(n)}function z(n){return typeof n=="number"?n:typeof n=="string"&&Un(n)?qb(n):n!==void 0&&yi(n)?z(n.num):null}function Ar(n){if(n==null)return null;if(M(n)==="Half")return[1,2];let e=S(n);if(!e)return null;let t=null,i=null;if(e==="Negate"){let r=Ar(A(n)[0]);if(r)return[-r[0],r[1]]}if(e==="Rational"||e==="Divide"){let[r,o]=A(n);t=z(r)??NaN,i=z(o)??NaN}if(e==="Power"){let[r,o]=A(n),s=z(o);s===1?(t=z(r),i=1):s===-1&&(t=1,i=z(r))}if(e==="Multiply"){let[r,o]=A(n);if(S(o)==="Power"){let[s,a]=A(o);z(a)===-1&&(t=z(r),i=z(s))}}return t===null||i===null?null:Number.isInteger(t)&&Number.isInteger(i)?[t,i]:null}function Ys(n,e){let t=null;if(Array.isArray(n)&&(t=n),wr(n)&&(t=n.fn),t===null)return[];let i=1,r=[];for(;i<t.length;)r.push(e(t[i])),i+=1;return r}function kr(n,e,t){let i=S(e),r=S(t);return i===n&&r===n?[n,...A(e),...A(t)]:i===n?[n,...A(e),t]:r===n?[n,e,...A(t)]:[n,e,t]}function bi(n){if(n==null)return null;let e=S(n);if(e==="Delimiter"){if(n=b(n,1),n===null)return[];if(e=S(n),e!=="Sequence")return[n]}return e!=="Sequence"?null:A(n)}function fe(n){return n==null||n==="Nothing"?!0:S(n)==="Sequence"&&de(n)===0}function ne(n){return fe(n)?Bo:n}function Cu(n){return n[0]==="Square"?Cu(n.slice(1))+2:n.reduce((e,t)=>e+wo(t),0)}function wo(n){if(n===null)return 0;if(typeof n=="number"||typeof n=="string"||$t(n)||Br(n)||Mu(n))return 1;if(Array.isArray(n))return Cu(n);if("fn"in n)return Cu(n.fn);let e=Ou(n);if(e){let t=Object.keys(e);return 1+t.length+t.reduce((i,r)=>i+wo(e[r]),0)}return 0}function Un(n){return/^(nan|oo|\+oo|-oo|infinity|\+infinity|-infinity)$/i.test(n)||/^[+-]?(0|[1-9][0-9]*)(\.[0-9]+)?(\([0-9]+\))?([eE][+-]?[0-9]+)?$/.test(n)}function Bn(n){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n)||n.length>=2&&n[0]==="`"&&n[n.length-1]==="`"}function Qs(n){return n.length>=2&&n[0]==="'"&&n[n.length-1]==="'"?!0:!Un(n)&&!Bn(n)}function Ru(n){if(typeof n=="string")return{str:n};if(typeof n=="number")return{num:n.toString()};if(typeof n=="boolean")return n?"True":"False";if(Array.isArray(n))return["List",...n.map(e=>Ru(e)??"Nothing")];if(n===null)return null;if(typeof n=="object"){let e={};for(let t in n)e[t]=Ru(n[t])??"Nothing";return{dict:e}}return wr(n)||Br(n)||yi(n)||Mu(n)||ad(n)?n:null}function Fb(n){return n==null?null:Mu(n)?n.str:yi(n)?parseFloat(n.num):Br(n)?n.sym:typeof n=="string"||typeof n=="number"?n:Array.isArray(n)?{fn:n}:n}var Bo,Ye=k(()=>{Bo=["Error","'missing'"]});function Vb(n){let e=[];for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);if(i>=55296&&i<=56319){let r=n.charCodeAt(t+1);if(r>=56320&&r<=57343){let o=i-55296,s=r-56320;i=2**16+o*2**10+s,t++}}e.push(i)}return e}function cd(n){return n===Xs||n===65038||n===65039||n>=127995&&n<=128e3||n>=129456&&n<=129460||n>=917536&&n<=917632}function $b(n){return n>=ld[0]&&n<=ld[1]}function fd(n){if(/^[\u0020-\u00FF]*$/.test(n))return n;let e=[],t=Vb(n),i=0;for(;i<t.length;){let r=t[i++],o=t[i];if(o===Xs){let s=i-1;for(i+=2;t[i]===Xs;)i+=2;e.push(String.fromCodePoint(...t.slice(s,2*i-s+1)))}else if(cd(o)){let s=i-1;for(;cd(t[i]);)i+=t[i]===Xs?2:1;e.push(String.fromCodePoint(...t.slice(s,2*i-s-1)))}else $b(r)?(i+=1,e.push(String.fromCodePoint(...t.slice(i-2,2)))):e.push(String.fromCodePoint(r))}return e}var Xs,ld,pd=k(()=>{Xs=8205,ld=[127462,127487]});function jb(n,e){let t=n.next();if(!t)return[];let i=[];if(t!=="\\relax"){if(t==="\\noexpand")t=n.next(),t&&i.push(t);else if(t==="\\obeyspaces")n.obeyspaces=!0;else if(t==="\\space"||t==="~")i.push("<space>");else if(t==="\\bgroup")i.push("<{>");else if(t==="\\egroup")i.push("<}>");else if(t==="\\string")t=n.next(),t&&(t[0]==="\\"?Array.from(t).forEach(r=>i.push(r==="\\"?"\\backslash":r)):t==="<{>"?i.push("\\{"):t==="<space>"?i.push("~"):t==="<}>"&&i.push("\\}"));else if(t==="\\csname"){for(;n.peek()==="<space>";)n.next();let r="",o=!1,s=[];do{if(s.length===0)if(/^#[0-9?]$/.test(n.peek())){let a=n.get().slice(1);s=Ve(e?.[a]??e?.["?"]??"\\placeholder{}",e),t=s[0]}else t=n.next(),s=t?[t]:[];o=s.length===0,!o&&t==="\\endcsname"&&(o=!0,s.shift()),o||(o=t==="<$>"||t==="<$$>"||t==="<{>"||t==="<}>"||!!t&&t.length>1&&t[0]==="\\"),o||(r+=s.shift())}while(!o);r&&i.push("\\"+r),i=i.concat(s)}else if(t!=="\\endcsname")if(t.length>1&&t[0]==="#"){let r=t.slice(1);i=i.concat(Ve(e?.[r]??e?.["?"]??"\\placeholder{}",e))}else i.push(t)}return i}function Ve(n,e=[]){let t=n.toString().split(/\r?\n/),i="",r="";for(let a of t){i+=r,r=" ";let u=a.match(/((?:\\%)|[^%])*/);u!==null&&(i+=u[0])}let o=new qu(i),s=[];do s.push(...jb(o,e));while(!o.end());return s}function Ks(n){return Ve(n).length}function C(n){let e="",t="";for(let i of n)i!=null&&(typeof i=="string"&&(/[a-zA-Z]/.test(i[0])&&(t+=e),/\\[a-zA-Z]+\*?$/.test(i)?e=" ":e=""),t+=i.toString());return t}function Ei(n,e,t){return e.includes(n)&&(e=`{${e}}`),/^[0-9]$/.test(t)?`${e}${n}${t}`:`${e}${n}{${t}}`}function ot(n){let e=[];if(Array.isArray(n))for(let i of n)Array.isArray(i)?e=[...e,...i]:e.push(i);else e=[n];return C(e.map(i=>({"<space>":" ","<$$>":"$$","<$>":"$","<{>":"{","<}>":"}"})[i]??i))}var qu,Gn=k(()=>{pd();qu=class{s;pos;obeyspaces=!1;constructor(e){e=e.replace(/[\u200E\u200F\u2066-\u2069\u202A-\u202E]/g,""),e=e.replace(/\u2212/g,"-"),this.s=fd(e),this.pos=0}end(){return this.pos>=this.s.length}get(){return this.pos<this.s.length?this.s[this.pos++]:""}peek(){return this.s[this.pos]}match(e){let t;return typeof this.s=="string"?t=e.exec(this.s.slice(this.pos)):t=e.exec(this.s.slice(this.pos).join("")),t?.[0]?(this.pos+=t[0].length,t[0]):null}next(){if(this.end())return null;if(!this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]+/))return"<space>";if(this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]/))return"<space>";let e=this.get();if(e==="\\"){if(!this.end()){let t=this.match(/^[a-zA-Z]+/);if(t)this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]*/);else if(t=this.get(),t===" ")return"<space>";return"\\"+t}}else{if(e==="{")return"<{>";if(e==="}")return"<}>";if(e==="^"){if(this.peek()==="^"){this.get();let t=this.match(/^(\^(\^(\^(\^[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f][0-9a-f]/);if(t)return String.fromCodePoint(parseInt(t.slice(t.lastIndexOf("^")+1),16))}return e}else if(e==="#"){if(!this.end()){let t=!1;if(/[0-9?]/.test(this.peek())&&(t=!0,this.pos+1<this.s.length)){let i=this.s[this.pos+1];t=/[^0-9A-Za-z]/.test(i)}return t?"#"+this.get():"#"}}else if(e==="$")return this.peek()==="$"?(this.get(),"<$$>"):"<$>"}return e}}});function dd(n){return!("kind"in n)||n.kind==="expression"}function md(n){return"kind"in n&&n.kind==="symbol"}function ko(n){return"kind"in n&&n.kind==="matchfix"}function ju(n){return"kind"in n&&n.kind==="infix"}function ea(n){return"kind"in n&&n.kind==="prefix"}function Uu(n){return"kind"in n&&n.kind==="postfix"}function gd(n){return"kind"in n&&n.kind==="environment"}var W,Ao,jt,Ae,wn,Ut,Fu,Vu,$u,Gt=k(()=>{W=245,Ao=260,jt=270,Ae=275,wn=390,Ut=600,Fu=650,Vu=700,$u=810});function xd(n,e){return"normal"}function yd(n,e){return"normal"}function bd(n,e){return e>2?"solidus":"radical"}function Ed(n,e){if(e>3)return"inline-solidus";if(S(n)==="Divide"){let[t,i]=A(n),[r,o]=[wo(t),wo(i)];if(o<=2&&r>5)return"factor";let s=S(i);if(r<=2&&o>5&&s!=="Sqrt"&&s!=="Root")return"reciprocal"}return"quotient"}function vd(n,e){return"boolean"}function _d(n,e){return"solidus"}function Nd(n,e){return"compact"}function Cr(n,e,t){n.indexOf("#1")<0&&n.indexOf("#2")<0&&(n=`#1 ${n} #2`);let i=n.split(/(#\d+)/).filter(r=>r.trim()!=="").map(r=>r.trim());return C(i.map(r=>{switch(r){case"#1":return e;case"#2":return t;default:return r}}))}var Gu=k(()=>{Ye();Gn()});var Ui,na=k(()=>{Gt();Ui=[{latexTrigger:["\\not","<"],kind:"infix",associativity:"any",precedence:246,parse:"NotLess"},{name:"NotLess",latexTrigger:["\\nless"],kind:"infix",associativity:"any",precedence:246},{latexTrigger:["<"],kind:"infix",associativity:"any",precedence:245,parse:"Less"},{name:"Less",latexTrigger:["\\lt"],kind:"infix",associativity:"any",precedence:245},{latexTrigger:["<","="],kind:"infix",associativity:"any",precedence:241,parse:"LessEqual"},{name:"LessEqual",latexTrigger:["\\le"],kind:"infix",associativity:"any",precedence:241},{latexTrigger:["\\leq"],kind:"infix",associativity:"any",precedence:241,parse:"LessEqual"},{latexTrigger:["\\leqslant"],kind:"infix",associativity:"any",precedence:W+5,parse:"LessEqual"},{name:"LessNotEqual",latexTrigger:["\\lneqq"],kind:"infix",associativity:"any",precedence:W},{name:"NotLessNotEqual",latexTrigger:["\\nleqq"],kind:"infix",associativity:"any",precedence:W},{name:"LessOverEqual",latexTrigger:["\\leqq"],kind:"infix",associativity:"any",precedence:W+5},{name:"GreaterOverEqual",latexTrigger:["\\geqq"],kind:"infix",associativity:"any",precedence:W+5,parse:"GreaterEqual"},{name:"Equal",latexTrigger:["="],kind:"infix",associativity:"right",precedence:W},{latexTrigger:["*","="],kind:"infix",associativity:"right",precedence:W,parse:"StarEqual"},{name:"StarEqual",latexTrigger:["\\star","="],kind:"infix",associativity:"right",precedence:W},{name:"PlusEqual",latexTrigger:["+","="],kind:"infix",associativity:"right",precedence:W},{name:"MinusEqual",latexTrigger:["-","="],kind:"infix",associativity:"right",precedence:W},{name:"SlashEqual",latexTrigger:["/","="],kind:"infix",associativity:"right",precedence:W},{name:"EqualEqual",latexTrigger:["=","="],kind:"infix",associativity:"right",precedence:W},{name:"EqualEqualEqual",latexTrigger:["=","=","="],kind:"infix",associativity:"right",precedence:W+5},{name:"TildeFullEqual",latexTrigger:["\\cong"],kind:"infix",associativity:"right",precedence:W},{name:"NotTildeFullEqual",latexTrigger:["\\ncong"],kind:"infix",associativity:"right",precedence:W},{name:"Approx",latexTrigger:["\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"NotApprox",latexTrigger:["\\not","\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"ApproxEqual",latexTrigger:["\\approxeq"],kind:"infix",associativity:"right",precedence:W},{name:"NotApproxEqual",latexTrigger:["\\not","\\approxeq"],kind:"infix",associativity:"right",precedence:250},{name:"NotEqual",latexTrigger:["\\ne"],kind:"infix",associativity:"right",precedence:255},{name:"Unequal",latexTrigger:["!","="],kind:"infix",associativity:"right",precedence:W},{name:"GreaterEqual",latexTrigger:["\\ge"],kind:"infix",associativity:"right",precedence:242},{latexTrigger:["\\geq"],kind:"infix",associativity:"right",precedence:242,parse:"GreaterEqual"},{latexTrigger:[">","="],kind:"infix",associativity:"right",precedence:243,parse:"GreaterEqual"},{latexTrigger:["\\geqslant"],kind:"infix",associativity:"right",precedence:W+5,parse:"GreaterEqual"},{name:"GreaterNotEqual",latexTrigger:["\\gneqq"],kind:"infix",associativity:"right",precedence:W},{name:"NotGreaterNotEqual",latexTrigger:["\\ngeqq"],kind:"infix",associativity:"right",precedence:W},{latexTrigger:[">"],kind:"infix",associativity:"right",precedence:245,parse:"Greater"},{name:"Greater",latexTrigger:["\\gt"],kind:"infix",associativity:"right",precedence:245},{name:"NotGreater",latexTrigger:["\\ngtr"],kind:"infix",associativity:"right",precedence:244},{latexTrigger:["\\not",">"],kind:"infix",associativity:"right",precedence:244,parse:"NotGreater"},{name:"RingEqual",latexTrigger:["\\circeq"],kind:"infix",associativity:"right",precedence:W},{name:"TriangleEqual",latexTrigger:["\\triangleq"],kind:"infix",associativity:"right",precedence:W},{name:"DotEqual",latexTrigger:["\\doteq"],kind:"infix",associativity:"right",precedence:W+5},{name:"DotEqualDot",latexTrigger:["\\doteqdot"],kind:"infix",associativity:"right",precedence:W+5},{name:"FallingDotEqual",latexTrigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:W+5},{name:"RisingDotEqual",latexTrigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:W+5},{name:"QuestionEqual",latexTrigger:["\\questeq"],kind:"infix",associativity:"right",precedence:W},{name:"MuchLess",latexTrigger:["\\ll"],kind:"infix",associativity:"right",precedence:W},{name:"MuchGreater",latexTrigger:["\\gg"],kind:"infix",associativity:"right",precedence:W},{name:"Precedes",latexTrigger:["\\prec"],kind:"infix",associativity:"right",precedence:W},{name:"Succeeds",latexTrigger:["\\succ"],kind:"infix",associativity:"right",precedence:W},{name:"PrecedesEqual",latexTrigger:["\\preccurlyeq"],kind:"infix",associativity:"right",precedence:W},{name:"SucceedsEqual",latexTrigger:["\\curlyeqprec"],kind:"infix",associativity:"right",precedence:W},{name:"NotPrecedes",latexTrigger:["\\nprec"],kind:"infix",associativity:"right",precedence:W},{name:"NotSucceeds",latexTrigger:["\\nsucc"],kind:"infix",associativity:"right",precedence:W},{name:"Between",latexTrigger:["\\between"],kind:"infix",associativity:"right",precedence:W+5}]});function Rr(n){return typeof n=="string"?n.startsWith("$")&&n.endsWith("$"):!1}function vi(n){if(typeof n=="number")return n.toString();if(typeof n=="string"){let e=n.trim();if(e.startsWith("$$")&&e.endsWith("$$"))return e.slice(2,-2);if(e.startsWith("$")&&e.endsWith("$"))return e.slice(1,-1)}return Array.isArray(n)?vi(C(n)):null}function Dn(n){return typeof n!="string"?!1:Ui.some(e=>e.name===n)}function st(n){return typeof n!="string"?!1:["Less","LessEqual","Greater","GreaterEqual"].includes(n)}function Mr(n){return typeof n!="string"?!1:["Equal","NotEqual"].includes(n)}var Pn=k(()=>{Gn();na()});function Zu(n,e,t,i,r){if(e&&e.minPrec>=i)return null;let o=t?[t]:["Nothing"],s=!1;for(;!s;){for(s=!0,n.skipSpace();n.match(r);)o.push("Nothing"),n.skipSpace();if(n.atTerminator(e))o.push("Nothing");else{let a=n.parseExpression({...e,minPrec:i});o.push(a??"Nothing"),s=a===null}s||(n.skipSpace(),s=!n.match(r))}return o}function vt(n=""){return(e,t)=>{if(!t)return"";let i=A(t);if(i.length===0)return"";if(i.length===1)return e.serialize(i[0]);n={"&":"\\&",":":"\\colon","|":"\\mvert","-":"-","\xB7":"\\cdot","\u2012":"-","\u2013":"--","\u2014":"---","\u2015":"-","\u2022":"\\bullet","\u2026":"\\ldots"}[n]??n;let r=i.reduce((o,s)=>(o.push(e.serialize(s),n),o),[]);return r.pop(),C(r)}}function Zt(n,e){if(!n.match("<{>"))return"''";let t=[],i="",r=null,o=()=>{r!==null&&i?t.push(["Annotated",`'${i}'`,Lu(r)]):i&&t.push(`'${i}'`),i="",r=null};for(;!n.atEnd&&!n.match("<}>");)if(n.peek==="<{>")o(),t.push(Zt(n));else if(n.match("\\textbf"))o(),t.push(Zt(n,{fontWeight:"bold"}));else if(n.match("\\textmd"))o(),t.push(Zt(n,{fontStyle:"normal"}));else if(n.match("\\textup"))o(),t.push(Zt(n,{fontStyle:"normal"}));else if(n.match("\\textsl"))o(),t.push(Zt(n,{fontStyle:"italic"}));else if(n.match("\\textit"))o(),t.push(Zt(n,{fontStyle:"italic"}));else if(n.match("\\texttt"))o(),t.push(Zt(n,{fontFamily:"monospace"}));else if(n.match("\\textsf"))o(),t.push(Zt(n,{fontFamily:"sans-serif"}));else if(n.match("\\textcolor")){let a=n.index,u=n.parseStringGroup(),l=n.parseExpression();u!==null&&l!==null?t.push(["Annotated",l,{dict:{color:u}}]):(n.index=a,i+="\\textcolor")}else if(n.match("\\color")){let a=n.parseStringGroup();a!==null&&(o(),r={color:a})}else if(n.match("<space>"))i+=" ";else if(n.match("<$>")){let a=n.index,u=n.parseExpression()??"Nothing";n.skipSpace(),n.match("<$>")?t.push(u):(i+="$",n.index=a)}else if(n.match("<$$>")){let a=n.index,u=n.parseExpression()??"Nothing";n.skipSpace(),n.match("<$$>")?t.push(u):(i+="$$",n.index=a)}else{let a=n.parseChar()??n.nextToken();i+={"\\enskip":"\u2002","\\enspace":"\u2002","\\quad":"\u2003","\\qquad":"\u2003\u2003","\\space":"\u2003","\\ ":"\u2003","\\;":"\u2004","\\,":"\u2009","\\:":"\u205F","\\!":"","\\{":"{","\\}":"}","\\$":"$","\\&":"&","\\#":"#","\\%":"%","\\_":"_","\\textbackslash":"\\","\\textasciitilde":"~","\\textasciicircum":"^","\\textless":"<","\\textgreater":">","\\textbar":"|","\\textunderscore":"_","\\textbraceleft":"{","\\textbraceright":"}","\\textasciigrave":"`","\\textquotesingle":"'","\\textquotedblleft":"\u201C","\\textquotedblright":"\u201D","\\textquotedbl":'"',"\\textquoteleft":"\u2018","\\textquoteright":"\u2019","\\textbullet":"\u2022","\\textdagger":"\u2020","\\textdaggerdbl":"\u2021","\\textsection":"\xA7","\\textparagraph":"\xB6","\\textperiodcentered":"\xB7","\\textellipsis":"\u2026","\\textemdash":"\u2014","\\textendash":"\u2013","\\textregistered":"\xAE","\\texttrademark":"\u2122","\\textdegree":"\xB0"}[a]??a}o();let s;return t.length===1?s=t[0]:t.every(a=>se(a)!==null)?s="'"+t.map(a=>se(a)).join()+"'":s=["Text",...t],e?["Annotated",s,Lu(e)]:s}function Kb(n,e){return e===null?"":C(Ys(e,t=>{let i=se(t);return i===null?n.serialize(t):i==="<{>"?"{":i==="<}>"?"}":i==="<$>"?"$":i==="<$$>"?"$$":i==="<space>"?" ":i}))}function e1(n){return n===null?"":n.replace(/[{}\[\]\\:\-\$%]/g,e=>({"{":"\\lbrace ","}":"\\rbrace ","[":"\\lbrack ","]":"\\rbrack ",":":"\\colon ","\\":"\\backslash "})[e]??"\\"+e)}function n1(n,e){let t=b(e,2);return t?S(t)==="LatexString"?se(b(t,1))??"":S(t)==="Hold"?n.serialize(b(t,1)):n.serialize(t):""}function zt(n,e,t){for(;!n.atEnd;)if(n.match("'")||n.match("\\prime"))t++;else if(n.match("\\doubleprime"))t+=2;else if(n.match("\\tripleprime"))t+=3;else break;let i=S(e);if(i==="Derivative"||i==="Prime"){let a=z(b(e,2))??1;return[i,ne(b(e,1)),a+t]}let r=M(e),o=r&&n.getSymbolType(r).matches("function")||S(e);n.skipSpace();let s=n.parseArguments("enclosure");if(s&&s.length>0){let a=s[0],u=M(a)??"x",c=typeof e=="string"?[e,...s]:["Apply",e,...s];for(let f=0;f<t;f++)c=["D",c,u];return c}return o?t===1?["Derivative",e]:["Derivative",e,t]:t===1?["Prime",ne(e)]:["Prime",ne(e),t]}function t1(n,e){if(fe(e))return["Delimiter"];let t=S(e);if(t==="Delimiter"&&b(e,2)!==null){let i=se(b(e,2));if(i?.length===1)return["Delimiter",b(e,1)??"Nothing",{str:`(${i})`}]}return t==="Matrix"&&(se(b(e,2))??"..")===".."?["Matrix",b(e,1)]:["Delimiter",e]}function Md(n,e){if(fe(e))return["List"];let t=S(e);if(t==="Range"||t==="Linspace")return e;if(t==="Sequence")return["List",...A(e)];if(t==="Delimiter"){let i=se(b(e,2))??"...";if(i===";"||i===".;.")return["List",...(A(b(e,1))??[]).map(r=>Md(n,r))];if(i===","||i===".,.")return e=b(e,1),S(e)==="Sequence"?["List",...A(e)]:["List",e??"Nothing"]}return["List",e]}function i1(n,e){return de(e)>1&&A(e).every(t=>{let i=S(t);return Mr(i)||st(i)})?C(["\\begin{cases}",vt("\\\\")(n,e),"\\end{cases}"]):C(["\\bigl\\lbrack",vt(", ")(n,e),"\\bigr\\rbrack"])}function r1(n,e){if(e===null)return null;let t=n.parseExpression({minPrec:270});if(t===null)return null;if(S(t)==="Range"){let i=b(t,1),r=b(t,2);return i&&r?["Range",e,r,["Subtract",i,e]]:null}return["Range",e,t]}function ta(n,e){let t=M(e);if(t&&t.includes("_")){let o=t.indexOf("_"),s=t.substring(0,o),a=t.substring(o+1),u=parseInt(a,10),l=!isNaN(u)&&String(u)===a?u:a;e=["Subscript",s,l]}if(S(e)==="InvisibleOperator"&&de(e)===2&&S(b(e,2))==="Delimiter"){let o=M(b(e,1));if(!o)return null;let s=n.parseExpression({minPrec:0});if(s===null)return null;let a=b(b(e,2),1),u=[];return S(a)==="Sequence"?u=[...A(a)]:a&&(u=[a]),["Assign",o,["Function",s,...u??[]]]}if(S(e)==="Subscript"&&M(b(e,1))){if(!M(b(e,1)))return null;let s=n.parseExpression({minPrec:0});if(s===null)return null;let a=b(e,2);return se(a)!==null?["Assign",e,s]:M(a)?["Assign",e,s]:["Assign",e,s]}let i=S(e);if(i){let o=A(e),s=n.parseExpression({minPrec:0});return s===null?null:["Assign",i,["Function",s,...o]]}if(!M(e))return null;let r=n.parseExpression({minPrec:0});return r===null?null:["Assign",e,r]}function Hu(n){let e=n.parseTabular();if(!e)return["List"];if(e.every(i=>{if(i.length!==1)return!1;let r=S(i[0]);return st(r)||Mr(r)}))return["List",...e.map(i=>i[0])];let t=[];for(let i of e)if(i.length===1)t.push("True"),t.push(i[0]);else if(i.length===2){let r=se(i[1]);t.push(r?"True":Du(i[1])??"True"),t.push(i[0])}return["Which",...t]}function Wu(...n){return(e,t)=>{if(!M(t)&&S(t)!=="List")return null;let i=null;return n.length===0&&(i=e.parseGroup()),i??=e.parseExpression({minPrec:0}),i===null||n.length>0&&!e.matchAll(n)||se(i)!==null?null:(S(i)==="Delimiter"&&(i=b(i,1)??"Nothing"),S(i)==="Sequence"?["At",t,...A(i)]:["At",t,i])}}var Rd,Dr,ia=k(()=>{Ye();Gt();Gn();Pn();Rd=[{latexTrigger:["\\placeholder"],kind:"symbol",parse:n=>{for(;n.match("<space>"););if(n.match("["))for(;!n.match("]")&&!n.atBoundary;)n.nextToken();for(;n.match("<space>"););if(n.match("<{>"))for(;!n.match("<}>")&&!n.atBoundary;)n.nextToken();return"Nothing"}},{name:"ContinuationPlaceholder",latexTrigger:["\\dots"]},{latexTrigger:["\\ldots"],parse:"ContinuationPlaceholder"},{latexTrigger:[".",".","."],parse:"ContinuationPlaceholder"},{name:"Function",latexTrigger:["\\mapsto"],kind:"infix",precedence:jt,parse:(n,e,t)=>{let i=[];if(S(e)==="Delimiter"&&(e=b(e,1)??"Nothing"),S(e)==="Sequence")for(let o of A(e)){if(!M(o))return null;i.push(M(o))}else{if(!M(e))return null;i=[M(e)]}let r=n.parseExpression({minPrec:jt})??"Nothing";return S(r)==="Delimiter"&&(r=b(r,1)??"Nothing"),S(r)==="Sequence"&&(r=["Block",...A(r)]),["Function",r,...i]},serialize:(n,e)=>{let t=A(e);return t.length<1?"()\\mapsto()":t.length===1?C(["()","\\mapsto",n.serialize(b(e,1))]):t.length===2?C([n.serialize(b(e,2)),"\\mapsto",n.serialize(b(e,1))]):C([n.wrapString(A(e)?.slice(1).map(i=>n.serialize(i)).join(", "),"normal"),"\\mapsto",n.serialize(b(e,1))])}},{name:"Apply",kind:"function",symbolTrigger:"apply",serialize:(n,e)=>{let t=b(e,1),i=S(t);if(i==="InverseFunction"||i==="Derivative"){let s=n.options.applyFunctionStyle(e,n.level),a=A(e).slice(1);return n.serializeFunction(t,n.dictionary.ids.get(i))+n.wrapString(a.map(u=>n.serialize(u)).join(", "),s)}let r=b(e,2);if(typeof t=="string"||!r){let s=A(e).slice(1);return n.serialize(s)}if(de(e)===2)return C([n.wrap(t,20),"\\lhd",n.wrap(r,20)]);let o=n.options.applyFunctionStyle(e,n.level);return C(["\\operatorname{apply}",n.wrapString(n.serialize(i)+", "+n.serialize(["List",...A(e)]),o)])}},{latexTrigger:"\\lhd",kind:"infix",precedence:20,parse:"Apply"},{latexTrigger:"\\rhd",kind:"infix",precedence:20,parse:(n,e,t)=>["Apply",n.parseExpression({minPrec:21})??"Nothing",e]},{name:"EvaluateAt",openTrigger:".",closeTrigger:"|",kind:"matchfix",serialize:(n,e)=>{let t=b(e,1);if(!t)return"";let i=A(e).slice(1);if(S(t)==="Function"){let r=A(t).slice(1),o=b(t,1);if(S(o)==="Block"&&de(o)===1&&(o=b(o,1)),r.length>0)return`\\left.\\left(${n.serialize(o)}\\right)\\right|_{${r.map((s,a)=>`${n.serialize(s)}=${n.serialize(i[a])}`).join(", ")}}`}return`\\left.\\left(${n.serialize(t)}\\right)\\right|_{${i.map(r=>n.serialize(r)).join(", ")}}`}},{name:"Assign",latexTrigger:"\\coloneq",kind:"infix",associativity:"right",precedence:Ao,serialize:(n,e)=>{let t=Pu(b(e,1));if(S(b(e,2))==="Function"){let i=b(e,2),r=Pu(b(i,1)),o=A(i).slice(1);return C([n.serialize(t),n.wrapString(o.map(s=>n.serialize(s)).join(", "),n.options.applyFunctionStyle(e,n.level)),"\\coloneq",n.serialize(r)])}return C([n.serialize(t),"\\coloneq",n.serialize(b(e,2))])},parse:ta},{latexTrigger:"\\coloneqq",kind:"infix",associativity:"right",precedence:Ao,parse:ta},{latexTrigger:"\\colonequals",kind:"infix",associativity:"right",precedence:Ao,parse:ta},{latexTrigger:[":","="],kind:"infix",associativity:"right",precedence:Ao,parse:ta},{name:"BaseForm",serialize:(n,e)=>{let t=z(b(e,2))??NaN;if(isFinite(t)&&t>=2&&t<=36){let i=z(b(e,1))??NaN;if(isFinite(i)&&Number.isInteger(i)){let r=Number(i).toString(t),o=0;if(t===2||t===10?o=4:t===16?o=2:t>16&&(o=4),o>0){let s=r;r="";for(let a=0;a<s.length;a++)a>0&&a%o===0&&(r="\\, "+r),r=s[s.length-a-1]+r}return`(\\text{${r}}_{${t}}`}}return"\\operatorname{BaseForm}("+n.serialize(b(e,1))+", "+n.serialize(b(e,2))+")"}},{name:"Sequence",serialize:vt(" ")},{name:"InvisibleOperator",serialize:vt("")},{name:"Delimiter",serialize:(n,e)=>{let t=n.options.groupStyle(e,n.level+1),i=b(e,1),r={Set:"{,}",List:"[,]",Tuple:"(,)",Single:"(,)",Pair:"(,)",Triple:"(,)",Sequence:"(,)",String:'""'}[S(i)],o=r?i:["Sequence",i];if(r??="(,)",de(e)>1){let c=se(b(e,2));typeof c=="string"&&c.length<=3&&(r=c)}let[s,a,u]=["","",""];r.length===3?[s,a,u]=r:r.length===2?[s,u]=r:r.length===1&&(a=r);let l=i?o?vt(a)(n,o):n.serialize(i):"";return n.wrapString(l,t,s+u)}},{name:"Tuple",serialize:(n,e)=>C(["(",vt(",")(n,e),")"])},{name:"Pair",serialize:(n,e)=>C(["(",vt(",")(n,e),")"])},{name:"Triple",serialize:(n,e)=>C(["(",vt(",")(n,e),")"])},{name:"Single",serialize:(n,e)=>C(["(",vt(",")(n,e),")"])},{name:"Domain",serialize:(n,e)=>S(e)==="Error"?n.serialize(e):`\\mathbf{${n.serialize(b(e,1))}}`},{latexTrigger:["\\mathtip"],parse:n=>{let e=n.parseGroup();return n.parseGroup(),e}},{latexTrigger:["\\texttip"],parse:n=>{let e=n.parseGroup();return n.parseGroup(),e}},{latexTrigger:["\\error"],parse:n=>["Error",n.parseGroup()]},{name:"Error",serialize:(n,e)=>{let t=b(e,1);if(se(t)==="missing")return`\\error{${n.options.missingSymbol??"\\placeholder{}"}}`;let i=n1(n,e)||"\\blacksquare",r=S(t)==="ErrorCode"?se(b(t,1)):se(t);return r==="incompatible-type"?M(b(t,3))==="Undefined"?`\\mathtip{\\error{${i}}}{\\notin ${n.serialize(b(t,2))}}`:`\\mathtip{\\error{${i}}}{\\in ${n.serialize(b(t,3))}\\notin ${n.serialize(b(t,2))}}`:typeof r=="string"?`\\error{${i}}`:`\\error{${i}}`}},{name:"ErrorCode",serialize:(n,e)=>{let t=se(b(e,1));return t==="missing"?n.options.missingSymbol??"\\placeholder{}":t==="unexpected-command"||t==="unexpected-operator"||t==="unexpected-token"||t==="invalid-symbol"||t==="unknown-environment"||t==="unexpected-base"||t==="incompatible-type"?"":`\\texttip{\\error{\\blacksquare}}{\\mathtt{${t}}}`}},{name:"FromLatex",serialize:(n,e)=>`\\texttt{${e1(se(b(e,1)))}}`},{name:"Latex",serialize:(n,e)=>e===null?"":C(Ys(e,t=>se(t)??n.serialize(t)))},{name:"LatexString",serialize:(n,e)=>e===null?"":C(Ys(e,t=>n.serialize(t)))},{name:"LatexTokens",serialize:Kb},{name:"At",kind:"postfix",precedence:810,latexTrigger:["["],parse:Wu("]"),serialize:(n,e)=>C(["\\lbrack",vt(", ")(n,e),"\\rbrack"])},{kind:"postfix",precedence:810,latexTrigger:["\\lbrack"],parse:Wu("\\rbrack")},{kind:"postfix",precedence:810,latexTrigger:["\\left","\\lbrack"],parse:Wu("\\right","\\rbrack")},{kind:"postfix",latexTrigger:["_"],parse:(n,e,t)=>{let i=n.parseGroup()??n.parseToken();return i===null&&n.options.strict===!1&&n.peek==="("&&(i=n.parseEnclosure()),["Subscript",e,i]}},{name:"List",kind:"matchfix",openTrigger:"[",closeTrigger:"]",parse:Md,serialize:i1},{kind:"matchfix",openTrigger:"(",closeTrigger:")",parse:t1},{latexTrigger:[","],kind:"infix",precedence:20,parse:(n,e,t)=>{let i=Zu(n,t,e,20,",");return i===null?null:["Delimiter",["Sequence",...i],{str:","}]}},{latexTrigger:[","],kind:"prefix",precedence:20,parse:(n,e)=>{let t=Zu(n,e,null,20,",");return t===null?null:["Delimiter",["Sequence",...t],{str:","}]}},{name:"Range",latexTrigger:[".","."],kind:"infix",precedence:800,parse:r1,serialize:(n,e)=>{let t=A(e);if(t.length===0)return"";if(t.length===1)return"1.."+n.serialize(b(e,1));if(t.length===2)return n.wrap(b(e,1),10)+".."+n.wrap(b(e,2),10);if(t.length===3){let i=z(b(e,3)),r=z(b(e,1));return i!==null&&r!==null?n.wrap(b(e,1),10)+".."+n.wrap(r+i,10)+".."+n.wrap(b(e,2),10):n.wrap(b(e,1),10)+"..("+(n.wrap(b(e,1),Ae)+"+"+n.wrap(b(e,3),Ae))+").."+n.wrap(b(e,2),10)}return""}},{latexTrigger:[";"],kind:"infix",precedence:19,parse:(n,e,t)=>{let i=Zu(n,t,e,19,";");return i===null?null:["Delimiter",["Sequence",...i],"';'"]}},{name:"String",latexTrigger:["\\text"],parse:n=>Zt(n),serialize:(n,e)=>{let t=A(e);return t.length===0?"\\text{}":C(["\\text{",t.map(i=>n.serialize(i)).join(""),"}"])}},{name:"Subscript",latexTrigger:["_"],kind:"infix",serialize:(n,e)=>de(e)===2?n.serialize(b(e,1))+"_{"+n.serialize(b(e,2))+"}":"_{"+n.serialize(b(e,1))+"}"},{name:"Superplus",latexTrigger:["^","+"],kind:"postfix"},{name:"Subplus",latexTrigger:["_","+"],kind:"postfix"},{name:"Superminus",latexTrigger:["^","-"],kind:"postfix"},{name:"Subminus",latexTrigger:["_","-"],kind:"postfix"},{latexTrigger:["^","*"],kind:"postfix",parse:(n,e)=>["Superstar",e]},{latexTrigger:["_","*"],kind:"postfix",parse:(n,e)=>["Substar",e]},{name:"Substar",latexTrigger:["_","\\star"],kind:"postfix"},{name:"Superdagger",latexTrigger:["^","\\dagger"],kind:"postfix"},{latexTrigger:["^","\\dag"],kind:"postfix",parse:(n,e)=>["Superdagger",e]},{name:"Prime",latexTrigger:["^","\\prime"],kind:"postfix",parse:(n,e)=>zt(n,e,1),serialize:(n,e)=>{let t=z(b(e,2))??1,i=n.serialize(b(e,1));return t===1?i+"^\\prime":t===2?i+"^\\doubleprime":t===3?i+"^\\tripleprime":i+"^{("+n.serialize(b(e,2))+")}"}},{latexTrigger:"^{\\prime\\prime}",kind:"postfix",parse:(n,e)=>zt(n,e,2)},{latexTrigger:"^{\\prime\\prime\\prime}",kind:"postfix",parse:(n,e)=>zt(n,e,3)},{latexTrigger:["^","\\doubleprime"],kind:"postfix",parse:(n,e)=>zt(n,e,2)},{latexTrigger:["^","\\tripleprime"],kind:"postfix",parse:(n,e)=>zt(n,e,3)},{latexTrigger:"'",kind:"postfix",precedence:810,parse:(n,e)=>zt(n,e,1)},{latexTrigger:"\\prime",kind:"postfix",precedence:810,parse:(n,e)=>zt(n,e,1)},{latexTrigger:"\\doubleprime",kind:"postfix",precedence:810,parse:(n,e)=>zt(n,e,2)},{latexTrigger:"\\tripleprime",kind:"postfix",precedence:810,parse:(n,e)=>zt(n,e,3)},{latexTrigger:["^","<{>","("],kind:"postfix",parse:(n,e,t)=>{let i=M(e);if(!i||!n.getSymbolType(i).matches("function"))return null;n.addBoundary([")"]);let r=n.parseExpression(t);return!n.matchBoundary()||!n.match("<}>")?null:["Derivative",e,r]}},{name:"InverseFunction",latexTrigger:"^{-1",kind:"postfix",parse:(n,e)=>{let t=M(e);if(!t||!n.getSymbolType(t).matches("function"))return null;let i=0;for(;!n.atEnd&&!n.match("<}>");)if(n.match("'"))i++;else if(n.match("\\prime"))i++;else if(n.match("\\doubleprime"))i+=2;else if(n.match("\\tripleprime"))i+=3;else return null;return i===1?["Derivative",["InverseFunction",e]]:i>0?["Derivative",["InverseFunction",e],i]:["InverseFunction",e]},serialize:(n,e)=>n.serialize(b(e,1))+"^{-1}"},{name:"Derivative",serialize:(n,e)=>{let t=z(b(e,2))??1,i=n.serialize(b(e,1));return t===1?i+"^{\\prime}":t===2?i+"^{\\doubleprime}":t===3?i+"^{\\tripleprime}":i+"^{("+n.serialize(b(e,2))+")}"}},{name:"D",serialize:(n,e)=>{if(S(e)!=="D")return"D";let t=b(e,1),i=b(e,2);if(!t||!i)return"D";let r=1,o=t;for(;S(o)==="D";){let l=b(o,2);if(M(l)===M(i))r++,o=b(o,1);else break}let s=o;S(o)==="Function"&&(s=b(o,1)??o);let a=n.serialize(s),u=n.serialize(i);return r===1?`\\frac{\\mathrm{d}}{\\mathrm{d}${u}}${a}`:`\\frac{\\mathrm{d}^{${r}}}{\\mathrm{d}${u}^{${r}}}${a}`}},{name:"NewtonDerivative1",latexTrigger:["\\dot"],kind:"prefix",precedence:740,parse:n=>{let e=n.parseGroup();if(e===null)return null;let t=n.options.timeDerivativeVariable;return["D",e,t]}},{name:"NewtonDerivative2",latexTrigger:["\\ddot"],kind:"prefix",precedence:740,parse:n=>{let e=n.parseGroup();if(e===null)return null;let t=n.options.timeDerivativeVariable;return["D",["D",e,t],t]}},{name:"NewtonDerivative3",latexTrigger:["\\dddot"],kind:"prefix",precedence:740,parse:n=>{let e=n.parseGroup();if(e===null)return null;let t=n.options.timeDerivativeVariable;return["D",["D",["D",e,t],t],t]}},{name:"NewtonDerivative4",latexTrigger:["\\ddddot"],kind:"prefix",precedence:740,parse:n=>{let e=n.parseGroup();if(e===null)return null;let t=n.options.timeDerivativeVariable;return["D",["D",["D",["D",e,t],t],t],t]}},{name:"EulerDerivative",latexTrigger:["D"],kind:"expression",parse:n=>{let e=1,t=null,i=!1;for(;!i;)if(n.match("_")){if(t=n.parseGroup()??n.parseToken(),!t)return null}else if(n.match("^")){let s=n.parseGroup()??n.parseToken();e=z(s)??1}else i=!0;if(!t)return null;n.skipSpace();let r=n.parseExpression({minPrec:740});if(!r)return null;let o=r;for(let s=0;s<e;s++)o=["D",o,t];return o}},{kind:"environment",name:"Which",symbolTrigger:"cases",parse:Hu,serialize:(n,e)=>{let t=[],i=A(e);if(i.length>0)for(let r=0;r<=i.length-2;r+=2){let o=[];o.push(n.serialize(i[r+1])),o.push(n.serialize(i[r])),t.push(o.join("&"))}return C(["\\begin{cases}",t.join("\\\\"),"\\end{cases}"])}},{kind:"environment",symbolTrigger:"dcases",parse:Hu},{kind:"environment",symbolTrigger:"rcases",parse:Hu}];Dr={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","\u27E6":"\\llbrack","\u27E7":"\\rrbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","\u2016":"\\Vert","\\":"\\backslash","\u2308":"\\lceil","\u2309":"\\rceil","\u230A":"\\lfloor","\u230B":"\\rfloor","\u231C":"\\ulcorner","\u231D":"\\urcorner","\u231E":"\\llcorner","\u231F":"\\lrcorner","\u23B0":"\\lmoustache","\u23B1":"\\rmoustache"}});var at,Zd,ra=k(()=>{at=[["alpha","\\alpha",945],["beta","\\beta",946],["gamma","\\gamma",947],["delta","\\delta",948],["epsilon","\\epsilon",949],["epsilonSymbol","\\varepsilon",1013],["zeta","\\zeta",950],["eta","\\eta",951],["theta","\\theta",952],["thetaSymbol","\\vartheta",977],["iota","\\iota",953],["kappa","\\kappa",954],["kappaSymbol","\\varkappa",1008],["lambda","\\lambda",955],["mu","\\mu",956],["nu","\\nu",957],["xi","\\xi",958],["omicron","\\omicron",959],["pi","\\pi",960],["piSymbol","\\varpi",982],["rho","\\rho",961],["rhoSymbol","\\varrho",1009],["sigma","\\sigma",963],["finalSigma","\\varsigma",962],["tau","\\tau",964],["phi","\\phi",981],["phiLetter","\\varphi",966],["upsilon","\\upsilon",965],["chi","\\chi",967],["psi","\\psi",968],["omega","\\omega",969],["Alpha","\\Alpha",913],["Beta","\\Beta",914],["Gamma","\\Gamma",915],["Delta","\\Delta",916],["Epsilon","\\Epsilon",917],["Zeta","\\Zeta",918],["Eta","\\Eta",919],["Theta","\\Theta",920],["Iota","\\Iota",921],["Kappa","\\Kappa",922],["Lambda","\\Lambda",923],["Mu","\\Mu",924],["Nu","\\Nu",925],["Xi","\\Xi",926],["Omicron","\\Omicron",927],["Rho","\\Rho",929],["Sigma","\\Sigma",931],["Tau","\\Tau",932],["Phi","\\Phi",934],["Upsilon","\\Upsilon",933],["Chi","\\Chi",935],["Psi","\\Psi",936],["Omega","\\Omega",937],["digamma","\\digamma",989],["aleph","\\aleph",8501],["bet","\\beth",8502],["gimel","\\gimel",8503],["dalet","\\daleth",8504],["ell","\\ell",8499],["turnedCapitalF","\\Finv",8498],["turnedCapitalG","\\Game",8513],["weierstrass","\\wp",8472],["eth","\\eth",240],["invertedOhm","\\mho",8487],["hBar","\\hbar",295],["hSlash","\\hslash",8463],["blackClubSuit","\\clubsuit",9827],["whiteHeartSuit","\\heartsuit",9825],["blackSpadeSuit","\\spadesuit",9824],["whiteDiamondSuit","\\diamondsuit",9826],["sharp","\\sharp",9839],["flat","\\flat",9837],["natural","\\natural",9838]],Zd=[...at.map(([n,e,t])=>({kind:"symbol",name:n,latexTrigger:[e],parse:n})),...at.map(([n,e,t])=>({kind:"symbol",latexTrigger:[String.fromCodePoint(t)],parse:n}))]});function ke(n){return(n.isFiniteCollection??!1)&&n.isIndexedCollection}function b1(n,e){return typeof e=="number"?(e<0&&(e=0),{next(){return e===0?{done:!0,value:void 0}:(e--,{done:!1,value:n})}}):{next(){return{done:!1,value:n}}}}function tl(n){if(n.length===0)return{next(){return{done:!0,value:void 0}}};if(n.length===1){let r=n[0],o=r.each();if(!o){let s=!1;return{next(){return s?{done:s,value:void 0}:(s=!0,{done:!1,value:[r]})}}}return{next(){let s=o.next();return s.done?{done:!0,value:void 0}:{done:!1,value:[s.value]}}}}let e=Math.min(...n.map(r=>r.isCollection?r.count??1:1/0));if(e===0)return{next(){return{done:!0,value:void 0}}};let t=n.map(r=>r.isCollection?r.each():b1(r)),i=0;return{next(){if(i>=e)return{done:!0,value:void 0};let r=t.map(o=>o.next());return i+=1,{done:!1,value:r.map(o=>o.value)}}}}function im(n,e,t){if(!(n.isFiniteCollection!==!0||e.isFiniteCollection!==!0)){for(let i of n.each())if(e.contains(i)!==!0)return!1;if(t){let i=n.count;if(i===void 0)return!1;let r=e.count;if(r===void 0||i===r)return!1}return!0}}function E1(n,e){for(let t=0;t!==n.nops;t+=1)if(e(n.ops[t]))return t+1}function v1(n,e){if(n.isIndexedCollection!==!0)return;let t=1,i=n.at(t);for(;i!==void 0;){if(e(i))return t;t+=1,i=n.at(t)}}function _1(n,e){if(n.isFiniteCollection===!0){if(n.isIndexedCollection)return n.indexWhere(t=>t.isSame(e))!==void 0;for(let t of n.each())if(t.isSame(e))return!0;return!1}}function sa(){return{isLazy:n=>!1,count:n=>n.nops,isEmpty:n=>n.nops===0,isFinite:n=>!0,contains:(n,e)=>n.ops.some(t=>t.isSame(e)),iterator:n=>{let e=1,t=n.nops;return{next:()=>e===t+1?{value:void 0,done:!0}:(e+=1,{value:n.ops[e-1-1],done:!1})}},subsetOf:im,at:(n,e)=>{if(typeof e=="number"&&(e<0&&(e=n.nops+e+1),!(e<1||e>n.nops)))return n.ops[e-1]},indexWhere:E1,eltsgn:n=>{},elttype:n=>n.nops===0?"unknown":n.nops===1?n.ops[0].type.type:ve(...n.ops.map(e=>e.type.type))}}function aa(n){if(!n)return;if(!n.count||!n.iterator)throw new Error('A collection must have at least an "iterator" and a "count" handler');if(n.indexWhere&&n.at===void 0)throw new Error('A collection with an "indexWhere" handler must also have an "at" handler');let e={iterator:n.iterator,count:n.count,contains:n.contains??_1,isEmpty:n.isEmpty??(t=>{if(n.count(t)!==void 0)return n.count(t)===0}),isFinite:n.isFinite??(t=>{let i=n.count(t);if(i!==void 0)return Number.isFinite(i)}),subsetOf:n.subsetOf??im};return n.isLazy&&(e.isLazy=n.isLazy),n.eltsgn&&(e.eltsgn=n.eltsgn),n.elttype&&(e.elttype=n.elttype),n.at&&(e.at=n.at,e.indexWhere=n.indexWhere??v1),e}var tm,Yt=k(()=>{an();tm=100});function he(n,e){let t=n.every(r=>r.isCanonical)?n:n.map(r=>r.canonical);if(e){let r=s=>s.symbol==="Nothing"||s.operator===e||s.operator==="Sequence";if(t.every(s=>!r(s)))return t;let o=[];for(let s of t)s.symbol!=="Nothing"&&(s.ops&&(s.operator===e||s.operator==="Sequence")?o.push(...he(s.ops,e)):o.push(s));return o}if(t.every(r=>!(r.symbol==="Nothing"||r.operator==="Sequence")))return t;let i=[];for(let r of t)r.symbol!=="Nothing"&&(r.ops&&r.operator==="Sequence"?i.push(...he(r.ops,e)):i.push(r));return i}function _i(n,e){if(!e||n.every(i=>!i.ops||i.operator!==e))return n;let t=[];for(let i of n)!i.ops||i.operator!==e?t.push(i):t.push(..._i(i.ops,e));return t.length,n.length,t.length===n.length?n:t}function il(n){if(n.every(t=>t.operator!=="Sequence"&&t.operator!=="Delimiter"))return n;let e=[];for(let t of n)if(!t.isValid)e.push(t);else if(t.operator==="Delimiter")if(t.op1.operator==="Sequence"){let i=t.op1.ops??[];i.length===0?e.push(t.engine.box(["Tuple"])):e.push(...il(i))}else e.push(t.op1);else t.operator==="Sequence"?t.ops&&e.push(...t.ops):e.push(t);return e}var zn=k(()=>{});function om(n,e,t){if(t.repeatingDecimal&&t.repeatingDecimal!=="none"){let o=n.slice(0,-1);for(let s=0;s<n.length-16;s++){let a=o.substring(0,s);for(let u=0;u<17;u++){let l=o.substring(s,s+u+1),c=Math.floor((o.length-a.length)/l.length);if(c<=3)break;if((a+l.repeat(c+1)).startsWith(o)){if(l==="0")return rl(a,t);let f={vinculum:"\\overline{#}",parentheses:"(#)",dots:"\\overset{\\cdots}{#1}#2\\overset{\\cdots}{#3}",arc:"\\wideparen{#}"}[t.repeatingDecimal]??"\\overline{#}";return f=f.replace(/#1/g,l[0]).replace(/#2/g,l.slice(1)).replace(/#3/g,l.slice(-1)).replace(/#/,l),rl(a,t)+f}}}}let i=typeof t.fractionalDigits=="number"?t.fractionalDigits:1/0;i<0&&(i=i-e),i<0&&(i=0);let r=n.length>i;return r&&(n=n.substring(0,i)),n=rl(n,t),r&&(n+=t.truncationMarker),n}function sm(n,e){return!n||n==="0"?"":e.beginExponentMarker?e.beginExponentMarker+n+(e.endExponentMarker??""):`10^{${n}}`}function am(n,e){if(n===null)return"";let t;if(typeof n=="number"||typeof n=="string")t=n;else if(typeof n=="object"&&"num"in n)t=n.num;else return"";if(typeof t=="number"){if(t===1/0)return e.positiveInfinity;if(t===-1/0)return e.negativeInfinity;if(Number.isNaN(t))return e.notANumber;let o;return e.notation==="engineering"?o=Or(t.toExponential(),e,3):e.notation==="scientific"?o=Or(t.toExponential(),{...e,avoidExponentsInRange:null}):e.notation==="adaptiveScientific"&&(o=Or(t.toExponential(),e)),o??ol(t.toString(),e)}if(t=t.toLowerCase().replace(/[\u0009-\u000d\u0020\u00a0]/g,""),t==="infinity"||t==="+infinity"||t==="oo"||t==="+oo")return e.positiveInfinity;if(t==="-infinity"||t==="-oo")return e.negativeInfinity;if(t==="nan")return e.notANumber;if(!/^[-+\.]?[0-9]/.test(t))return"";if(t=t.replace(/[nd]$/,""),/\([0-9]+\)/.test(t)){let[o,s,a,u]=t.match(/(.+)\(([0-9]+)\)(.*)$/)??[];t=s+a.repeat(6)+u}let i="";for(t[0]==="-"?(i="-",t=t.substring(1)):t[0]==="+"&&(t=t.substring(1));t[0]==="0";)t=t.substring(1);t.length===0?t="0":t[0]==="."&&(t="0"+t);let r;return e.notation==="engineering"?r=Or(t,e,3):(e.notation==="scientific"||e.notation==="adaptiveScientific")&&(r=Or(t,e)),i+(r??ol(t,{...e}))}function Or(n,e,t=1){let i=n.match(/^(.*)[e|E]([-+]?[0-9]+)$/);if(!i){let c="";if(n[0]==="-"?(c="-",n=n.substring(1)):n[0]==="+"&&(n=n.substring(1)),n.indexOf(".")<0)n.length===1?n=c+n+"e+0":n=c+n[0]+"."+n.slice(1)+"e+"+(n.length-1).toString();else{let[f,p,d]=n.match(/^(.*)\.(.*)$/);for(d||(d="");p.startsWith("0");)p=p.substring(1);if(p)n=c+p[0]+"."+p.slice(1)+d+"e+"+(p.length-1).toString();else{let m=0;for(;d[m]==="0";)m++;if(m===d.length)n=c+"0e+0";else{let g=d.slice(m),h=g[0],x=g.slice(1),y=-(m+1);x?n=c+h+"."+x+"e"+y:n=c+h+"e"+y}}}i=n.match(/^(.*)[e|E]([-+]?[0-9]+)$/)}if(!i)return ol(n,e);let r=parseInt(i[2]),o=i[1];if(Math.abs(r)%t!==0){let c=r>0?r%t:-((t+r)%t);r=r>=0?r-c:r+c;let[f,p,d]=o.match(/^(.*)\.(.*)$/)??["",o,""];o=p+(d+"00000000000000000").slice(0,Math.abs(c))+"."+d.slice(Math.abs(c))}let s=e.avoidExponentsInRange;if(s&&r>=s[0]&&r<=s[1])return;let a="",u=o;i=u.match(/^(.*)\.(.*)$/),i&&(u=i[1],a=i[2]);let l=sm(Number(r).toString(),e);return a=om(a,u.length,e),a&&(a=e.decimalSeparator+a),u=lm(u,e),l?u+a+e.exponentProduct+l:u+a}function ol(n,e){let t=n.match(/^(.*)[e|E]([-+]?[0-9]+)$/i),i=0,r=0;t?.[1]&&t[2]&&(i=parseInt(t[2]),r=i,n=t[1]);let o=t?.[1]??n,s="";t=n.match(/^(.*)\.(.*)$/),t?.[1]&&t[2]&&(o=t[1],s=t[2]),i!==0&&s&&(o+=s,i-=s.length,s="");let a=e.avoidExponentsInRange;i!==0&&a&&r>=a[0]&&r<=a[1]&&([o,s]=S1(o,s,i),i=0);let u=sm(i.toString(),e);if(s&&(s=e.decimalSeparator+om(s,o.length,e)),o=lm(o,e),!u)return o+s;if(!s){if(o==="1")return u;if(o==="-1")return"-"+u}return o+s+e.exponentProduct+u}function rm(n,e,t){let i=new RegExp(`(\\d{${e}})(?=\\d)`,"g");return n.replace(i,`$1${t}`)}function N1(n,e,t){let i=new RegExp(`(\\d{${e}})(?=\\d)`,"g"),r=t.split("").reverse().join("");return n.split("").reverse().join("").replace(i,`$1${r}`).split("").reverse().join("")}function T1(n,e){let t=n.split("").reverse().join(""),i=e.split("").reverse().join(""),r=t.replace(/(\d{3})(?=\d)/,`$1${i}`);return r=r.replace(/(\d{2})(?=(\d{2})+,)/g,`$1${i}`),r.split("").reverse().join("")}function um(n,e,t){let i=e.digitGroup;typeof i!="string"&&Array.isArray(i)&&(i=i[t]);let r=typeof e.digitGroupSeparator=="string"?e.digitGroupSeparator:e.digitGroupSeparator[t];return r?i==="lakh"?t===0?T1(n,r):rm(n,3,r):i===!1||i<=0?n:t===1?rm(n,i,r):N1(n,i,r):n}function rl(n,e){return um(n,e,1)}function lm(n,e){return um(n,e,0)}function S1(n,e,t){let i=n+e,o=n.length+t,s,a;return o>0?o>=i.length?(i=i+"0".repeat(o-i.length),s=i,a=""):(s=i.slice(0,o),a=i.slice(o)):(s="0",a="0".repeat(-o)+i),[s,a]}var cm=k(()=>{});function I1(n){let e=n.match(/^([^_]+)/)?.[1]??"",t=at.findIndex(s=>e===s[0]);if(t>=0)return[at[t][1],n.substring(at[t][0].length)];let i={zero:"0",one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10"};if(t=Object.keys(i).findIndex(s=>n.startsWith(s)),t>=0){let s=Object.keys(i)[t];return[i[s],n.substring(s.length)]}let r=n.codePointAt(0);if(t=at.findIndex(s=>s[2]===r),t>=0)return[at[t][1],n.substring(1)];let o={plus:"+",minus:"-",pm:"\\pm",ast:"\\ast",dag:"\\dag",ddag:"\\ddag",hash:"\\#",bottom:"\\bot",top:"\\top",bullet:"\\bullet",circle:"\\circ",diamond:"\\diamond",times:"\\times",square:"\\square",star:"\\star"};if(t=Object.keys(o).findIndex(s=>e===s),t>=0){let s=Object.keys(o)[t];return[o[s],n.substring(s.length)]}return[e,n.substring(e.length)]}function B1(n){let[e,t]=I1(n),i=[];for(;t.length>0;){let o=t.match(/^_([a-zA-Z]+)(.*)/);if(!o||!al[o[1]])break;i.push(o[1]),t=o[2]}let r=[];for(;t.length>0;){let o=t.match(/^_([a-zA-Z]+)(.*)/);if(!o||!ul[o[1]])break;r.push(o[1]),t=o[2]}return[e,i,r,t]}function ua(n,e=!0,t="auto"){let[i,r,o,s]=B1(n);for(let a of r)al[a]&&(i=al[a](i));if(e){let a=[],u=[],l=i.match(/^([^\d].*?)(\d+)$/);for(l&&(u.push(l[2]),i=l[1]);s.length>0;)if(s.startsWith("__")){let[c,f]=ua(s.substring(2),!1,"none");a.push(c),s=f}else if(s.startsWith("_")){let[c,f]=ua(s.substring(1),!1,"none");u.push(c),s=f}else break;a.length>0&&(i=Ei("^",i,a.join(","))),u.length>0&&(i=Ei("_",i,u.join(",")))}for(let a of o)ul[a]&&(i=ul[a](i));if(o.length===0&&t!=="none")switch(t){case"auto":Ks(i)>1&&(i=`\\mathrm{${i}}`);break;case"operator":i=`\\operatorname{${i}}`;break;case"italic":i=`\\mathit{${i}}`;break;case"upright":i=`\\mathrm{${i}}`;break}return[i,s]}function sl(n,e="auto"){if(n===null)return null;if(Nr.test(n))return n;let t=n.match(/^(_+)(.*)/);if(t){let[o,s]=ua(t[2],!0,"none");return`\\operatorname{${"\\_".repeat(t[1].length)+o+s}}`}let[i,r]=ua(n,!0,e);return r.length>0?`\\operatorname{${n}}`:i}function fm(n,e,t){return new ll(e,t).serialize(n)}var al,ul,ll,pm=k(()=>{Ye();Gt();Gn();cm();ra();ia();di();al={deg:n=>`${n}\\degree`,prime:n=>`${n}^{\\prime}`,dprime:n=>`${n}^{\\doubleprime}`,ring:n=>`\\mathring{${n}}`,hat:n=>`\\hat{${n}}`,tilde:n=>`\\tilde{${n}}`,vec:n=>`\\vec{${n}}`,bar:n=>`\\overline{${n}}`,underbar:n=>`\\underline{${n}}`,dot:n=>`\\dot{${n}}`,ddot:n=>`\\ddot{${n}}`,tdot:n=>`\\dddot{${n}}`,qdot:n=>`\\ddddot{${n}}`,acute:n=>`\\acute{${n}}`,grave:n=>`\\grave{${n}}`,breve:n=>`\\breve{${n}}`,check:n=>`\\check{${n}}`},ul={upright:n=>`\\mathrm{${n}}`,italic:n=>`\\mathit{${n}}`,bold:n=>`\\mathbf{${n}}`,script:n=>`\\mathscr{${n}}`,fraktur:n=>`\\mathfrak{${n}}`,doublestruck:n=>`\\mathbb{${n}}`,blackboard:n=>`\\mathbb{${n}}`,calligraphic:n=>`\\mathcal{${n}}`,gothic:n=>`\\mathfrak{${n}}`,sansserif:n=>`\\mathsf{${n}}`,monospace:n=>`\\mathtt{${n}}`},ll=class{options;dictionary;level=-1;constructor(e,t){this.dictionary=e,this.options=t}wrap(e,t){if(e==null)return"";if(t===void 0)return this.wrapString(this.serialize(e),this.options.groupStyle(e,this.level+1));if(typeof e=="number"||yi(e)){let r=z(e);return r!==null&&r<0&&t>Ae?this.wrap(e):this.serialize(e)}let i=S(e);if(i&&i!=="Delimiter"&&i!=="Subscript"){let r=this.dictionary.ids.get(i);if(r&&(r.kind==="symbol"||r.kind==="expression"||r.kind==="prefix"||r.kind==="infix"||r.kind==="postfix")&&r.precedence<t)return this.wrapString(this.serialize(e),this.options.applyFunctionStyle(e,this.level))}return this.serialize(e)}wrapShort(e){if(e==null)return"";let t=this.serialize(e);if(M(e)!==null||$t(e)&&!/^(-|\.)/.test(t))return t;let r=S(e);return r==="Delimiter"&&de(e)===1||r!=="Add"&&r!=="Negate"&&r!=="Subtract"&&r!=="PlusMinus"&&r!=="Multiply"?t:this.wrapString(t,this.options.groupStyle(e,this.level+1))}wrapString(e,t,i){if(t==="none")return e;i??="()";let r=i?.[0]??".",o=i?.[1]??".";return r==='"'?r="``":r==="|"?r="\\lvert":r=Dr[r]??r,o==='"'?o="''":o==="|"?o="\\rvert":o=Dr[o]??o,r==="."&&o==="."?e:((r==="."||o===".")&&t==="normal"&&(t="scaled"),t==="scaled"?`\\left${r}${e}\\right${o}}`:t==="big"?`${`\\Bigl${r}`}${e}${`\\Bigr${o}`})`:r+e+o)}wrapArguments(e){return this.wrapString(A(e).map(t=>this.serialize(t)).join(", "),this.options.applyFunctionStyle(e,this.level))}serializeSymbol(e,t){return typeof e=="string"||Br(e),t?.kind==="function"?sl(M(e)??"")??"":t?.serialize?.(this,e)??sl(M(e))??""}serializeFunction(e,t){if(t?.serialize)return t.serialize(this,e);let i=S(e);return sl(i,"auto")+this.wrapArguments(e)}serialize(e){if(e==null)return"";this.level+=1;try{let t=(()=>{let i=am(e,this.options);if(i)return i;let r=se(e);if(r!==null)return`\\text{${r}}`;let o=M(e);if(o!==null)return this.serializeSymbol(e,this.dictionary.ids.get(o));let s=S(e);if(s){let a=this.dictionary.ids.get(s);return this.serializeFunction(e,a)}throw Error(`Syntax error ${e?JSON.stringify(e,void 0,4):""}`)})();return this.level-=1,t??""}catch{}return this.level-=1,""}applyFunctionStyle(e,t){return this.options.applyFunctionStyle(e,t)}groupStyle(e,t){return this.options.groupStyle(e,t)}rootStyle(e,t){return this.options.rootStyle(e,t)}fractionStyle(e,t){return this.options.fractionStyle(e,t)}logicStyle(e,t){return this.options.logicStyle(e,t)}powerStyle(e,t){return this.options.powerStyle(e,t)}numericSetStyle(e,t){return this.options.numericSetStyle(e,t)}}});function Gi(n,e){for(;e!==BigInt(0);)[n,e]=[e,n%e];return n<0?-n:n}function dm(n,e){return n*e/Gi(n,e)}function*la(n){if(n<0)return BigInt(0);if(n<10)return BigInt([1,1,2,6,24,120,720,5040,40320,362880][Number(n)]);if(n%BigInt(2)===BigInt(1))return n*(yield*la(n-BigInt(1)));let e=n,t=n,i=n,r=0;for(;e>2;)e-=BigInt(2),t+=e,i*=t,r+=1,(r%5e4===0||r>1e4&&r%500===0)&&(yield i);return i}var ca=k(()=>{Vt();Js()});function Qt(n){return n!==null&&Array.isArray(n)}function Ne(n){return n!==null&&Array.isArray(n)&&typeof n[0]=="number"}function mm(n){return n!==null&&Array.isArray(n)&&typeof n[0]=="bigint"}function Nt(n){return n[0]==0}function cl(n){return n[0]>0}function nn(n){return n[0]==n[1]}function qo(n){return n[0]===-n[1]}function zi(n){return n[1]==1}function fl(n){return Number(n[0])}function pl(n){return Number(n[1])}function gm(n){return Number(n[0])/Number(n[1])}function Zi(n,e){if(typeof n[0]=="number"&&!Number.isFinite(n[0]))return n;let t=e;if(t===null)return n;if(mm(t))return n=[BigInt(n[0]),BigInt(n[1])],[t[1]*n[0]+t[0]*n[1],t[1]*n[1]];if(!Number.isFinite(t[0]))return t;if(mm(n)){let i=[BigInt(t[0]),BigInt(t[1])];return[i[1]*n[0]+i[0]*n[1],i[1]*n[1]]}return[t[1]*n[0]+t[0]*n[1],t[1]*n[1]]}function Tt(n,e){return Ne(n)&&Ne(e)?[n[0]*e[0],n[1]*e[1]]:Ne(n)?[BigInt(n[0])*e[0],BigInt(n[1])*e[1]]:Ne(e)?[BigInt(e[0])*n[0],BigInt(e[1])*n[1]]:[n[0]*e[0],n[1]*e[1]]}function Hi(n){return[-n[0],n[1]]}function hm(n){return n[0]<0?[-n[1],-n[0]]:[n[1],n[0]]}function xm(n){return[Number(n[0]),Number(n[1])]}function fa(n,e){return Ne(n)&&Ne(e)?n[1]===1&&e[1]===1?[un(n[0],e[0]),1]:[un(n[0],e[0]),ji(n[1],e[1])]:n[1]===1&&e[1]===1?[Gi(BigInt(n[0]),BigInt(e[0])),BigInt(1)]:[Gi(BigInt(n[0]),BigInt(e[0])),dm(BigInt(n[1]),BigInt(e[1]))]}function Lr(n){if(Ne(n)){if(n[1]<0&&(n=[-n[0],-n[1]]),n[0]===1||n[1]===1)return n;if(!Number.isFinite(n[1]))return[0,1];let r=un(n[0],n[1]);return r<=1?n:[n[0]/r,n[1]/r]}n[1]<0&&(n=[-n[0],-n[1]]);let e=Gi(n[0],n[1]),[t,i]=e<=1?n:[n[0]/e,n[1]/e];return t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER&&i<=Number.MAX_SAFE_INTEGER?[Number(t),Number(i)]:[t,i]}function ym(n){if(!Number.isFinite(n)||n%1===0)return n;let t=1e-15,i=Math.floor(n),r=1,o=0,s=i,a=1;for(;n-i>t*a*a;){n=1/(n-i),i=Math.floor(n);let u=r;r=s;let l=o;o=a,s=u+i*r,a=l+i*o}return[s,a]}var St=k(()=>{en();ca()});function dl(n,e,t){let[i,...r]=n.ops??[],o=[],s,a=[];if(i?.operator==="Function"){a=i.ops.slice(1)??[];let l=i.op1??i;l.operator==="Block"?s=t(l.op1??l):s=t(l)}else if(i)a=[],s=t(i);else return`${e}()`;let u=e;for(let l of r)if(["Range","Tuple","Pair","Single","Limits"].includes(l.operator)&&l.nops!==0){if(l.nops===2)l.op1.symbol?(l.op1.symbol!=="Nothing"&&o.push(l.op1),l.op2.symbol!=="Nothing"&&(e==="int"?u+=`_${gn(t(l.op2))}`:u+="_"+gn(`${l.op1.symbol}=${t(l.op2)}`))):(l.op1.symbol!=="Nothing"&&(u+=`_${gn(t(l.op1))}`),l.op2.symbol!=="Nothing"&&(u+=`^${gn(t(l.op2))}`));else if(l.nops===3){let c="";l.op1.symbol!=="Nothing"&&(o.push(l.op1),c=l.op1.symbol??"");let f=l.op2.symbol!=="Nothing"?l.op2:null,p=l.op3.symbol!=="Nothing"?l.op3:null;f?e==="int"||!c?u+=`_${gn(t(f))}`:u+="_"+gn(`${c}=${t(f)}`):e!=="int"&&(u+=`_${gn(t(l.op1))}`),p&&(u+=`^${gn(t(p))}`)}}return e==="int"?u+=gn(s+a.map(l=>` d${t(l)}`).join(" ")):u+=gn(s),u}function w1(n,e,t){e||(e="(,)");let i="",r="",o="";if(e.length===1&&(i=e),e.length===2&&(r=e[0],o=e[1]),e.length===3&&(r=e[0],i=e[1],o=e[2]),!n)return`${r}${o}`;let s=[n];return n.operator==="Sequence"&&(s=n.ops),`${r}${s.map(a=>t(a)).join(i)}${o}`}function gn(n,e=0,t=-1){return e>t&&!/^\(.+\)$/.test(n)?`(${n})`:n}function pa(n,e={}){return e.symbols?.[n]?e.symbols[n]:bm[n]?bm[n]:n.startsWith("_")?n:qr[n]&&typeof qr[n]=="string"?qr[n]:n.length===1?n:`"${n}"`}function Fo(n,e={},t=0){if(n===void 0)return"[undefined]";if(n===null)return"[null]";if(n.symbol)return pa(n.symbol,e);let i=(o,s=0)=>Fo(o,e,s);if(n.string)return`"${n.string.replace(/"/g,'\\"')}"`;let r=n.numericValue;if(r!==null)return n.isNaN?pa("NaN",e):n.isFinite===!1?n.isNegative!==!0&&n.isPositive!==!0?pa("ComplexInfinity",e):pa(n.isNegative?"NegativeInfinity":"PositiveInfinity",e):r.toString();if(n.operator){let o=e.operators?{...Em,...e.operators}:Em,[s,a]=o[n.operator]??[];if(s){let c="";if(typeof s=="function")c=s(n,i);else{if(n.nops===1)return`${s}${i(n.op1,a+1)}`;c=n.ops?.map(f=>i(f,a+1)).join(` ${s} `)??""}return gn(c,t,a)}let l=(e.functions?{...qr,...e.functions}:qr)[n.operator];return typeof l=="function"?l(n,i):typeof l=="string"?`${l}(${n.ops?.map(c=>i(c)).join(", ")??""})`:`${n.operator}(${n.ops?.map(c=>i(c)).join(", ")??""})`}return JSON.stringify(n.json)}function ml(n,e){return n?e?((e.startsWith("-")||e.startsWith("+"))&&(e=`(${e})`),n.match(/^[-+]?\d+$/)&&e.match(/^[a-zA-Z\(]/)?n+e:`${n} * ${e}`):n:e}function vm(n,e){return n?e?e.startsWith("-")?`${n} - ${e.substring(1)}`:e.startsWith("+")?`${n} + ${e.substring(1)}`:`${n} + ${e}`:n:e}var bm,Em,qr,_m=k(()=>{St();bm={PositiveInfinity:"+oo",NegativeInfinity:"-oo",ComplexInfinity:"~oo",NaN:"NaN",Pi:"pi",ExponentialE:"e",ImaginaryUnit:"i",ContinuationPlaceholder:"...",alpha:"alpha",beta:"beta",gamma:"gamma",delta:"delta",epsilon:"epsilon",epsilonSymbol:"varepsilon",zeta:"zeta",eta:"eta",theta:"theta",thetaSymbol:"vartheta",iota:"iota",kappa:"kappa",lambda:"lambda",mu:"mu",nu:"nu",xi:"xi",omicron:"omicron",pi:"pi",rho:"rho",sigma:"sigma",tau:"tau",upsilon:"upsilon",phi:"phi",phiSymbol:"varphi",chi:"chi",psi:"psi",omega:"omega",Gamma:"Gamma",Delta:"Delta",Theta:"Theta",Lambda:"Lambda",Xi:"Xi",Sigma:"Sigma",Upsilon:"Upsilon",Phi:"Phi",Psi:"Psi",Omega:"Omega"},Em={Add:[(n,e)=>{let t=n.ops??[];return t.length===2&&t[0].operator==="Negate"&&t[1].operator!=="Negate"&&t[1].isNumberLiteral&&(t=[t[1],t[0]]),t.reduce((i,r)=>{if(r.operator==="Negate"){let o=e(r.op1,10);return i===""?`-${o}`:o.startsWith("+")?`${i} - ${o.substring(1)}`:o.startsWith("-")?`${i} + ${o.substring(1)}`:`${i} - ${o}`}return vm(i,e(r,10))},"")??""},11],Negate:[(n,e)=>{let t=e(n.op1,14),i=n.op1?.operator;return i==="Power"||i==="Square"?`-(${t})`:`-${t}`},14],Subtract:[(n,e)=>n.ops?.reduce((t,i)=>{let r=e(i,10);return t===""?r:r.startsWith("-")?`${t} - (${r})`:`${t} - ${r}`},"")??"",11],Multiply:[(n,e)=>{if(!n.ops)return"";if(n.nops===2){let t=n.op1.numericValue;if(t!==null){typeof t!="number"&&t.im!==0&&ml(e(n.op2,12),vm(t.re.toString(),`${t.im}i`));let i=n.op2;if((i.symbol||i.operator==="Power"||i.operator==="Square"||typeof qr[i.operator]=="string")&&Qt(t)&&t[0]===1){let r=t[1];return`${e(i,12)}/${r}`}return ml(e(n.op1,12),e(n.op2,12))}}return n.ops.reduce((t,i)=>ml(t,e(i,12)),"")},12],Divide:["/",13],Power:[(n,e)=>{let t=e(n.op2,14);if(t==="1")return e(n.op1);if(t==="(1/2)"||t==="1/2"||t==="0.5")return`sqrt(${e(n.op1)})`;if(t==="-0.5"||t==="-1/2"||t==="(-1/2)")return`1 / sqrt(${e(n.op1)})`;let i=e(n.op1,14);return i.startsWith("-")&&(i=`(${i})`),t.length===1?`${i}^${t}`:`${i}^${gn(t)}`},15],Equal:["===",8],NotEqual:["!==",8],LessEqual:["<=",9],GreaterEqual:[">=",9],Less:["<",9],Greater:[">",9],And:["&&",4],Or:["||",3],Not:["!",14]},qr={Abs:(n,e)=>`|${e(n.op1)}|`,Norm:(n,e)=>`||${e(n.op1)}||`,Sin:"sin",Cos:"cos",Tan:"tan",Sec:"sec",Csc:"csc",Cot:"cot",Arcsin:"arcsin",Arccos:"arccos",Arctan:"arctan",Arcsec:"arcsec",Arccsc:"arccsc",Arccot:"arccot",Sinh:"sinh",Cosh:"cosh",Tanh:"tanh",Sech:"sech",Csch:"csch",Coth:"coth",Arsinh:"arsinh",Arcosh:"arcosh",Artanh:"artanh",Arsech:"arsech",Arcsch:"arcsch",Arcoth:"arcoth",Ceil:"ceil",Exp:"exp",Factorial:(n,e)=>`${e(n.op1,12)}!`,Floor:"floor",Log:"log",Ln:"ln",Log10:"log10",Sqrt:"sqrt",Root:(n,e)=>{let t=n.op1,i=n.op2;return i.is(2)?`sqrt${gn(e(t))}`:`root${gn(e(i))}${gn(e(t))}`},Square:(n,e)=>`${e(n.op1,12)}^2`,Det:"det",Dim:"dim",Mod:"mod",GCD:"gcd",LCM:"lcm",Lub:"lub",Glb:"glb",Max:"max",Min:"min",PlusMinus:(n,e)=>{let[t,i]=n.ops??[];if(!i)return e(t);if(t&&i){let r=e(t),o=e(i);return`${r} \xB1 ${o}`}return t?`\xB1 ${e(t)}`:i?`\xB1 ${e(i)}`:"0"},Sum:(n,e)=>dl(n,"sum",e),Product:(n,e)=>dl(n,"prod",e),Integrate:(n,e)=>dl(n,"int",e),Limit:(n,e)=>{let[t,i]=n.ops??[];if(t?.operator==="Function"){let r=t.ops?.slice(2)??[],o=t.op1??t,s=null;return r.length===1&&(s=r[0]),s?`lim_(${e(s)} -> ${e(i)}) ${e(o)}`:`lim_(${e(i)}) ${e(o)}`}else if(t?.symbol)return`lim_(x -> ${e(i)}) ${e(t)}(x)`;return"lim"},Delimiter:(n,e)=>w1(n.ops[0],n.ops[1]?.string,e),Sequence:(n,e)=>n.nops===0?"":n.ops.map(t=>e(t)).join(" "),List:(n,e)=>`[${n.ops?.map(t=>e(t))??""}]`,Single:(n,e)=>`(${n.ops.map(t=>e(t)).join(", ")})`,Pair:(n,e)=>`(${n.ops.map(t=>e(t)).join(", ")})`,Triple:(n,e)=>`(${n.ops.map(t=>e(t)).join(", ")})`,Tuple:(n,e)=>`(${n.ops.map(t=>e(t)).join(", ")})`,Block:(n,e)=>n.nops===0?"{}":n.nops===1?`{${e(n.op1)}}`:`{    ${n.ops.map(t=>e(t)).join(`;
     `)}
    }`,EvaluateAt:(n,e)=>{let t=n.op1,i=n.ops.slice(1);return i.length===0?e(t):i.length===1?`(${e(t)})|_(${e(i[0])})`:i.length===2?`(${e(t)})|_(${e(i[0])})^(${e(i[1])})`:`(${e(t)})|_(${i.map(r=>e(r)).join(", ")})`},Function:(n,e)=>{let t=n.ops.slice(1),i=()=>t.map(r=>e(r)).join(", ");return n.op1.operator==="Block"?n.op1.nops===0?`(${i()}) |-> {}`:n.op1.nops===1?t.length===1&&t[0].symbol==="_1"?`(_) |-> ${e(n.op1.op1.subs({_1:"_"}))}`:`(${i()}) |-> ${e(n.op1.op1)}`:`(${i()}) |-> {
    ${n.op1.ops.map(r=>e(r)).join(`;
     `)}
}`:`(${i()}) |-> ${e(n.op1)}`},Domain:n=>JSON.stringify(n.json),Error:(n,e)=>n.nops===1?`Error(${e(n.op1)})`:n.nops===2?n.op1.string?`Error("${n.op1.string}", ${e(n.op2)})`:`Error(${e(n.op1)}, ${e(n.op2)})`:`Error(${n.ops.map(t=>e(t)).join(", ")})`,LatexString:n=>`"${n.op1.string??""}"`}});async function Fr(n,e,t){let i=performance.now();for(;;){let r=performance.now(),o=16;for(;performance.now()-r<o;){let{done:s,value:a}=n.next();if(s)return a;if(t?.aborted)throw new On({value:a,cause:t.reason});if(performance.now()-i>=e)throw new On({value:a,cause:"timeout",message:`Timeout exceeded (${e}ms)`})}await new Promise(s=>setTimeout(s,0))}}function Vr(n,e){let t=Date.now();for(;;){let{done:i,value:r}=n.next();if(i)return r;if(Date.now()-t>=e)throw new On({value:r,cause:"timeout",message:`Timeout exceeded (${e}ms)`})}}var On,Vo=k(()=>{On=class extends Error{cause;value;constructor({message:e,value:t,cause:i}={}){super(e??"Operation canceled"),t&&(this.value=t),this.cause=i,this.name="CancellationError"}}});function gl(n,e){for(n.isInteger()&&e.isInteger();!e.isZero();)[n,e]=[e,n.modulo(e)];return n.abs()}function Nm(n,e){return n.mul(e).div(gl(n,e))}function Tm(n,e){if(!e.isInteger()||e.isNegative())return n._BIGNUM_NAN;if(e.lessThan(1))return n._BIGNUM_ONE;let t=e;for(;e.greaterThan(2);)e=e.minus(2),t=t.mul(e);return t}function Wi(n){return n.isFinite()?n.d.length>3||n.d.length===3&&n.d[0]>=90?!1:(n.precision()<=16,n.e<308&&n.e>-306):!0}var $o=k(()=>{});function A1(n){if(n==="N")return[0,""];let e={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3},t=0,i=0;n=n.toUpperCase();for(let r=n.length-1;r>=0;r--){let o=e[n[r]];if(o===void 0)return[t,n.slice(r)];o<i?t-=o:t+=o,i=o}return[t,""]}function jo(n,e){if(n=n.trim(),n.length===0)return[NaN,""];if(n.startsWith("+"))return jo(n.slice(1),e);if(n.startsWith("-")){let[r,o]=jo(n.slice(1),e);return[-r,o]}let t=10;if(typeof e=="string"&&(e=e.toLowerCase()),n.startsWith("0x"))t=16,n=n.slice(2);else if(n.startsWith("0b"))t=2,n=n.slice(2);else{if(e==="roman")return A1(n);if(e==="base64"||e==="base-64")try{return[parseInt(btoa(n)),""]}catch{return[NaN,""]}else typeof e=="number"?t=e:typeof e=="string"&&(t=parseInt(e))}let i=0;for(let r=0;r<n.length;r++){let o={" ":-1,"\xA0":-1,"\u2000":-1,"\u2001":-1,"\u2002":-1,"\u2003":-1,"\u2004":-1,"\u2005":-1,"\u2006":-1,"\u2007":-1,"\u2008":-1,"\u2009":-1,"\u200A":-1,"\u200B":-1,"\u202F":-1,"\u205F":-1,_:-1,",":-1,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35}[n[r]];if(o!==-1){if(o===void 0)return[i,n.substring(r)];if(o>=t)return[i,n.substring(r)];i=i*t+o}}return[i,""]}function Ze(n,e){if(typeof e=="number"&&typeof n=="number")return n.toFixed(e);let t=n.toString();if(typeof n=="number"&&Number.isInteger(n)&&t.includes("e")){let i=BigInt(n).toString(),r=i.match(/0+$/);if((r?r[0].length:0)<=5)return i}else if(typeof n=="bigint"){let i=t.match(/0+$/),r=i?i[0].length:0;if(r>5)return`${t.slice(0,-r)}e+${r}`}return t}var Ji=k(()=>{});function Sm(n){if(typeof n=="number")return Number.isInteger(n)?BigInt(n):null;if(n==null||!$t(n))return null;let e=yi(n)?n.num:n;if(typeof e=="number")return Number.isInteger(e)?BigInt(e):null;if(typeof e!="string")return null;let t=e.toLowerCase().replace(/[nd]$/,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,"");return t==="nan"||/^(infinity|\+infinity|oo|\+oo|-infinity|-oo)$/.test(t)?null:be(t)}function ln(n,e){if(typeof n=="number")return isNaN(n)?"NaN":Number.isFinite(n)?typeof e=="number"?{num:n.toFixed(e)}:n:n<0?"NegativeInfinity":"PositiveInfinity";if(n>=Number.MIN_SAFE_INTEGER&&n<=Number.MAX_SAFE_INTEGER)return Number(n);let t=Ze(n);return Number(n).toString()===t?Number(n):{num:t}}var $r=k(()=>{Ye();Vt();Ji()});var ae,kn=k(()=>{ae=class{get bignumRe(){}im;get bignumIm(){}isZeroWithTolerance(e){return this.isZero}valueOf(){return this.im===0?this.bignumRe?this.bignumRe.toNumber():this.re:this.toString()}[Symbol.toPrimitive](e){return e==="string"?this.toString():this.valueOf()}toJSON(){if(this.im===0){let e=this.re;if(Number.isFinite(e))return e}return this.N().toString()}print(){let e=console.log;e?.(this.toString())}}});var ye,Xt=k(()=>{_n();en();St();kn();$r();Ji();Nn();ye=class n extends ae{__brand;rational;radical;im=0;factory;bignum;constructor(e,t,i){if(super(),this.factory=t,this.bignum=i,typeof e=="number"){!Number.isFinite(e)||Number.isInteger(e),this.rational=[e,1],this.radical=1;return}if(typeof e=="bigint"){this.rational=[e,BigInt(1)],this.radical=1;return}typeof e!="object"||"im"in e;let r=1;if(typeof r!="number"||Number.isInteger(r),r==0){this.rational=[0,1],this.radical=1;return}let o=e.rational?[...e.rational]:[1,1];r!=1&&(typeof r=="bigint"?o=Tt(o,[r,BigInt(1)]):o=Tt(o,[r,1])),this.rational=o,this.radical=e.radical??1,this.radical<=K&&this.radical>=1,this.normalize()}get type(){return this.isNaN?"number":this.isPositiveInfinity||this.isNegativeInfinity?"non_finite_number":this.radical!==1?(Nt(this.rational),"finite_real"):zi(this.rational)?"finite_integer":"finite_rational"}get isExact(){return!0}get asExact(){return this}toJSON(){if(this.isNaN)return"NaN";if(this.isPositiveInfinity)return"PositiveInfinity";if(this.isNegativeInfinity)return"NegativeInfinity";if(this.isZero)return 0;if(this.isOne)return 1;if(this.isNegativeOne)return-1;let e=t=>zi(t)?ln(t[0]):["Rational",ln(t[0]),ln(t[1])];return this.radical===1?e(this.rational):nn(this.rational)?["Sqrt",this.radical]:qo(this.rational)?["Negate",["Sqrt",this.radical]]:this.rational[0]==1?["Divide",["Sqrt",this.radical],ln(this.rational[1])]:this.rational[0]==-1?["Negate",["Divide",["Sqrt",this.radical],ln(this.rational[1])]]:["Multiply",e(this.rational),["Sqrt",this.radical]]}clone(e){return new n(e,this.factory,this.bignum)}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";let e=i=>zi(i)?Ze(i[0]):`${Ze(i[0])}/${Ze(i[1])}`;if(this.radical===1)return e(this.rational);let t=i=>`sqrt(${Ze(i)})`;return nn(this.rational)?t(this.radical):qo(this.rational)?`-${t(this.radical)}`:this.rational[0]==1?`${t(this.radical)}/${Ze(this.rational[1])}`:this.rational[0]==-1?`-${t(this.radical)}/${Ze(this.rational[1])}`:`${e(this.rational)}${t(this.radical)}`}get sign(){return Nt(this.rational)?0:cl(this.rational)?1:-1}get re(){return gm(this.rational)*Math.sqrt(this.radical)}get bignumRe(){let e,t=this.rational;return Ne(t)?e=this.bignum(t[0]).div(t[1]):e=this.bignum(t[0].toString()).div(this.bignum(t[1].toString())),this.radical===1?e:e.mul(this.bignum(this.radical).sqrt())}get numerator(){return this.rational[1]==1?this:this.clone({rational:Ne(this.rational)?[this.rational[0],1]:[this.rational[0],BigInt(1)],radical:this.radical})}get denominator(){return Ne(this.rational)?this.clone(this.rational[1]):this.clone({rational:[this.rational[1],BigInt(1)]})}normalize(){if(Number.isInteger(this.radical)&&this.radical>0&&Number.isFinite(this.radical),isNaN(this.radical)){this.rational=[NaN,1],this.radical=1;return}let[e,t]=this.rational;if(t==0){this.rational=[NaN,1],this.radical=1;return}if(this.radical===0||e===0){this.rational=[0,1],this.radical=1;return}if(this.radical>=4){let[i,r]=Ir(this.radical,2);typeof this.rational[0]=="number"?this.rational[0]*=i:this.rational=Tt(this.rational,[i,1]),this.radical=r}this.rational=Lr(this.rational)}get isNaN(){return Number.isNaN(this.rational[0])}get isPositiveInfinity(){return this.rational[0]==1/0}get isNegativeInfinity(){return this.rational[0]==-1/0}get isComplexInfinity(){return!1}get isZero(){return Nt(this.rational)}get isOne(){return!(this.rational[0]!==this.rational[1]||this.radical!==1)}get isNegativeOne(){return!(this.rational[0]!==-this.rational[1]||this.radical!==1)}sgn(){if(!Number.isNaN(this.rational[0]))return Nt(this.rational)?0:cl(this.rational)?1:-1}N(){return this.isZero||this.isOne||this.isNegativeOne?this:this.rational[1]==1&&this.radical===1?this:this.factory(this.bignumRe)}neg(){return this.isZero?this:this.clone({rational:Hi(this.rational),radical:this.radical})}inv(){return this.isOne?this:this.isNegativeOne?this:this.clone({rational:Ne(this.rational)?[this.rational[1],this.rational[0]*this.radical]:[this.rational[1],this.rational[0]*BigInt(this.radical)],radical:this.radical})}add(e){return typeof e=="number"?e===0?this:Number.isInteger(e)&&this.radical===1?this.clone({rational:Ne(this.rational)?[this.rational[0]+e*this.rational[1],this.rational[1]]:[this.rational[0]+BigInt(e)*this.rational[1],this.rational[1]]}):this.factory(this.bignumRe).add(e):e.isZero?this:this.isZero?e:e instanceof n?this.radical===e.radical?this.clone({rational:Zi(this.rational,e.rational),radical:this.radical}):this.factory(this.bignumRe).add(e):e.add(this)}sub(e){return this.add(e.neg())}mul(e){return e===0?this.clone(0):e===1?this:e===-1?this.neg():typeof e=="number"?Number.isInteger(e)?this.clone({rational:Ne(this.rational)?[this.rational[0]*e,this.rational[1]]:[this.rational[0]*BigInt(e),this.rational[1]],radical:this.radical}):this.factory(this.bignumRe).mul(e):e instanceof U?this.factory(e).mul(this):e.im!==0?e.mul(this):e.isZero?e:e.isOne?this:e.isNegativeOne?this.neg():e.isNaN?e:this.isZero?this:this.isOne?e:this.isNegativeOne?e.neg():e instanceof n?this.clone({rational:Tt(this.rational,e.rational),radical:this.radical*e.radical}):e.mul(this)}div(e){if(typeof e=="number")return e===1?this:e===-1?this.neg():e===0?this.clone(NaN):this.clone({rational:Ne(this.rational)?[this.rational[0],this.rational[1]*e]:[this.rational[0],this.rational[1]*BigInt(e)],radical:this.radical});if(e.isOne)return this;if(e.isNegativeOne)return this.neg();if(this.isZero)return e.isZero?this.clone(NaN):e.isNaN?e:this;if(e.isNaN)return e;if(e.isZero)return this.clone(this.sign*(1/0));if(!(e instanceof n))return this.factory(this.bignumRe).div(e);if(e.im!==0)return this.factory(this.bignumRe).div(e);let t;if(Ne(this.rational)&&Ne(e.rational)){let[i,r]=this.rational,[o,s]=e.rational;t=[i*s,r*o*e.radical]}else t=Tt(this.rational,[BigInt(e.rational[1]),BigInt(e.rational[0])*BigInt(e.radical)]);return this.clone({rational:t,radical:this.radical*e.radical})}pow(e){if(Array.isArray(e),this.isNaN)return this;if(typeof e=="number"&&isNaN(e))return this.clone(NaN);if(e instanceof ae){if(e.isNaN)return this.clone(NaN);if(e.isZero)return this.clone(1);if(e.isOne)return this;if(e.im)e={re:e.re,im:e.im};else{if(e instanceof n&&e.radical===1&&e.rational[0]==1)return this.root(e.rational[0]);e=e.re}}if(e===.5)return this.sqrt();if(typeof e=="object"&&("re"in e||"im"in e))return this.factory(this.bignumRe).pow(e);if(this.isPositiveInfinity){if(e===-1)return this.clone(0);if(e===1/0)return this.clone(1/0);if(e===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&e===1/0)return this.clone(NaN);if((e===1/0||e===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(e===1)return this;if(e===-1)return this.inv();if(e===0)return this.clone(1);if(this.isZero){if(e>0)return this;if(e<0)return this.factory({im:1/0})}if(e<0)return this.pow(-e).inv();if(e%1===.5)return this.pow(Math.floor(e)).mul(this.sqrt());if(this.radical>K||this.rational[0]>K||this.rational[0]<-K||this.rational[1]>K)return this.factory(this.bignumRe).pow(e);if(this.sign<0){if(Number.isInteger(e)){let t=e%2===0?1:-1;return this.clone({rational:Ne(this.rational)?[t*(-this.rational[0])**e,this.rational[1]**e]:[BigInt(t)*(-this.rational[0])**BigInt(e),this.rational[1]**BigInt(e)],radical:this.radical**e})}return this.factory({im:(-this.re)**e})}else if(Number.isInteger(e))return this.clone({rational:Ne(this.rational)?[this.rational[0]**e,this.rational[1]**e]:[BigInt(this.rational[0])**BigInt(e),this.rational[1]**BigInt(e)],radical:this.radical**e});return this.factory(this.bignumRe).pow(e)}root(e){if(e===0)return this.clone(NaN);if(this.isNaN)return this;if(this.isZero)return this;if(e===1)return this;if(e===-1)return this.inv();if(e<0)return this.root(-e).inv();if(e%1===.5)return this.root(Math.floor(e)).sqrt();if(this.radical===1){if(this.sign>0){let t=this.re;if(Number.isInteger(t)){if(t>0){let i=Math.pow(t,1/e);if(Number.isInteger(i))return this.clone(i)}return this.factory(this.bignumRe).root(e)}}return this.factory(this.bignumRe).root(e)}if(this.sign<0)return this.factory({im:Math.pow(-this.re,1/e)});if(this.radical>K||this.rational[0]>K||this.rational[0]<-K||this.rational[1]>K)return this.factory(this.bignumRe).root(e);if(this.rational[1]==1){let t=Math.pow(this.rational[0],1/e);if(Number.isInteger(t))return this.clone(t)}return this.factory(this.bignumRe).root(e)}sqrt(){if(this.isZero||this.isOne)return this;if(this.radical===1)if(Ne(this.rational)){let[e,t]=this.rational;return e*t>K?this.factory(this.bignumRe).sqrt():e>0?this.clone({radical:e*t,rational:[1,t]}):this.factory({im:Math.sqrt(-e*t)/t})}else return this.factory(this.bignumRe).sqrt();if(this.sign>0){let e=Math.sqrt(this.re);if(Number.isInteger(e))return this.clone(e)}return this.factory(this.bignumRe).sqrt()}gcd(e){if(!(e instanceof n))return e.gcd(this);if(this.isOne||e.im!==0||e.isOne)return this.clone(1);let t=fa(this.rational,e.rational),i=un(this.radical,e.radical);return this.clone({rational:t,radical:i})}abs(){return this.sign===-1?this.neg():this}ln(e){return this.isZero?this.clone(NaN):this.isPositiveInfinity?this.clone(1/0):this.sign<0?this.clone(NaN):this.isOne?this.clone(0):this.isNegativeOne?this.factory({im:Math.PI}):this.factory(this.bignumRe).ln(e)}exp(){return this.isNaN?this.clone(NaN):this.isZero?this.clone(1):this.isNegativeInfinity?this.clone(0):this.isPositiveInfinity?this.clone(1/0):this.factory(this.bignumRe).exp()}floor(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.floor(this.re))}ceil(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.ceil(this.re))}round(){return this.isNaN?this.clone(NaN):this.type==="integer"?this:this.clone(Math.round(this.re))}eq(e){return typeof e=="number"?this.radical===1&&zi(this.rational)&&this.rational[0]==e:e instanceof n?this.radical===e.radical&&this.rational[0]==e.rational[0]&&this.rational[1]==e.rational[1]:e.im===0&&e.re===this.re}lt(e){return this.im,typeof e=="number"?this.re<e:this.re<e.re}lte(e){return this.im,typeof e=="number"?this.re<=e:this.re<=e.re}gt(e){return this.im,typeof e=="number"?this.re>e:this.re>e.re}gte(e){return this.im,typeof e=="number"?this.re>=e:this.re>=e.re}static sum(e,t,i){if(e.length===1)return e;if(e.some(u=>!u.isExact)){if(e.length===2)return[e[0].add(e[1])];let u=t(0);for(let l of e)u=u.add(l);return[u]}let r=0,o=[0,1],s=[];for(let u of e){if(u.isNaN)return[new n(NaN,t,i)];if(!u.isZero)if(r+=u.im,u instanceof n){let l=u.rational;if(u.radical===1)o=Zi(o,l);else{let c=s.findIndex(f=>f.radical===u.radical);c===-1?s.push({multiple:l,radical:u.radical}):s[c].multiple=Zi(s[c].multiple,l)}}else w(u.type,"integer"),o=Zi(o,[u.re,1])}if(Nt(o)&&s.length===0)return r===0?[new n(0,t,i)]:[t({im:r})];let a=[];return r!==0&&a.push(t({im:r})),s.length===0?a.push(new n({rational:o},t,i)):(s.push({multiple:o,radical:1}),a.push(...s.map(u=>new n({rational:u.multiple,radical:u.radical},t,i)))),a}}});function Qe(n){let e=n.numericValue;if(e===null||typeof e=="number"&&!Number.isFinite(e)||e instanceof ae&&(e.isNaN||e.isPositiveInfinity||e.isNegativeInfinity))return;if(typeof e=="number")return Number.isInteger(e)?[e,1]:void 0;let t=e.type;if(t!=="finite_integer"&&t!=="finite_rational"||e.im!==0)return;if(e instanceof ye)return e.radical!==1?void 0:e.rational;let i=e.bignumRe;if(i!==void 0&&Number.isInteger(i))return[be(i),BigInt(1)];let r=e.re;if(Number.isInteger(r))return[r,1]}function Kt(n){if(n==null)return null;if(typeof n=="bigint")return n;if(typeof n=="number"&&Number.isInteger(n))return BigInt(n);if(ei(n)){let e=n.numericValue;if(e===null)return null;if(typeof e=="number")return Number.isInteger(e)?BigInt(e):null;if(e.im!==0)return null;let t=e.bignumRe;return t?.isInteger()?be(t):Number.isInteger(e.re)?BigInt(e.re):null}return n instanceof U||typeof n=="string"?be(n):n instanceof ie?n.im===0?be(n.re):null:Sm(n)}function hl(n){if(n==null)return null;let e=typeof n=="number"?n:n.numericValue;if(e===null)return null;if(typeof e=="number")return n.engine.bignum(e);if(e.im!==0)return null;let t=e.bignumRe??e.re;return typeof t=="number"&&isNaN(t)?null:n.engine.bignum(t)}function J(n){if(n==null)return null;if(typeof n=="number")return Number.isInteger(n)&&n>=-K&&n<=K?n:null;let e=n.numericValue;if(e===null)return null;if(typeof e=="number")return Number.isInteger(e)&&e>=-K&&e<=K?e:null;if(e.im!==0)return null;let t=e.re;return Number.isInteger(t)&&t>=-K&&t<=K?Number(t):null}function G(n){let e=n?.numericValue??void 0;return e===void 0?null:Math.round(typeof e=="number"?e:e.re)}function De(n){if(n==null)return null;let e=n.numericValue;if(e===null)return null;if(typeof e=="number")return BigInt(Math.round(e));let t=e.bignumRe??e.re;return typeof t=="number"?BigInt(Math.round(t)):be(t.round())}var Xe=k(()=>{Fi();_n();me();en();Vt();Xt();kn();$r()});var wm={};yr(wm,{choose:()=>da,expand:()=>Ln,expandAll:()=>Ur,expandFunction:()=>Bm,expandProducts:()=>jr});function It(n,e){if(n.operator==="Negate"&&e.operator==="Negate")return It(n.op1,e.op1);let t=n.engine;if(n.operator==="Negate")return It(n.op1,e).neg();if(e.operator==="Negate")return It(n,e.op1).neg();if(n.operator==="Divide"&&e.operator==="Divide"){let i=n.op2.mul(e.op2);return It(n.op1,e.op1).div(i)}return n.operator==="Divide"?It(n.op1,e).div(n.op2):e.operator==="Divide"?It(n,e.op1).div(e.op2):n.operator==="Add"?X(...n.ops.map(i=>It(i,e))):e.operator==="Add"?X(...e.ops.map(i=>It(n,i))):new fn(t,[n,e]).asExpression()}function jr(n,e){if(e.length===0)return null;if(e.length===1)return e[0];if(e.length===2)return It(e[0],e[1]);let t=jr(n,e.slice(1));return t===null?null:It(e[0],t)}function da(n,e){for(;n>=Uo.length;){let t=Uo.length,i=[1],r=Uo[t-1];for(let o=1;o<t;o++)i[o]=r[o-1]+r[o];i[t]=1,Uo.push(i)}return Uo[n][e]}function k1(n){let e=n.reduce((i,r)=>i+r,0),t=1;for(let i=0;i<n.length;i+=1)t*=da(e,n[i]),e-=n[i];return t}function*Im(n,e){if(n===1){yield[e];return}for(let t=0;t<=e;t+=1)for(let i of Im(n-1,e-t))yield[t,...i]}function xl(n,e){let t=n.engine;if(e<0){let s=xl(n,-e);return s?s.inv():null}if(e===0)return t.One;if(e===1)return Ln(n);if(n.operator==="Negate"&&Number.isInteger(e)){let s=e%2===0?1:-1,a=xl(n.op1,e);return a===null?null:s>0?a:a.neg()}if(n.operator,n.operator!=="Add")return null;let i=n.ops,r=Im(i.length,e),o=[];for(let s of r){let a=[t.number(k1(s))];for(let u=0;u<s.length;u+=1)s[u]!==0&&(s[u]===1?a.push(i[u]):a.push(i[u].pow(s[u])));o.push(pe(...a))}return X(...o)}function Bm(n,e,t){let i=null;if(e==="Divide"){let r=Ln(t[0]);return r===null?null:r.operator==="Add"?X(...r.ops.map(o=>o.div(t[1]))):n._fn("Divide",[r,t[1]])}if(e==="Multiply")return jr(n,t);if(e==="Negate")return Ln(t[0])?.neg()??null;if(e==="Add")return X(...t.map(r=>Ln(r)??r));if(e==="Power"){let r=J(t[1]);i=r!==null?xl(t[0],r):null}return i}function Ln(n){return n=n?.canonical,!n||typeof n.operator!="string"?null:Dn(n.operator)?n.engine._fn(n.operator,n.ops.map(e=>Ln(e)??e)):Bm(n.engine,n.operator,n.ops??[])}function Ur(n){if(!n.operator||!n.ops)return null;let e=n.ops.map(i=>Ur(i)??i),t=n.engine.function(n.operator,e);return Ln(t)??t}var Uo,Ni=k(()=>{Pn();Xe();cn();tn();Gr();Uo=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]]});function Am(n){let e=-1;for(;n.operator==="Negate";)n=n.op1,e=-e;return e===1?n:n.isNumberLiteral?n.neg():n.engine._fn("Negate",[n])}function Yi(n){let e=-1;for(;n.operator==="Negate";)n=n.op1,e=-e;if(e===1)return n;if(n.numericValue!==null)return n.neg();let t=n.engine;return n.operator==="Subtract"?n.op2.sub(n.op1):n.operator==="Add"?X(...n.ops.map(i=>Yi(i))):n.operator==="Multiply"?yl(t,n.ops):n.operator==="Divide"?Yi(n.op1).div(n.op2):t._fn("Negate",[n])}function yl(n,e){if(e.length===0)return n.NegativeOne;if(e.length===1)return Yi(e[0]);let t=[],i=!1;for(let r of e)!i&&r.operator==="Negate"?(i=!0,r.op1.is(1)||t.push(r.op1)):t.push(r);if(!i){t=[];for(let r of e)i||r.numericValue===null&&!r.isInteger?t.push(r):(i=!0,r.is(-1)||t.push(r.neg()))}if(i)return n._fn("Multiply",t.sort(Pe));if(!i){t=[];for(let r of e)i||r.numericValue===null||!r.isNumber?t.push(r):(i=!0,r.is(-1)||t.push(r.neg()))}return i?n._fn("Multiply",t.sort(Pe)):n._fn("Negate",[n._fn("Multiply",[...e].sort(Pe))])}var Go=k(()=>{tn();ut()});function Zn(n,e){let t=n.engine;if(!n.isValid||!e.isValid)return t._fn("Divide",[n,e]);if(n.isNaN||e.isNaN)return t.NaN;let i=e.symbols.length===0&&!e.isNumberLiteral;if(e.is(0))return n.is(0)?t.NaN:t.ComplexInfinity;if(n.is(0)&&e.isFinite!==!1)return i?t._fn("Divide",[n,e],{canonical:!1}):t.Zero;if(e.isInfinity)return n.isInfinity?t.NaN:t.Zero;if(e.is(0)===!1&&e.isFinite!==!1){if(n.symbol!==null&&n.symbol===e.symbol&&n.isConstant)return t.One;if(n.isSame(e))return i?t._fn("Divide",[n,e],{canonical:!1}):t.One}if(n.operator==="Negate"&&e.operator==="Negate"&&(n=n.op1,e=e.op1),n.operator==="Divide"&&e.operator==="Divide")return Zn($e(t,[n.op1,e.op2]),$e(t,[n.op2,e.op1]));if(n.operator==="Divide")return Zn(n.op1,$e(t,[n.op2,e]));if(e.operator==="Divide")return Zn($e(t,[n,e.op2]),e.op1);if(e.is(1))return n;if(e.is(-1))return n.neg();if(n.is(1))return e.inv();if(n.operator==="Sqrt"&&e.operator==="Sqrt"){let f=J(n.op1),p=J(e.op1);if(f!==null&&p!==null)return t.number(t._numericValue({radical:f*p,rational:[1,p]}))}else if(n.operator==="Sqrt"){let f=J(n.op1),p=J(e);if(f!==null&&p!==null)return t.number(t._numericValue({radical:f,rational:[1,p]}))}else if(e.operator==="Sqrt"){let f=J(n),p=J(e.op1);if(f!==null&&p!==null)return t.number(t._numericValue({radical:p,rational:[f,p]}))}let r=n.numericValue,o=e.numericValue;if(r!==null&&o!==null){if(typeof r!="number"&&r.im!==0||typeof o!="number"&&o.im!==0)return t._fn("Divide",[n,e]);if(typeof r=="number"&&Number.isInteger(r)&&typeof o=="number"&&Number.isInteger(o))return o===0?r===0?t.NaN:t.ComplexInfinity:t.number([r,o]);if(typeof r=="number"&&Number.isInteger(r)){if(r===0)return t.Zero;if(typeof o!="number"&&w(o.type,"integer")){let f=o.bignumRe;if(f!==void 0){if(f.isInteger())return t.number([be(r),be(f)])}else{let p=o.re;if(Number.isInteger(p))return t.number([r,p])}}}return t._fn("Divide",[n,e])}let[s,a]=n.toNumericValue();if(s.isZero)return t.Zero;let[u,l]=e.toNumericValue();if(u.isZero)return t.NaN;let c=s.div(u);return c.isOne?l.is(1)?a:t._fn("Divide",[a,l]):c.isNegativeOne?l.is(1)?a.neg():t._fn("Divide",[a.neg(),l]):c.isExact?a.is(1)&&l.is(1)?t.number(c):l.is(1)?$e(t,[t.number(c),a]):t._fn("Divide",[$e(t,[t.number(c.numerator),a]),$e(t,[t.number(c.denominator),l])]):t._fn("Divide",[n,e])}function zr(n,e){let t=n.engine;if(n=n.canonical,typeof e!="number"&&(e=e.canonical),n.isNaN)return t.NaN;if(typeof e=="number"){if(isNaN(e))return t.NaN;if(n.is(0))return e===0||!isFinite(e)?t.NaN:n;if(e===1)return n;if(e===-1)return n.neg();if(e===0)return t.ComplexInfinity;if(n.isNumberLiteral){let r=n.numericValue;if(typeof r=="number"){if(Number.isInteger(r)&&Number.isInteger(e))return t.number(t._numericValue({rational:[r,e]}))}else if(r.isExact&&Number.isInteger(e))return t.number(r.asExact.div(e))}}else{if(e.isNaN)return t.NaN;if(n.is(0))return e.is(0)||e.isFinite===!1?t.NaN:t.Zero;if(e.is(1))return n;if(e.is(-1))return n.neg();if(e.is(0))return t.NaN;if(n.isNumberLiteral&&e.isNumberLiteral){let r=n.numericValue,o=e.numericValue;if(typeof r=="number"&&typeof o=="number"&&Number.isInteger(r)&&Number.isInteger(o))return t.number(t._numericValue({rational:[r,o]}));if(typeof r=="number"&&Number.isInteger(r)&&typeof o!="number"){if(o.isExact)return t.number(t._numericValue(r).div(o.asExact))}else if(typeof o=="number"&&Number.isInteger(o)&&typeof r!="number"){if(r.isExact)return t.number(r.asExact.div(o))}else if(typeof r!="number"&&typeof o!="number"&&r.isExact&&o.isExact)return t.number(r.asExact.div(o.asExact))}}let i=new fn(t,[n]);return i.div(typeof e=="number"?t._numericValue(e):e),i.asRationalExpression()}function $e(n,e){let t=1,i=[];for(let o of e){let[s,a]=C1(o);t*=a,i.push(s)}i=i.filter(o=>!o.is(1));let r=[];for(let o=0;o<i.length;o++){let s=i[o];if(o+1>=i.length){r.push(s);continue}let a=i[o+1];if(s.isNumberLiteral){if(a.operator==="Sqrt"&&a.op1.isNumberLiteral&&a.op1.type.matches("finite_integer")){let u=a.op1.numericValue;if(typeof u!="number"&&(u=u.re),u>=K){r.push(s);continue}if(s.type.matches("finite_rational")){let l=s.numericValue,[c,f]=typeof l=="number"?[l,1]:[l.numerator.re,l.denominator.re];r.push(n.number(n._numericValue({rational:[c,f],radical:u}))),o++;continue}}else if(a.isNumberLiteral&&a.numericValue instanceof ae){let u=a.numericValue;if(u instanceof ye&&nn(u.rational)&&u.radical!==1){let l=Qe(s);if(l){r.push(n.number(n._numericValue({rational:l,radical:u.radical}))),o++;continue}}else if(u.im===1){let l=s.numericValue;if(typeof l=="number"){r.push(n.number(n.complex(0,l))),o++;continue}else if(l.im===0){if(Number.isInteger(l.re)){r.push(n.number(n.complex(0,l.re))),o++;continue}else if(!l.isExact){r.push(n.number(n.complex(0,l.re))),o++;continue}}}}}r.push(s)}return t<0?r.length===0?n.number(-1):r.length===1?r[0].neg():yl(n,r):r.length===0?n.number(1):r.length===1?r[0]:n._fn("Multiply",[...r].sort(Pe))}function C1(n){let e=1;for(;n.operator==="Negate";)e=-e,n=n.op1;return n.isNumberLiteral&&n.isNegative&&(e=-e,n=n.neg()),[n,e]}function pe(...n){if(n.length>0,n.length===1)return n[0];let e=n[0].engine,t=jr(e,n);if(t){if(t.operator!=="Multiply")return t;n=t.ops}return new fn(e,n).asRationalExpression()}function km(...n){n.length>0;let e=n[0].engine;n=n.map(i=>i.N());let t=jr(e,n);if(t){if(t.operator!=="Multiply")return t;n=t.ops}return new fn(e,n).asExpression({numericApproximation:!0})}var cn=k(()=>{Nn();Xt();en();St();Vt();Xe();Gr();Ni();Go();ut();kn()});function ma(n){let e=n.toString();if(n.isInteger()&&e.includes("e")){let t=n.toFixed(),i=t.match(/0+$/);if((i?i[0].length:0)<=5)return t}return e}function Zr(n){return Math.abs(n)<=1e-14?0:n}var Qi,bl=k(()=>{_n();kn();Xt();$o();$r();Ji();Vt();Qi=class n extends ae{__brand;decimal;bignum;constructor(e,t){if(super(),this.bignum=t,typeof e=="number")this.decimal=t(e),this.im=0;else if(e instanceof U)this.decimal=e,this.im=0;else{let i=t(e.re??0);this.decimal=i,this.im=e.im??0}this.decimal.isNaN()&&(this.im=NaN),this.decimal.isNaN(),isNaN(this.im)}get type(){return this.isNaN?"number":this.isComplexInfinity?"complex":this.im!==0?this.decimal.isZero()?"imaginary":"finite_complex":this.decimal.isFinite()?this.decimal.isInteger()?"finite_integer":"finite_real":"non_finite_number"}get isExact(){return this.im===0&&this.decimal.isInteger()}get asExact(){if(this.isExact)return this._makeExact(be(this.decimal))}toJSON(){return this.isNaN?"NaN":this.isPositiveInfinity?"PositiveInfinity":this.isNegativeInfinity?"NegativeInfinity":this.isComplexInfinity?"ComplexInfinity":this.im===0?Wi(this.decimal)?this.decimal.toNumber():{num:ma(this.decimal)}:Wi(this.decimal)?["Complex",ln(this.decimal.toNumber()),ln(this.im)]:["Complex",{num:ma(this.decimal)},ln(this.im)]}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";if(this.im===0)return ma(this.decimal);if(this.decimal.isZero())return this.im===1?"i":this.im===-1?"-i":`${Ze(this.im)}i`;if(this.isComplexInfinity)return"~oo";let e="";return this.im===1?e="+ i":this.im===-1?e="- i":this.im>0?e=`+ ${this.im}i`:e=`- ${-this.im}i`,`(${ma(this.decimal)} ${e})`}clone(e){return new n(e,this.bignum)}_makeExact(e){return new ye(e,t=>this.clone(t),this.bignum)}get re(){return this.decimal.toNumber()}get bignumRe(){return this.decimal}get numerator(){return this}get denominator(){return this._makeExact(1)}get isNaN(){return this.decimal.isNaN()}get isPositiveInfinity(){return this.im===0&&!this.decimal.isFinite()&&!this.decimal.isNaN()&&this.decimal.isPositive()}get isNegativeInfinity(){return this.im===0&&!this.decimal.isFinite()&&!this.decimal.isNaN()&&this.decimal.isNegative()}get isComplexInfinity(){return!Number.isFinite(this.im)&&!Number.isNaN(this.im)}get isZero(){return this.im===0&&this.decimal.isZero()}isZeroWithTolerance(e){if(this.im!==0)return!1;let t=typeof e=="number"?this.bignum(e):e;return this.decimal.abs().lte(t)}get isOne(){return this.im===0&&this.decimal.eq(1)}get isNegativeOne(){return this.im===0&&this.decimal.eq(-1)}sgn(){if(this.im===0){if(this.decimal.isZero())return 0;if(this.decimal.isPositive())return 1;if(this.decimal.isNegative())return-1}}N(){return this}neg(){return this.isZero?this:this.clone({re:this.decimal.neg(),im:-this.im})}inv(){if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.clone(this.decimal.pow(-1));let e=Math.hypot(this.re,this.im),t=this.decimal.mul(this.decimal).add(this.im*this.im).sqrt();return this.clone({re:this.decimal.div(t),im:-this.im/e})}add(e){return typeof e=="number"?e===0?this:this.clone({re:this.decimal.add(e),im:this.im}):e.isZero?this:this.isZero?this.clone(e):this.clone({re:this.decimal.add(e.bignumRe??e.re),im:this.im+e.im})}sub(e){return this.add(e.neg())}mul(e){if(this.isZero)return this;if(e===1)return this;if(e===-1)return this.neg();if(e===0)return this.clone(0);if(this.isOne)return typeof e=="number"||e instanceof U?this.clone(e):this.clone({re:e.bignumRe??e.re,im:e.im});if(typeof e=="number")return this.im===0?this.clone(this.decimal.mul(e)):this.clone({re:this.decimal.mul(e),im:this.im*e});if(e instanceof U)return this.im===0?this.clone(this.decimal.mul(e)):this.clone({re:this.decimal.mul(e),im:this.im*e.toNumber()});if(this.isNegativeOne){let t=e.neg();return this.clone({re:t.bignumRe??t.re,im:t.im})}return e.isOne?this:e.isNegativeOne?this.neg():e.isZero?this.clone(0):this.im===0&&e.im===0?this.clone(this.decimal.mul(e.bignumRe??e.re)):this.clone({re:this.decimal.mul(e.bignumRe??e.re).sub(this.im*e.im),im:this.re*e.im+this.im*e.re})}div(e){if(typeof e=="number")return e===1?this:e===-1?this.neg():e===0?this.clone(NaN):this.clone({re:this.decimal.div(e),im:this.im/e});if(e.isOne)return this;if(e.isNegativeOne)return this.neg();if(e.isZero)return this.clone(this.isZero?NaN:1/0);if(this.im===0&&e.im===0)return this.clone(this.decimal.div(e.bignumRe??e.re));let[t,i]=[this.re,this.im],[r,o]=[e.re,e.im],s=r*r+o*o,a=e.bignumRe??this.bignum(e.re),u=a.mul(a).add(o*o);return this.clone({re:this.decimal.mul(a).add(i*o).div(u),im:(i*r-t*o)/s})}pow(e){if(Array.isArray(e),this.isNaN)return this;if(typeof e=="number"&&isNaN(e))return this.clone(NaN);if(e instanceof ae){if(e.isNaN)return this.clone(NaN);if(e.isZero)return this.clone(1);if(e.isOne)return this;e.im?e={re:e.re,im:e.im}:e=e.re}if(typeof e=="object"&&("re"in e||"im"in e)){let[u,l]=[e?.re??0,e?.im??0];if(Number.isNaN(l)||Number.isNaN(u))return this.clone(NaN);if(l===0)e=u;else{if(this.im===1/0)return this.clone(NaN);if(this.isNegativeInfinity)return this.clone(0);if(this.isPositiveInfinity)return this.clone({im:1/0});let c=this.pow(u),f=this.decimal.ln().mul(l),p=this.clone({re:f.cos(),im:Zr(f.sin().toNumber())});return c.mul(p)}}if(this.isPositiveInfinity){if(e===-1)return this.clone(0);if(e===1/0)return this.clone(1/0);if(e===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&e===1/0)return this.clone(NaN);if((e===1/0||e===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(e===1)return this;if(e===-1)return this.inv();if(e===0)return this.clone(1);if(this.isZero){if(e>0)return this;if(e<0)return this.clone({im:1/0})}if(e<0)return this.pow(-e).inv();if(this.im===0)return this.clone(this.decimal.pow(e));let t=this.decimal,i=this.im,r=t.mul(t).add(i*i).sqrt(),o=U.atan2(i,t),s=r.pow(e),a=o.mul(e);return this.clone({re:s.mul(a.cos()),im:Zr(s.mul(a.sin()).toNumber())})}root(e){if(!Number.isInteger(e))return this._makeExact(NaN);if(e===0)return this._makeExact(NaN);if(e===1)return this;if(this.isZero)return this;if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.decimal.isNegative()?this._makeExact(NaN):e===2?this.clone(this.decimal.sqrt()):e===3?this.clone(this.decimal.cbrt()):this.clone(this.decimal.pow(1/e));let t=this.decimal,i=this.im,r=t.mul(t).add(i*i).sqrt(),o=U.atan2(i,t),s=r.pow(1/e),a=o.div(e);return this.clone({re:s.mul(a.cos()),im:Zr(s.mul(a.sin()).toNumber())})}sqrt(){if(this.isZero||this.isOne)return this;if(this.im!==0){let e=this.decimal,t=this.im,i=e.mul(e).add(t*t).sqrt(),r=e.add(i).div(2).sqrt(),o=Zr(Math.sign(t)*i.sub(e).div(2).sqrt().toNumber());return this.clone({re:r,im:o})}return this.decimal.isPositive()?this.clone(this.decimal.sqrt()):this.clone({im:Math.sqrt(-this.re)})}gcd(e){if(this.isZero)return e;if(e.isZero)return this;if(this.im!==0||e.im!==0)return this._makeExact(NaN);if(!this.decimal.isInteger())return this._makeExact(1);let t=this.bignum(e.bignumRe??e.re);if(!t.isInteger())return this._makeExact(1);let i=this.decimal;for(;!t.isZero();){let r=t;t=i.mod(t),i=r}return this.clone(i.abs())}abs(){return this.im===0?this.decimal.isPositive()?this:this.clone(this.decimal.neg()):this.clone(this.decimal.pow(2).add(this.im**2).sqrt())}ln(e){if(this.isZero)return this._makeExact(NaN);if(this.isNegativeInfinity)return this._makeExact(NaN);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im===0)return this.decimal.isNegative()?this._makeExact(NaN):this.isOne?this._makeExact(0):this.isNegativeOne?this.clone({im:Math.PI}):e===void 0?this.clone(this.decimal.ln()):this.clone(this.decimal.log(e));let t=this.decimal,i=this.im,r=t.mul(t).add(i*i).sqrt(),o=U.atan2(i,t).toNumber();return e===void 0?this.clone({re:r.ln(),im:o}):this.clone({re:r.log(e),im:o})}exp(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(1);if(this.isNegativeInfinity)return this._makeExact(0);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im!==0){let e=this.decimal.exp();return this.clone({re:e.mul(Zr(Math.cos(this.im))),im:Zr(e.mul(Math.sin(this.im)).toNumber())})}return this.clone(this.decimal.exp())}floor(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(be(this.decimal.floor()))}ceil(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(be(this.decimal.ceil()))}round(){return this.isNaN||this.im!==0?this._makeExact(NaN):this.decimal.isInteger()?this:this._makeExact(be(this.decimal.round()))}eq(e){return this.isNaN?!1:typeof e=="number"?this.im===0&&this.decimal.eq(e):e.isNaN?!1:Number.isFinite(this.im)?this.decimal.eq(e.bignumRe??e.re)&&this.im-e.im===0:!Number.isFinite(e.im)}lt(e){return this.im,typeof e=="number"?this.decimal.lt(e):this.decimal.lt(e.bignumRe??e.re)}lte(e){return this.im,typeof e=="number"?this.decimal.lte(e):this.decimal.lte(e.bignumRe??e.re)}gt(e){return this.im,typeof e=="number"?this.decimal.gt(e):this.decimal.gt(e.bignumRe??e.re)}gte(e){return this.im,typeof e=="number"?this.decimal.gte(e):this.decimal.gte(e.bignumRe??e.re)}}});function Cm(n){return Math.abs(n)<=1e-14?0:n}var Xi,El=k(()=>{_n();kn();Ji();$r();Xt();Xi=class n extends ae{__brand;decimal;bignum;constructor(e,t){if(super(),this.bignum=t,typeof e=="number")this.decimal=e,this.im=0;else if(e instanceof U)this.decimal=e.toNumber(),this.im=0;else{let i=e.re===void 0?0:e.re instanceof U?e.re.toNumber():e.re;this.decimal=i,this.im=e.im??0,isFinite(this.im)||(this.decimal=this.im)}isNaN(this.im)}_makeExact(e){return new ye(e,t=>this.clone(t),this.bignum)}get type(){return this.isNaN?"number":this.isComplexInfinity?"complex":this.im!==0?this.decimal===0?"imaginary":"finite_complex":Number.isFinite(this.decimal)?Number.isInteger(this.decimal)?"finite_integer":"finite_real":"non_finite_number"}get isExact(){return this.im===0&&Number.isInteger(this.decimal)}get asExact(){if(this.isExact)return this._makeExact(this.decimal)}toJSON(){return this.isNaN?"NaN":this.isPositiveInfinity?"PositiveInfinity":this.isNegativeInfinity?"NegativeInfinity":this.im===0?ln(this.decimal):["Complex",ln(this.decimal),ln(this.im)]}toString(){if(this.isZero)return"0";if(this.isOne)return"1";if(this.isNegativeOne)return"-1";if(this.im===0)return Ze(this.decimal);if(this.decimal===0)return this.im===1?"i":this.im===-1?"-i":`${Ze(this.im)}i`;if(this.isComplexInfinity)return"~oo";let e="";return this.im===1?e="+ i":this.im===-1?e="- i":this.im>0?e=`+ ${Ze(this.im)}i`:e=`- ${Ze(-this.im)}i`,`(${Ze(this.decimal)} ${e})`}clone(e){return new n(e,this.bignum)}get re(){return this.decimal}get bignumRe(){}get numerator(){return this}get denominator(){return this._makeExact(1)}get isNaN(){return Number.isNaN(this.decimal)}get isPositiveInfinity(){return!Number.isFinite(this.decimal)&&this.decimal>0&&this.im===0}get isNegativeInfinity(){return!Number.isFinite(this.decimal)&&this.decimal<0&&this.im===0}get isComplexInfinity(){return!Number.isFinite(this.im)&&!Number.isNaN(this.im)}get isZero(){return this.im===0&&this.decimal===0}isZeroWithTolerance(e){if(this.im!==0)return!1;let t=e instanceof U?e.toNumber():e;return Math.abs(this.decimal)<t}get isOne(){return this.im===0&&this.decimal===1}get isNegativeOne(){return this.im===0&&this.decimal===-1}sgn(){if(!(this.im!==0||!Number.isFinite(this.decimal)))return Math.sign(this.decimal)}N(){return this}neg(){return this.isNaN?this._makeExact(NaN):this.isZero?this:this.clone({re:-this.decimal,im:-this.im})}inv(){if(this.isNaN)return this._makeExact(NaN);if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.im===0)return this.clone(1/this.decimal);let e=Math.hypot(this.re,this.im);return this.clone({re:this.decimal/e,im:-this.im/e})}add(e){return this.isNaN?this._makeExact(NaN):typeof e=="number"?e===0?this:this.clone({re:this.decimal+e,im:this.im}):e.isZero?this:this.isZero?this.clone({re:e.bignumRe??e.re,im:e.im}):this.clone({re:this.decimal+e.re,im:this.im+e.im})}sub(e){return this.add(e.neg())}mul(e){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this;if(e instanceof U&&(e=e.toNumber()),e===1)return this;if(e===-1)return this.neg();if(e===0)return this.clone(0);if(this.isOne)return typeof e=="number"||e instanceof U?this.clone(e):this.clone({re:e.bignumRe??e.re,im:e.im});if(typeof e=="number")return this.im===0?this.clone(this.decimal*e):this.clone({re:this.decimal*e,im:this.im*e});if(this.isNegativeOne){let t=e.neg();return this.clone({re:t.bignumRe??t.re,im:t.im})}return e.isOne?this:e.isNegativeOne?this.neg():e.isZero?this.clone(0):this.im===0&&e.im===0?this.clone(this.decimal*e.re):this.clone({re:this.decimal*e.re-this.im*e.im,im:this.re*e.im+this.im*e.re})}div(e){if(this.isNaN)return this._makeExact(NaN);if(typeof e=="number")return e===1?this:e===-1?this.neg():e===0?this.clone(NaN):this.clone({re:this.decimal/e,im:this.im/e});if(e.isOne)return this;if(e.isNegativeOne)return this.neg();if(e.isZero)return this.clone(this.isZero?NaN:1/0);if(this.im===0&&e.im===0)return this.clone(this.decimal/e.re);let[t,i]=[this.decimal,this.im],[r,o]=[e.re,e.im],s=r*r+o*o;return this.clone({re:(t*r+i*o)/s,im:(i*r-t*o)/s})}pow(e){if(Array.isArray(e),this.isNaN)return this._makeExact(NaN);if(typeof e=="number"&&isNaN(e))return this.clone(NaN);if(e instanceof ae){if(e.isNaN)return this.clone(NaN);if(e.isZero)return this.clone(1);if(e.isOne)return this;e.im?e={re:e.re,im:e.im}:e=e.re}if(typeof e=="object"&&("re"in e||"im"in e)){let[u,l]=[e?.re??0,e?.im??0];if(Number.isNaN(l)||Number.isNaN(u))return this.clone(NaN);if(l===0)e=u;else{if(this.im===1/0)return this.clone(NaN);if(this.isNegativeInfinity)return this.clone(0);if(this.isPositiveInfinity)return this.clone({im:1/0});let c=this.pow(u).re,f=Math.log(this.decimal)*l;return this.clone({re:Cm(c*Math.cos(f)),im:Cm(c*Math.sin(f))})}}if(this.isPositiveInfinity){if(e===-1)return this.clone(0);if(e===1/0)return this.clone(1/0);if(e===-1/0)return this.clone(0)}else if(this.isNegativeInfinity&&e===1/0)return this.clone(NaN);if((e===1/0||e===-1/0)&&(this.isOne||this.isNegativeOne))return this.clone(NaN);if(e===1)return this;if(e===-1)return this.inv();if(e===0)return this.clone(1);if(this.isZero){if(e>0)return this;if(e<0)return this.clone({im:1/0})}if(e<0)return this.clone(1/this.decimal**-e);if(this.im===0)return this.clone(this.decimal**e);let t=this.decimal,i=this.im,r=Math.sqrt(t*t+i*i),o=Math.atan2(i,t),s=r**e,a=o**e;return this.clone({re:s*Math.cos(a),im:s*Math.sin(a)})}root(e){if(this.isNaN)return this._makeExact(NaN);if(e===0)return this.clone(NaN);if(this.isNaN)return this;if(this.isZero)return this;if(this.isOne)return this;if(this.isNegativeOne)return this;if(e===1)return this;if(e===2)return this.sqrt();if(e===3)return this.clone(Math.cbrt(this.decimal));if(this.im===0)return this.decimal<0?e%2===0?this.clone(NaN):this.clone(-Math.pow(-this.decimal,1/e)):this.clone(Math.pow(this.decimal,1/e));let t=this.decimal,i=this.im,r=Math.hypot(t,i),o=Math.atan2(i,t),s=Math.pow(r,1/e),a=o/e;return this.clone({re:s*Math.cos(a),im:s*Math.sin(a)})}sqrt(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero||this.isOne)return this;if(this.im!==0){let e=this.decimal,t=this.im,i=Math.sqrt(e*e+t*t),r=Math.sqrt((e+i)/2),o=Math.sign(t)*Math.sqrt((i-e)/2);return this.clone({re:r,im:o})}return this.decimal>0?this.clone(Math.sqrt(this.decimal)):this.clone({im:Math.sqrt(-this.decimal)})}gcd(e){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return e;if(e.isZero)return this;if(this.im!==0||e.im!==0)return this._makeExact(NaN);if(!Number.isInteger(this.decimal))return this._makeExact(1);let t=e.re;if(!Number.isInteger(t))return this._makeExact(1);let i=this.decimal;for(;t!==0;){let r=t;t=i%t,i=r}return this.clone(Math.abs(i))}abs(){return this.isNaN?this._makeExact(NaN):this.im===0?this.decimal>0?this:this.clone(-this.decimal):this.clone(Math.sqrt(this.decimal**2+this.im**2))}ln(e){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(NaN);if(this.isNegativeInfinity)return this._makeExact(NaN);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im===0)return this.decimal<0?this._makeExact(NaN):this.isOne?this._makeExact(0):this.isNegativeOne?this.clone({im:Math.PI}):e===void 0?this.clone(Math.log(this.decimal)):this.clone(Math.log(this.decimal)/Math.log(e));let t=this.decimal,i=this.im,r=Math.hypot(t,i),o=Math.atan2(i,t),s=e===void 0?Math.log(r):Math.log(r)/Math.log(e);return this.clone({re:s,im:o})}exp(){if(this.isNaN)return this._makeExact(NaN);if(this.isZero)return this._makeExact(1);if(this.isNegativeInfinity)return this._makeExact(0);if(this.isPositiveInfinity)return this._makeExact(1/0);if(this.im!==0){let e=Math.exp(this.decimal);return this.clone({re:e*Math.cos(this.im),im:e*Math.sin(this.im)})}return this.clone(Math.exp(this.decimal))}floor(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.floor(this.decimal))}ceil(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.ceil(this.decimal))}round(){return this.isNaN||this.im!==0?this._makeExact(NaN):Number.isInteger(this.decimal)?this:this._makeExact(Math.round(this.decimal))}eq(e){return this.isNaN?!1:typeof e=="number"?this.im===0&&this.decimal-e===0:e.isNaN?!1:Number.isFinite(this.im)?this.decimal-e.re===0&&this.im-e.im===0:!Number.isFinite(e.im)}lt(e){return this.im,typeof e=="number"?this.decimal<e:this.decimal<e.re}lte(e){return this.im,typeof e=="number"?this.decimal<=e:this.decimal<=e.re}gt(e){return this.im,typeof e=="number"?this.decimal>e:this.decimal>e.re}gte(e){return this.im,typeof e=="number"?this.decimal>=e:this.decimal>=e.re}}});function Rm(n,e){let t=o=>n.bignum(o),i=o=>new ye(o,r,t),r=n.precision>Et?o=>new Qi(o,t):o=>new Xi(o,i);return ye.sum(e,r,t)}function R1(n,e){let t=s=>n.bignum(s),i=s=>new ye(s,r,t),r=n.precision>Et?s=>new Qi(s,t):s=>new Xi(s,i),o=ye.sum(e,r,t);return o.length===0?i(0):o.length===1?o[0].N():o.reduce((s,a)=>s.add(a).N())}var Hr,Mm=k(()=>{tn();cn();en();Xt();bl();El();Hr=class{engine;terms=[];constructor(e,t){this.engine=e;let i=0,r=0,o=[];for(let s of t){if(s.type.is("complex")&&s.isInfinity){this.terms=[{term:e.ComplexInfinity,coef:[]}];return}if(s.isNaN||s.symbol==="Undefined"){this.terms=[{term:e.NaN,coef:[]}];return}let[a,u]=s.toNumericValue();a.isPositiveInfinity?i+=1:a.isNegativeInfinity&&(r+=1),u.is(1)?a.isZero||o.push(a):this.add(a,u)}if(i>0&&r>0){this.terms=[{term:e.NaN,coef:[]}];return}if(i>0){this.terms=[{term:e.PositiveInfinity,coef:[]}];return}if(r>0){this.terms=[{term:e.NegativeInfinity,coef:[]}];return}o.length===1?this.add(o[0],e.One):o.length>0&&Rm(e,o).forEach(s=>this.add(s,e.One))}add(e,t){if(t.is(0)||e.isZero)return;if(t.is(1)){let r=this.engine;this.terms.push({coef:[],term:r.number(e)});return}if(t.operator==="Add"){for(let r of t.ops){let[o,s]=r.toNumericValue();this.add(e.mul(o),s)}return}if(t.operator==="Negate"){this.add(e.neg(),t.op1);return}let i=this.find(t);if(i>=0){this.terms[i].coef.push(e);return}t.numericValue===null||t.is(1),this.terms.push({coef:[e],term:t})}find(e){return this.terms.findIndex(t=>t.term.isSame(e))}N(){let e=this.engine,t=this.terms;if(t.length===0)return e.Zero;let i=[],r=[];for(let{coef:s,term:a}of t)if(s.length===0)a.isNumberLiteral?typeof a.numericValue=="number"?r.push(e._numericValue(a.numericValue)):r.push(a.numericValue):i.push(a);else{let u=s.reduce((l,c)=>l.add(c)).N();if(u.isZero)continue;u.eq(1)?i.push(a.N()):u.eq(-1)?i.push(a.N().neg()):i.push(a.N().mul(e.box(u)))}let o=R1(e,r);if(!o.isZero){if(i.length===0)return e.box(o);i.push(e.box(o))}return qn(e,i)}asExpression(){let e=this.engine,t=this.terms;return t.length===0?e.Zero:qn(e,t.map(({coef:i,term:r})=>{if(i.length===0)return r;let o=Rm(e,i);if(o.length===0)return r;if(o.length>1)return $e(e,[qn(e,o.map(a=>e.box(a))),r]);let s=o[0];return s.isNaN?e.NaN:s.isZero?e.Zero:s.eq(1)?r:s.eq(-1)?r.neg():r.is(1)?e.box(s):r.mul(e.box(s))}))}}});function ha(n,e){switch(e){case"float64":case"float32":case"int32":case"uint8":return new ga(n);case"complex128":case"complex64":return new _l(n);case"bool":case"expression":return new vl(n);case void 0:return new ga(n)}throw new Error(`Unknown dtype ${e}`)}function xa(n,e){return n===void 0?e:n===e?n:n==="expression"||e==="expression"?"expression":n==="complex128"||e==="complex128"?"complex128":n==="complex64"||e==="complex64"?"complex64":n==="float64"||e==="float64"?"float64":n==="float32"||e==="float32"?"float32":n==="int32"||e==="int32"?"int32":n==="uint8"||e==="uint8"?"uint8":n==="bool"||e==="bool"?"bool":"expression"}function Dm(n){if(n.symbol==="True"||n.symbol==="False")return"bool";if(n.symbol==="NaN"||n.symbol==="PositiveInfinity"||n.symbol==="NegativeInfinity")return"float64";if(n.symbol==="ComplexInfinity"||n.symbol==="ImaginaryUnit")return"complex128";if(n.isNumberLiteral)switch(n.type.type){case"real":case"rational":case"finite_real":case"finite_rational":case"integer":return"float64";case"complex":case"finite_complex":case"imaginary":return"complex128";case"finite_integer":{let e=n.re;return e>=0&&e<=255?"uint8":"int32"}default:return"expression"}return"expression"}var ga,vl,_l,Nl=k(()=>{cn();tn();ga=class{constructor(e){this.ce=e}one=1;zero=0;nan=NaN;cast(e,t){let i=this.ce;switch(t){case"float64":case"float32":case"int32":case"uint8":return e;case"complex128":case"complex64":return Array.isArray(e)?e.map(r=>i.complex(r)):this.ce.complex(e);case"bool":return Array.isArray(e)?e.map(r=>r!==0):e!==0;case"expression":return Array.isArray(e)?e.map(r=>i.number(r)):i.number(e)}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return this.ce.number(e)}isZero(e){return e===0}isOne(e){return e===1}equals(e,t){return e===t}add(e,t){return e+t}addn(...e){return e.reduce((t,i)=>t+i,0)}neg(e){return-e}sub(e,t){return e-t}mul(e,t){return e*t}muln(...e){return e.reduce((t,i)=>t*i,1)}div(e,t){return e/t}pow(e,t){return e**t}conjugate(e){return e}},vl=class{one;zero;nan;ce;constructor(e){this.zero=e.Zero,this.nan=e.NaN,this.ce=e}cast(e,t){if(Array.isArray(e))return e.map(i=>this.cast(i,t));switch(t){case"float64":case"float32":return e.im===0?e.re:void 0;case"int32":return typeof e.re=="number"?Math.round(e.re):void 0;case"uint8":if(typeof e.re!="number")return;let i=Math.round(e.re);return i>=0&&i<=255?i:void 0;case"complex128":case"complex64":let[r,o]=[e.re,e.im];return typeof r=="number"&&typeof o=="number"?this.ce.complex(r,o):typeof r=="number"?this.ce.complex(r):void 0;case"bool":let s=e.valueOf();return typeof s=="boolean"?s:void 0;case"expression":return e}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return e}isZero(e){return e.is(0)}isOne(e){return e.is(1)}equals(e,t){return e.isSame(t)===!0}add(e,t){return e.add(t)}addn(...e){return X(...e)}neg(e){return e.neg()}sub(e,t){return e.sub(t)}mul(e,t){return e.mul(t)}muln(...e){return pe(...e)}div(e,t){return e.div(t)}pow(e,t){return e.pow(t)}conjugate(e){return this.ce.function("Conjugate",[e]).evaluate()}},_l=class{one;zero;nan;ce;constructor(e){this.ce=e,this.one=e.complex(1),this.zero=e.complex(0),this.nan=e.complex(NaN)}cast(e,t){if(Array.isArray(e))return e.map(i=>this.cast(i,t));switch(t){case"float64":return e.im===0?e.re:void 0;case"float32":return e.im===0?e.re:void 0;case"int32":return e.im===0?Math.round(e.re):void 0;case"uint8":if(e.im!==0)return;let i=Math.round(e.re);return i>=0&&i<=255?i:void 0;case"complex128":return e;case"complex64":return e;case"bool":return!(e.im===0&&e.re===0);case"expression":return this.ce.number(e)}throw new Error(`Cannot cast ${e} to ${t}`)}expression(e){return this.ce.number(e)}isZero(e){return e.isZero()}isOne(e){return e.re===1&&e.im===0}equals(e,t){return e.equals(t)}add(e,t){return e.add(t)}addn(...e){return e.reduce((t,i)=>t.add(i),this.zero)}neg(e){return e.neg()}sub(e,t){return e.sub(t)}mul(e,t){return e.mul(t)}muln(...e){return e.reduce((t,i)=>t.mul(i),this.one)}div(e,t){return e.div(t)}pow(e,t){return e.pow(t)}conjugate(e){return e.conjugate()}}});function zo(n){let e=new Array(n.length);for(let t=n.length-1,i=1;t>=0;t--)e[t]=i,i*=n[t];return e}function Cn(n,e){let t=e.dtype;return t==="float64"||t==="float32"||t==="uint8"||t==="int32"?new Tl(n,e):t==="bool"?new Il(n,e):t==="complex64"||t==="complex128"?new Sl(n,e):new Bl(n,e)}var Wr,Tl,Sl,Il,Bl,Pm=k(()=>{Nl();Wr=class n{constructor(e,t){this.ce=e;this.shape=t.shape,this.rank=this.shape.length,this._strides=zo(this.shape),this.field=ha(e,t.dtype)}static align(e,t){if(e.dtype===t.dtype)return[e,t];let i=xa(e.dtype,t.dtype);return e.dtype===i?[e,t.upcast(i)]:[e.upcast(i),t]}static broadcast(e,t,i){if(!(i instanceof n))return t.map1(e,i);let[r,o]=n.align(t,i),s=r.data.map((a,u)=>e(a,o.data[u]));return Cn(r.ce,{dtype:r.dtype,shape:r.shape,data:s})}field;shape;rank;_strides;get expression(){let e=this.shape,t=this.rank,i=this.data,r=this._index.bind(this),o=this.field.expression.bind(this.field),s=a=>{if(a.length===t-1){let u=r(a);return this.ce._fn("List",i.slice(u,u+e[t-1]).map(l=>o(l)))}else{let u=[];for(let l=1;l<=e[a.length];l++)u.push(s([...a,l]));return this.ce._fn("List",u)}};return s([])}get array(){let e=this.shape,t=this.rank,i=this.data;if(t===1)return i;if(t===2){let[s,a]=e,u=new Array(s);for(let l=0;l<s;l++)u[l]=i.slice(l*a,(l+1)*a);return u}let r=this._index.bind(this),o=s=>{if(s.length===t-1){let a=r(s);return i.slice(a,a+e[t-1])}else{let a=[];for(let u=0;u<e[s.length];u++)a.push(o([...s,u+1]));return a}};return o([])}_index(e){let t=this._strides;return e.reduce((i,r,o)=>i+(r-1)*t[o],0)}get isSquare(){let e=this.shape;return e.length===2&&e[0]===e[1]}get isSymmetric(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.equals.bind(this.field);for(let r=0;r<e;r++)for(let o=r+1;o<e;o++)if(!i(t[r*e+o],t[o*e+r]))return!1;return!0}get isSkewSymmetric(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.equals.bind(this.field),r=this.field.neg.bind(this.field);for(let o=0;o<e;o++)for(let s=o+1;s<e;s++)if(!i(t[o*e+s],r(t[s*e+o])))return!1;return!0}get isUpperTriangular(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.isZero.bind(this.field);for(let r=1;r<e;r++)for(let o=0;o<r;o++)if(i(t[r*e+o]))return!1;return!0}get isLowerTriangular(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.isZero.bind(this.field);for(let r=0;r<e-1;r++)for(let o=r+1;o<e;o++)if(!i(t[r*e+o]))return!1;return!0}get isTriangular(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.isZero.bind(this.field);for(let r=0;r<e;r++)for(let o=0;o<e;o++)if(r<o&&!i(t[r*e+o])||r>o&&!i(t[r*e+o]))return!1;return!0}get isDiagonal(){if(!this.isSquare)return!1;let e=this.shape[0],t=this.data,i=this.field.isZero.bind(this.field);for(let r=0;r<e;r++)for(let o=0;o<e;o++)if(r===o&&!i(t[r*e+o])||r!==o&&!i(t[r*e+o]))return!1;return!0}get isIdentity(){if(!this.isSquare)return!1;let[e,t]=this.shape,i=this.data,r=this.field.isOne.bind(this.field),o=this.field.isZero.bind(this.field);for(let s=0;s<t;s++)for(let a=0;a<t;a++)if(s===a&&!r(i[s*t+a])||s!==a&&!o(i[s*t+a]))return!1;return!0}get isZero(){let e=this.field.isZero.bind(this.field);return this.data.every(t=>e(t))}at(...e){let t=this.data.length;return this.data[this._index(e)%t]}diagonal(e,t){if(e??=1,t??=2,e===t||e<=0||e>this.shape.length||this.shape[e-1]!==this.shape[t-1])return;let i=new Array(this.shape[e-1]),r=this.data,o=this.shape[e-1];for(let s=0;s<o;s++)i[s]=r[s*o+s];return i}trace(e,t){let i=this.rank;if(i<2)return;e??=i-1,t??=i;let r=e-1,o=t-1;if(this.shape[r]!==this.shape[o])return;let s=this.shape[r];if(i===2){let p=this.data,d=s,m=new Array(d);for(let g=0;g<d;g++)m[g]=p[g*d+g];return this.field.addn(...m)}let a=this.shape.filter((p,d)=>d!==r&&d!==o),u=zo(this.shape),l=a.reduce((p,d)=>p*d,1),c=new Array(l),f=zo(a);for(let p=0;p<l;p++){let d=new Array(a.length),m=p;for(let y=0;y<a.length;y++)d[y]=Math.floor(m/f[y]),m=m%f[y];let g=new Array(i),h=0;for(let y=0;y<i;y++)y===r||y===o?g[y]=0:g[y]=d[h++];let x=new Array(s);for(let y=0;y<s;y++){g[r]=y,g[o]=y;let v=0;for(let E=0;E<i;E++)v+=g[E]*u[E];x[y]=this.data[v]}c[p]=this.field.addn(...x)}return Cn(this.ce,{dtype:this.dtype,shape:a,data:c})}reshape(...e){return Cn(this.ce,{dtype:this.dtype,shape:e,data:this.data})}slice(e){if(e<0&&(e=this.shape[0]+e+1),this.rank===0)return this;if(this.rank===1){let s=this.data[e-1];return Cn(this.ce,{dtype:this.dtype,shape:[],data:[s]})}let t=this.shape[1],i=this._strides[0],r=e*i,o=r+i;return Cn(this.ce,{dtype:this.dtype,shape:this.shape.slice(1),data:this.data.slice(r,o)})}flatten(){return this.data}upcast(e){let t=this.field.cast(this.data,e);if(t===void 0)throw Error(`Cannot cast tensor to ${e}`);return Cn(this.ce,{dtype:e,shape:this.shape,data:t})}transpose(e,t,i){let r=this.rank;if(r===1)return this;if(e??=r-1,t??=r,e===t)return this;if(e<=0||e>r||t<=0||t>r)return;let o=e-1,s=t-1,a=[...this.shape];[a[o],a[s]]=[a[s],a[o]];let u=this.data;if(i&&(u=u.map(d=>i(d))),r===2){let[d,m]=this.shape,g=0,h=new Array(d*m);for(let x=0;x<m;x++)for(let y=0;y<d;y++)h[g++]=u[y*m+x];return Cn(this.ce,{dtype:this.dtype,shape:a,data:h})}let l=u.length,c=new Array(l),f=zo(this.shape),p=zo(a);for(let d=0;d<l;d++){let m=new Array(r),g=d;for(let y=0;y<r;y++)m[y]=Math.floor(g/p[y]),g=g%p[y];let h=[...m];[h[o],h[s]]=[h[s],h[o]];let x=0;for(let y=0;y<r;y++)x+=h[y]*f[y];c[d]=u[x]}return Cn(this.ce,{dtype:this.dtype,shape:a,data:c})}conjugateTranspose(e,t){let i=this.field.conjugate.bind(this.field);return this.transpose(e,t,i)}determinant(){if(this.rank!==2)return;let[e,t]=this.shape;if(e!==t)return;if(e===1)return this.data[0];let i=this.field.add.bind(this.field),r=this.field.mul.bind(this.field),o=this.field.neg.bind(this.field);if(e===2){let[g,h,x,y]=this.data;return i(r(g,y),o(r(h,x)))}let s=this.field.addn.bind(this.field),a=this.field.muln.bind(this.field);if(e===3){let[g,h,x,y,v,E,_,N,T]=this.data;return s([a(g,v,T),a(h,E,_),a(x,y,N),o(a(x,v,_)),o(a(h,y,T)),o(a(g,E,N))])}let u=this.shape[0],l=!1,c=this.field.div.bind(this.field),f=this.field.sub.bind(this.field),p=new Array(u).fill(0).map((g,h)=>h),d=[...this.data];for(let g=0;g<u;g++){let h=p[g-1];if(this.at(h,g)===0){let v;for(v=g+1;v<u;v++)if(this.at(p[v],g)!==0){h=p[v],p[v-1]=p[g-1],p[g-1]=h,l=!l;break}if(v===u)return this.at(h,g)}let x=this.at(h,g),y=g===0?1:this.at(p[g-2],g-2);for(let v=g+1;v<u;v++){let E=p[v-1];for(let _=g+1;_<u;_++)d[E][_]=c(f(r(d[E][_],x),r(d[E][g],d[h][_])),y)}}let m=d[p[u-1]][u-1];return l?this.field.neg(m):m}inverse(){if(this.rank!==2)return;let[e,t]=this.shape;if(e!==t)return;if(e===2){let[p,d,m,g]=this.data,h=this.determinant();if(h===void 0||this.field.isZero(h))return;let x=this.field.div.bind(this.field),y=this.field.neg.bind(this.field),v=[x(g,h),y(x(d,h)),y(x(m,h)),x(p,h)];return Cn(this.ce,{dtype:this.dtype,shape:[t,t],data:v})}let i=this.shape[0],r=this.field.div.bind(this.field),o=this.field.sub.bind(this.field),s=this.field.mul.bind(this.field),a=this.array,u=new Array(i).fill(0).map((p,d)=>{let m=new Array(i).fill(0);return m[d]=1,m}),l=a.map((p,d)=>[...p,...u[d]]),c=new Array(i).fill(0).map((p,d)=>d);for(let p=0;p<i;p++){let d=c[p-1];if(this.at(d,p)===0){let h;for(h=p+1;h<i;h++)if(this.at(c[h],p)!==0){d=c[h],c[h-1]=c[p-1],c[p-1]=d;break}if(h===i)return}let m=this.at(d,p),g=p===0?1:this.at(c[p-2],p-2);for(let h=p+1;h<i;h++){let x=c[h-1];for(let y=p+1;y<i*2;y++)l[x][y]=o(l[x][y],s(r(s(l[x][p],l[d][y]),m),g))}}for(let p=i-1;p>=0;p--){let d=l[c[p],p];for(let m=0;m<p;m++){let g=c[m];for(let h=i;h<i*2;h++)l[g][h]=o(l[g][h],s(r(s(l[g][p],l[p][h]),d),d))}for(let m=i;m<i*2;m++)l[p][m]=r(l[p][m],d)}let f=l.map(p=>p.slice(i));return Cn(this.ce,{dtype:this.dtype,shape:[t,t],data:f})}pseudoInverse(){}adjugateMatrix(){}minor(e,t){}map1(e,t){return Cn(this.ce,{dtype:this.dtype,shape:this.shape,data:this.data.map(i=>e(i,t))})}map2(e,t){let i=t.data;return Cn(this.ce,{dtype:this.dtype,shape:this.shape,data:this.data.map((r,o)=>e(r,i[o]))})}add(e){return n.broadcast(this.field.add.bind(this.field),this,e)}subtract(e){return n.broadcast(this.field.sub.bind(this.field),this,e)}multiply(e){return n.broadcast(this.field.mul.bind(this.field),this,e)}divide(e){return n.broadcast(this.field.div.bind(this.field),this,e)}power(e){return n.broadcast(this.field.pow.bind(this.field),this,e)}equals(e){if(this.rank!==e.rank||!this.shape.every((o,s)=>o===e.shape[s]))return!1;let t=this.field.equals.bind(this.field),i=this.field.cast.bind(this.field),r=this.dtype;return this.dtype!==e.dtype?!!this.data.every((o,s)=>t(o,i(e.data[s],r))):this.data.every((o,s)=>t(o,e.data[s]))}};Tl=class extends Wr{dtype="float64";data;constructor(e,t){super(e,t),this.data=t.data}get isZero(){return this.data.every(e=>e===0)}},Sl=class extends Wr{dtype="complex128";data;constructor(e,t){super(e,t),this.data=t.data}},Il=class extends Wr{dtype="bool";data;constructor(e,t){super(e,t),this.data=t.data}},Bl=class extends Wr{dtype="expression";data;constructor(e,t){super(e,t),this.data=t.data}}});function He(n){return n.symbol?.startsWith("_")??(n.operator==="Wildcard"||n.operator==="WildcardSequence"||n.operator==="WildcardOptionalSequence")}function pn(n){if(n.symbol?.startsWith("_"))return n.symbol;if(n.nops===1){let e=n.op1;if(n.operator==="Wildcard")return`_${e}`;if(n.operator==="WildcardSequence")return`__${e}`;if(n.operator==="WildcardOptionalSequence")return`___${e}`}return n.operator==="Wildcard"?"_":n.operator==="WildcardSequence"?"__":n.operator==="WildcardOptionalSequence"?"___":null}function Bt(n){if(typeof n=="string")return n.startsWith("_")?n.startsWith("__")?n.startsWith("___")?"OptionalSequence":"Sequence":"Wildcard":null;if(n.symbol!==null){let e=n.symbol;return e.startsWith("_")?e.startsWith("__")?e.startsWith("___")?"OptionalSequence":"Sequence":"Wildcard":null}if(n.isFunctionExpression){if(n.operator==="Wildcard")return"Wildcard";if(n.operator==="WildcardSequence")return"Sequence";if(n.operator==="WildcardOptionalSequence")return"OptionalSequence"}return null}var Jr=k(()=>{});function Z(n){return n instanceof Zo}function Om(n,e){let t,i=[],r=!0,o=(s,a=0)=>{if(!r)return;let u=s.length;if(u===0)return;if(i[a]===void 0)i[a]=u;else if(i[a]!==u){r=!1;return}let l=0;for(let f of s)f.operator===n&&l++;let c=u-l;if(l>0&&c>0){r=!1;return}if(l===u){for(let f of s)if(o(f.ops,a+1),!r)return}else for(let f of s)t=xa(t,Dm(f))};return o(e),r?{shape:i,dtype:t}:void 0}function M1(n,e,t,i,r){let o=!0,s=[],a=ha(n,"expression"),u=a.cast.bind(a),l=(c,f=0)=>{if(c.length!==0){if(i[f]===void 0)i[f]=c.length;else if(i[f]!==c.length){o=!1;return}for(let p of c){if(!o)return;if(p.operator===e)l(p.ops,f+1);else{let d=u(p,r);if(d===void 0){o=!1;return}s.push(d)}}}};if(l(t),!!o)return{shape:i,rank:i.length,data:s,dtype:r}}var Zo,Yr=k(()=>{In();Nl();Pm();lt();Jr();me();Zo=class n extends ue{constructor(t,i,r){super(t,r?.metadata);this.input=i;this.options=r;let o=M1(t,"List",i.ops,i.shape,i.dtype);if(!o)throw new Error("Invalid tensor");this._tensor=Cn(t,o)}_tensor;_expression;get structural(){return this._expression??=this._tensor.expression,this._expression}get tensor(){return this._tensor}get baseDefinition(){return this.structural.baseDefinition}get operatorDefinition(){return this.structural.operatorDefinition}get hash(){return Hn("BoxedTensor")}get canonical(){return this}get isCanonical(){return this._tensor?!0:this._expression.isCanonical}get isPure(){return this._tensor?!0:this.structural.isPure}get isValid(){return this._tensor?!0:this.structural.isValid}get complexity(){return 97}get operator(){return"List"}get nops(){return this._tensor?this._tensor.shape[0]:this.structural.nops}get ops(){return this.structural.ops}get op1(){if(this._tensor){let t=this._tensor.data;return t.length===0?this.engine.Nothing:this.engine.box(t[0])}return this.structural.op1}get op2(){if(this._tensor){let t=this._tensor.data;return t.length<2?this.engine.Nothing:this.engine.box(t[1])}return this.structural.op2}get op3(){if(this._tensor){let t=this._tensor.data;return t.length<3?this.engine.Nothing:this.engine.box(t[2])}return this.structural.op3}neg(){return this.structural.neg()}inv(){return this.engine.One.div(this.structural)}abs(){return this.structural.abs()}add(t){return this.structural.add(t)}sub(t){return this.structural.sub(t)}mul(t){return this.structural.mul(t)}div(t){return this.structural.div(t)}pow(t){return this.structural.pow(t)}root(t){return this.structural.root(t)}sqrt(){return this.structural.sqrt()}get shape(){return this.tensor.shape}get rank(){try{return this.tensor.rank}catch{}return 0}get type(){if(!this.isValid)return new R("error");let t=this.shape;if(t.length===0)return new R("number");let i=t.join("x");return new R(`list<number^${i}>`)}get json(){return this.structural.json}isEqual(t){return this===t?!0:t instanceof n?this.tensor.equals(t.tensor):this.structural.isEqual(t)}get isCollection(){return!0}get isIndexedCollection(){return!0}contains(t){return["float64","float32","int32","uint8"].includes(this.tensor.dtype)?this.tensor.data.includes(t.re):this.tensor.data.some(i=>t.isSame(this.tensor.field.cast(i,"expression")??t.engine.Nothing))}get count(){return this.tensor.shape.reduce((t,i)=>t*i,1)}each(){let t=this.tensor.shape,i=this.tensor.rank;if(i===0)return(function*(o){yield o})(this);let r=t[0];return i===1?(function*(o){for(let s=1;s<=r;s+=1){let a=o.tensor.data,u=s-1;u>=0&&u<a.length&&(yield o.engine.box(a[u]))}})(this):(function*(o){for(let s=1;s<=r;s+=1){let a=o.tensor.slice(s-1);yield new n(o.engine,{ops:a.expression.ops,shape:a.shape,dtype:a.dtype})}})(this)}at(t){let i=this.tensor.slice(t);if(i.rank===0)return this.engine.box(i.data[0]);if(i.rank===1)return this.engine.box(i.data[0]);if(i.rank>1)return new n(this.engine,{ops:i.expression.ops,shape:i.shape,dtype:i.dtype})}match(t,i){return ei(t)||(t=this.engine.box(t,{canonical:!1})),He(t)?{[pn(t)]:this}:this.structural.match(t,i)}evaluate(t){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.evaluate(t)}simplify(t){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.simplify(t)}N(){return this._tensor&&this._tensor.dtype!=="expression"?this:this.structural.N()}solve(t){return this.structural.solve(t)}}});function qn(n,e){if(e=he(e,"Add"),e=e.filter(i=>i.numericValue===null||!i.is(0)),e.length===0)return n.Zero;if(e.length===1&&!e[0].isIndexedCollection)return e[0];let t=[];for(let i=0;i<e.length;i++){let r=e[i];if(r.isNumberLiteral){let o=r.numericValue;if(typeof o=="number"||w(o.type,"real")&&!o.isExact||w(o.type,"integer")){let s=e[i+1];if(s){let a=Qr(s)?.numericValue;if(a!==void 0){let u=typeof a=="number"?a:a?.re;if(u!==0){let l=typeof o=="number"?o:o.re;t.push(n.number(n._numericValue({re:l,im:u??0}))),i++;continue}}}}}t.push(r)}return t.length===1?t[0]:n._fn("Add",[...t].sort(Ho))}function Lm(n){return n.length===0?"finite_integer":n.length===1?n[0].type:ve(...n.map(e=>e.type.type))}function X(...n){return n.length>0,n.every(t=>t.isValid)?n.some(t=>Z(t))?Fm(n[0].engine,n):new Hr(n[0].engine,n).asExpression():n[0].engine._fn("Add",n)}function qm(...n){return n.length>0,n.every(t=>t.isValid)?n.some(t=>Z(t))?(n=n.map(t=>Z(t)?t.evaluate():t.N()),Fm(n[0].engine,n)):(n=n.map(t=>t.isNumberLiteral?t.evaluate():t.N()),new Hr(n[0].engine,n).N()):n[0].engine._fn("Add",n)}function Fm(n,e){let t=[],i=[];for(let s of e){let a=s.evaluate();Z(a)?t.push(a):i.push(a)}if(t.length===0)return new Hr(n,i).asExpression();let r=t[0].shape;for(let s=1;s<t.length;s++){let a=t[s].shape;if(a.length!==r.length||!a.every((u,l)=>u===r[l]))return n.error("incompatible-dimensions",`${r.join("x")} vs ${a.join("x")}`)}let o=n.Zero;for(let s of i)o=o.add(s);if(r.length===1){let s=r[0],a=[];for(let u=0;u<s;u++){let l=o;for(let c of t){let f=c.tensor.at(u+1)??n.Zero;l=l.add(n.box(f))}a.push(l.evaluate())}return n.box(["List",...a])}if(r.length===2){let[s,a]=r,u=[];for(let l=0;l<s;l++){let c=[];for(let f=0;f<a;f++){let p=o;for(let d of t){let m=d.tensor.at(l+1,f+1)??n.Zero;p=p.add(n.box(m))}c.push(p.evaluate())}u.push(n.box(["List",...c]))}return n.box(["List",...u])}return n._fn("Add",[...e])}var tn=k(()=>{me();zn();ut();Mm();an();Nn();Yr()});function hn(n){if(n.symbol&&!n.isConstant)return 1;if(n.operator==="Power"&&n.op2.isNumberLiteral){if(hn(n.op1)===0)return 0;let e=J(n.op2);return e!==null&&e>0?e:0}if(n.operator==="Multiply"){let e=0;for(let t of n.ops){let i=hn(t);e=e+i}return e}if(n.operator==="Add"||n.operator==="Subtract"){let e=0;for(let t of n.ops)e=Math.max(e,hn(t));return e}return n.operator==="Negate"||n.operator==="Divide"?hn(n.op1):0}function Wn(n){if(n.symbol&&!n.isConstant)return 1;if(n.operator==="Power"&&n.op2.isNumberLiteral){if(Wn(n.op1)===0)return 0;let e=J(n.op2);return e!==null&&e>0?e:0}if(n.operator==="Multiply"||n.operator==="Add"||n.operator==="Subtract"){let e=0;for(let t of n.ops)e=Math.max(e,hn(t));return e}return n.operator==="Negate"||n.operator==="Divide"?Wn(n.op1):0}function Vm(n){return n.symbol&&!n.isConstant?n.symbol:n.ops?n.ops.map(e=>Vm(e)).join(" ").trim():""}function kl(n){return Vm(n).split(" ").reverse().join(" ").trim()}function ge(n,e){if(n.isNumberLiteral)return 0;if(n.symbol)return n.symbol===e?1:0;let t=n.operator;if(t==="Negate")return ge(n.op1,e);if(t==="Add"||t==="Subtract"){let i=0;for(let r of n.ops){let o=ge(r,e);if(o<0)return-1;i=Math.max(i,o)}return i}if(t==="Multiply"){let i=0;for(let r of n.ops){let o=ge(r,e);if(o<0)return-1;i+=o}return i}if(t==="Power"){let i=ge(n.op1,e);if(i<0)return-1;if(i===0)return n.op2.has(e)?-1:0;let r=J(n.op2);return r===null||r<0?-1:i*r}return n.has(e)?-1:0}function Jn(n,e){let t=n.engine,i=ge(n,e);if(i<0)return null;let r=new Array(i+1).fill(t.Zero),o=n.expand(),s=(u,l)=>l>i?!1:(r[l]=r[l].add(u),!0),a=u=>{let l=ge(u,e);if(l<0)return!1;if(l===0)return s(u,0);if(u.symbol===e)return s(t.One,1);if(u.operator==="Negate"){if(ge(u.op1,e)===0)return s(u,0);let f=Jn(u.op1,e);if(!f)return!1;for(let p=0;p<f.length;p++)f[p].is(0)||s(f[p].neg(),p);return!0}if(u.operator==="Power"){if(u.op1.symbol===e){let c=J(u.op2);if(c!==null&&c>=0)return s(t.One,c)}return u.op1.has(e)?!1:s(u,0)}if(u.operator==="Multiply"){let c=u.ops,f=t.One,p=0;for(let d of c)if(!d.has(e))f=f.mul(d);else if(d.symbol===e)p+=1;else if(d.operator==="Power"&&d.op1.symbol===e){let m=J(d.op2);if(m!==null&&m>=0)p+=m;else return!1}else return!1;return s(f,p)}return!1};if(o.operator==="Add"){for(let u of o.ops)if(!a(u))return null}else if(!a(o))return null;return r}function Al(n,e){if(n.length===0)return n[0]?.engine.Zero??null;let t=n[0].engine,i=t.symbol(e),r=[];for(let o=0;o<n.length;o++){let s=n[o];if(!s.is(0))if(o===0)r.push(s);else if(o===1)s.is(1)?r.push(i):s.is(-1)?r.push(i.neg()):r.push(s.mul(i));else{let a=t.box(["Power",e,o]);s.is(1)?r.push(a):s.is(-1)?r.push(a.neg()):r.push(s.mul(a))}}return r.length===0?t.Zero:r.length===1?r[0]:X(...r)}function ni(n,e,t){let i=n.engine,r=Jn(n,t),o=Jn(e,t);if(!r||!o||o.every(m=>m.is(0)))return null;let s=m=>{for(let g=m.length-1;g>=0;g--)if(!m[g].is(0))return g;return-1},a=s(r),u=s(o);if(u<0)return null;if(a<0)return[i.Zero,i.Zero];if(a<u)return[i.Zero,n];let l=r.map(m=>m),c=new Array(a-u+1).fill(i.Zero),f=o[u];for(let m=a;m>=u;m--){if(l[m].is(0))continue;let g=l[m].div(f);c[m-u]=g;for(let h=0;h<=u;h++){let x=g.mul(o[h]);l[m-u+h]=l[m-u+h].sub(x)}}let p=Al(c,t),d=Al(l,t);return[p,d]}function Cl(n,e,t){let i=n.engine,r=ge(n,t),o=ge(e,t);if(r<0||o<0)return i.One;let s=Jn(n,t),a=Jn(e,t);if(!s||s.every(c=>c.is(0)))return wl(e,t);if(!a||a.every(c=>c.is(0)))return wl(n,t);let u=n,l=e;for(;;){let c=Jn(l,t);if(!c||c.every(d=>d.is(0)))break;let f=ni(u,l,t);if(!f)return i.One;let[,p]=f;u=l,l=p}return wl(u,t)}function wl(n,e){let t=n.engine,i=Jn(n,e);if(!i)return n;let r=null;for(let s=i.length-1;s>=0;s--)if(!i[s].is(0)){r=i[s];break}if(!r||r.is(1))return n;let o=i.map(s=>s.div(r));return Al(o,e)}function Xr(n,e){let t=n.engine;if(n.operator!=="Divide")return n;let i=n.op1,r=n.op2,o=ge(i,e),s=ge(r,e);if(o<0||s<0)return n;let a=Cl(i,r,e);if(ge(a,e)<=0)return n;let l=ni(i,a,e),c=ni(r,a,e);if(!l||!c)return n;let[f]=l,[p]=c,d=Jn(p,e);return d&&d.length===1&&d[0].is(1)?f:f.div(p)}var Ki=k(()=>{Xe();tn()});function Ee(n,e,t,i){if((n?.numericValue??null)===null)return;let r=n.engine,o;if(n.im!==0)o=i?.(r.complex(n.re,n.im));else{let s=n.bignumRe;if(s!==void 0&&Ce(r)&&t)o=t(s);else{let a=n.re;Ce(r)&&t?o=t(r.bignum(a)):o=e(a)}}if(o!==void 0)return o instanceof ie?r.number(r._numericValue({re:o.re,im:o.im})):r.number(o)}function wt(n,e,t,i,r){if(n.numericValue===null||e.numericValue===null)return;let o=n.engine,s;if((n.im!==0||e.im!==0)&&(s=r?.(o.complex(n.re,n.im),o.complex(e.re,e.im))),s===void 0&&i){let a=n.bignumRe,u=e.bignumRe;(a!==void 0||u!==void 0)&&(a??=o.bignum(n.re),u??=o.bignum(e.re),s=i(a,u))}if(s===void 0){let a=n.re,u=e.re;!isNaN(a)&&!isNaN(u)&&(Ce(o)&&i?s=i(o.bignum(n.bignumRe??a),o.bignum(e.bignumRe??u)):s=t(a,u))}if(s!==void 0)return s instanceof ie?o.number(o._numericValue({re:o.chop(s.re),im:o.chop(s.im)})):o.number(o.chop(s))}var Wo=k(()=>{Fi();me()});function $m(n){return n.operator==="Sqrt"||n.operator==="Power"&&n.op2.im===0&&n.op2.re===.5||n.operator==="Root"&&n.op2.im===0&&n.op2.re===2}function ya(n){if($m(n))return Qe(n.op1)??null;if(n.operator==="Divide"&&n.op1.is(1)&&$m(n.op2)){let e=n.op2.re;return Number.isInteger(e)?[1,e]:null}return null}function ti(n,e){let t=n.engine,i=n.isCanonical&&e.isCanonical,r=()=>t._fn("Power",[n,e],{canonical:i});if(n.operator==="Power"){let[a,u]=n.ops;return t._fn("Power",[a,t.box(["Multiply",u,e],{canonical:i||"Power"})])}if(n.operator==="Divide"&&n.op1&&n.op2&&e.isNegative===!0){let a=n.op1,u=n.op2;return Oe(a,e,{numericApproximation:!1}).div(Oe(u,e,{numericApproximation:!1}))}if(e.isFunctionExpression||e.symbol!==null||!e.type.matches("number"))return r();if(n.isNumberLiteral&&n.is(0))return e.type.matches("imaginary")||e.isNaN||e.is(0)?t.NaN:e.isInfinity?e.isPositive?t.Zero:e.isNegative?t.ComplexInfinity:t.NaN:e.isGreater(0)?t.Zero:e.isLess(0)?t.ComplexInfinity:r();let o=n.type.matches("number")&&(n.isFunctionExpression===!1||n.operator==="Negate");if(e.is(0))return o&&n.isFinite!==void 0?n.isFinite?t.One:t.NaN:r();if(o&&n.is(1))return e.isFinite?t.One:t.NaN;if(e.is(1)&&n.type.matches("number"))return n;if(e.is(-1)){if(o){if(n.isInfinity&&(n.isNegative||n.isPositive))return t.Zero;if(n.is(-1))return t.NegativeOne;if(n.is(1))return t.One}return n.isCanonical?n.inv():t._fn("Power",[n,t.number(-1)],{canonical:!1})}if(e.isInfinity&&o)return e.isPositive?n.symbol==="ExponentialE"?t.PositiveInfinity:n.is(-1)?t.NaN:n.isInfinity?t.ComplexInfinity:n.isNaN?t.NaN:n.isReal?n.isGreater(1)?t.PositiveInfinity:n.isLess(-1)?t.ComplexInfinity:t.Zero:r():e.isNegative?n.symbol==="ExponentialE"?t.Zero:n.is(-1)?t.NaN:n.isInfinity?t.Zero:n.isNaN?t.NaN:n.isReal?n.isGreater(0)?n.isLess(1)?t.PositiveInfinity:t.Zero:n.isGreater(-1)?t.ComplexInfinity:t.Zero:r():t.NaN;if(n.isNumberLiteral&&n.isInfinity){if(n.isNegative){if(e.isInteger===!0){if(e.isEven===!0)return t.PositiveInfinity;if(e.isOdd===!0)return t.NegativeInfinity}if(e.isRational===!0){let[a,u]=e.numeratorDenominator,l=a.re,c=u.re;if(typeof l=="number"&&typeof c=="number"&&Number.isInteger(l)&&Number.isInteger(c)){let f=l%2===0,p=l%2!==0,d=c%2!==0;if(f&&d)return t.PositiveInfinity;if(p&&d)return t.NegativeInfinity}}}if(e.type.matches("imaginary"))return t.NaN;if(e.type.matches("complex")&&!isNaN(e.re)){if(e.re>0)return t.ComplexInfinity;if(e.re<0)return t.Zero}}if(e.is(.5))return n.isCanonical?er(n,2):t._fn("Sqrt",[n],{canonical:!1});let s=Qe(e);return s!==void 0&&s[0]===1&&s[1]!==1?n.isCanonical?er(n,t.number(s[1])):t._fn("Root",[n,t.number(s[1])],{canonical:!1}):r()}function er(n,e){let t=n.engine,i;if(typeof e=="number"?i=e:e.isNumberLiteral&&e.im===0&&(i=e.re),i===1)return n;if(i===2){if(n.isNumberLiteral&&n.type.matches("rational")&&n.re<K){let r=n.sqrt();if(typeof r.numericValue=="number"||r.numericValue.isExact)return r}return t._fn("Sqrt",[n],{canonical:n.isCanonical})}return t._fn("Root",[n,typeof e=="number"?t.number(e):e],{canonical:n.isCanonical&&(typeof e=="number"||e.isCanonical)})}function Oe(n,e,{numericApproximation:t}){if(!n.isCanonical||typeof e!="number"&&!e.isCanonical)return n.engine._fn("Power",[n,n.engine.box(e)],{canonical:!1});if(t&&n.isNumberLiteral){if(typeof e=="number")return Ee(n,s=>Math.pow(s,e),s=>s.pow(e),s=>s.pow(e))??Oe(n,e,{numericApproximation:!1});if(e.isNumberLiteral)return wt(n,e,(s,a)=>Math.pow(s,a),(s,a)=>s.pow(a),(s,a)=>s.pow(a))??Oe(n,e,{numericApproximation:!1})}let i=n.engine;typeof e!="number"&&(e=e.canonical);let r=ti(n,i.box(e));if(r.operator!=="Power")return r;let o=typeof e=="number"?e:e.im===0?e.re:void 0;if(n.symbol==="ComplexInfinity")return i.NaN;if(n.symbol==="ExponentialE"){let s=Qr(e);if(s!==void 0){if(s=Ea(s),s!==void 0)return i.function("Cos",[s]).add(i.function("Sin",[s]).mul(i.I)).simplify()}else{if(typeof e=="number")return i.number(i._numericValue(i.E.N().numericValue).pow(e));if(e.isNumberLiteral)return i.number(i._numericValue(i.E.N().numericValue).pow(e.numericValue))}}if(n.operator==="Power"){let[s,a]=n.ops;return Oe(s,a.mul(e),{numericApproximation:t})}if(n.operator==="Divide"){let[s,a]=n.ops;return Oe(s,e,{numericApproximation:t}).div(Oe(a,e,{numericApproximation:t}))}if(n.operator==="Negate"&&o!==void 0)return o%2===0?Oe(n.op1,e,{numericApproximation:t}):Oe(n.op1,e,{numericApproximation:t}).neg();if(n.operator==="Sqrt")return o===2?n.op1:o!==void 0&&o%2===0?n.op1.pow(o/2):Oe(n.op1,e,{numericApproximation:t}).sqrt();if(n.operator==="Exp")return Oe(i.E,n.op1.mul(e),{numericApproximation:t});if(n.operator==="Multiply"){let s=n.ops.map(a=>Oe(a,e,{numericApproximation:t}));return i._fn("Multiply",s)}if(typeof e!="number"&&e.isNumberLiteral){let s=Qe(e);if(s!==void 0&&s[0]===1)return ba(n,i.number(s[1]),{numericApproximation:t})}if(n.operator==="Root"){let[s,a]=n.ops;return Oe(s,i.box(e).div(a),{numericApproximation:t})}if(n.isNumberLiteral&&Number.isInteger(o)){let s=n.numericValue;return typeof s=="number"?Ee(n,a=>Math.pow(a,o),a=>a.pow(o),a=>a.pow(o))??i._fn("Power",[n,i.box(e)]):i.number(s.pow(o))}return i._fn("Power",[n,i.box(e)])}function ba(n,e,{numericApproximation:t}){if(!n.isCanonical||!e.isCanonical)return n.engine._fn("Root",[n,e],{canonical:!1});if(t&&n.isNumberLiteral&&e.isNumberLiteral){let i=n.isNegative,r=e.isEven;return i&&(n=n.neg()),wt(n,e,(o,s)=>{let a=Math.pow(o,1/s);return i&&!r?-a:a},(o,s)=>{let a=o.pow(s.pow(-1));return i&&!r?a.neg():a},(o,s)=>{let a=o.pow(typeof s=="number"?1/s:s.inverse());return i&&!r?a.neg():a})??ba(n,e,{numericApproximation:!1})}if(n.isNumberLiteral&&e.isNumberLiteral&&e.isInteger){let i=typeof e=="number"?e:e.im===0?e.re:void 0;if(i!==void 0)if(typeof n.numericValue=="number"){let r=n.engine._numericValue(n.numericValue)?.root(i);if(r?.isExact)return n.engine.number(r)}else{let r=n.numericValue.asExact?.root(i);if(r?.isExact)return n.engine.number(r)}}return n.engine._fn("Root",[n,e])}var ii=k(()=>{en();Xe();me();Wo()});function P1(n){return!n||typeof n!="string"?!1:n in D1}function Ho(n,e){let t=hn(n),i=hn(e);if(t!==i)return i-t;let r=Wn(n),o=Wn(e);if(r!==o)return o-r;let s=kl(n),a=kl(e);if(s||a){if(!s)return 1;if(!a||s<a)return-1;if(s>a)return 1}return Pe(n,e)}function Um(n){if(typeof n.numericValue=="number")return Number.isInteger(n.numericValue)?"integer":"real";if(n.numericValue){let e=n.numericValue.type;return e==="integer"||e==="finite_integer"?"integer":e==="rational"||e==="finite_rational"?"rational":e==="real"||e==="finite_real"?"real":e==="complex"||e==="finite_complex"||e==="imaginary"||e==="finite_number"?"complex":e==="non_finite_number"?"constant":e==="number"?"real":"other"}return n.symbol==="ImaginaryUnit"?"complex":ya(n)?"radical":n.symbol&&n.isConstant?"constant":n.symbol?"symbol":P1(n.operator)?"trig":n.operator==="Add"?"add":n.operator==="Power"||n.operator==="Root"?"power":n.operator==="Multiply"||n.operator==="Negate"?"multiply":n.operator==="Divide"?"divide":n.operator==="Rational"?"rational":n.operator==="Complex"?n.im!==0?"complex":"real":n.operator==="Sqrt"?n.op1.isNumberLiteral&&(n.op1.isInteger||n.op1.isRational)?"radical":"power":n.ops?"fn":n.string?"string":"other"}function Pe(n,e){if(n===e)return 0;let t=Um(n),i=Um(e);if(t!==i)return jm.indexOf(t)-jm.indexOf(i);if(t==="complex"){let[r,o]=Gm(n),[s,a]=Gm(e);return o!==a?o-a:r-s}if(t==="integer"||t==="rational"||t==="real"){let r=n.numericValue,o=e.numericValue;r===null&&n.operator==="Rational"&&(r=n.op1.re/n.op2.re),o===null&&e.operator==="Rational"&&(o=e.op1.re/e.op2.re);let s=typeof r=="number"?r:r.re,a=typeof o=="number"?o:o.re;return s-a}if(t==="radical")return Pe(n.op1,e.op1);if(t==="constant"||t==="symbol")return n.symbol===e.symbol?0:n.symbol>e.symbol?1:-1;if(t==="add"){let r=n.ops,o=e.ops;if(r.length!==o.length)return o.length-r.length;for(let s=0;s<r.length;s++){let a=Pe(r[s],o[s]);if(a!==0)return a}return 0}if(t==="power"){let r=hn(n),o=hn(e);if(r!==o)return o-r;let s=Wn(n),a=Wn(e);return s!==a?s-a:Pe(n.op1,e.op1)}if(t==="multiply"){let r=hn(n),o=hn(e);if(r!==o)return o-r;let s=Wn(n),a=Wn(e);if(s!==a)return s-a;let u=n.ops,l=e.ops;if(u.length!==l.length)return l.length-u.length;for(let c=0;c<u.length;c++){let f=Pe(u[c],l[c]);if(f!==0)return f}return 0}if(t==="divide"){let r=hn(n.op1),o=hn(e.op1);if(r!==o)return o-r;let s=Wn(n.op1),a=Wn(e.op1);if(s!==a)return s-a;let u=Pe(n.op1,e.op1);return u!==0?u:Pe(n.op2,e.op2)}if(t==="fn"||t==="trig"){if(n.operator==e.operator&&n.nops===1&&e.nops===1)return Pe(n.op1,e.op1);let r=n.operatorDefinition?.complexity??Ti,o=e.operatorDefinition?.complexity??Ti;return r===o?n.operator===e.operator?Rl(n)-Rl(e):n.operator<e.operator?1:-1:r-o}return t==="string"?n.string===e.string?0:e.string<n.string?-1:1:(n.complexity??Ti)-(e.complexity??Ti)}function Ml(n,{recursive:e=!1}){if(n.isCanonical||!n.ops)return n;let t=n.ops;return e&&(t=t.map(i=>Ml(i,{recursive:e}))),t=Jo(n.operator,t),n.engine._fn(n.operator,t,{canonical:!1})}function Jo(n,e){if(e.length===0)return e;let t=e[0].engine;if(n==="Add")return[...e].sort(Ho);if(n==="Multiply")return[...e].sort(Pe);let i=t.lookupDefinition(n);return!i||!le(i)||!i.operator.commutative?e:i.operator.commutativeOrder?[...e].sort(i.operator.commutativeOrder):[...e].sort(Pe)}function Rl(n){return n.ops?1+[...n.ops].reduce((e,t)=>e+Rl(t),0):1}function Gm(n){if(n.symbol==="ImaginaryUnit")return[0,1];if(n.numericValue){if(typeof n.numericValue=="number")return[n.numericValue,0];let e=n.numericValue;return[e.re,e.im]}if(n.operator==="Complex"){let e=n.op1.numericValue;if(e===null)return[0,0];let t=typeof e=="number"?e:e.re,i=n.op2.numericValue;if(i===null)return[0,0];let r=typeof i=="number"?i:i.re;return[t,r]}return[0,0]}var Ti,D1,jm,ut=k(()=>{Ki();ii();me();Ti=1e5,D1={Sin:!0,Cos:!0,Tan:!0,Cot:!0,Sec:!0,Csc:!0,Sinh:!0,Cosh:!0,Tanh:!0,Coth:!0,Sech:!0,Csch:!0,Arcsin:!0,Arccos:!0,Arctan:!0,Arccot:!0,Arcsec:!0,Arccsc:!0,Arsinh:!0,Arcosh:!0,Artanh:!0,Arcoth:!0,Arcsch:!0,Arsech:!0};jm=["integer","rational","radical","real","complex","constant","symbol","multiply","divide","add","trig","fn","power","string","other"]});function zm(n,e){let t=n.engine,i=n.coefficient.gcd(e.coefficient);if(i.isOne)return[t._numericValue(1),t.One];let r=[];for(let o of n.terms){let s=e.terms.find(u=>o.term.isSame(u.term));if(!s)continue;let a=fa(o.exponent,s.exponent);if(nn(a))r.push(o.term);else{let[u,l]=xm(a);l===1?r.push(o.term.pow(u)):u===1?r.push(o.term.root(l)):r.push(o.term.pow(u).root(l))}}return[i,r.length===0?t.One:pe(...r)]}function va(n,e){let t=e.map(({terms:i,exponent:r})=>{let o=he(i,"Multiply"),s=o.length<=1?o[0]:n._fn("Multiply",[...o].sort(Pe));return nn(r)?s:s.pow(n.number(r))});return t=he(t,"Multiply"),t.length===0?n.One:t.length===1?t[0]:n._fn("Multiply",t.sort(Pe))}var fn,Gr=k(()=>{kn();St();ut();ii();zn();Xe();cn();fn=class n{constructor(e,t,i){this.options=i;if(i=i?{...i}:{},"canonical"in i||(i.canonical=!0),this._isCanonical=i.canonical,this.engine=e,this.coefficient=e._numericValue(1),t)for(let r of t)this.mul(r)}engine;coefficient;terms=[];_isCanonical=!0;static from(e){return new n(e.engine,[e])}mul(e,t){if(e.isCanonical||e.isStructural,this.coefficient.isNaN)return;if(e.isNaN){this.coefficient=this.engine._numericValue(NaN);return}if(e.operator==="Multiply"){for(let o of e.ops)this.mul(o,t);return}if(e.operator==="Negate"){this.mul(e.op1,t),this.coefficient=this.coefficient.neg();return}if(this._isCanonical){if(e.symbol==="Nothing")return;t??=[1,1];let o=e.numericValue;if(o!==null){if(e.is(1))return;if(e.is(0)){if(this.coefficient.isPositiveInfinity||this.coefficient.isNegativeInfinity){this.coefficient=this.engine._numericValue(NaN);return}this.coefficient=this.engine._numericValue(Nt(t)?NaN:0);return}if(e.is(-1)){nn(t)?this.coefficient=this.coefficient.neg():this.coefficient=this.coefficient.mul(this.engine._numericValue(-1).pow(this.engine._numericValue(t)));return}if(e.isInfinity){if(this.coefficient.isZero){this.coefficient=this.engine._numericValue(NaN);return}if(nn(t)){let a=this.coefficient.sgn(),u=e.isNegative?-1:1,l=a*u;this.coefficient=this.engine._numericValue(l<0?-1/0:1/0)}else this.terms.push({term:e,exponent:t});return}nn(t)?this.coefficient=this.coefficient.mul(o):this.coefficient=this.coefficient.mul(this.engine._numericValue(o).pow(this.engine._numericValue(t)));return}let s=ya(e);if(s!==null){this.coefficient=this.coefficient.mul(this.engine._numericValue({radical:s[0]*s[1],rational:[1,Number(s[1])]}).pow(this.engine._numericValue(t)));return}if(!e.symbol&&!((e.operator==="Sqrt"||e.operator==="Root"||e.operator==="Power")&&e.op1?.isNumberLiteral===!0)){let u;[u,e]=e.toNumericValue(),t&&!nn(t)&&(u=u.pow(this.engine._numericValue(t))),this.coefficient=this.coefficient.mul(u)}}if(e.is(1)&&(!t||nn(t))||e.is(0)===!1&&t&&Nt(t))return;if(e.is(0)){t&&Nt(t)?this.coefficient=this.engine._numericValue(NaN):this.coefficient=this.engine._numericValue(0);return}let i=t??[1,1];if(e.operator==="Power"){let o=Qe(e.op2);if(o){let s=e.op1?.isNumberLiteral===!0,a=o[1]===1||o[1]===-1;if(!s||a){this.mul(e.op1,Tt(i,o));return}}}if(e.operator==="Sqrt"&&!(e.op1?.isNumberLiteral===!0)){this.mul(e.op1,Tt(i,[1,2]));return}if(e.operator==="Root"){let o=Qe(e.op2);if(o&&!(e.op1?.isNumberLiteral===!0)){this.mul(e.op1,Tt(i,hm(o)));return}}if(e.operator==="Divide"){this.mul(e.op1,i),this.mul(e.op2,Hi(i));return}let r=!1;for(let o of this.terms)if(o.term.isSame(e)){o.exponent=Zi(o.exponent,i),r=!0;break}r||this.terms.push({term:e,exponent:i})}div(e){e instanceof ae?this.coefficient=this.coefficient.div(e):this.mul(e,[-1,1])}groupedByDegrees(e){e??={},"mode"in e||(e.mode="expression");let t=e.mode;if(t==="numeric"&&(this.coefficient.isNegativeInfinity||this.coefficient.isPositiveInfinity))return[];if(this.coefficient.isZero)return[];let i=this.engine;if(this.terms.length===0)if(t==="numeric"){let o=this.coefficient.N();return[{exponent:[1,1],terms:[i.number(o)]}]}else return[{exponent:[1,1],terms:[i.number(this.coefficient)]}];let r=[];if(!this.coefficient.isOne)if(t==="rational"&&this.coefficient.type==="finite_rational"){let o=this.coefficient.numerator;o.isOne||r.push({exponent:[1,1],terms:[i.number(o)]});let s=this.coefficient.denominator;s.isOne||r.push({exponent:[-1,1],terms:[i.number(s)]})}else if(t==="numeric"){let o=this.coefficient.N();r.push({exponent:[1,1],terms:[i.number(o)]})}else r.push({exponent:[1,1],terms:[i.number(this.coefficient)]});for(let o of this.terms){let s=Lr(o.exponent);if(s[0]===0)continue;let a=!1;for(let u of r)if(s[0]===u.exponent[0]&&s[1]===u.exponent[1]){u.terms.push(o.term),a=!0;break}a||r.push({exponent:s,terms:[o.term]})}return r}asExpression(e={numericApproximation:!1}){let t=this.engine,i=this.coefficient;if(i.isNaN)return t.NaN;if(i.isPositiveInfinity)return t.PositiveInfinity;if(i.isNegativeInfinity)return t.NegativeInfinity;if(i.isZero)return t.Zero;let r=i.isNegativeOne;r&&(this.coefficient=t._numericValue(1));let o=this.groupedByDegrees({mode:e.numericApproximation?"numeric":"expression"});if(o===null)return t.NaN;if(r){let s=va(t,o).neg();return this.coefficient=t._numericValue(-1),s}return va(t,o)}asNumeratorDenominator(){let e=this.engine,t=this.coefficient;if(t.isZero)return[e.Zero,e.One];if(t.isPositiveInfinity||t.isNegativeInfinity)return this.terms.length===0?[t.isPositiveInfinity?e.PositiveInfinity:e.NegativeInfinity,e.One]:[e.NaN,e.NaN];let i=t.isNegativeOne;i&&(this.coefficient=e._numericValue(1));let r=this.groupedByDegrees({mode:"rational"});if(this.coefficient=t,r===null)return[e.NaN,e.NaN];let o=r.filter(u=>u.exponent[0]>=0),s=r.filter(u=>u.exponent[0]<0).map(u=>({exponent:Hi(u.exponent),terms:u.terms})),a=va(e,o);return[i?a.neg():a,va(e,s)]}asRationalExpression(){let[e,t]=this.asNumeratorDenominator();return Zn(e,t)}}});var Jm={};yr(Jm,{serializeJson:()=>Wm});function Zm(n,e,t,i,r){if(e.numericValue!==null&&e.isNegative){let o=e.numericValue;if(typeof o=="number")return Q(n,"Subtract",[t,n.number(-o)],i,r);if(e.type.matches("rational"))return Q(n,"Subtract",[t,n.number(o.neg())],i,r)}return e.operator==="Negate"&&t.operator!=="Negate"?Q(n,"Subtract",[t,e.op1],i,r):null}function O1(n,e,t,i,r){let o=i.exclude;if(e==="Add"&&t.length===2&&!o.includes("Subtract")){let s=Zm(n,t[0],t[1],i,r)??Zm(n,t[1],t[0],i,r);if(s)return s}if(e==="Divide"&&t.length===2&&o.includes("Divide"))return Q(n,"Multiply",[t[0],n._fn("Power",[t[1],n.NegativeOne])],i,r);if(e==="Multiply"&&!o.includes("Negate")&&t[0].im===0&&t[0].re===-1)return t.length===2?Q(n,"Negate",[t[1]],i):Q(n,"Negate",[n._fn("Multiply",[...t.slice(1)].sort(Pe))],i,r);if(e==="Multiply"&&!o.includes("Divide")){let s=new fn(n,t,{canonical:!1}).asRationalExpression();if(s.operator==="Divide")return Q(n,s.operator,s.ops,i,r)}if(e==="Power"){if(!o.includes("Exp")&&t[0]?.symbol==="ExponentialE")return Q(n,"Exp",[t[1]],i,r);if(t[1]?.numericValue!==null){let s=J(t[1]);if(s===2&&!o.includes("Square"))return Q(n,"Square",[t[0]],i,r);if(s!==null&&s<0&&!o.includes("Divide"))return Q(n,"Divide",[n.One,s===-1?t[0]:t[0].pow(-s)],i,r);let a=t[1].re;if(!o.includes("Sqrt")&&a===.5)return Q(n,"Sqrt",[t[0]],i,r);if(!o.includes("Sqrt")&&a===-.5)return Q(n,"Divide",[n.One,n._fn("Sqrt",[t[0]])],i,r);if(Qt(a)){let u=fl(a),l=pl(a);if(u===1){if(!o.includes("Sqrt")&&l===2)return Q(n,"Sqrt",[t[0]],i,r);if(!o.includes("Root"))return Q(n,"Root",[t[0],n.number(a[1])],i,r)}if(u===-1){if(!o.includes("Sqrt")&&l===2)return Q(n,"Divide",[n.One,n._fn("Sqrt",[t[0]])],i,r);if(!o.includes("Root"))return Q(n,"Divide",[n.One,n._fn("Root",[t[0],n.number(a[1])])],i,r)}}}}if(e==="Add"&&t.length===2&&!o.includes("Subtract")){if(t[1]?.numericValue!==null){let s=J(t[1]);if(s!==null&&s<0)return Q(n,"Subtract",[t[0],n.number(-s)],i,r)}if(t[1]?.operator==="Negate")return Q(n,"Subtract",[t[0],t[1].op1],i,r)}if(e==="Tuple"){if(t.length===1&&!o.includes("Single"))return Q(n,"Single",t,i,r);if(t.length===2&&!o.includes("Pair"))return Q(n,"Pair",t,i,r);if(t.length===3&&!o.includes("Triple"))return Q(n,"Triple",t,i,r)}if(e==="Function"&&t.length>0&&t[0].operator==="Block"){let s=t[0];if(s.nops===1){let a=t.slice(1);return a.every(u=>/_\d?/.test(u.symbol))?s.op1.ops?.every((u,l)=>u.symbol===a[l]?.symbol)?Q(n,"Function",[n.symbol(s.op1.operator,{canonical:!1})],i,r):Q(n,"Function",[s.op1],i,r):Q(n,"Function",[s.op1,...t.slice(1)],i,r)}}return Q(n,e,t,i,r)}function Q(n,e,t,i,r){let o=i.exclude;if(e==="Negate"&&t.length===1){let l=t[0]?.numericValue;if(l!==null){if(typeof l=="number")return Yn(n,-l,i);if(l instanceof U||l instanceof ie)return Yn(n,l.neg(),i);if(Qt(l))return Yn(n,Hi(l),i)}}if(typeof e=="string"&&o.includes(e)){if(e==="Rational"&&t.length===2)return Q(n,"Divide",t,i,r);if(e==="Complex"&&t.length===2)return Q(n,"Add",[t[0],n._fn("Multiply",[t[1]??n.symbol("Undefined"),n.I])],i,r);if(e==="Sqrt"&&t.length===1)return Q(n,"Power",[t[0],o.includes("Half")?n.number([1,2]):n.Half],i,r);if(e==="Root"&&t.length===2&&t[1]?.numericValue!==null){let l=J(t[1]);if(l===2)return Q(n,"Sqrt",[t[0]],i);if(l!==null)return l<0?Q(n,"Divide",[n.One,n._fn("Power",[t[0]??n.symbol("Undefined"),n.number([1,-l])])],i,r):Q(n,"Power",[t[0],n.number([1,-l])],i,r)}if(e==="Square"&&t.length===1)return Q(n,"Power",[t[0],n.number(2)],i,r);if(e==="Exp"&&t.length===1)return Q(n,"Power",[n.E,t[0]],i,r);if(e==="Pair"||e=="Single"||e==="Triple")return Q(n,"Tuple",t,i,r);if(e==="Subtract"&&t.length===2)return Q(n,"Add",[t[0],n._fn("Negate",[t[1]??n.symbol("Undefined")])],i,r);if(e==="Subtract"&&t.length===1)return Q(n,"Negate",t,i,r)}let a=[e,...t.map(l=>l?Wm(n,l,i):"Undefined")],u={...r??{}};return i.metadata.includes("latex")?u.latex=u.latex??n.box({fn:a}).latex:u.latex="",i.metadata.includes("wikidata")||(u.wikidata=""),!u.latex&&!u.wikidata&&i.shorthands.includes("function")?a:u.latex&&u.wikidata?{fn:a,latex:u.latex,wikidata:u.wikidata}:u.latex?{fn:a,latex:u.latex}:u.wikidata?{fn:a,wikidata:u.wikidata}:{fn:a}}function L1(n,e){return n=n,e.shorthands.includes("string")?Un(n)||Bn(n)?`'${n}'`:n:{str:n}}function Si(n,e,t,i){if(e==="Half"&&t.exclude.includes("Half"))return Yn(n,[1,2],t,i);if(i={...i},t.metadata.includes("latex")?(i.latex=i.latex??n.box({sym:e}).latex,i.latex!==void 0&&(i.latex=i.latex)):i.latex=void 0,t.metadata.includes("wikidata")){if(i.wikidata===void 0){let r=n.lookupDefinition(e);if(r){let o=le(r)?r.operator.wikidata:r.value.wikidata;o!==void 0&&(i.wikidata=o)}}}else i.wikidata=void 0;return e=e,i.latex===void 0&&i.wikidata===void 0&&t.shorthands.includes("symbol")?Bn(e)?e:`\`${e}\``:i.latex!==void 0&&i.wikidata!==void 0?{sym:e,latex:i.latex,wikidata:i.wikidata}:i.latex!==void 0?{sym:e,latex:i.latex}:i.wikidata!==void 0?{sym:e,wikidata:i.wikidata}:{sym:e}}function Hm(n,e){if(!e.repeatingDecimal)return n;let[t,i,r,o]=n.match(/^(.*)\.([0-9]+)([e|E][-+]?[0-9]+)?$/)??[];if(!r)return n.toLowerCase();let s=r[r.length-1];r=r.slice(0,-1);let a=16,u="";for(let l=0;l<r.length-a;l++){u=r.substring(0,l);for(let c=0;c<=a;c++){let f=r.substring(l,l+c+1),p=Math.floor((r.length-u.length)/f.length);if(p<3)break;if((u+f.repeat(p+1)).startsWith(r))return f==="0"?s==="0"?i+"."+u+(o??""):n:i+"."+u+"("+f+")"+(o??"")}}for(r+=s;r.endsWith("0");)r=r.slice(0,-1);return typeof e.fractionalDigits=="number"&&(r=r.slice(0,e.fractionalDigits)),o?`${i}.${r}${o.toLowerCase()}`:`${i}.${r}`}function Yn(n,e,t,i){i={...i},t.metadata.includes("latex")||(i.latex=void 0);let r=i.latex===void 0&&i.wikidata===void 0&&!t.metadata.includes("latex")&&t.shorthands.includes("number"),o=t.exclude;if(e instanceof ae){if(e.isNaN)return Si(n,"NaN",t,i);if(e.isPositiveInfinity)return Si(n,"PositiveInfinity",t,i);if(e.isNegativeInfinity)return Si(n,"NegativeInfinity",t,i);if(e.isComplexInfinity)return Si(n,"ComplexInfinity",t,i);if(r){if(e.isZero)return 0;if(e.isOne)return 1;if(e.isNegativeOne)return-1}if(e instanceof ye){e.im;let u=l=>zi(l)?Yn(n,e.rational[0],t):["Rational",Yn(n,e.rational[0],t),Yn(n,e.rational[1],t)];return e.radical===1?u(e.rational):nn(e.rational)?["Sqrt",e.radical]:qo(e.rational)?["Negate",["Sqrt",e.radical]]:e.rational[0]==1?["Divide",["Sqrt",e.radical],Yn(n,e.rational[1],t)]:e.rational[0]==-1?["Negate",["Divide",["Sqrt",e.radical],Yn(n,e.rational[1],t)]]:["Multiply",u(e.rational),["Sqrt",e.radical]]}if(e.im===0){let u=e.bignumRe??e.re;return Yn(n,u,t,i)}return Number.isFinite(e.im)?Q(n,"Complex",[n.number(e.bignumRe??e.re),n.number(e.im)],t,{...i,wikidata:"Q11567"}):Si(n,"ComplexInfinity",t,i)}let s="";if(e instanceof U){let u;if(e.isNaN())u="NaN";else if(!e.isFinite())u=e.isPositive()?"PositiveInfinity":"NegativeInfinity";else{if(r&&Wi(e))return e.toNumber();if(e.isInteger()&&e.e<e.precision()+4)s=e.toFixed(0);else{let l=t.fractionalDigits,c;if(l==="max"?c=e.toString():l==="auto"?c=e.toPrecision(n.precision):c=e.toDecimalPlaces(l).toString(),s=Hm(c,t),r){let f=e.toNumber();if(f.toString()===s)return f}}}return t.metadata.includes("latex")&&(i.latex=i.latex??n.box(u??{num:s}).latex),u?i.latex!==void 0?{sym:u,latex:i.latex}:r?u:{sym:u}:i.latex!==void 0?{num:s,latex:i.latex}:r?s:{num:s}}if(e instanceof ie)return e.isInfinite()?Si(n,"ComplexInfinity",t,i):e.isNaN()?(s="NaN",t.metadata.includes("latex")&&(i.latex=i.latex??n.box({num:s}).latex),i.latex!==void 0?{num:s,latex:i.latex}:{num:s}):Q(n,"Complex",[n.number(e.re),n.number(e.im)],t,{...i,wikidata:"Q11567"});if(Qt(e)){let u=!o.includes("Rational");return r&&t.shorthands.includes("function")&&Ne(e)?e[0]===1&&e[1]===2&&!o.includes("Half")?Si(n,"Half",t,i):[u?"Rational":"Divide",e[0],e[1]]:Q(n,u?"Rational":"Divide",[n.number(e[0]),n.number(e[1])],t,{...i})}if(typeof e=="bigint")if(e>=Number.MIN_SAFE_INTEGER&&e<=Number.MAX_SAFE_INTEGER)e=Number(e);else return t.metadata.includes("latex")&&(i.latex=i.latex??n.box({num:e.toString()}).latex),i.latex!==void 0?{num:e.toString(),latex:i.latex}:r?ln(e,t.fractionalDigits):{num:Ze(e,t.fractionalDigits)};let a;return Number.isNaN(e)?a="NaN":Number.isFinite(e)?s=Hm(e.toString(),t):a=e>0?"PositiveInfinity":"NegativeInfinity",t.metadata.includes("latex")&&(i.latex=i.latex??n.box({num:s}).latex),a?i.latex!==void 0?{sym:a,latex:i.latex}:r?a:{sym:a}:i.latex!==void 0?{num:s,latex:i.latex}:r&&s===e.toString()?e:{num:s}}function Wm(n,e,t){let i=e.wikidata;return e.numericValue!==null?Yn(n,e.numericValue,t,{latex:e.verbatimLatex}):e.rank>0?e.json:e.type.matches("dictionary")?e.toMathJson(t):e.string!==null?L1(e.string,t):e.symbol!==null?Si(n,e.symbol,t,{latex:e.verbatimLatex,wikidata:i}):e.ops?e.isValid&&(e.isCanonical||e.isStructural)&&t.prettify?O1(n,e.operator,e.structural.ops,t,{latex:e.verbatimLatex,wikidata:i}):Q(n,e.operator,e.structural.ops,t,{latex:e.verbatimLatex,wikidata:i}):e.json}var Dl=k(()=>{Fi();_n();$o();St();Ji();$r();kn();Xt();Gr();ut();Xe();me();Ye()});function Ii(n){if(n.operator==="Interval"){let e=n.op1,t=n.op2,i=!1,r=!1;e.operator==="Open"?(i=!0,e=e.op1):e.operator==="Closed"&&(e=e.op1),t.operator==="Open"?(r=!0,t=t.op1):t.operator==="Closed"&&(t=t.op1);let o=e.N(),s=t.N();return!o.isNumberLiteral||!s.isNumberLiteral?void 0:{start:o.re,openStart:i,end:s.re,openEnd:r}}if(n.symbol==="EmptySet")return{start:0,openStart:!0,end:0,openEnd:!0};if(n.symbol==="RealNumbers")return{start:-1/0,openStart:!1,end:1/0,openEnd:!1};if(n.symbol==="NegativeNumbers")return{start:-1/0,openStart:!1,end:0,openEnd:!0};if(n.symbol==="NonPositiveNumbers")return{start:-1/0,openStart:!1,end:0,openEnd:!1};if(n.symbol==="PositiveNumbers")return{start:0,openStart:!0,end:1/0,openEnd:!1};if(n.symbol==="NonNegativeNumbers")return{start:0,openStart:!1,end:1/0,openEnd:!1}}var Ym=k(()=>{});var Qm=k(()=>{});var Xm=k(()=>{});var Km=k(()=>{});var Pl=k(()=>{});var Ol=k(()=>{Qm();In();Xm();Km();kn();Pl()});function Fn(n,e,t){return e.every(i=>i.isCanonical)?e:e.map(i=>n.box(i,{scope:t}))}var Yo=k(()=>{});function Qn(n){if(n.nops===0)return[1,0,0];let e=n.op1.re;if(isFinite(e)?e=Math.round(e):e=1,n.nops===1)return[1,e,1];let t=n.op2.re;if(!isFinite(t)&&!t?t=1:isFinite(t)&&(t=Math.round(t)),n.nops===2)return[e,t,t>e?1:-1];let i=n.op3.re;return isFinite(i)?i=Math.abs(Math.round(i)):i=1,[e,t,e<t?i:-i]}function og(n){let[e,t,i]=n;return Number.isFinite(t)?i>0?t-(t-e)%i:t+(e-t)%i:i>0?1/0:-1/0}function q1(n,{engine:e}){let t=n[0];if(n.length===1&&t.operator==="Matrix"){let[i,r,o]=t.ops;if(!r||r.string==="..")return o?e._fn("Matrix",[i,e.string("[]"),o]):e._fn("Matrix",[i,r])}return n=n.map(i=>i.operator==="Delimiter"?i.op1.operator==="Sequence"?e._fn("List",Fn(e,i.op1.ops)):e._fn("List",[i.op1?.canonical??e.Nothing]):i.canonical),e._fn("List",n)}function F1(n,{engine:e}){let t=[],i=r=>t.some(o=>o.isSame(r));for(let r of n)i(r)||t.push(r);return e._fn("Set",t)}function eg(n){let e=[],t=[],i=r=>{for(let o=0;o<e.length;o++)if(e[o].isSame(r))return o;return-1};for(let r of n.each()){let o=i(r);o>=0?t[o]++:(e.push(r),t.push(1))}return[e,t]}function*sg(n,e,t){let i=t,r=0;for(let o of n.each()){let s=e(i,o);if(s===null)return;r+=1,r%1e3===0&&(yield i),i=s}return i}function V1(n){return n.some(e=>e.type.matches("record"))?"record":n.some(e=>e.type.matches("dictionary"))?"dictionary":n.some(e=>e.type.matches("set"))?"set":"list"}function ng(n,e){return n.operator!==e.operator||n.nops!==e.nops?!1:n.ops.every((t,i)=>t.isSame(e.ops[i]))}function Fl(n,e){return Array.from({length:e-n+1},(t,i)=>n+i)}function tg(n,e=void 0){let t=e?Te(e):void 0,i=t?(s,a)=>{let u=t([s,a]);return u?.isNegative?-1:u?.is(0)?0:1}:(s,a)=>s.isLess(a)?-1:s.isEqual(a)?0:1,r=n.count;if(r===void 0||!Number.isFinite(r)||r<1)return;let o=Array.from({length:r},(s,a)=>a+1);return o.sort((s,a)=>{let u=n.at(s),l=n.at(a);return i(u,l)}),o}function ql(n){if(n.length===0)return[];let e=[];for(let t of n)t.symbol!=="Nothing"&&(t.operator==="Sequence"?e.push(...ql(t.ops)):t.string?e.push(t):t.isCollection?e.push(...ql([...t.each()])):e.push(t));return e}function $1(n){let e=Math.max(0,G(n.op2)??0);if(e===0)return{next:()=>({value:void 0,done:!0})};let t=1,i=0;return{next:()=>{if(i>=Math.abs(e))return{value:void 0,done:!0};let r=n.op1.at(t);return r?(t+=1,i+=1,{value:r,done:!1}):{value:void 0,done:!0}}}}function ig(n){let[e,t]=n.ops,i=e.count;if(i===void 0)return;let r=Math.max(0,G(t)??0);return Number.isFinite(r)?Math.min(i,r):1/0}function Ll(n){let e=n.ops.map(t=>t.count);if(!e.some(t=>t===void 0))return e.some(t=>!Number.isFinite(t))?1/0:e.length===0?0:Math.min(...e)}var Qo,rg,_a=k(()=>{kt();Xe();Yt();At();Tn();an();Ym();Vo();Ol();gi();Yo();Qo=50,rg={List:{complexity:8200,signature:"(any*) -> list",type:(n,{engine:e})=>F(`list<${R.widen(...n.map(t=>t.type))}>`),canonical:q1,lazy:!0,evaluate:(n,{engine:e,materialization:t})=>{if(t)return e._fn("List",ql(n).map(i=>i.evaluate({materialization:t})))},eq:ng,collection:sa()},Set:{complexity:8200,signature:"(any*) -> set",type:(n,{engine:e})=>F(`set<${R.widen(...n.map(t=>t.type))}>`),canonical:F1,eq:(n,e)=>{if(n.operator!==e.operator||n.nops!==e.nops)return!1;let t=i=>e.ops.some(r=>i.isSame(r));return n.ops.every(t)},collection:{...sa(),at:void 0,indexWhere:void 0}},Tuple:{description:"A fixed number of heterogeneous elements",complexity:8200,signature:"(any*) -> tuple",type:n=>F(`tuple<${n.map(e=>e.type).join(", ")}>`),canonical:(n,{engine:e})=>e.tuple(...n),eq:ng,collection:{...sa(),keys:n=>["first","second","last"]}},KeyValuePair:{description:"A key/value pair",complexity:8200,signature:"(key: string, value: any) -> tuple<string, unknown>",type:([n,e])=>F(`tuple<string, ${e.type}>`),canonical:(n,{engine:e})=>{let[t,i]=Xo(e,n,["string","any"]);return!t.isValid||!i.isValid?e._fn("KeyValuePair",[t,i]):e.tuple(t,i)}},Single:{description:"A tuple with a single element",complexity:8200,signature:"(value: any) -> tuple<any>",type:([n])=>F(`tuple<${n.type}>`),canonical:(n,{engine:e})=>e.tuple(...Vn(e,n,1))},Pair:{description:"A tuple of two elements",complexity:8200,signature:"(first: any, second: any) -> tuple<any, any>",type:([n,e])=>F(`tuple<${n.type}, ${e.type}>`),canonical:(n,{engine:e})=>e.tuple(...Vn(e,n,2))},Triple:{description:"A tuple of three elements",complexity:8200,signature:"(first: any, second: any, third: any) -> tuple<any, any, any>",type:([n,e,t])=>F(`tuple<${n.type}, ${e.type}, ${t.type}>`),canonical:(n,{engine:e})=>e.tuple(...Vn(e,n,3))},Range:{complexity:8200,signature:"(number, number?, step: number?) -> indexed_collection<integer>",canonical:(n,{engine:e})=>n.length===0?null:n.length===1?e._fn("Range",[e.One,n[0].canonical]):n.length===2?e._fn("Range",[n[0].canonical,n[1].canonical]):e._fn("Range",[n[0].canonical,n[1].canonical,n[2].canonical.evaluate()]),eq:(n,e)=>{if(n.operator!==e.operator)return!1;let[t,i,r]=Qn(n),[o,s,a]=Qn(e);return t===o&&i===s&&r===a},collection:{isLazy:n=>!0,count:n=>{let[e,t,i]=Qn(n);return i===0?0:!isFinite(e)||!isFinite(t)?1/0:1+Math.max(0,Math.floor((t-e)/i))},contains:(n,e)=>{if(!e.type.matches("integer"))return!1;let t=e.re,[i,r,o]=Qn(n);return o===0?!1:o>0?t>=i&&t<=r:t<=i&&t>=r},iterator:n=>{let[e,t,i]=Qn(n),r=i===0?0:Math.floor((t-e)/i)+1,o=1;return{next:()=>o===r+1?{value:void 0,done:!0}:(o+=1,{value:n.engine.number(e+i*(o-1-1)),done:!1})}},at:(n,e)=>{if(typeof e!="number")return;let[t,i,r]=Qn(n);if(!(e<1||e>1+(i-t)/r))return n.engine.number(t+r*(e-1))},indexWhere:void 0,subsetOf:(n,e)=>{if(e.operator==="Range"){let[i,r,o]=Qn(n),[s,a,u]=Qn(e);return i>=s&&r<=a&&o%u===0}if(!e.isCollection)return!1;let t=1;for(let i of e.each()){if(!n.contains(i)||!n.at(t)?.isSame(i))return!1;t++}return!0},eltsgn:n=>{let[e,t,i]=Qn(n);return i===0?"zero":i>0?e<=t?"positive":"negative":e>=t?"positive":"negative"},elttype:n=>"finite_integer"}},Interval:{description:"A set of real numbers between two endpoints. The endpoints may or may not be included.",complexity:8200,lazy:!0,signature:"(number, number) -> set<real>",canonical:([n,e],{engine:t})=>{if(!n||!e)return null;let[i,r]=Xo(t,[n.canonical,e.canonical],["number","number"]);return!i.isValid||!r.isValid?null:t._fn("Interval",[i,r])},eq:(n,e)=>{let t=Ii(n),i=Ii(e);return!t||!i?!1:t.start===i.start&&t.end===i.end&&t.openStart===i.openStart&&t.openEnd===i.openEnd},collection:{count:n=>1/0,iterator:n=>{let e=Ii(n);if(!e)return{next:()=>({value:void 0,done:!0})};if(e.start>=e.end)return{next:()=>({value:void 0,done:!0})};let t=n.engine,i=0,r=0;return{next:()=>{let o=Math.pow(2,i);r>=o&&(i++,r=0);let s=(2*r+1)/Math.pow(2,i+1),a=e.start+s*(e.end-e.start);return r++,{value:t.number(a),done:!1}}}},isEmpty:n=>{let e=Ii(n);return e?e.openStart&&e.start===e.end||e.openEnd&&e.start===e.end?!0:e.openStart&&e.openEnd?!1:e.start>=e.end:!1},isFinite:n=>!1,contains:(n,e)=>{let t=Ii(n);return!t||t.openStart&&e.isLessEqual(t.start)||t.openEnd&&e.isGreaterEqual(t.end)?!1:e.isGreaterEqual(t.start)&&e.isLessEqual(t.end)},eltsgn:n=>{let e=Ii(n);if(!e||e.start===e.end)return"unsigned";if(e.start>=0&&!e.openStart)return"non-negative";if(e.end<=0&&!e.openEnd)return"non-positive";if(e.start>0&&e.end>0)return"positive";if(e.start<0&&e.end<0)return"negative"},elttype:n=>{let e=Ii(n);return e?isFinite(e.start)&&isFinite(e.end)?"finite_real":"real":"never"}}},Linspace:{complexity:8200,signature:"(start: number, end: number?, count: number?) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>{let e=n.op3.re;return isFinite(e)||(e=Qo),Math.max(0,Math.floor(e))},at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.re,i=n.op2.re,r=n.op3.re;if(isFinite(r)||(r=Qo),!(!isFinite(t)||!isFinite(i))&&!(e<1||e>r))return n.engine.number(t+(i-t)*(e-1)/r)},iterator:n=>{let e=n.op1.re,t=n.op2.re,i;isFinite(t)?i=Math.max(0,isFinite(n.op3.re)?n.op3.re:Qo):(t=e,e=1,i=Qo);let r=1;return{next:()=>r===i+1?{value:void 0,done:!0}:(r+=1,{value:n.engine.number(e+(t-e)*(r-1-1)/i),done:!1})}},contains:(n,e)=>{if(!e.type.matches("finite_real"))return!1;let t=e.re,i=n.op1.re,r=n.op2.re;if(t<i||t>r)return!1;let o=n.op3.re;if(isFinite(o)||(o=Qo),o===0)return!1;let s=(r-i)/o;return(t-i)%s===0}}},Contains:{description:"Return True if the collection contains the given element, False otherwise.",complexity:8200,signature:"(collection, element: any) -> boolean",evaluate:([n,e],{engine:t})=>n.contains(e)?t.True:t.False},Count:{description:["Return the number of elements in the collection."],complexity:8200,signature:"(collection) -> integer",evaluate:([n],{engine:e})=>n.isEmptyCollection?e.Zero:e.number(n.count),sgn:([n])=>n.isEmptyCollection?"zero":"positive"},IsEmpty:{description:["Return True if the collection is empty, False otherwise."],complexity:8200,signature:"(collection) -> boolean",evaluate:([n],{engine:e})=>n.isEmptyCollection?e.True:e.False},Map:{description:["Return the collection where each element has been transformed by the mapping function.","Equivalent to `[f(x) for x in xs]`."],complexity:8200,lazy:!0,signature:"(collection, function) -> collection",type:n=>n[0].type,canonical:(n,{engine:e})=>{let t=We(e,n[0]?.canonical,"collection"),i=Le(n[1]);return!t.isValid||!i?null:e._fn("Map",[t,i])},collection:{isLazy:n=>!0,count:n=>n.op1.count,isEmpty:n=>n.op1.isEmptyCollection,isFinite:n=>n.op1.isFiniteCollection,iterator:n=>{let e=Te(n.op2);if(!e)return{next:()=>({value:void 0,done:!0})};let t=n.op1.each();return{next:()=>{for(;;){let{value:i,done:r}=t.next();return r?{value:void 0,done:!0}:{value:e([i])??n.engine.Nothing,done:!1}}}}},at:(n,e)=>{if(!n.isIndexedCollection||typeof e!="number"||!Number.isFinite(e)||e===0)return;let t=n.op1.at(e);if(t)return Te(n.op2)?.([t])}}},Filter:{description:["Return the elements of the collection for which the predicate function returns True.","Equivalent to `[x for x in xs if p(x)]`."],complexity:8200,lazy:!0,signature:"(collection, predicate: function) -> collection",type:n=>n[0].type,canonical:(n,{engine:e})=>{let t=We(e,n[0]?.canonical,"collection"),i=Le(n[1]);return!t.isValid||!i?null:e._fn("Filter",[t,i])},collection:{isLazy:n=>!0,count:n=>1/0,contains:(n,e)=>n.contains(e)?Te(n.op2)([e])?.symbol==="True":!1,iterator:n=>{let e=Te(n.op2);if(!e)return{next:()=>({value:void 0,done:!0})};let t=n.op1.each(),i=0,r=n.engine.iterationLimit;return{next:()=>{for(;;){let{value:o,done:s}=t.next();if(i+=1,i>r)throw new On({cause:"iteration-limit-exceeded",message:`Iteration limit of ${r} exceeded while evaluating Filter()`});if(s)return{value:void 0,done:!0};let a=e([o]);if(!a)throw new Error(`Invalid filter predicate. ${Xn(n.op2)}`);if(a.symbol==="True")return{value:o,done:!1};if(a.symbol!=="False")throw new Error(`Filter predicate must return "True" or "False". ${Xn(n.op2)}`)}}}},at:(n,e)=>{if(typeof e!="number"||!Number.isFinite(e)||e===0)return;let t=Te(n.op2);if(!t)return;if(e<0){if(!n.op1.isFiniteCollection)return;let r=Array.from(n.each()),o=r.length+e+1;return o<1||o>r.length?void 0:r[o-1]}let i=0;for(let r of n.op1.each()){let o=t([r])?.symbol;if(o==="True"){if(i+=1,i===e)return r}else if(o!=="False")throw new Error(`Filter predicate must return "True" or "False". ${Xn(n.op2)}`)}}}},Reduce:{complexity:8200,lazy:!0,signature:"(collection, function, initial:value?) -> value",canonical:(n,{engine:e})=>{let t=We(e,n[0],"collection"),i=Le(n[1]);if(!t.isValid||!i)return null;let r=n[2]?.canonical;return r?.isValid?e._fn("Reduce",[t,i,r]):e._fn("Reduce",[t,i])},type:n=>F(Mn(n[1].type.type)??"unknown"),evaluate:([n,e,t],{engine:i})=>{if(!n.isFiniteCollection)return;if(t??=i.Nothing,t.type.matches("real")&&n.type.matches(i.type("collection<real>"))){let a=e.compile();if(!a)return;let u=t.re,l=!0;for(let c of n.each())l?u=c.re:u=a(u,c.re),l=!1;return i.box(u)}let r=Te(e),o=t,s=!0;for(let a of n.each())s?o=a:o=r([o,a])??i.Nothing,s=!1;return o}},Join:{description:["Join the elements of some collections into a flat collection."],complexity:8200,signature:"(collection*) -> collection",type:V1,collection:{isLazy:n=>!0,count:n=>{let e=0;for(let t of n.ops){let i=t.count;if(i===void 0)return;if(!Number.isFinite(i))return 1/0;e+=i}return e},contains:(n,e)=>n.ops.some(t=>t.contains(e)),iterator:n=>{let e=n.ops.map(i=>i.each()),t=0;return{next:()=>{for(;;){let{value:i,done:r}=e[t].next();if(!r)return{value:i,done:!1};if(t+=1,t>=e.length)return{value:void 0,done:!0}}}}}}},At:{description:["Access an element of an indexed collection.","If the index is negative, it is counted from the end.","Multiple indices can be provided to access nested collections (e.g., matrices)."],complexity:8200,signature:"(value: indexed_collection, index: (number|string)+) -> unknown",type:([n])=>n.operatorDefinition?.collection?.elttype?.(n)??Sn(n.type.type)??"any",evaluate:(n,{engine:e})=>{let t=n[0],i=1;for(;n[i];){let o=t.baseDefinition?.collection?.at;if(!o)return;let s=n[i].string;if(s!==null)t=o(t,s)??e.Nothing;else{let a=n[i].re;if(!Number.isInteger(a))return;t=o(t,a)??e.Nothing}i+=1}return t}},Take:{description:["Return `n` elements from a collection."],complexity:8200,signature:"(xs: indexed_collection, count: number) -> indexed_collection",type:([n])=>`list<${Sn(n.type.type)}>`,evaluate:(n,{engine:e,materialization:t})=>{if(!t)return;let i=e._fn("Take",n),r=Array.from(i.each());return e._fn("List",r)},collection:{isLazy:n=>!0,count:ig,isEmpty:n=>{let[e,t]=n.ops;if(e.isEmptyCollection)return!0;if(e.isFiniteCollection===!1)return!1;let i=Math.max(0,G(t)??0),r=e.count;if(r!==void 0)return Number.isFinite(i)?Math.min(r,i)===0:!1},isFinite:n=>n.op1.isFiniteCollection,iterator:$1,at:(n,e)=>{if(typeof e!="number"||e===0)return;let t=Math.max(0,G(n.op2)??0);if(t===0)return;if(e>0)return e>t?void 0:n.op1.at(e);let i=ig(n);if(!(i===void 0||i===0)&&!(e<-i))return n.op1.at(i+e)}}},Drop:{description:["Return the collection without the first n elements."],complexity:8200,signature:"(xs: indexed_collection, count: number) -> indexed_collection",type:([n])=>`list<${Sn(n.type.type)}>`,collection:{isLazy:n=>!0,count:n=>{let[e,t]=n.ops,i=e.count;if(i===void 0)return;if(!Number.isFinite(i))return 1/0;if(e.isEmptyCollection)return 0;let r=G(t)??0;return r>=i?0:Math.max(0,i-r)},isFinite:n=>n.op1.isFiniteCollection,iterator:n=>{let[e,t]=n.ops,i=G(t)??0;if(i<=0)return e.each();let r=i+1;return{next:()=>{let o=n.op1.at(r++);return o===void 0?{value:void 0,done:!0}:{value:o,done:!1}}}},at:(n,e)=>{if(typeof e!="number")return;let[t,i]=n.ops,r=G(i)??0;if(!(r<=0))return t.at(e+r)}}},First:{complexity:8200,signature:"(collection) -> any",type:([n])=>n.operatorDefinition?.collection?.elttype?.(n)??"any",evaluate:([n],{engine:e})=>n.at(1)??e.Nothing},Second:{complexity:8200,signature:"(collection) -> any",type:([n])=>n.operatorDefinition?.collection?.elttype?.(n)??"any",evaluate:([n],{engine:e})=>n.at(2)??e.Nothing},Last:{complexity:8200,signature:"(collection) -> any",type:([n])=>n.operatorDefinition?.collection?.elttype?.(n)??"any",evaluate:([n],{engine:e})=>n.at(-1)??e.Nothing},Rest:{description:["Return the collection without the first element.","If the collection has only one element, return an empty collection."],complexity:8200,signature:"(indexed_collection) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>{let e=n.op1.count;if(e!==void 0)return Math.max(0,e-1)},isEmpty:n=>{if(n.op1.isEmptyCollection)return!0;let e=n.op1.count;if(e!==void 0)return e<=1},isFinite:n=>n.op1.isFiniteCollection,iterator:n=>({next:()=>{let e=1,t=n.op1.at(e>0?e+1:e);return t?(e+=1,{value:t,done:!1}):{value:void 0,done:!0}}}),at:(n,e)=>{if(typeof e=="number")return n.op1.at(e>0?e+1:e)}}},Most:{complexity:8200,description:["Return the collection without the last element.","If the collection has only one element, return an empty collection."],signature:"(indexed_collection) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>{let e=n.op1.count;if(e!==void 0)return Math.max(0,e-1)},isFinite:n=>n.op1.isFiniteCollection,isEmpty:n=>{let e=n.op1.count;if(e!==void 0)return e<=1},iterator:n=>{let e=n.op1.count;if(e===void 0||e<=1)return{next:()=>({value:void 0,done:!0})};let t=1,i=e-1;return{next:()=>t>i?{value:void 0,done:!0}:{value:n.op1.at(t++),done:!1}}},at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.count;if(t!==void 0&&(e<1&&(e=t+1+e),!(e<1||e>t-1)))return n.op1.at(e)}}},Slice:{description:["Return a range of elements from an indexed collection.","If the index is negative, it is counted from the end."],complexity:8200,signature:"(value: indexed_collection, start: number, end: number) -> list",type:([n])=>F(`list<${Sn(n.type.type)}>`),collection:{isLazy:n=>!0,count:n=>{let e=G(n.op2)??1,t=n.op1.count;if(t===void 0)return;let i=G(n.op3)??t;return e<1?Math.max(0,i+e-1):Math.max(0,Math.min(i,t)-e+1)},isFinite:n=>!0,at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.count;if(t===void 0)return;let i=G(n.op2)??1;if(i<1&&(i=t+1+i),i<1&&(i=1),i>t)return;let r=G(n.op3)??t;r<1&&(r=t+1+r),r<1&&(r=1),r>t&&(r=t)},iterator:n=>{let e=G(n.op2)??1,t=n.op1.count;if(t===void 0)return{next:()=>({value:void 0,done:!0})};if(e<1&&(e=t+1+e),e<1&&(e=1),e>t)return{next:()=>({value:void 0,done:!0})};let i=G(n.op3)??t;i<1&&(i=t+1+i),i<1&&(i=1),i>t&&(i=t);let r=e,o=i;return{next:()=>{if(r>o)return{value:void 0,done:!0};let s=n.op1.at(r);return r+=1,{value:s,done:!1}}}}}},Reverse:{complexity:8200,signature:"(indexed_collection) -> indexed_collection",type:([n])=>n.type,collection:{isLazy:n=>!0,count:n=>n.op1.count,isEmpty:n=>n.op1.isEmptyCollection,isFinite:n=>n.op1.isFiniteCollection,contains:(n,e)=>n.op1.contains(e)??!1,iterator:n=>{let e=-1;return{next:()=>{if(e===0)return{value:void 0,done:!0};let t=n.op1.at(e);return e-=1,{value:t,done:!1}}}},at:(n,e)=>{if(typeof e=="number")return n.op1.at(-e)}}},RotateLeft:{description:"Rotate the elements of the collection to the left by n positions.",complexity:8200,signature:"(indexed_collection, integer?) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>n.op1.count,isEmpty:n=>n.op1.isEmptyCollection,isFinite:n=>n.op1.isFiniteCollection,contains:(n,e)=>n.op1.contains(e)??!1,iterator:n=>{let e=n.op1.count;if(e===void 0||e<=0)return{next:()=>({value:void 0,done:!0})};let t=G(n.op2)??1;t=(t%e+e)%e;let i=1,r=e;return{next:()=>{if(i===r+1)return{value:void 0,done:!0};i+=1;let o=n.op1.at((i-1-1+t)%e+1);return o===void 0?{value:void 0,done:!0}:{value:o,done:!1}}}},at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.count;if(t===void 0||t<=0||(e<1&&(e=t+1+e),e<1||e>t))return;let i=G(n.op2)??1;return i=(i%t+t)%t,n.op1.at((e-1+i)%t+1)}}},RotateRight:{description:"Rotate the elements of the collection to the right by n positions.",complexity:8200,signature:"(indexed_collection, integer?) -> indexed_collection",collection:{isLazy:n=>!0,count:n=>n.op1.count,contains:(n,e)=>n.op1.contains(e)??!1,iterator:n=>{let e=n.op1.count;if(e===void 0||e<=0)return{next:()=>({value:void 0,done:!0})};let t=G(n.op2)??1;t=(t%e+e)%e;let i=1;return{next:()=>{if(i===e+1)return{value:void 0,done:!0};i+=1;let r=(i-1-1+(e-t))%e+1,o=n.op1.at(r);return o===void 0?{value:void 0,done:!0}:{value:o,done:!1}}}},at:(n,e)=>{if(typeof e!="number")return;let t=n.op1.count;if(t===void 0||t<=0||(e<1&&(e=t+1+e),e<1||e>t))return;let i=G(n.op2)??1;i=(i%t+t)%t;let r=(e-1+(t-i))%t+1;return n.op1.at(r)}}},IndexOf:{description:"Return the 1-based index of the first occurrence of value in collection, or 0 if not found.",complexity:8200,signature:"(collection, any) -> integer",evaluate:([n,e],{engine:t})=>{let i=n.indexWhere(r=>r.isSame(e))??void 0;return t.number(i??0)}},IndexWhere:{description:"Return the 1-based index of the first element satisfying the predicate, or 0 if not found.",complexity:8200,signature:"(collection, function) -> integer",evaluate:([n,e],{engine:t})=>{let i=Te(e);if(!i)return t.Zero;let r=n.indexWhere(o=>{let s=i([o])?.symbol;if(s==="True")return!0;if(s==="False")return!1;throw new Error(`Filter predicate must return "True" or "False". ${Xn(e)}`)})??void 0;return t.number(r??0)}},Find:{description:"Return the first element of the collection satisfying the predicate, or Nothing if none found.",complexity:8200,signature:"(collection, function) -> any",type:n=>n[0].type,evaluate:([n,e],{engine:t})=>{let i=Te(e);if(!i)return t.Nothing;for(let r of n.each()){let o=i([r])?.symbol;if(o!=="False"){if(o==="True")return r;throw new Error(`Filter predicate must return "True" or "False". ${Xn(e)}`)}}return t.Nothing}},CountIf:{description:"Return the number of elements in the collection satisfying the predicate.",complexity:8200,signature:"(collection, function) -> integer",evaluate:([n,e],{engine:t})=>{let i=Te(e);if(!i)return t.Zero;let r=0;for(let o of n.each()){let s=i([o])?.symbol;if(s!=="False")if(s==="True")r++;else throw new Error(`Filter predicate must return "True" or "False". ${Xn(e)}`)}return t.number(r)}},Position:{description:"Return a list of indexes of elements in the collection satisfying the predicate.",complexity:8200,signature:"(collection, function) -> list<integer>",type:()=>"list<integer>",evaluate:([n,e],{engine:t})=>{let i=Te(e);if(!i)return t.function("List",[]);let r=[],o=1;for(let s of n.each()){let a=i([s])?.symbol;if(a==="True"&&r.push(t.number(o)),a!=="False")throw new Error(`Filter predicate must return "True" or "False". ${Xn(e)}`);o++}return t.function("List",r)}},Ordering:{description:"Return the indexes that would sort the collection.",complexity:8200,signature:"(indexed_collection, function?) -> list<integer>",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return t.function("List",[]);let i=tg(n,e);return i?t.function("List",i):t.function("List",[])}},Sort:{description:"Return the elements of the collection sorted according to the given comparison function.",complexity:8200,signature:"(indexed_collection, function?) -> indexed_collection",type:n=>n[0].type,evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return t.function(n.operator,[]);let i=tg(n,e);if(i)return t.function(n.operator,i.map(r=>n.at(r)))}},Shuffle:{description:"Randomize the order of the elements in the collection.",complexity:8200,signature:"(indexed_collection) -> indexed_collection",type:n=>n[0].type,evaluate:([n],{engine:e})=>{if(!n.isFiniteCollection)return;let t=Array.from(n.each());for(let i=t.length-1;i>0;i--){let r=Math.floor(Math.random()*(i+1));[t[i],t[r]]=[t[r],t[i]]}return e.function(n.operator,t)}},Tabulate:{description:"Create a collection by applying a function to each index in the specified dimensions.",complexity:8200,lazy:!0,signature:"(function, integer, integer?) -> collection",canonical:(n,{engine:e})=>{let t=Le(n[0]);return t?n[2]?e._fn("Tabulate",[t,We(e,n[1]?.canonical,"integer"),We(e,n[2]?.canonical,"integer")]):e._fn("Tabulate",[t,We(e,n[1]?.canonical,"integer")]):null},evaluate:(n,{engine:e})=>{let t=Te(n[0]);if(!t)return;if(n.length===1)return e._fn("List",[]);let i=n.slice(1).map(o=>G(o));if(i.some(o=>o===null||o<=0))return;if(i.length===1)return e._fn("List",Array.from({length:i[0]??0},(o,s)=>t([e.number(s+1)])??e.Nothing));let r=(o,s,a=0)=>{if(a===o.length){let l=s.map(c=>e.number(c));return t(l)}let u=["List"];for(let l=1;l<=o[a];l++)s[a]=l,u.push(r(o,s,a+1));return u};return e.box(r(i,Array(i.length).fill(0)))}},Tally:{description:"Return a tuple with the unique elements of the collection and their respective counts.",complexity:8200,signature:"(collection) -> tuple<list, list<integer>>",type:([n],{engine:e})=>{let t=n.type.type;return t==="string"?F("tuple<list<string>, list<integer>>"):F(`tuple<list<${Sn(t)}>, list<integer>>`)},evaluate:(n,{engine:e})=>{if(!n[0].isFiniteCollection)return;let[t,i]=eg(n[0]);return e.tuple(e.function("List",t),e.function("List",i))}},Unique:{description:"Return a list of the unique elements of the collection.",complexity:8200,signature:"(collection) -> list",type:([n])=>`list<${Sn(n.type.type)}>`,evaluate:(n,{engine:e})=>{if(!n[0].isFiniteCollection)return;let[t,i]=eg(n[0]);return e.function("List",t)}},Partition:{wikidata:"Q381060",complexity:8200,signature:"(collection, integer | function) -> list",type:([n])=>`list<${Sn(n.type.type)}>`,evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=G(e);if(i!==null&&i>0){let a=Array.from(n.each()),u=[],l=Math.ceil(a.length/i);for(let c=0;c<i;c++){let f=a.slice(c*l,(c+1)*l);u.push(t.function("List",f))}return t.function("List",u)}let r=Te(e);if(!r)return;let o=[],s=[];for(let a of n.each()){let u=r([a])?.symbol;if(u==="True")o.push(a);else if(u==="False")s.push(a);else throw new Error(`Partition predicate must return "True" or "False". ${Xn(e)}`)}return t.function("List",[t.function("List",o),t.function("List",s)])}},Chunk:{description:"Split the collection into `k` nearly equal-sized chunks.",complexity:8200,signature:"(collection, integer) -> list<list>",evaluate:([n,e],{engine:t})=>{let i=G(e);if(!n.isFiniteCollection||i===null||i<=0)return;let r=Array.from(n.each()),o=[],s=Math.ceil(r.length/i);for(let a=0;a<i;a++){let u=r.slice(a*s,(a+1)*s);o.push(t.function("List",u))}return t.function("List",o)}},GroupBy:{description:["Partition the collection into a dictionary of lists based on the key returned by the function."],complexity:8200,signature:"(collection, function) -> dictionary<list>",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Te(e);if(!i)return;let r={};for(let o of n.each()){let s=i([o])??t.Nothing,a=s.symbol??s.string??s.toString();a in r||(r[a]=[]),r[a].push(o)}return t.function("Dictionary",Object.entries(r).map(([o,s])=>t._fn("Tuple",[t.string(o),t.function("List",s)])))}},Zip:{description:"Combine multiple collections element-wise into a list of tuples. The result has the length of the shortest input.",complexity:8200,signature:"(indexed_collection+) -> list",collection:{isLazy:n=>!0,count:Ll,isFinite:n=>n.ops.every(e=>e.isFiniteCollection),isEmpty:n=>n.nops===0||n.ops.every(e=>e.isEmptyCollection),iterator:n=>{let e=Ll(n);if(e===void 0||e<=0)return{next:()=>({value:void 0,done:!0})};let t=1;return{next:()=>{if(t===e+1)return{value:void 0,done:!0};t+=1;let i=n.ops.map(r=>r.at(t-1));return i.some(r=>r===void 0)?{value:void 0,done:!0}:{value:n.engine.tuple(...i),done:!1}}}},at:(n,e)=>{if(typeof e!="number"||e<1)return;let t=Ll(n);if(t===void 0||e<1||e>t)return;let i=n.ops.map(r=>r.at(e));if(!i.some(r=>r===void 0))return n.engine.tuple(...i)}}},Iterate:{description:"Produce an infinite sequence by repeatedly applying a function to the previous value, starting with an initial value.",complexity:8200,signature:"((index: integer, acc:any) -> any, initial: any?) -> list",canonical:([n,e],{engine:t})=>{let i=Le(n);if(!i)return null;let r=e?.canonical;return r?t._fn("Iterate",[i,r]):t._fn("Iterate",[i])},collection:{isLazy:n=>!0,count:()=>1/0,iterator:n=>{let e=Te(n.op1);if(!e)return{next:()=>({value:void 0,done:!0})};let t=n.op2??n.engine.Nothing,i=0;return{next:()=>(i+=1,t=e([n.engine.number(i),t])??n.engine.Nothing,{value:t,done:!1})}},at:(n,e)=>{if(typeof e!="number"||e<1)return;let t=Te(n.op1);if(!t)return;let i=n.op2??n.engine.Nothing;for(let r=1;r<e;r++)i=t([n.engine.number(r),i])??n.engine.Nothing;return i}}},Repeat:{description:"Produce an infinite sequence by repeating a single value.",complexity:8200,signature:"(value: any) -> list",collection:{isLazy:n=>!0,count:()=>1/0,isEmpty:n=>!1,isFinite:()=>!1,contains:(n,e)=>n.op1.isSame(e),iterator:n=>({next:()=>({value:n.op1,done:!1})}),at:(n,e)=>n.op1}},Cycle:{description:"Produce an infinite sequence by cycling through the elements of a finite collection.",complexity:8200,signature:"(list) -> list",collection:{isLazy:n=>!0,count:()=>1/0,isEmpty:n=>n.isEmptyCollection,isFinite:n=>!n.isEmptyCollection,contains:(n,e)=>n.op1.contains(e)??!1,iterator:n=>{let e=1,t=n.op1.count;return t===void 0||t===0?{next:()=>({value:void 0,done:!0})}:{next:()=>{let i=(e-1-1)%t+1,r=n.op1.at(i);return r===void 0?{value:void 0,done:!0}:(e+=1,{value:r,done:!1})}}},at:(n,e)=>{if(typeof e!="number"||e<1)return;let t=n.op1.count;if(t===void 0||t===0)return;let i=(e-1)%t+1;return n.op1.at(i)}}},Fill:{description:"Produce a 2D list (matrix) by applying a function to each pair of row and column indexes.",complexity:8200,signature:"(function, tuple) -> list",collection:{isLazy:n=>!0,count:n=>n.op2.ops.map(t=>G(t)??0)[0]??0,iterator:n=>{let e=Te(n.op1);if(!e)return{next:()=>({value:void 0,done:!0})};let t=n.op2.ops.map(a=>G(a)??0),i=t[0]??0,r=t[1]??0,o=i,s=1;return{next:()=>{if(s===o+1)return{value:void 0,done:!0};s+=1;let a=[];for(let u=1;u<=r;u++)a.push(e([n.engine.number(s-1),n.engine.number(u)])??n.engine.Nothing);return{value:n.engine.function("List",a),done:!1}}}},at:(n,e)=>{if(typeof e!="number"||e<1)return;let t=Te(n.op1);if(!t)return;let i=n.op2.ops.map(u=>G(u)??0),r=i[0]??0,o=i[1]??0;if(e>r*o)return;let s=Math.ceil(e/o),a=(e-1)%o+1;return t([n.engine.number(s),n.engine.number(a)])??n.engine.Nothing}}},ListFrom:{description:"Create a list from the elements of a collection.",complexity:8200,signature:"(value*) -> list",type:n=>{if(n.length===0)return"list";let e="unknown";for(let t of n){if(t.isCollection&&!t.isFiniteCollection)return"list";e=ve(e,Sn(t.type.type)??e)}return F(`list<${te(e)}>`)},evaluate:(n,{engine:e})=>{let t=[];for(let i of n)if(!i.isCollection)t.push(i);else{if(!i.isFiniteCollection)return;t.push(...Array.from(i.each()))}return e.function("List",t)}},SetFrom:{description:"Create a set from the elements of a collection.",complexity:8200,signature:"(value*) -> set",type:n=>{if(n.length===0)return"set";let e="unknown";for(let t of n){if(t.isCollection&&!t.isFiniteCollection)return"set";e=ve(e,Sn(t.type.type)??e)}return F(`set<${te(e)}>`)},evaluate:(n,{engine:e})=>{let t=[];for(let i of n)if(i.isCollection)t.push(i);else{if(!i.isFiniteCollection)return;t.push(...Array.from(i.each()))}return e.function("Set",t)}},TupleFrom:{description:"Create a tuple from the elements of a collection.",complexity:8200,signature:"(value*) -> tuple",evaluate:(n,{engine:e})=>{let t=[];for(let i of n)if(i.isCollection)t.push(i);else{if(!i.isFiniteCollection)return;t.push(...Array.from(i.each()))}return e.tuple(...t)}},DictionaryFrom:{description:"Create a dictionary from the elements of a collection of (key, value) pairs.",complexity:8200,signature:"(collection) -> dictionary",evaluate:([n],{engine:e})=>{if(!n.isCollection)return;if(n.operator==="Record")return e.function("Dictionary",n.ops);let t=[];for(let i of n.each()){if(i.nops!==2)throw new Error(`Expected a collection of pairs, got ${i.type}`);let r=i.op1,o=i.op2;if(!r.string)throw new Error(`Expected a string key, got ${r.type}`);t.push(e.tuple(r,o))}return e.function("Dictionary",t)}},RecordFrom:{description:"Create a record from the elements of a collection of (key, value) pairs.",complexity:8200,signature:"(collection) -> record",evaluate:([n],{engine:e})=>{if(!n.isCollection)return;if(n.operator==="Dictionary")return e.function("Record",n.ops);let t=[];for(let i of n.each()){if(i.nops!==2)throw new Error(`Expected a collection of pairs, got ${i.type}`);let r=i.op1,o=i.op2;if(!r.string)throw new Error(`Expected a string key, got ${r.type}`);t.push(e.tuple(r,o))}return e.function("Record",t)}}}});function j1(n){for(let e=0;e<n.length;e++){let t=n[e];for(let i=e+1;i<n.length;i++){let r=n[i];if(t.operator==="Not"&&t.op1.isSame(r)||r.operator==="Not"&&r.op1.isSame(t))return!0}}return!1}function U1(n){for(let e=0;e<n.length;e++){let t=n[e];for(let i=e+1;i<n.length;i++){let r=n[i];if(t.operator==="Not"&&t.op1.isSame(r)||r.operator==="Not"&&r.op1.isSame(t))return!0}}return!1}function jl(n,{engine:e}){if(n.length===0)return e.True;let t=[];for(let r of n){if(r.operator==="Or"&&U1(r.ops)&&(r=e.True),r.symbol==="False")return e.False;if(r.symbol!=="True"){let o=!1;for(let s of t)if(s.isSame(r))o=!0;else if(r.operator==="Not"&&r.op1.isSame(s)||s.operator==="Not"&&s.op1.isSame(r))return e.False;o||t.push(r)}}if(t.length===0)return e.True;if(t.length===1)return t[0];let i=G1(t);return i.length===0?e.True:i.length===1?i[0]:e._fn("And",i)}function G1(n){let e=[];for(let t of n)if(t.operator==="Or"&&t.ops){let i=!1;for(let r of t.ops){for(let o of n)if(o!==t&&r.isSame(o)){i=!0;break}if(i)break}i||e.push(t)}else e.push(t);return e}function Ul(n,{engine:e}){if(n.length===0)return e.True;let t=[];for(let r of n){if(r.operator==="And"&&j1(r.ops)&&(r=e.False),r.symbol==="True")return e.True;if(r.symbol!=="False"){let o=!1;for(let s of t)if(s.isSame(r))o=!0;else if(r.operator==="Not"&&r.op1.isSame(s)||s.operator==="Not"&&s.op1.isSame(r))return e.True;o||t.push(r)}}if(t.length===0)return e.False;if(t.length===1)return t[0];let i=z1(t);return i.length===0?e.False:i.length===1?i[0]:e._fn("Or",i)}function z1(n){let e=[];for(let t of n)if(t.operator==="And"&&t.ops){let i=!1;for(let r of t.ops){for(let o of n)if(o!==t&&r.isSame(o)){i=!0;break}if(i)break}i||e.push(t)}else e.push(t);return e}function Gl(n,{engine:e}){let t=n[0]?.symbol;if(t==="True")return e.False;if(t==="False")return e.True}function zl(n,{engine:e}){let t=n[0].symbol,i=n[1].symbol;if(t==="True"&&i==="True"||t==="False"&&i==="False")return e.True;if(t==="True"&&i==="False"||t==="False"&&i==="True")return e.False}function Zl(n,{engine:e}){let t=n[0].symbol,i=n[1].symbol;if(t==="True"&&i==="True"||t==="False"&&i==="False"||t==="False"&&i==="True")return e.True;if(t==="True"&&i==="False")return e.False}function Hl(n,{engine:e}){if(n.length===0)return e.False;let t=0,i=[];for(let r of n)r.symbol==="True"?t++:r.symbol==="False"||i.push(r);if(i.length===0)return t%2===1?e.True:e.False;if(i.length===1&&t%2===1)return e._fn("Not",[i[0]]);if(i.length===1&&t%2===0)return i[0]}function Wl(n,{engine:e}){if(n.length===0)return e.False;for(let i of n)if(i.symbol==="False")return e.True;let t=!0;for(let i of n)if(i.symbol!=="True"){t=!1;break}if(t)return e.False}function Jl(n,{engine:e}){if(n.length===0)return e.True;for(let i of n)if(i.symbol==="True")return e.False;let t=!0;for(let i of n)if(i.symbol!=="False"){t=!1;break}if(t)return e.True}function je(n,e){let t=n.operator;if(!t||n.symbol==="True"||n.symbol==="False")return n;if(t==="Not"){let i=n.op1;if(!i)return n;let r=i.operator;if(r==="Not")return je(i.op1,e);if(r==="And"){let o=i.ops.map(s=>je(e._fn("Not",[s]),e));return e._fn("Or",o)}if(r==="Or"){let o=i.ops.map(s=>je(e._fn("Not",[s]),e));return e._fn("And",o)}if(i.symbol==="True")return e.False;if(i.symbol==="False")return e.True;if(r==="Implies"){let o=i.op1,s=i.op2;return je(e._fn("And",[o,e._fn("Not",[s])]),e)}if(r==="Equivalent"){let o=i.op1,s=i.op2;return je(e._fn("Or",[e._fn("And",[o,e._fn("Not",[s])]),e._fn("And",[e._fn("Not",[o]),s])]),e)}if(r==="Xor"){let o=i.ops;if(o.length===2){let s=o[0],a=o[1];return je(e._fn("Or",[e._fn("And",[s,a]),e._fn("And",[e._fn("Not",[s]),e._fn("Not",[a])])]),e)}return je(e._fn("Not",[je(i,e)]),e)}return r==="Nand"?je(e._fn("And",i.ops),e):r==="Nor"?je(e._fn("Or",i.ops),e):n}if(t==="Implies"){let i=n.op1,r=n.op2;return je(e._fn("Or",[e._fn("Not",[i]),r]),e)}if(t==="Equivalent"){let i=n.op1,r=n.op2;return je(e._fn("And",[e._fn("Or",[e._fn("Not",[i]),r]),e._fn("Or",[e._fn("Not",[r]),i])]),e)}if(t==="Xor"){let i=n.ops;if(i.length===2){let r=i[0],o=i[1];return je(e._fn("And",[e._fn("Or",[r,o]),e._fn("Or",[e._fn("Not",[r]),e._fn("Not",[o])])]),e)}if(i.length>2){let r=e._fn("Xor",[i[0],i[1]]),o=i.slice(2);return je(e._fn("Xor",[r,...o]),e)}return i.length===1?je(i[0],e):e.False}if(t==="Nand"){let i=n.ops;return je(e._fn("Not",[e._fn("And",i)]),e)}if(t==="Nor"){let i=n.ops;return je(e._fn("Not",[e._fn("Or",i)]),e)}if(t==="And"||t==="Or"){let i=n.ops.map(r=>je(r,e));return e._fn(t,i)}return n}function Vl(n,e){let t=n.operator;if(t!=="Or")return t==="And"?e._fn("And",n.ops.map(l=>Vl(l,e))):n;let i=[];for(let l of n.ops)l.operator==="Or"?i.push(...l.ops):i.push(l);let r=i.findIndex(l=>l.operator==="And");if(r===-1)return n;let o=i[r],s=[...i.slice(0,r),...i.slice(r+1)],a=s.length===1?s[0]:e._fn("Or",s),u=e._fn("And",o.ops.map(l=>e._fn("Or",[l,a])));return Vl(u,e)}function ag(n,e){let t=je(n,e);return Vl(t,e).simplify()}function $l(n,e){let t=n.operator;if(t!=="And")return t==="Or"?e._fn("Or",n.ops.map(l=>$l(l,e))):n;let i=[];for(let l of n.ops)l.operator==="And"?i.push(...l.ops):i.push(l);let r=i.findIndex(l=>l.operator==="Or");if(r===-1)return n;let o=i[r],s=[...i.slice(0,r),...i.slice(r+1)],a=s.length===1?s[0]:e._fn("And",s),u=e._fn("Or",o.ops.map(l=>e._fn("And",[l,a])));return $l(u,e)}function ug(n,e){let t=je(n,e);return $l(t,e).simplify()}function Bi(n){let e=new Set;function t(i){if(!(i.symbol==="True"||i.symbol==="False")){if(i.symbol&&i.operator==="Symbol"){e.add(i.symbol);return}if(i.ops)for(let r of i.ops)t(r)}}return t(n),Array.from(e).sort()}function wi(n,e,t){let i={};for(let[o,s]of Object.entries(e))i[o]=s?t.True:t.False;return n.subs(i).canonical.evaluate()}function*Ai(n){let e=n.length,t=1<<e;for(let i=0;i<t;i++){let r={};for(let o=0;o<e;o++)r[n[o]]=(i>>e-1-o&1)===1;yield r}}var Yl=k(()=>{});function Z1(n,e,t,i){return n.filter(r=>t.subs({[e]:r}).evaluate().symbol==="True")}function Kl(n,e){if(n.operator!=="Element")return{status:"error",reason:"expected-element-expression"};let t=n.op1?.symbol;if(!t)return{status:"error",reason:"expected-index-variable"};let i=n.op2;if(!i)return{status:"error",reason:"expected-domain"};let r=n.op3,o=n.nops>=3&&r&&r.symbol!=="Nothing"?r:null,s=a=>{if(o){let u=Z1(a,t,o,e);return{status:"success",variable:t,values:u}}return{status:"success",variable:t,values:a}};if(i.operator==="Set"||i.operator==="List"){let a=i.ops;if(a&&a.length<=1e3){if(i.operator==="List"&&a.length===2){let u=J(a[0]),l=J(a[1]);if(u!==null&&l!==null){let c=l-u+1;if(c>0&&c<=1e3){let f=[];for(let p=u;p<=l;p++)f.push(e.number(p));return s(f)}if(c>1e3)return{status:"non-enumerable",variable:t,domain:i,reason:"domain-too-large"}}}return s([...a])}return a&&a.length>1e3?{status:"non-enumerable",variable:t,domain:i,reason:"domain-too-large"}:{status:"error",reason:"empty-domain"}}if(i.operator==="Range"){let a=J(i.op1),u=J(i.op2),l=i.ops&&i.ops.length>=3?J(i.op3):1;if(a!==null&&u!==null&&l!==null&&l!==0){let c=Math.floor((u-a)/l)+1;if(c>0&&c<=1e3){let f=[];for(let p=a;l>0?p<=u:p>=u;p+=l)f.push(e.number(p));return s(f)}if(c>1e3)return{status:"non-enumerable",variable:t,domain:i,reason:"domain-too-large"}}return{status:"non-enumerable",variable:t,domain:i,reason:"non-integer-bounds"}}if(i.operator==="Interval"){let a=i.op1,u=i.op2,l=!1,c=!1;a?.operator==="Open"?(l=!0,a=a.op1):a?.operator==="Closed"&&(a=a.op1),u?.operator==="Open"?(c=!0,u=u.op1):u?.operator==="Closed"&&(u=u.op1);let f=J(a),p=J(u);if(f!==null&&p!==null){l&&(f+=1),c&&(p-=1);let d=p-f+1;if(d>0&&d<=1e3){let m=[];for(let g=f;g<=p;g++)m.push(e.number(g));return s(m)}if(d>1e3)return{status:"non-enumerable",variable:t,domain:i,reason:"domain-too-large"}}return{status:"non-enumerable",variable:t,domain:i,reason:"non-integer-bounds"}}if(i.symbol){if(["Integers","NonNegativeIntegers","PositiveIntegers","NegativeIntegers","Rationals","Reals","PositiveReals","NonNegativeReals","NegativeReals","NonPositiveReals","ExtendedReals","Complexes","ImaginaryNumbers","Numbers","ExtendedComplexes","AlgebraicNumbers","TranscendentalNumbers"].includes(i.symbol))return{status:"non-enumerable",variable:t,domain:i,reason:"infinite-domain"};let u=i.value;if(u&&u.operator==="Set"){let l=u.ops;if(l&&l.length<=1e3)return s([...l]);if(l&&l.length>1e3)return{status:"non-enumerable",variable:t,domain:i,reason:"domain-too-large"}}return{status:"non-enumerable",variable:t,domain:i,reason:"unknown-domain"}}return{status:"non-enumerable",variable:t,domain:i,reason:"unrecognized-domain-type"}}function Ko(n,e){let t=Kl(n,e);return t.status==="success"?{variable:t.variable,values:t.values}:null}function Ta(n,e){if(n.symbol===e)return!0;if(n.ops){for(let t of n.ops)if(Ta(t,e))return!0}return!1}function Sa(n,e){let t=n.canonical,i=t.operator;if(i!=="ForAll"&&i!=="Exists")return[];let r=t.op1,o=t.op2;if(!r||!o)return[];let s=Ko(r,e);if(!s)return[];let a=Sa(o,e);return[{variable:s.variable,values:s.values},...a]}function Ia(n){let e=n.canonical,t=e.operator;if(t==="ForAll"||t==="Exists"){let i=e.op2;if(i)return Ia(i)}return e}function cg(n,e,t){let i=n.map(()=>0),r=n.map(o=>o.values.length);if(r.some(o=>o===0))return t.True;for(;;){let o={};for(let l=0;l<n.length;l++)o[n[l].variable]=n[l].values[i[l]];let a=e.subs(o).canonical.evaluate();if(a.symbol==="False")return t.False;if(a.symbol!=="True")return;let u=n.length-1;for(;u>=0&&(i[u]++,!(i[u]<r[u]));)i[u]=0,u--;if(u<0)break}return t.True}function fg(n,e,t){let i=n.map(()=>0),r=n.map(o=>o.values.length);if(r.some(o=>o===0))return t.False;for(;;){let o={};for(let l=0;l<n.length;l++)o[n[l].variable]=n[l].values[i[l]];if(e.subs(o).canonical.evaluate().symbol==="True")return t.True;let u=n.length-1;for(;u>=0&&(i[u]++,!(i[u]<r[u]));)i[u]=0,u--;if(u<0)break}return t.False}function pg(n,e){let t=Bi(n);if(t.length===0)return n.evaluate().symbol==="True"?e.True:e.False;if(t.length>20)return e._fn("IsSatisfiable",[n]);for(let i of Ai(t))if(wi(n,i,e).symbol==="True")return e.True;return e.False}function dg(n,e){let t=Bi(n);if(t.length===0)return n.evaluate().symbol==="True"?e.True:e.False;if(t.length>20)return e._fn("IsTautology",[n]);for(let i of Ai(t))if(wi(n,i,e).symbol!=="True")return e.False;return e.True}function mg(n,e){let t=Bi(n);if(t.length>10)return e._fn("TruthTable",[n]);let i=[],r=e._fn("List",[...t.map(o=>e.string(o)),e.string("Result")]);i.push(r);for(let o of Ai(t)){let s=wi(n,o,e),a=e._fn("List",[...t.map(u=>o[u]?e.True:e.False),s]);i.push(a)}return e._fn("List",i)}function H1(n,e){let t=[];for(let i=e-1;i>=0;i--)t.push(n>>i&1);return t}function W1(n){return n.filter(e=>e===1).length}function J1(n,e){let t=-1;for(let i=0;i<n.length;i++)if(n[i]===-1||e[i]===-1){if(n[i]!==e[i])return-1}else if(n[i]!==e[i]){if(t!==-1)return-1;t=i}return t}function Y1(n,e){let t=[...n];return t[e]=-1,t}function lg(n){return n.map(e=>e===-1?"-":e.toString()).join("")}function gg(n,e){let t=Bi(n);if(t.length>12)return null;if(t.length===0){let s=n.evaluate();return s.symbol==="True"?[e.True]:s.symbol==="False"?[]:null}let i=[],r=0;for(let s of Ai(t))wi(n,s,e).symbol==="True"&&i.push(r),r++;return i.length===0?[]:i.length===1<<t.length?[e.True]:Ba(i,t.length).map(s=>Ql(s,t,e))}function hg(n,e){let t=Bi(n);if(t.length>12)return null;if(t.length===0){let s=n.evaluate();return s.symbol==="True"?[]:s.symbol==="False"?[e.False]:null}let i=[],r=0;for(let s of Ai(t))wi(n,s,e).symbol==="False"&&i.push(r),r++;return i.length===0?[]:i.length===1<<t.length?[e.False]:Ba(i,t.length).map(s=>Xl(s,t,e))}function Ba(n,e){let t=new Map;for(let r of n){let o=H1(r,e);t.set(lg(o),{term:o,combined:!1})}let i=[];for(;t.size>0;){let r=new Map,o=new Map;for(let[a,{term:u}]of t){let l=W1(u);o.has(l)||o.set(l,[]),o.get(l).push({key:a,term:u})}let s=Array.from(o.keys()).sort((a,u)=>a-u);for(let a=0;a<s.length-1;a++){let u=o.get(s[a]),l=o.get(s[a+1]);for(let{key:c,term:f}of u)for(let{key:p,term:d}of l){let m=J1(f,d);if(m!==-1){let g=t.get(c),h=t.get(p);g.combined=!0,h.combined=!0;let x=Y1(f,m),y=lg(x);r.has(y)||r.set(y,{term:x,combined:!1})}}}for(let{term:a,combined:u}of t.values())u||i.push(a);t=r}return i}function Ql(n,e,t){let i=[];for(let r=0;r<n.length;r++)n[r]===1?i.push(t.symbol(e[r])):n[r]===0&&i.push(t._fn("Not",[t.symbol(e[r])]));return i.length===0?t.True:i.length===1?i[0]:t._fn("And",i)}function Xl(n,e,t){let i=[];for(let r=0;r<n.length;r++)n[r]===0?i.push(t.symbol(e[r])):n[r]===1&&i.push(t._fn("Not",[t.symbol(e[r])]));return i.length===0?t.False:i.length===1?i[0]:t._fn("Or",i)}function xg(n,e){let t=Bi(n);if(t.length>12)return null;if(t.length===0)return n.evaluate().symbol==="True"?e.True:e.False;let i=[],r=0;for(let a of Ai(t))wi(n,a,e).symbol==="True"&&i.push(r),r++;if(i.length===0)return e.False;if(i.length===1<<t.length)return e.True;let o=Ba(i,t.length),s=bg(o,i,t.length);return s.length===0?e.False:s.length===1?Ql(s[0],t,e):e._fn("Or",s.map(a=>Ql(a,t,e)))}function yg(n,e){let t=Bi(n);if(t.length>12)return null;if(t.length===0)return n.evaluate().symbol==="True"?e.True:e.False;let i=[],r=0;for(let a of Ai(t))wi(n,a,e).symbol==="False"&&i.push(r),r++;if(i.length===0)return e.True;if(i.length===1<<t.length)return e.False;let o=Ba(i,t.length),s=bg(o,i,t.length);return s.length===0?e.True:s.length===1?Xl(s[0],t,e):e._fn("And",s.map(a=>Xl(a,t,e)))}function Na(n,e){let t=[],i=[];for(let s=0;s<n.length;s++)n[s]===-1&&i.push(s);let r=i.length,o=1<<r;for(let s=0;s<o;s++){let a=0;for(let u=0;u<e;u++){let l=i.indexOf(u),c;l!==-1?c=s>>r-1-l&1:c=n[u],a=a<<1|c}t.push(a)}return t}function bg(n,e,t){let i=new Set(e),r=[],o=new Map;for(let a of e)o.set(a,[]);for(let a=0;a<n.length;a++){let u=Na(n[a],t);for(let l of u)o.has(l)&&o.get(l).push(a)}let s=new Set;for(let[a,u]of o)if(u.length===1&&i.has(a)){let l=u[0];if(!s.has(l)){s.add(l),r.push(n[l]);let c=Na(n[l],t);for(let f of c)i.delete(f)}}for(;i.size>0;){let a=-1,u=0;for(let c=0;c<n.length;c++){if(s.has(c))continue;let p=Na(n[c],t).filter(d=>i.has(d)).length;p>u&&(u=p,a=c)}if(a===-1)break;s.add(a),r.push(n[a]);let l=Na(n[a],t);for(let c of l)i.delete(c)}return r}var ec=k(()=>{Xe();Yl()});function Q1(n){switch(n){case"NonNegativeIntegers":return{lower:0,upper:$i,isFinite:!1};case"PositiveIntegers":return{lower:1,upper:1+$i,isFinite:!1};default:return}}function Kr(n){n?.operator;let e=1,t=e+$i,i,r=!0;return i=n.op1.symbol,e=Math.floor(n.op2.re),isNaN(e)&&(e=1),Number.isFinite(e)||(r=!1),n.op3.symbol==="Nothing"||n.op3.isInfinity?r=!1:(isNaN(n.op3.re)||(t=Math.floor(n.op3.re??t)),Number.isFinite(t)||(r=!1)),!r&&Number.isFinite(e)&&(t=e+$i),{index:i,lower:e,upper:t,isFinite:r}}function X1(n){return n.map(e=>Kr(e))}function K1(n){n.length>0;let{index:e,lower:t,upper:i,isFinite:r}=n[0];r||(i=t+$i);let o=Fl(t,i).map(s=>[s]);if(n.length===1)return o;for(let s=1;s<n.length;s++){let{index:a,lower:u,upper:l,isFinite:c}=n[s];c||(l=u+$i),o=e0(o.map(f=>f[0]),Fl(u,l))}return o}function e0(n,e){return n.flatMap(t=>e.map(i=>[t,i]))}function Eg(n,e){let t=e.engine,i=[];for(let r=0;r<n.length;r++){let o=n[r];o.operator==="Range"?i.push(ki([t.Nothing,o.op1,o.op2],e)??t.error("missing")):o.operator&&["Limits","Tuple","Triple","Pair","Single","Hold"].includes(o.operator)?i.push(ki(o.ops,e)??t.error("missing")):o.symbol&&(n[r+1]?.isNumberLiteral?n[r+2]?.isNumberLiteral?(i.push(ki([o,n[r+1],n[r+2]],e)??t.error("missing")),r+=2):(i.push(ki([o,n[r+1]],e)??t.error("missing")),r+=1):i.push(ki([o],e)??t.error("missing")))}return i}function ki(n,{engine:e}){if(n.length===1){let t=n[0];return t.symbol?e._fn("Limits",[t,e.Nothing,e.Nothing]):t.operator==="Hold"?ki(t.ops,{engine:e}):e._fn("Limits",[e.typeError("symbol",void 0,t)])}else if(n.length>1){let t=e.Nothing,i=e.Nothing,r=n[1].canonical;return n.length===2?n[0].operator==="Hold"?(t=n[0].op1,r=n[1].canonical):n[0].symbol?(t=n[0],r=n[1].canonical):(t=e.Nothing,i=n[0].canonical,r=n[1].canonical):n.length===3&&(t=n[0]??e.Nothing,i=n[1]?.canonical??e.Nothing,r=n[2]?.canonical??e.Nothing),t.operator==="Hold"&&(t=t.op1),t.symbol||(t=e.typeError("symbol",t.type,t)),e._fn("Limits",[t,i,r])}return null}function n0(n){let e=n.engine,t,i=null,r=null;if(n.operator==="Element"){let o=n.op1,s=n.op2,a=n.op3;return o?.symbol?(o.symbol!=="Nothing"&&e.declare(o.symbol,"integer"),a?e.function("Element",[o.canonical,s.canonical,a.canonical]):e.function("Element",[o.canonical,s.canonical])):void 0}if(n.operator==="Limits"){let o=n.op1.canonical,s=n.op2?.canonical??e.Nothing,a=n.op3?.canonical??e.Nothing;return o.symbol?e.function("Limits",[o,s,a]):e.function("Limits",[e.typeError("symbol",void 0,o)])}if(n.operator==="Tuple"||n.operator==="Triple"||n.operator==="Pair"||n.operator==="Single"?(t=n.op1,r=n.ops[1]?.canonical??null,i=n.ops[2]?.canonical??null):t=n,t.operator==="Hold"&&(t=t.op1),!!t.symbol)return t.symbol&&t.symbol!=="Nothing"&&e.declare(t.symbol,"integer"),i&&r?e.function("Limits",[t,r,i]):i?e.function("Limits",[t,e.One,i]):r?e.function("Limits",[t,r]):e.function("Limits",[t])}function nc(n,e,t,i){let r=e.engine;r.pushScope(i);let o=t.map(s=>n0(s)??r.error("missing"));return e=e?.canonical??r.error("missing"),r.popScope(),e.isCollection?n==="Sum"?r.box(["Reduce",e,"Add",0]):r.box(["Reduce",e,"Multiply",1]):r._fn(n,[e,...o],{scope:i})}function*es(n,e,t,i){if(n.isCollection)return yield*sg(n.evaluate(),t,i);if(e.length===0)return t(i,n)??void 0;let r=n.engine;if(e.filter(c=>c.operator==="Element").length>0){let c=t0(n,e,t,i,!0),f=c.next();for(;!f.done;){let d=f.value;d!==void 0&&typeof d!="object"&&(yield d),f=c.next()}let p=f.value;if(p&&typeof p=="object"&&"status"in p){let d=p;return d.status==="success"?d.value:d.status==="non-enumerable"?eo:void 0}return p}let s=X1(e),a=K1(s),u=i,l=0;for(let c of a)if(s.forEach((f,p)=>r.assign(f.index,c[p])),u=t(u,n)??void 0,l+=1,l%1e3===0&&(yield u),u===void 0)break;return u??void 0}function*t0(n,e,t,i,r=!1){let o=n.engine,s=[],a=[];for(let p of e)if(p.operator==="Element"){let d=Kl(p,o);if(d.status==="error")return r?{status:"error",reason:d.reason}:void 0;if(d.status==="non-enumerable"){if(d.reason==="infinite-domain"&&d.domain?.symbol){let m=Q1(d.domain.symbol);if(m){a.push({index:d.variable,...m});continue}}return r?{status:"non-enumerable",reason:d.reason,domain:d.domain}:void 0}s.push({variable:d.variable,values:d.values})}else a.push(Kr(p));if(a.length>0)for(let p of a){let d=[];for(let m=p.lower;m<=p.upper;m++)d.push(o.number(m));s.push({variable:p.index,values:d})}let u=s.map(()=>0),l=s.map(p=>p.values.length);if(l.some(p=>p===0))return r?{status:"success",value:i}:i;let c=i,f=0;for(;;){for(let d=0;d<s.length;d++)o.assign(s[d].variable,s[d].values[u[d]]);if(c=t(c,n)??void 0,f++,f%1e3===0&&(yield c),c===void 0)break;let p=s.length-1;for(;p>=0&&(u[p]++,!(u[p]<l[p]));)u[p]=0,p--;if(p<0)break}return r?{status:"success",value:c}:c??void 0}var eo,ns=k(()=>{en();_a();ec();eo=Symbol("non-enumerable-domain")});var ts={};yr(ts,{BaseCompiler:()=>Je});var Je,Ct=k(()=>{me();Yt();Pn();ns();Je=class n{static compile(e,t,i=0){if(e===void 0)return"";if(!e.isValid)throw new Error(`Cannot compile invalid expression: "${e.toString()}"`);let r=e.symbol;if(r!==null){let s=t.operators?.(r);return s!==void 0?`(a,b) => a ${s[0]} b`:t.var?.(r)??r}if(e.isNumberLiteral){if(e.im!==0)throw new Error("Complex numbers are not supported");return t.number(e.re)}let o=e.string;return o!==null?t.string(o):n.compileExpr(e.engine,e.operator,e.ops,i,t)}static compileExpr(e,t,i,r,o){if(t==="Error")throw new Error("Error");if(t==="Sequence")return i.length===0?"":`(${i.map(u=>n.compile(u,o,r)).join(", ")})`;if(t==="Sum"||t==="Product")return n.compileLoop(t,i,o);let s=o.operators?.(t);if(s!==void 0){if(/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(s[0]))return i===null?`${s[0]}()`:`${s[0]}(${i.map(l=>n.compile(l,o)).join(", ")})`;if(i.every(l=>!l.isCollection)){if(Dn(t)&&i.length>2){let c=[];for(let f=0;f<i.length-1;f++)c.push(n.compileExpr(e,t,[i[f],i[f+1]],s[1],o));return`(${c.join(") && (")})`}if(i===null)return"";let l;return i.length===1?l=`${s[0]}${n.compile(i[0],o,s[1])}`:l=i.map(c=>n.compile(c,o,s[1])).join(` ${s[0]} `),s[1]<r?`(${l})`:l}}if(t==="Function"){let u=i.slice(1).map(l=>l.symbol);return`((${u.join(", ")}) => ${n.compile(i[0].canonical,{...o,var:l=>u.includes(l)?l:o.var(l)})})`}if(t==="Declare")return`let ${i[0].symbol}`;if(t==="Assign")return`${i[0].symbol} = ${n.compile(i[1],o)}`;if(t==="Return")return`return ${n.compile(i[0],o)}`;if(t==="If"){if(i.length!==3)throw new Error("If: wrong number of arguments");let u=o.functions?.(t);return u?typeof u=="function"?u(i,l=>n.compile(l,o),o):i===null?`${u}()`:`${u}(${i.map(l=>n.compile(l,o)).join(", ")})`:`((${n.compile(i[0],o)}) ? (${n.compile(i[1],o)}) : (${n.compile(i[2],o)}))`}if(t==="Block")return n.compileBlock(i,o);let a=o.functions?.(t);if(!a)throw new Error(`Unknown operator \`${t}\``);if(typeof a=="function"){let u=e.lookupDefinition(t);if(le(u)&&u.operator.broadcastable&&i.length===1&&ke(i[0])){let l=n.tempVar();return`(${n.compile(i[0],o)}).map((${l}) => ${a([i[0].engine.box(l)],c=>n.compile(c,o),o)})`}return a(i,l=>n.compile(l,o),o)}return i===null?`${a}()`:`${a}(${i.map(u=>n.compile(u,o)).join(", ")})`}static compileBlock(e,t){let i=[];for(let o of e)o.operator==="Declare"&&i.push(o.ops[0].symbol);if(e.length===1&&i.length===0)return n.compile(e[0],t);let r=e.map(o=>n.compile(o,{...t,var:s=>i.includes(s)?s:t.var(s)}));return r[r.length-1]=`return ${r[r.length-1]}`,`(() => {${t.ws(`
`)}${r.join(`;${t.ws(`
`)}`)}${t.ws(`
`)}})()`}static compileLoop(e,t,i){if(t===null)throw new Error("Sum/Product: no arguments");if(!t[0])throw new Error("Sum/Product: no body");let{index:r,lower:o,upper:s,isFinite:a}=Kr(t[1]),u=e==="Sum"?"+":"*";if(!r){let f=n.tempVar(),p=n.tempVar();return`${n.compile(t[0],i)}.reduce((${p}, ${f}) => ${p} ${u} ${f}, ${u==="+"?"0":"1"})`}let l=n.compile(t[0],{...i,var:f=>f===r?r:i.var(f)}),c=n.tempVar();return`(() => {
  let ${c} = ${u==="+"?"0":"1"};
  let ${r} = ${o};
  while (${r} <= ${s}) {
    ${c} ${u}= ${l};
    ${r}++;
  }
  return ${c};
})()`}static tempVar(){return`_${Math.random().toString(36).substring(4)}`}static inlineExpression(e,t){if(/^[\p{L}_][\p{L}\p{N}_]*$/u.test(t)||/^[0-9]+$/.test(t))return new Function("x",`return \`${e}\`;`)(t);{let r=n.tempVar();return new Function("x",`return \`(() => { const ${r} = \${x}; return ${e.replace(/\\\${x}/g,r)}; })()\`;`)(t)}}}});function vg(n,e){let t=!e||n.operator===e?[n]:[];if(n.ops)for(let i of n.ops)t.push(...vg(i,e));return t}function _g(n,e){if(n.symbol){e.add(n.symbol);return}if(n.ops)for(let t of n.ops)_g(t,e)}function Ng(n,e){if(n.symbol){let t=n.symbol;if(t==="Unknown"||t==="Undefined"||t==="Nothing"||n.valueDefinition?.isConstant||n.operatorDefinition)return;n.engine._getSymbolValue(t)===void 0&&e.add(t);return}if(n.ops)for(let t of n.ops)Ng(t,e)}var ue,lt=k(()=>{In();Gu();pm();_m();Aa();Vo();ue=class{engine;verbatimLatex;constructor(e,t){this.engine=e,t?.latex!==void 0&&(this.verbatimLatex=t.latex)}valueOf(){try{return this.symbol==="True"?!0:this.symbol==="False"?!1:this.symbol==="NaN"?NaN:this.symbol==="PositiveInfinity"?1/0:this.symbol==="NegativeInfinity"?-1/0:this.symbol==="ComplexInfinity"?"~oo":this.isInfinity?this.isPositive?1/0:this.isNegative?-1/0:"~oo":typeof this.string=="string"?this.string:typeof this.symbol=="string"?this.value?.valueOf()??this.symbol:Fo(this)}catch(e){if(e instanceof On){let t=e.message??"<canceled>";return e.cause?`${t}: ${e.cause}`:`${t}`}return e.message?e.message:"<error>"}}[Symbol.toPrimitive](e){if(e==="number"){let t=this.valueOf();return typeof t=="number"?t:null}return this.toString()}toString(){try{if(this.isLazyCollection){let e=this.evaluate({materialization:!0});if(!e.isLazyCollection)return Fo(e)}return Fo(this)}catch(e){if(e instanceof On){let t=e.message??"<canceled>";return e.cause?`${t}: ${e.cause}`:`${t}`}return e.message?e.message:"<error>"}}toLatex(e){if(this.isLazyCollection){let r=this.evaluate({materialization:e?.materialization??!0});if(!r.isLazyCollection)return r.toLatex(e)}let t=this.toMathJson({prettify:e?.prettify??!0}),i={imaginaryUnit:"\\imaginaryI",positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalSeparator:this.engine.decimalSeparator,digitGroupSeparator:"\\,",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",digitGroup:3,truncationMarker:"\\ldots",repeatingDecimal:"vinculum",fractionalDigits:"max",notation:"auto",avoidExponentsInRange:[-7,20],prettify:!0,materialization:!1,invisibleMultiply:"",invisiblePlus:"",multiply:"\\times",missingSymbol:"\\blacksquare",applyFunctionStyle:xd,groupStyle:yd,rootStyle:bd,fractionStyle:Ed,logicStyle:vd,powerStyle:_d,numericSetStyle:Nd};return e?.fractionalDigits==="auto"?i.fractionalDigits=-this.engine.precision:i.fractionalDigits=e?.fractionalDigits??"max",typeof i.fractionalDigits=="number"&&i.fractionalDigits>this.engine.precision&&(i.fractionalDigits=this.engine.precision),i={...i,...e??{},fractionalDigits:i.fractionalDigits},!i.prettify&&this.verbatimLatex?this.verbatimLatex:fm(t,this.engine._indexedLatexDictionary,i)}get latex(){return this.toLatex()}toJSON(){return this.json}toMathJson(e){let t={exclude:[],shorthands:["function","symbol","string","number","dictionary"],metadata:[],fractionalDigits:"max",repeatingDecimal:!0,prettify:!0};e&&((typeof e.shorthands=="string"&&e.shorthands==="all"||e.shorthands?.includes("all"))&&(t.shorthands=["function","symbol","string","number","dictionary"]),Array.isArray(e.shorthands)&&(t.shorthands=e.shorthands),(typeof e.metadata=="string"&&e.metadata==="all"||e.metadata?.includes("all"))&&(t.metadata=["latex","wikidata"]),e.fractionalDigits==="auto"&&(t.fractionalDigits=-this.engine.precision),typeof e.fractionalDigits=="number"&&(t.fractionalDigits=e.fractionalDigits));let i={...t,...e,fractionalDigits:t.fractionalDigits,shorthands:t.shorthands,metadata:t.metadata},{serializeJson:r}=(Dl(),it(Jm));return r(this.engine,this,i)}print(){let e=console.info;e?.(this.toString())}get isStructural(){return!0}get canonical(){return this}get structural(){return this}get isValid(){return!0}get isPure(){return!1}get isConstant(){return!0}get isNumberLiteral(){return!1}get numericValue(){return null}toNumericValue(){return[this.engine._numericValue(1),this]}get isEven(){}get isOdd(){}get re(){return NaN}get im(){return NaN}get bignumRe(){}get bignumIm(){}get sgn(){}get isPositive(){}get isNonNegative(){}get isNegative(){}get isNonPositive(){}neg(){return this.engine.NaN}inv(){return this.engine.NaN}abs(){return this.engine.NaN}add(e){return this.engine.NaN}sub(e){return this.add(e.neg())}mul(e){return this.engine.NaN}div(e){return this.engine.NaN}pow(e){return this.engine.NaN}root(e){return this.engine.NaN}sqrt(){return this.engine.NaN}ln(e){return this.engine.NaN}get numerator(){return this}get denominator(){return this.engine.One}get numeratorDenominator(){return[this,this.engine.One]}is(e){return typeof e=="number"||typeof e=="bigint"||e==null?!1:typeof e=="boolean"?e===!0?this.value?.symbol==="True":e===!1?this.value?.symbol==="False":!1:typeof e=="string"?this.value?.string===e:no(this,this.engine.box(e))}isSame(e){return no(this,e)}isEqual(e){return wa(this,e)}isLess(e){let t=nr(this,e);if(t!==void 0)return t==="<"}isLessEqual(e){let t=nr(this,e);if(t!==void 0)return t==="<="||t==="<"||t==="="}isGreater(e){let t=nr(this,e);if(t!==void 0)return t===">"}isGreaterEqual(e){let t=nr(this,e);if(t!==void 0)return t===">="||t===">"||t==="="}get symbol(){return null}get tensor(){return null}get string(){return null}getSubexpressions(e){return vg(this,e)}get subexpressions(){return this.getSubexpressions("")}get symbols(){let e=new Set;return _g(this,e),Array.from(e).sort()}get unknowns(){let e=new Set;return Ng(this,e),Array.from(e).sort()}get errors(){return this.getSubexpressions("Error")}get isFunctionExpression(){return!1}get ops(){return null}get isScoped(){return!1}get localScope(){}get nops(){return 0}get op1(){return this.engine.Nothing}get op2(){return this.engine.Nothing}get op3(){return this.engine.Nothing}get isNaN(){}get isInfinity(){}get isFinite(){}get shape(){return[]}get rank(){return 0}subs(e,t){return t?.canonical===!0?this.canonical:this}map(e,t){if(!this.ops)return e(this);let i=t?.canonical??this.isCanonical,r=t?.recursive??!0,o=this.ops.map(s=>r?s.map(e,t):e(s));return e(this.engine.function(this.operator,o,{canonical:i}))}solve(e){return null}replace(e){return null}has(e){return!1}get description(){if(this.baseDefinition&&this.baseDefinition.description)return typeof this.baseDefinition.description=="string"?[this.baseDefinition.description]:this.baseDefinition.description}get url(){return this.baseDefinition?.url??void 0}get wikidata(){return this.baseDefinition?.wikidata??void 0}get complexity(){}get baseDefinition(){}get valueDefinition(){}get operatorDefinition(){}infer(e,t){return!1}bind(){}reset(){}get value(){}set value(e){throw new Error(`Can't change the value of \\(${this.toString()}\\)`)}get type(){return R.unknown}set type(e){throw new Error(`Can't change the type of \\(${this.toString()}\\)`)}get isNumber(){}get isInteger(){}get isRational(){}get isReal(){}simplify(e){return this}trigSimplify(){return this.simplify({strategy:"fu"})}expand(){let{expand:e}=(Ni(),it(wm));return e(this)??this}evaluate(e){return this.simplify()}evaluateAsync(e){return Promise.resolve(this.evaluate())}N(){return this.evaluate({numericApproximation:!0})}compile(e){try{let t=this,i;if(e?.target){let{BaseCompiler:o}=(Ct(),it(ts)),s=o.compile(t,e.target),a=function(){return s};return Object.defineProperty(a,"toString",{value:()=>s}),Object.defineProperty(a,"isCompiled",{value:!0}),a}let r=e?.to??"javascript";if(i=this.engine._getCompilationTarget(r),!i)throw new Error(`Compilation target "${r}" is not registered. Available targets: ${Array.from(this.engine._compilationTargets.keys()).join(", ")}`);return i.compileToExecutable(t,{operators:e?.operators,functions:e?.functions,vars:e?.vars,imports:e?.imports,preamble:e?.preamble})}catch(t){if(e?.fallback??!0){let{applicableN1:i}=(At(),it(Tg));return i(this)}throw t}}get isCollection(){return!1}get isIndexedCollection(){return!1}get isLazyCollection(){return!1}contains(e){}subsetOf(e,t){}get count(){}get isEmptyCollection(){if(!this.isCollection)return;let e=this.count;if(e!==void 0)return e===0}get isFiniteCollection(){if(!this.isCollection)return;let e=this.count;if(e!==void 0)return Number.isFinite(e)}each(){return(function*(){})()}at(e){}get(e){}indexWhere(e){}}});function Ag(n,e){for(let t of e)if(wg[t](n)!==!0)return!1;return!0}function i0(n){let e=/\\[a-zA-Z]+|[{}]|[\d]+|[+\-*/^_=()><,.;]|[a-zA-Z]/g,t=n.match(e);return t?t.filter(i=>!/^[ \f\n\r\t\v\xA0\u2028\u2029]+$/.test(i)):[]}function r0(n){let e=n.peek,t=null;if(e==="\\mathrm")n.nextToken(),t=n.parseStringGroup();else if(/^[a-z]$/.test(e))for(t=n.nextToken();/^[a-z]$/.test(n.peek);)t+=n.nextToken();else{let i={">0":"positive","\\gt0":"positive","<0":"negative","\\lt0":"negative",">=0":"nonnegative","\\geq0":"nonnegative","<=0":"nonpositive","\\leq0":"nonpositive","!=0":"notzero","\\neq0":"notzero","\\neq1":"notone","!=1":"notone","\\in\\R":"real","\\in\\mathbb{R}":"real","\\in\\C":"complex","\\in\\mathbb{C}":"complex","\\in\\Q":"rational","\\in\\mathbb{Q}":"rational","\\in\\Z^+":"integer,positive","\\in\\Z^-":"intger,negative","\\in\\Z^*":"nonzero","\\in\\R^+":"positive","\\in\\R^-":"negative","\\in\\R^*":"real,nonzero","\\in\\Z":"integer","\\in\\mathbb{Z}":"integer","\\in\\N":"integer,nonnegative","\\in\\mathbb{N}":"integer,nonnegative","\\in\\N^*":"integer,positive","\\in\\N_0":"integer,nonnegative","\\in\\R\\backslash\\Q":"irrational"};for(let r in i)if(n.matchAll(i0(r))){t=i[r];break}}if(!t)return null;if(!Object.keys(wg).includes(t))throw new Error(`Unexpected condition "${t}" in a rule`);return t}function Sg(n){let e=[];do{let t=r0(n);if(!t)break;e.push(t)}while(n.match(","));return e.join(",")}function tc(n){let e=null;if(n.match(":"))e=Sg(n);else if(n.matchAll(["_","<{>"])&&(e=Sg(n),!n.match("<}>")))return null;return e}function Ig(n,e,t){if(e===void 0||typeof e=="function")return;if(typeof e=="string"){let r=n.parse(e,{canonical:t?.canonical??!1});return t?.autoWildcard&&(r=r.map(o=>o.symbol&&o.symbol.length===1?n.symbol("_"+o.symbol):o,{canonical:!1})),r}let i=t?.canonical??(e instanceof ue?e.isCanonical:!1);return n.box(e,{canonical:i})}function o0(n,e,t){let i=m=>({kind:"symbol",latexTrigger:m,parse:(g,h)=>{o[m]||(o[m]=`_${m}`);let x=tc(g);return x!==null&&(s[m]?s[m]+=","+x:s[m]=x),o[m]}}),r=n.latexDictionary,o={},s={};n.latexDictionary=[...r,{kind:"prefix",precedence:100,latexTrigger:"...",parse:(m,g)=>{let h=m.nextToken();if(!"abcfghjklmnopqrstuvwxyz".includes(h))return null;let x="__";if(m.match("?")&&(x="___"),o[h]&&o[h]!==`${x}${h}`)throw new Error(`Duplicate wildcard "${h}"`);o[h]||(o[h]=`${x}${h}`);let y=tc(m);return y===null?`${x}${h}`:(s[h]?s[h]+=","+y:s[h]=y,`${x}${h}`)}},..."abcfghjklmnopqrstuvwxyz".split("").map(i),{kind:"infix",precedence:100,latexTrigger:"->",parse:(m,g,h)=>{let x=m.parseExpression({...h,minPrec:20});if(x===null)return null;let y=null;if(m.match(";")){let _=!1,N=m.index;do{m.skipSpace();let T=m.nextToken();if(o[T]){let B=tc(m);if(B===null||!B){_=!0,m.index=N;break}s[T]?s[T]+=","+B:s[T]=B}}while(!_&&!m.atEnd);y=m.parseExpression(h)}let v=[];for(let _ in s){let N=s[_].split(",");N.length!==0&&(N.length===1?v.push(["Condition",o[_],N[0]]):v.push(["Condition",o[_],["And",...N]]))}let E;return y&&v.length>0?E=["And",y,...v]:y?E=y:v.length===1?E=v[0]:v.length>1&&(E=["And",...v]),E?["Rule",g,x,E]:["Rule",g,x]}}];let a=t?.canonical??!1,u=n.contextStack[0]?.lexicalScope;u&&n.pushScope({parent:u,bindings:new Map});let l=n.parse(e);if(n.latexDictionary=r,!l.isValid||l.operator!=="Rule")throw u&&n.popScope(),new Error(`Invalid rule "${e}"
|   ${Cg(l).toString()}
|   A rule should be of the form:
|   <match> -> <replace>; <condition>`);let[c,f,p]=l.ops;if(a&&(c=c.canonical,f=f.canonical),u&&n.popScope(),!Bg(f,c))throw new Error(`Invalid rule "${e}"
|   The replace expression contains wildcards not present in the match expression`);if(c.isSame(f))throw new Error(`Invalid rule "${e}"
|   The match and replace expressions are the same.
|   This may be because the rule is not necessary due to canonical simplification`);let d;if(p!==void 0){if(!Bg(p,c))throw new Error(`Invalid rule "${e}"
|   The condition expression contains wildcards not present in the match expression`);d=m=>p.subs(m).canonical.evaluate()?.symbol==="True"}return kg(n,{match:c,replace:f,condition:d,id:e},t)}function kg(n,e,t){if(e==null)throw new Error("Expected a rule, not "+e);if(a0(e))return e;if(typeof e=="string")return o0(n,e,t);if(typeof e=="function")return{_tag:"boxed-rule",match:void 0,replace:e,condition:void 0,id:e.toString().replace(/\n/g," ")};let{match:i,replace:r,condition:o,id:s,onMatch:a,onBeforeMatch:u}=e;if(r===void 0)throw new Error(`Invalid rule "${s??JSON.stringify(e,void 0,4)}"
|   A rule must include at least a replace property`);let l;if(typeof o=="string"){let d=vi(o);if(d){let m=n.parse(d,{canonical:t?.canonical??!1});l=(g,h)=>m.subs(g).evaluate()?.symbol==="True"}}else{if(o!==void 0&&typeof o!="function")throw new Error(`Invalid rule ${s??JSON.stringify(e,void 0,4)}
|   condition is not a valid function`);l=o}if(typeof i=="function")throw new Error(`Invalid rule ${s??JSON.stringify(e,void 0,4)}
|   match is not a valid expression.
|   Use a replace function instead to validate and replace the expression`);let c=n.contextStack[0]?.lexicalScope;c?n.pushScope({parent:c,bindings:new Map}):n.pushScope();let f=Ig(n,i,{canonical:!1}),p=Ig(n,r,t);if(n.popScope(),s||(typeof i=="string"?s=i:s=JSON.stringify(i,void 0,4),r&&(s+=" -> ",typeof r=="string"?s+=r:typeof r=="function"?s+=r?.toString().replace(/\n/g," "):s=JSON.stringify(r,void 0,4)),typeof o=="string"?s+=`; ${o}`:typeof o=="function"&&(s+=`; ${o.toString().replace(/\n/g," ")}`)),f&&!f.isValid)throw new Error(`Invalid rule ${s}
|   the match expression is not valid: ${f.toString()}`);if(p&&!p.isValid)throw new Error(`Invalid rule ${s??JSON.stringify(e,void 0,4)}
|   The replace expression is not valid: ${p?.toString()}`);if(!p&&typeof r!="function")throw new Error(`Invalid rule ${s??JSON.stringify(e,void 0,4)}
|   The replace expression could not be parsed`);return{_tag:"boxed-rule",match:f,replace:p??r,condition:l,useVariations:e.useVariations,id:s,onMatch:a,onBeforeMatch:u}}function rs(n,e,t){if(!e)return{rules:[]};if(typeof e=="object"&&"rules"in e)return e;Array.isArray(e)||(e=[e]);let i=[];for(let r of e)try{i.push(kg(n,r,t))}catch(o){throw new Error(`
${o.message}
|   Skipping rule ${JSON.stringify(r,void 0,4)}

`)}return{rules:i}}function ic(n,e,t,i){let r=i?.canonical??(e.isCanonical||e.isStructural),o=!1;if(e.ops&&i?.recursive){let x=e.ops.map(y=>{let v=ic(n,y,{},i);return v?(o=!0,v.value):y});o&&(!r&&i?.canonical===void 0&&x.every(y=>y.isCanonical)&&(r=!0),e=e.engine.function(e.operator,x,{canonical:r}))}let{match:s,replace:a,condition:u,id:l,onMatch:c,onBeforeMatch:f}=n,p=l??"";if(r&&s){let x=is(s),y=s.canonical,v=is(y);if(!x.every(E=>v.includes(E)))return o?{value:e,because:p}:null}let d=n.useVariations??i?.useVariations??!1,m=i?.matchPermutations??!0;f?.(n,e);let g=s?e.match(s,{substitution:t,useVariations:d,recursive:!1,matchPermutations:m}):{};if(g===null)return o?{value:e,because:p}:null;if(typeof u=="function"){let x={...Object.fromEntries(Object.entries(g).map(([y,v])=>[y.slice(1),v])),...g};try{if(!u(x,e.engine))return o?{value:e,because:p}:null}catch(y){return console.error(`
|   Rule "${n.id}"
|   Error while checking condition
|    ${y.message}`),null}}!r&&i?.canonical===void 0&&a instanceof ue&&a.isCanonical&&(r=!0);let h=typeof a=="function"?a(e,g):a.subs(g,{canonical:r});return h?(c?.(n,e,h),s0(h)?r?{...h,value:h.value.canonical}:h:{value:r?h.canonical:h,because:p}):null}function ri(n,e,t){if(!e)throw new Error("replace(): Expected one or more rules");let i=t?.iterationLimit??1,r=0,o=t?.once??!1,s;typeof e=="object"&&"rules"in e?s=e.rules:s=n.engine.rules(Array.isArray(e)?e:[e]).rules;let a=!1,u=[];for(;!a&&r<i;){a=!0;for(let l of s)try{let c=ic(l,n,{},t);if(c!==null&&c.value!==n&&!c.value.isSame(n)){if(o)return[c];if(u.some(f=>f.value.isSame(c.value)))return u;u.push(c),a=!1,n=c.value}}catch(c){return console.error(`
${n.toString()}
${l.id}
${c.message}`),u}r+=1}return u}function tr(n,e,t,i){let r=[];for(let o of e.rules){let s=ic(o,n,t,i);s!==null&&!r.some(a=>a.isSame(s.value))&&r.push(s.value)}return r}function Cg(n){let e=n.symbol;if(e&&e.startsWith("_"))return n.engine.symbol(e.slice(1));if(n.ops){let t=n.ops.map(i=>Cg(i));return n.engine.function(n.operator,t,{canonical:!1})}return n}function is(n){let e=[];return n.symbol&&n.symbol.startsWith("_")&&e.push(n.symbol),n.ops&&n.ops.forEach(t=>e.push(...is(t))),e}function Bg(n,e){let t=is(n),i=is(e);return t.every(r=>i.includes(r))}function s0(n){return n&&typeof n=="object"&&"because"in n&&"value"in n}function a0(n){return n&&typeof n=="object"&&n._tag==="boxed-rule"}var wg,oi=k(()=>{lt();Pn();rc();wg={boolean:n=>n.type.matches("boolean"),string:n=>n.string!==null,number:n=>n.isNumberLiteral,symbol:n=>n.symbol!==null,expression:n=>!0,numeric:n=>{let[e,t]=n.toNumericValue();return t.is(1)},integer:n=>n.isInteger,rational:n=>n.isRational,irrational:n=>n.isRational===!1,real:n=>n.isReal,notreal:n=>!n.isReal,complex:n=>n.type.matches("complex"),imaginary:n=>n.type.matches("imaginary"),positive:n=>n.isPositive,negative:n=>n.isNegative,nonnegative:n=>n.isNonNegative,nonpositive:n=>n.isNonPositive,even:n=>n.isEven,odd:n=>n.isOdd,prime:n=>ka(n)===!0,composite:n=>ka(n)===!1,notzero:n=>n.is(0)===!1,notone:n=>n.is(1)===!1,finite:n=>n.isFinite,infinite:n=>n.isFinite===!1,constant:n=>n.valueDefinition?.isConstant??!1,variable:n=>!(n.valueDefinition?.isConstant??!0),function:n=>n.operatorDefinition!==void 0,relation:n=>Dn(n.operator),equation:n=>n.operator==="Equal",inequality:n=>st(n.operator),collection:n=>n.isCollection,list:n=>n.operator==="List",set:n=>n.operator==="Set",tuple:n=>n.operator==="Tuple"||n.operator==="Single"||n.operator==="Pair"||n.operator==="Triple",single:n=>n.operator==="Single",pair:n=>n.operator==="Pair",triple:n=>n.operator==="Triple",scalar:n=>n.rank===0,tensor:n=>n.rank>0,vector:n=>n.rank===1,matrix:n=>n.rank===2,unit:n=>n.operator==="Unit",dimension:n=>n.operator==="Dimension",angle:n=>n.operator==="Angle",polynomial:n=>n.unknowns.length===1}});function ee(n){for(let[e,t]of Object.entries(n))if(e!=="x"&&e!=="_x"&&t.has("_x"))return!1;return!0}function u0(n,e){if(n.operator!=="Add")return n;let t=n.ops;if(!t||t.length===0)return n;let i=t.map(s=>s.denominator).filter(s=>!s.is(1));if(i.length===0)return n;let r=[];for(let s of i){let a=!1;for(let u of r){if(s.isSame(u)){a=!0;break}if(s.symbol&&u.symbol&&s.symbol===u.symbol){a=!0;break}}a||r.push(s)}let o=r[0];for(let s=1;s<r.length;s++)o=o.mul(r[s]);return n.mul(o).simplify()}function l0(n,e){if(n.operator!=="Add")return n;let t=n.engine,i=n.ops;if(!i||i.length===0)return n;let r=null,o=-1;for(let f=0;f<i.length;f++){let p=i[f];if(p.operator==="Sqrt"){r=p,o=f;break}if(p.operator==="Multiply"&&p.ops){for(let d of p.ops)if(d.operator==="Sqrt")break}}if(!r||o<0)return n;let s=r.op1;if(!s||!s.has(e))return n;let a=i.filter((f,p)=>p!==o);if(a.length===0)return n;let u;if(a.length===1?u=a[0].neg():u=t.function("Add",a).neg(),u.has("Sqrt"))return n;let l=u.mul(u);return s.sub(l).simplify()}function c0(n,e){if(n.operator!=="Add")return null;let t=n.engine,i=n.ops;if(!i||i.length<2)return null;let r=[];for(let p=0;p<i.length;p++){let d=i[p];if(d.operator==="Sqrt"&&d.op1){r.push({term:d,arg:d.op1,index:p});continue}if(d.operator==="Negate"&&d.op1?.operator==="Sqrt"&&d.op1.op1){r.push({term:d,arg:d.op1.op1,index:p});continue}if(d.operator==="Multiply"&&d.ops){for(let m of d.ops)if(m.operator==="Sqrt"&&m.op1){r.push({term:d,arg:m.op1,index:p});break}}}if(r.length!==2||!r[0].arg.has(e)||!r[1].arg.has(e))return null;let o=new Set(r.map(p=>p.index)),s=i.filter((p,d)=>!o.has(d)),a;if(s.length===0||(s.length===1?a=s[0].neg():a=t.function("Add",s).neg(),a.has(e)))return null;let u=r[0].arg,l=r[1].arg,c=1,f=1;if(r[0].term.operator==="Negate"&&(c=-1),r[0].term.operator==="Multiply"){let p=r[0].term.ops?.find(m=>m.operator!=="Sqrt");p?.isNegative&&(c=-1);let d=p?.abs().N().numericValue;if(d!==1&&d!==null)return null}if(r[1].term.operator==="Negate"&&(f=-1),r[1].term.operator==="Multiply"){let p=r[1].term.ops?.find(m=>m.operator!=="Sqrt");p?.isNegative&&(f=-1);let d=p?.abs().N().numericValue;if(d!==1&&d!==null)return null}return c!==1?f===1?Rg(t,l,u,a,c,e):null:Rg(t,u,l,a,f,e)}function Rg(n,e,t,i,r,o){let s=i.mul(i),a=e.sub(s).sub(t).simplify(),l=n.number(4).mul(s).mul(t).simplify(),f=a.mul(a).simplify().sub(l).simplify(),p=Kn(f,o);if(p.length===0)return null;let d=[];for(let m of p){let g=e.subs({[o]:m}).N(),h=t.subs({[o]:m}).N();if(g.isNegative||h.isNegative)continue;let x=g.sqrt(),y=h.sqrt(),v=r===1?x.add(y):x.sub(y),E=i.N(),N=v.sub(E).abs().N().numericValue,T=0;typeof N=="number"?T=N:N&&typeof N=="object"&&"decimal"in N&&(T=N.decimal?.toNumber?.()??0),T<1e-9&&d.push(m)}return d.length>0?d:null}function f0(n,e){if(n.operator!=="Add")return null;let t=n.engine,i=n.ops;if(!i||i.length===0)return null;let r=null,o=-1;for(let v=0;v<i.length;v++)if(i[v].operator==="Sqrt"){r=i[v],o=v;break}if(!r||o<0)return null;let s=r.op1;if(!s)return null;let a=!1,u=null;if(s.operator==="Add"&&s.ops)for(let v of s.ops){if(v.operator==="Sqrt"&&v.op1?.symbol===e){a=!0,u=t.One;break}if(v.operator==="Negate"&&v.op1?.operator==="Sqrt"&&v.op1?.op1?.symbol===e){a=!0,u=t.NegativeOne;break}if(v.operator==="Multiply"&&v.ops){for(let E of v.ops)if(E.operator==="Sqrt"&&E.op1?.symbol===e){a=!0;let _=v.ops.filter(N=>N!==E);u=_.length===1?_[0]:t.function("Multiply",_);break}if(a)break}}if(!a)return null;let l=i.filter((v,E)=>E!==o);if(l.length===0)return null;let c;if(l.length===1?c=l[0].neg():c=t.function("Add",l).neg(),c.has(e))return null;let f="__internalU",p=t.symbol(f),m=s.replace({match:["Sqrt",e],replace:p},{recursive:!0})?.subs({[e]:t.box(["Power",f,2])});if(!m)return null;let g=c.mul(c),h=m.sub(g).simplify();t.pushScope(),t.declare(f,{type:"real"});let x=Kn(h,f);if(t.popScope(),x.length===0)return null;let y=[];for(let v of x){let E=v.N();if(E.isNegative)continue;let _=E.numericValue;if(_!==null){let T=null;if(typeof _=="number")T=_;else if(typeof _=="object"&&"decimal"in _){let B=_.decimal;B&&typeof B.toNumber=="function"&&(T=B.toNumber())}else typeof _=="object"&&"re"in _&&(T=_.re);if(T!==null&&T<-1e-10)continue}let N=v.mul(v).simplify();y.push(N)}return y.length>0?y:null}function Kn(n,e){let t=n.engine;n.operator==="Equal"?n=n.op1.expand().sub(n.op2.expand()).simplify():n=n.expand().simplify();let i=n;n=u0(n);let r=c0(n,e);if(r!==null)return r;let o=f0(n,e);if(o!==null)return Dg(i,e,o);n=l0(n,e);let s=t.getRuleSet("solve-univariate"),a=[n.subs({[e]:"_x"},{canonical:!1})];t.pushScope(),t.declare("_x","number");let u=a.flatMap(l=>tr(l,s,{_x:t.symbol("_x")},{useVariations:!0,canonical:!0}));return u.length===0&&(a=a.flatMap(l=>Mg(l)),u=a.flatMap(l=>tr(l,s,{_x:t.symbol(e)},{useVariations:!0,canonical:!0}))),u.length===0&&(a=a.flatMap(l=>Ln(l.canonical)).filter(l=>l!==null),a=a.flatMap(l=>Mg(l)),u=a.flatMap(l=>tr(l,s,{_x:t.symbol(e)},{useVariations:!0,canonical:!0}))),t.popScope(),Dg(i,e,u.map(l=>l.evaluate().simplify()))}function Mg(n){let e=n.engine,t=e.getRuleSet("harmonization");return tr(n,t,{_x:e.symbol("_x")})}function Dg(n,e,t){let i=t.filter(o=>{let s=n.subs({[e]:o}).canonical.evaluate();return s===null||!s.isValid||s.isNaN||s.has(e)?!1:s.isEqual(0)}),r=[];for(let o of i)r.some(a=>a.isSame(o)||a.isEqual(o))||r.push(o);return r}var Pg,Og,to=k(()=>{Pn();oi();Ni();Pg=[{match:["Multiply","_x","__a"],replace:0,id:"ax",condition:ee},{match:["Add",["Divide","_a","_x"],"__b"],replace:1/0,useVariations:!0,condition:ee},{match:["Add",["Multiply","_x","__a"],"__b"],replace:["Divide",["Negate","__b"],"__a"],useVariations:!0,condition:ee},{match:["Add",["Negate",["Multiply","_x","__a"]],"__b"],replace:["Divide","__b","__a"],useVariations:!0,condition:ee},{match:["Add",["Multiply","_a",["Power","_x","_n"]],"__b"],replace:["Power",["Divide",["Negate","__b"],"_a"],["Divide",1,"_n"]],useVariations:!0,condition:n=>ee(n)&&!n._n.is(0)},{match:["Add",["Multiply","_a",["Power","_x","_n"]],"__b"],replace:["Negate",["Power",["Divide",["Negate","__b"],"_a"],["Divide",1,"_n"]]],useVariations:!0,condition:n=>ee(n)&&!n._n.is(0)&&(n._n.isEven??!1)},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"]],replace:0,useVariations:!0,condition:ee},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"]],replace:["Divide",["Negate","__b"],"__a"],useVariations:!0,condition:ee},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"],"__c"],replace:["Divide",["Add",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","__c"]]]],["Multiply",2,"__a"]],useVariations:!0,condition:ee},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"],"__c"],replace:["Divide",["Subtract",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","__c"]]]],["Multiply",2,"__a"]],useVariations:!0,condition:ee},{id:"a^x + b = 0",match:["Add",["Power","_a","_x"],"__b"],replace:["Ln",["Negate","__b"],"_a"],useVariations:!0,onBeforeMatch:()=>{},condition:n=>ee(n)&&(n._a.isPositive??!1)&&(n.__b.isNegative??!1)},{match:["Add",["Multiply","__a",["Exp",["Multiply","__b","_x"]]],"__c"],replace:["Divide",["Ln",["Negate",["Divide","__c","__a"]]],"__b"],useVariations:!0,condition:n=>ee(n)&&((!n.__a.is(0)&&n.__c.div(n.__a).isNegative)??!1)},{match:["Add",["Multiply","__a",["Exp","_x"]],"__c"],replace:["Ln",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:n=>ee(n)&&((!n.__a.is(0)&&n.__c.div(n.__a).isNegative)??!1)&&!n.__a.has("_x")&&!n.__c.has("_x")},{match:["Add",["Exp","_x"],"__c"],replace:["Ln",["Negate","__c"]],useVariations:!0,condition:n=>ee(n)&&(n.__c.isNegative??!1)},{match:["Add",["Exp",["Multiply","__b","_x"]],"__c"],replace:["Divide",["Ln",["Negate","__c"]],"__b"],useVariations:!0,condition:n=>ee(n)&&(n.__c.isNegative??!1)},{match:["Add",["Multiply","__a",["Log","_x","__b"]],"__c"],replace:["Power","__b",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:n=>(ee(n)&&!n.__a.is(0)&&n.__b.isPositive)??!1},{match:["Multiply","__a",["Log","_x","__b"]],replace:["Power","__b",["Negate",["Divide","__c","__a"]]],useVariations:!0,condition:n=>(ee(n)&&!n.__a.is(0)&&n.__b.isPositive)??!1},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Divide",["Subtract","__b","__c"],"__a"],condition:ee},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Divide",["Negate",["Add","__b","__c"],"__a"]],condition:ee},{match:["Add",["Multiply","_x","__a"],["Multiply","__b",["Sqrt","_x"]],"___c"],replace:["Power",["Divide",["Add",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","___c"]]]],["Multiply",2,"__a"]],2],useVariations:!0,condition:ee},{match:["Add",["Multiply","_x","__a"],["Multiply","__b",["Sqrt","_x"]],"___c"],replace:["Power",["Divide",["Subtract",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","___c"]]]],["Multiply",2,"__a"]],2],useVariations:!0,condition:ee},{match:["Add",["Multiply","_x","__a"],["Negate",["Multiply","__b",["Sqrt","_x"]]],"___c"],replace:["Power",["Divide",["Add","__b",["Sqrt",["Add",["Square","__b"],["Multiply",4,"__a","___c"]]]],["Multiply",2,"__a"]],2],useVariations:!0,condition:ee},{match:["Add",["Multiply","_x","__a"],["Negate",["Multiply","__b",["Sqrt","_x"]]],"___c"],replace:["Power",["Divide",["Subtract","__b",["Sqrt",["Add",["Square","__b"],["Multiply",4,"__a","___c"]]]],["Multiply",2,"__a"]],2],useVariations:!0,condition:ee},{match:["Add",["Multiply","__a",["Sqrt","_x"]],"__b"],replace:["Square",["Divide",["Negate","__b"],"__a"]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let e=n.__a,t=n.__b;return!e||!t?!1:t.div(e).isNonPositive??!0}},{match:["Add",["Multiply","__a",["Ln","_x"]],"__b"],replace:["Exp",["Divide",["Negate","__b"],"__a"]],useVariations:!0,condition:ee},{match:["Add",["Ln","_x"],"__b"],replace:["Exp",["Negate","__b"]],useVariations:!0,condition:ee},{match:["Add",["Multiply","__a",["Sin","_x"]],"__b"],replace:["Arcsin",["Divide",["Negate","__b"],"__a"]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let e=n.__a,t=n.__b;if(!e||e.is(0))return!1;let r=t.div(e).neg().numericValue;return r===null?!0:typeof r=="number"?Math.abs(r)<=1:!0}},{match:["Add",["Multiply","__a",["Sin","_x"]],"__b"],replace:["Subtract","Pi",["Arcsin",["Divide",["Negate","__b"],"__a"]]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let e=n.__a,t=n.__b;if(!e||e.is(0))return!1;let r=t.div(e).neg().numericValue;return r===null?!0:typeof r=="number"?Math.abs(r)<=1:!0}},{match:["Add",["Sin","_x"],"__b"],replace:["Arcsin",["Negate","__b"]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let t=n.__b.numericValue;return t===null?!0:typeof t=="number"?Math.abs(t)<=1:!0}},{match:["Add",["Sin","_x"],"__b"],replace:["Subtract","Pi",["Arcsin",["Negate","__b"]]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let t=n.__b.numericValue;return t===null?!0:typeof t=="number"?Math.abs(t)<=1:!0}},{match:["Add",["Multiply","__a",["Cos","_x"]],"__b"],replace:["Arccos",["Divide",["Negate","__b"],"__a"]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let e=n.__a,t=n.__b;if(!e||e.is(0))return!1;let r=t.div(e).neg().numericValue;return r===null?!0:typeof r=="number"?Math.abs(r)<=1:!0}},{match:["Add",["Multiply","__a",["Cos","_x"]],"__b"],replace:["Negate",["Arccos",["Divide",["Negate","__b"],"__a"]]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let e=n.__a,t=n.__b;if(!e||e.is(0))return!1;let r=t.div(e).neg().numericValue;return r===null?!0:typeof r=="number"?Math.abs(r)<=1:!0}},{match:["Add",["Cos","_x"],"__b"],replace:["Arccos",["Negate","__b"]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let t=n.__b.numericValue;return t===null?!0:typeof t=="number"?Math.abs(t)<=1:!0}},{match:["Add",["Cos","_x"],"__b"],replace:["Negate",["Arccos",["Negate","__b"]]],useVariations:!0,condition:n=>{if(!ee(n))return!1;let t=n.__b.numericValue;return t===null?!0:typeof t=="number"?Math.abs(t)<=1:!0}},{match:["Add",["Multiply","__a",["Tan","_x"]],"__b"],replace:["Arctan",["Divide",["Negate","__b"],"__a"]],useVariations:!0,condition:n=>ee(n)?!n.__a.is(0):!1},{match:["Add",["Tan","_x"],"__b"],replace:["Arctan",["Negate","__b"]],useVariations:!0,condition:ee},{match:["Add",["Multiply","__a",["Cot","_x"]],"__b"],replace:["Arccot",["Divide",["Negate","__b"],"__a"]],useVariations:!0,condition:n=>ee(n)?!n.__a.is(0):!1},{match:["Add",["Cot","_x"],"__b"],replace:["Arccot",["Negate","__b"]],useVariations:!0,condition:ee}];Og=[{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Add",["Multiply","__a","_x"],"__b","__c"]},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Add",["Negate",["Multiply","__a","_x"]],["Negate","__b"],"__c"]},{match:["Multiply","__a",["Power","_b","_n"]],replace:"_b",condition:({__a:n,_b:e,_n:t})=>!n.has("_x")&&e.has("_x")&&!t.is(0)&&!t.has("_x")},{match:["Multiply","__a",["Sqrt","_b"]],replace:["Multiply",["Square","_a"],"__b"],condition:({_b:n})=>n.has("_x")},{match:["Divide","_a","_b"],replace:"_a",condition:({_a:n,_b:e})=>n.has("_x")&&!e.is(0)},{match:["Multiply","__a","_b"],replace:"_b",condition:({__a:n,_b:e})=>!n.has("_x")&&e.has("_x")},{match:["Add",["Ln","_a"],["Ln","_b"],"__c"],replace:["Add",["Ln",["Multiply","_a","_b"]],"__c"]},{match:["Multiply",["Exp","__a"],["Exp","__b"],"__c"],replace:["Multiply",["Exp",["Add","_a","_b"]],"__c"]},{match:["Ln","_a"],replace:["Subtract","_a",1],condition:({_a:n})=>n.has("_x")},{match:["Sin","_a"],replace:"_a",condition:({_a:n})=>n.has("_x")},{match:["Cos","_a"],replace:["Subtract","_a",["Divide","Pi",2]],condition:({_a:n})=>n.has("_x")},{match:["Tan","_a"],replace:"_a",condition:({_a:n})=>n.has("_x")},{match:["Add",["Sin","_a"],["Cos","_a"]],replace:1,condition:({_a:n})=>n.has("_x")},{match:["Subtract",["Square",["Sin","_a"]],["Square",["Cos","_a"]]],replace:["PlusMinus",["Sin","_a"],["Divide",["Sqrt",2],2]],condition:({_a:n})=>n.has("_x")}]});var Ra={};yr(Ra,{assume:()=>oc,getInequalityBoundsFromAssumptions:()=>os,getSignFromAssumptions:()=>sc});function Lg(n,e){return e.type.matches("integer")?n.type("integer"):e.type.matches("rational")||e.type.matches("real")?n.type("real"):e.type.matches("complex")?n.type("number"):e.type}function oc(n){if(n.operator==="Element")return m0(n);if(n.operator==="Equal")return p0(n);if(st(n.operator))return d0(n);throw new Error("Unsupported assumption. Use `Element`, `Equal` or an inequality")}function p0(n){n.operator;let e=n.unknowns;if(e.length===0){let r=n.evaluate();return r.symbol==="True"?"tautology":r.symbol==="False"?"contradiction":(n.canonical.evaluate(),"not-a-predicate")}let t=n.engine,i=n.op1.symbol;if(i&&!h0(t,i)&&!n.op2.has(i)){let r=n.op2.evaluate();if(!r.isValid)return"not-a-predicate";let o=t.lookupDefinition(i);return!o||!re(o)?(t.declare(i,{value:r}),"ok"):o.value.type&&!r.type.matches(o.value.type)&&!o.value.inferredType?"contradiction":(t._setCurrentContextValue(i,r),o.value.inferredType&&(o.value.type=Lg(t,r)),"ok")}if(e.length===1){let r=e[0],o=Kn(n,r);o.length===0&&t.context.assumptions.set(t.function("Equal",[n.op1.sub(n.op2),0]),!0);let s=o.length===1?o[0]:t.function("List",o),a=t.lookupDefinition(r);return!a||!re(a)?(t.declare(r,{value:s}),"ok"):a.value.type&&!o.every(u=>!u.type||s.type.matches(u.type))?"contradiction":(t._setCurrentContextValue(r,s),a.value.inferredType&&(a.value.type=Lg(t,s)),"ok")}return t.context.assumptions.set(n,!0),"ok"}function d0(n){let e=n.engine,t="",i,r;if(n.operator==="Less"?(i=n.op1,r=n.op2,t="<"):n.operator==="LessEqual"?(i=n.op1,r=n.op2,t="<="):n.operator==="Greater"?(i=n.op2,r=n.op1,t="<"):n.operator==="GreaterEqual"&&(i=n.op2,r=n.op1,t="<="),!t)return"internal-error";let o=i.sub(r),s=e.box([t==="<"?"Less":"LessEqual",o,0]).evaluate();if(s.symbol==="True")return"tautology";if(s.symbol==="False")return"contradiction";let a=s.unknowns;if(a.length===0)return"not-a-predicate";if(a.length===1){let u=a[0],l=os(e,u),c=n.operator,f=n.op1.symbol===u,p=f?n.op2:n.op1;if(p.numericValue!==null){let d=p.numericValue;if(typeof d=="number"&&isFinite(d)){let m;if(c==="Greater"?m=f?"greater":"less":c==="GreaterEqual"?m=f?"greaterEqual":"lessEqual":c==="Less"?m=f?"less":"greater":m=f?"lessEqual":"greaterEqual",m==="greater"||m==="greaterEqual"){let g=m==="greater";if(l.lowerBound!==void 0){let h=l.lowerBound.numericValue;if(typeof h=="number"&&isFinite(h)){if(g){if(h>d||l.lowerStrict&&h>=d)return"tautology"}else if(h>d||l.lowerStrict&&h>=d||!l.lowerStrict&&h>=d)return"tautology"}}if(l.upperBound!==void 0){let h=l.upperBound.numericValue;if(typeof h=="number"&&isFinite(h)){if(g){if(h<d||l.upperStrict&&h<=d||!l.upperStrict&&h<=d)return"contradiction"}else if(h<d||l.upperStrict&&h<=d)return"contradiction"}}}else{let g=m==="less";if(l.upperBound!==void 0){let h=l.upperBound.numericValue;if(typeof h=="number"&&isFinite(h)){if(g){if(h<d||l.upperStrict&&h<=d)return"tautology"}else if(h<d||h<=d)return"tautology"}}if(l.lowerBound!==void 0){let h=l.lowerBound.numericValue;if(typeof h=="number"&&isFinite(h)){if(g){if(h>d||l.lowerStrict&&h>=d||!l.lowerStrict&&h>=d)return"contradiction"}else if(h>d||l.lowerStrict&&h>d)return"contradiction"}}}}}}if(a.length===1){let u=a[0],l=e.lookupDefinition(u);l?re(l)&&l.value.inferredType&&(l.value.type=e.type("real")):e.declare(u,{type:"real"})}return s.operator==="Less"||s.operator,e.context.assumptions.set(s,!0),"ok"}function m0(n){n.operator;let e=n.engine,t=g0(n.op1);if(t.length===1){let r=n.op2.evaluate();if(!r.isValid)return"not-a-predicate";let o=Ca(r);if(o==="unknown")throw new Error(`Invalid domain "${r.toString()}"`);return e.declare(t[0],o),"ok"}if(n.op1.symbol&&qg(e,n.op1.symbol)){let r=n.op2.evaluate();if(!r.isValid)return"not-a-predicate";let o=Ca(r);e.context?.lexicalScope?.bindings.has(n.op1.symbol)||e.declare(n.op1.symbol,Ca(r));let s=e.lookupDefinition(n.op1.symbol);return re(s)?s.value.type&&!w(o,s.value.type.type)?"contradiction":(s.value.type=new R(o,e._typeResolver),"ok"):le(s)?w(o,Mn(s.operator.signature.type))?"ok":"contradiction":"not-a-predicate"}if(t.length>0)return e.context.assumptions.set(n,!0),"ok";let i=n.evaluate();return i.symbol==="True"?"tautology":i.symbol==="False"?"contradiction":"not-a-predicate"}function qg(n,e){return n.lookupDefinition(e)!==void 0}function g0(n){return n.symbols.filter(e=>!qg(n.engine,e))}function h0(n,e){let t=n.lookupDefinition(e);return t?!!(re(t)&&t.value.isConstant||n._getSymbolValue(e)!==void 0):!1}function sc(n,e){let t=n.context?.assumptions;if(t)for(let[i,r]of t.entries()){let o=i.operator;if(!o||o!=="Less"&&o!=="LessEqual")continue;let s=i.ops;if(!s||s.length!==2)continue;let[a,u]=s;if(u.is(0)){if(a.symbol===e){if(o==="Less")return"negative";if(o==="LessEqual")return"non-positive"}if(a.operator==="Negate"&&a.op1?.symbol===e){if(o==="Less")return"positive";if(o==="LessEqual")return"non-negative"}if(a.operator==="Subtract"){let[l,c]=a.ops??[];if(l&&c){if(c.symbol===e&&l.isNonNegative===!0&&o==="Less")return"positive";if(l.symbol===e&&c.isNonPositive===!0&&o==="Less")return"negative"}}if(a.operator==="Add"&&a.ops)for(let l of a.ops){if(l.symbol===e){let c=a.ops.filter(f=>f!==l);if(c.length>0&&c.every(f=>f.isNonNegative===!0)){if(o==="Less")return"negative";if(o==="LessEqual")return"non-positive"}}if(l.operator==="Negate"&&l.op1?.symbol===e){let c=a.ops.filter(f=>f!==l);if(c.length>0&&c.every(f=>f.isNonPositive===!0)){if(o==="Less")return"positive";if(o==="LessEqual")return"non-negative"}}}}}}function os(n,e){let t={},i=n.context?.assumptions;if(!i)return t;for(let[r,o]of i.entries()){let s=r.operator;if(!s||s!=="Less"&&s!=="LessEqual")continue;let a=r.ops;if(!a||a.length!==2)continue;let[u,l]=a;if(!l.is(0))continue;let c=s==="Less";if(u.operator==="Negate"&&u.op1?.symbol===e){let f=n.Zero;(t.lowerBound===void 0||f.isGreater(t.lowerBound)===!0)&&(t.lowerBound=f,t.lowerStrict=c)}if(u.operator==="Add"&&u.ops){let f=!1,p=0;for(let d of u.ops)if(d.operator==="Negate"&&d.op1?.symbol===e)f=!0;else if(d.isNumberLiteral){let m=typeof d.numericValue=="number"?d.numericValue:d.numericValue?.re;m!==void 0&&Number.isFinite(m)&&(p+=m)}if(f&&p!==0){let d=n.box(p);(t.lowerBound===void 0||d.isGreater(t.lowerBound)===!0)&&(t.lowerBound=d,t.lowerStrict=c)}}if(u.symbol===e){let f=n.Zero;(t.upperBound===void 0||f.isLess(t.upperBound)===!0)&&(t.upperBound=f,t.upperStrict=c)}if(u.operator==="Add"&&u.ops){let f=!1,p=0;for(let d of u.ops)if(d.symbol===e)f=!0;else if(d.isNumberLiteral){let m=typeof d.numericValue=="number"?d.numericValue:d.numericValue?.re;m!==void 0&&Number.isFinite(m)&&(p+=m)}if(f&&p!==0){let d=n.box(-p);(t.upperBound===void 0||d.isLess(t.upperBound)===!0)&&(t.upperBound=d,t.upperStrict=c)}}}return t}var io=k(()=>{Nn();an();In();to();me();Pn()});function no(n,e){if(n===e)return!0;if(n.ops)return n.operator!==e.operator||n.nops!==e.nops?!1:n.ops.every((t,i)=>no(t,e.ops[i]));if(n.isNumberLiteral){if(!e.isNumberLiteral)return!1;let t=n.numericValue,i=e.numericValue;return t===i?!0:typeof t=="number"?typeof i=="number"?t===i:i.eq(t):t.eq(i)}if(n.string||e.string)return n.string===e.string;if(n.symbol||e.symbol)return n.symbol===e.symbol;if(n.rank!==0){if(n.rank!==e.rank)return!1;for(let t=0;t<n.rank;t++)if(n.shape[t]!==e.shape[t])return!1;return n.tensor.equals(e.tensor)}return!1}function wa(n,e){if(n.operatorDefinition?.eq){let r=n.operatorDefinition.eq(n,n.engine.box(e));if(r!==void 0)return r}if(typeof e!="number"&&e.operatorDefinition?.eq){let r=e.operatorDefinition.eq(e,n);if(r!==void 0)return r}n=n.N();let t=typeof e!="number"?e.N():n.engine.box(e);if(n.ops||t.ops){let r=n.operatorDefinition?.eq?.(n,t);return r!==void 0||(r=t.operatorDefinition?.eq?.(t,n),r!==void 0)?r:n.isSame(t)?!0:n.unknowns.length===0&&t.unknowns.length===0?n.isFinite&&t.isFinite?Fg(n.sub(t).simplify().N()):n.isNaN||t.isNaN?!1:!!(n.isInfinity&&t.isInfinity&&n.sgn===t.sgn):(n=n.expand().simplify(),t=t.expand().simplify(),x0(n,t)?no(n,t):void 0)}if(n.symbol){let r=n.valueDefinition?.eq?.(t);if(r!==void 0)return r}if(t.symbol){let r=t.valueDefinition?.eq?.(n);if(r!==void 0)return r}if(n.symbol&&t.symbol)return n.symbol===t.symbol;let i=n.engine;if(n.isNumberLiteral&&t.isNumberLiteral)return n.isFinite&&t.isFinite?Fg(n.sub(t)):n.isNaN||t.isNaN?!1:!!(n.isInfinity&&t.isInfinity&&n.sgn===t.sgn);if(i.ask(i.box(["Equal",n,t])).length>0)return!0;if(i.ask(i.box(["NotEqual",n,t])).length>0)return!1;if(!(n.unknowns.length>0||t.unknowns.length>0))return no(n,t)}function nr(n,e){if(n.isNumberLiteral){if(typeof e!="number"&&typeof e.numericValue=="number"&&(e=e.numericValue),typeof e=="number"){if(e===0){let r=n.sgn;return r===void 0?void 0:r==="zero"?"=":r==="positive"?">":r==="negative"?"<":r==="non-negative"?">=":r==="non-positive"?"<=":void 0}if(n.isNumberLiteral){let r=n.numericValue;return typeof r=="number"?Math.abs(r-e)<=n.engine.tolerance?"=":r<e?"<":">":r.eq(e)?"=":r.lt(e)?"<":">"}return}if(!e.isNumberLiteral){if(e.symbol){let{getInequalityBoundsFromAssumptions:r}=(io(),it(Ra)),o=r(n.engine,e.symbol),s=typeof n.numericValue=="number"?n.numericValue:n.numericValue?.re;if(s!==void 0&&Number.isFinite(s)){if(o.lowerBound!==void 0){let a=typeof o.lowerBound.numericValue=="number"?o.lowerBound.numericValue:o.lowerBound.numericValue?.re;if(a!==void 0&&Number.isFinite(a)){if(a>s||a===s&&o.lowerStrict)return"<";if(a===s&&!o.lowerStrict)return"<="}}if(o.upperBound!==void 0){let a=typeof o.upperBound.numericValue=="number"?o.upperBound.numericValue:o.upperBound.numericValue?.re;if(a!==void 0&&Number.isFinite(a)){if(a<s||a===s&&o.upperStrict)return">";if(a===s&&!o.upperStrict)return">="}}}}return}let t=n.numericValue,i=e.numericValue;return typeof t=="number"?i.eq(t)?"=":i.lt(t)?">":"<":t.eq(i)?"=":t.lt(i)?"<":">"}if(typeof e=="number"){if(n.symbol){let{getInequalityBoundsFromAssumptions:t}=(io(),it(Ra)),i=t(n.engine,n.symbol);if(i.lowerBound!==void 0){let r=typeof i.lowerBound.numericValue=="number"?i.lowerBound.numericValue:i.lowerBound.numericValue?.re;if(r!==void 0&&Number.isFinite(r)){if(r>e||r===e&&i.lowerStrict)return">";if(r===e&&!i.lowerStrict)return">="}}if(i.upperBound!==void 0){let r=typeof i.upperBound.numericValue=="number"?i.upperBound.numericValue:i.upperBound.numericValue?.re;if(r!==void 0&&Number.isFinite(r)){if(r<e||r===e&&i.upperStrict)return"<";if(r===e&&!i.upperStrict)return"<="}}}return}if(n.ops||e.ops){if(n.operatorDefinition?.eq?.(n,e)!==void 0)return"=";let i=n.sub(e).N();if(!i.isNumberLiteral)return;if(typeof i.numericValue=="number")return i.numericValue===0?"=":i.numericValue<0?"<":">";let r=n.engine.tolerance;return i.numericValue.isZeroWithTolerance(r)?"=":i.numericValue.lt(0)?"<":">"}if(n.symbol){if(n.symbol===e.symbol)return"=";let t=n.valueDefinition?.cmp?.(e);if(t)return t;if(n.valueDefinition?.eq?.(e)===!0)return"=";if(e.isNumberLiteral){let{getInequalityBoundsFromAssumptions:r}=(io(),it(Ra)),o=r(n.engine,n.symbol),s=typeof e.numericValue=="number"?e.numericValue:e.numericValue?.re;if(s!==void 0&&Number.isFinite(s)){if(o.lowerBound!==void 0){let a=typeof o.lowerBound.numericValue=="number"?o.lowerBound.numericValue:o.lowerBound.numericValue?.re;if(a!==void 0&&Number.isFinite(a)){if(a>s||a===s&&o.lowerStrict)return">";if(a===s&&!o.lowerStrict)return">="}}if(o.upperBound!==void 0){let a=typeof o.upperBound.numericValue=="number"?o.upperBound.numericValue:o.upperBound.numericValue?.re;if(a!==void 0&&Number.isFinite(a)){if(a<s||a===s&&o.upperStrict)return"<";if(a===s&&!o.upperStrict)return"<="}}}}return}if(n.string)return e.string?n.string===e.string?"=":n.string<e.string?"<":">":void 0;if(n.tensor)return e.tensor&&n.tensor.equals(e.tensor)?"=":void 0}function Fg(n){if(!n.isNumberLiteral)return!1;let e=n.numericValue,t=n.engine;return typeof e=="number"?t.chop(e)===0:e.isZeroWithTolerance(t.tolerance)}function x0(n,e){let t=n.unknowns,i=e.unknowns;if(t.length!==i.length)return!1;for(let r of t)if(!i.includes(r))return!1;return!0}var Aa=k(()=>{});var Tg={};yr(Tg,{applicable:()=>Te,applicableN1:()=>v0,apply:()=>Rt,canonicalFunctionLiteral:()=>Le,canonicalFunctionLiteralArguments:()=>ir,lookup:()=>ss,makeLambdaN1:()=>E0,order:()=>b0,parseFunctionSignature:()=>_0,predicate:()=>y0});function y0(n){return()=>!1}function b0(n){return(e,t)=>{let i=nr(e,t);return i==="="?0:i==="<"||i==="<="?-1:1}}function Le(n){if(n){if(n.operator==="Function"&&n.isCanonical||n.symbol)return n;if(n.operator==="BuiltinFunction")return n.op1;if(n.operator==="Delimiter"){if(n.op1.operator==="Sequence")if(n.op1.nops===1)n=n.op1;else return Le(n.engine._fn("Block",n.op1.ops,{canonical:!1}));return Le(n.op1)}if(n.operator==="Function")return ir(n.engine,n.ops);if(n.operator){n.operator;let e=n.engine,t=n.subs({_:"_1"}),i=1,r=[];for(;i<10;)t.has(`_${i}`)&&r.push(t.engine.symbol(`_${i}`,{canonical:!1})),i++;if(r.length===0){t.operator!=="Block"?t=e.function("Block",[t]):t=t.canonical;let o=t.unknowns;o.length>0&&(r=o.map(s=>e.symbol(s,{canonical:!1})))}return ir(e,[t,...r])}}}function ir(n,e){if(e.length===0)return;let t=e[0].operator==="Block"?e[0].canonical:n.function("Block",[e[0]]),i=e.slice(1).map(r=>r.symbol?r:n.error("expected-a-symbol",r.toString()));t.isScoped;for(let r of i)r.symbol&&!t.localScope.bindings.has(r.symbol)&&n.declare(r.symbol,{inferred:!0,type:"unknown"},t.localScope);return n._fn("Function",[t,...i])}function Rt(n,e){let t=Ma(n)?.(e);return t||n.engine.function("Apply",[n,...e])}function Ma(n){let e=n.engine;if(n.symbol)return o=>e.function(n.symbol,o).evaluate();let t=Le(n);if(!t)throw new Error("Invalid function literal");if(n=t,n.operator,n.isCanonical,n.ops,n.ops.length===1)return n.ops[0],()=>n.ops[0].evaluate();let[i,...r]=n.ops;return i.isScoped,o=>{if(o.length>r.length)throw new Error(`Too many arguments for function "${n.toString()}": expected ${r.length}, got ${o.length}`);if(e.strict&&!o.every(a=>a.isValid))return;if(o.length<r.length){let a=new Set([...i.symbols,...r.map(f=>f.symbol)]),u=r.slice(o.length).map((f,p)=>{let d=`_${p+1}`,m=0;for(;a.has(d);)d=`_${p+1}_${m++}`;return a.add(d),e.symbol(d,{canonical:!1})}),l=Object.fromEntries(r.slice(o.length).map((f,p)=>[f.symbol,u[p]])),c=i.evaluate({withArguments:Object.fromEntries(r.slice(0,o.length).map((f,p)=>[f.symbol,o[p]]))}).subs(l);return e.function("Function",[c,...u])}let s=i.evaluate({withArguments:Object.fromEntries(r.map((a,u)=>[a.symbol,o[u].evaluate()]))});return s.isValid?s:void 0}}function E0(n){let e=Ma(n);if(e)return t=>e([n.engine.number(t)])?.valueOf()??NaN}function Te(n){return Ma(n)??(e=>n.engine.function("Apply",[n,...e]).evaluate())}function v0(n){let e=Ma(n),t=n.engine;return e?i=>e([t.number(i)])?.re??NaN:i=>t.function("Apply",[n,t.number(i)]).evaluate().re}function _0(n){let e=n.match(/(.+)\((.*)\)/);if(!e)return[n,void 0];let t=e[1],i=e[2].split(",").map(r=>r.trim());return[t,i]}function ss(n,e){typeof n=="string"&&n.length>0;let t=e;for(;t;){let i=t.bindings.get(n);if(i)return i;t=t.parent}}var At=k(()=>{Aa()});var N0,rr,ac=k(()=>{In();At();ut();an();Nn();Yt();N0=new Set(["engine","name","description","examples","wikidata","url","lazy","scoped","broadcastable","associative","commutative","commutativeOrder","idempotent","involution","pure","inferredSignature","signature","type","sgn","even","complexity","canonical","evaluate","evaluateAsync","evalDimension","compile","eq","neq","cmp","collection"]),rr=class{engine;name;description;url;wikidata;broadcastable=!1;associative=!1;commutative=!1;commutativeOrder;idempotent=!1;involution=!1;pure=!0;complexity=Ti;lazy=!1;scoped=!1;signature;inferredSignature=!0;type;sgn;eq;neq;even;canonical;evaluate;evaluateAsync;evalDimension;compile;collection;constructor(e,t,i){this.name=t,this.engine=e,i.signature?(this.inferredSignature=!1,this.signature=i.signature instanceof R?i.signature:new R(i.signature,e._typeResolver)):this.signature=new R("(any*) -> unknown"),this.update(i),e.listenToConfigurationChange(this)}toJSON(){let e={name:this.name};return this.wikidata&&(e.wikidata=this.wikidata),this.description&&(e.description=this.description),this.url&&(e.url=this.url),e.broadcastable=this.broadcastable,e.associative=this.associative,e.commutative=this.commutative,e.idempotent=this.idempotent,e.involution=this.involution,e.pure=this.pure,e.lazy=this.lazy,e.complexity=this.complexity,e.scoped=this.scoped,e.signature=this.signature.toString(),e.inferredSignature=this.inferredSignature,this.collection&&(e.collection=this.collection),e}infer(e){let t=new R(e,this.engine._typeResolver);if(!t.matches(this.signature))throw new Error(`Operator Definition "${this.name}": inferred signature "${t}" does not match current signature "${this.signature}"`);this.inferredSignature&&(this.signature=t)}update(e){if(this.engine.strict){for(let o in e)if(!N0.has(o))throw new Error(`Operator Definition "${this.name}": unexpected key "${o}"`)}if("name"in e&&e.name!==this.name)throw new Error(`Operator Definition "${this.name}": cannot change name to "${e.name}"`);if("engine"in e&&e.engine!==this.engine)throw new Error(`Operator Definition "${this.name}": cannot change engine`);this.lazy=e.lazy??this.lazy,this.scoped=e.scoped??this.scoped;let t=e.idempotent??this.idempotent,i=e.involution??this.involution;if(t&&i)throw new Error(`Operator Definition "${this.name}": the 'idempotent' and 'involution' flags are mutually exclusive`);if(this.idempotent=t,this.involution=i,this.description=e.description??this.description,this.collection=e.collection??this.collection,this.url=e.url??this.url,this.wikidata=e.wikidata??this.wikidata,this.broadcastable=e.broadcastable??this.broadcastable,this.associative=e.associative??this.associative,this.commutative=e.commutative??this.commutative,this.commutativeOrder=e.commutativeOrder??this.commutativeOrder,this.commutativeOrder&&!this.commutative)throw new Error(`Operator Definition "${this.name}": the 'commutativeOrder' handler requires the 'commutative' flag`);if(e.canonical&&(e.associative||e.commutative||e.idempotent||e.involution))throw new Error(`Operator Definition "${this.name}": the 'canonical' handler is incompatible with the 'associative', 'commutative', 'idempotent', and 'involution' flags`);if(this.pure=e.pure??this.pure,this.complexity=e.complexity??this.complexity,e.signature){let o=e.signature,s=e.signature instanceof R?e.signature:this.engine.type(e.signature);if(o&&!s.matches(this.engine.type(o)))throw s.matches(this.engine.type(o)),new Error(`Operator Definition "${this.name}": signature "${s}" does not match "${o}"`);this.signature=s,"inferredSignature"in e&&(this.inferredSignature=e.inferredSignature)}if(this.type=e.type??this.type,this.evaluateAsync=e.evaluateAsync??this.evaluateAsync,this.canonical=e.canonical??this.canonical,this.evalDimension=e.evalDimension??this.evalDimension,this.sgn=e.sgn??this.sgn,this.even=e.even??this.even,this.compile=e.xcompile??this.compile,this.eq=e.eq??this.eq,this.neq=e.neq??this.neq,this.scoped=e.scoped??this.scoped,this.lazy=e.lazy??this.lazy,e.collection&&(this.collection=aa(e.collection)),this.collection){let o=Mn(this.signature.type);if(!o)throw new Error(`Operator Definition "${this.name}": a collection handler is defined, but the signature "${this.signature}" does not have a result type`);if(!w(o,"collection"))throw new Error(`Operator Definition "${this.name}": a collection handler is defined, but the signature "${this.signature}" is not a collection type`);if(w(o,"indexed_collection")&&!this.collection.at)throw new Error(`Operator Definition "${this.name}" returns an indexed collection, but the 'at' handler is missing`)}let r;if(e.evaluate&&typeof e.evaluate!="function"){let o=this.scoped?{parent:this.engine.context.lexicalScope,bindings:new Map}:void 0,s=this.engine.box(e.evaluate,{canonical:!1,scope:o});if(!s.isValid)throw Error(`Invalid function ${s.toString()}`);if(this.inferredSignature&&s.operator==="Function"){let u=s.ops[0],l=s.ops.slice(1),c=u.type.toString(),f=l.map(()=>"unknown").join(", ");this.signature=new R(`(${f}) -> ${c}`,this.engine._typeResolver)}let a=Te(s);r=u=>a(u),Object.defineProperty(r,"toString",{value:()=>s.toString()})}else r=e.evaluate??this.evaluate;this.evaluate=r}onConfigurationChange(){}}});function Vg(n,e){if(e!==void 0)return Rr(e)?n.parse(e)??n.symbol("Undefined"):typeof e=="function"?n.box(e(n)??"Undefined"):e instanceof ue?e:n.box(e)}function T0(n,e){return e?e.type.matches("integer")?n.type("integer"):e.type.matches("rational")||e.type.matches("real")?n.type("real"):e.type.matches("complex")?n.type("number"):e.type:n.type("unknown")}var ct,Da=k(()=>{Tn();an();In();Yt();lt();Pn();ct=class{name;wikidata;description;url;_engine;_defValue;_value;_type;inferredType;_isConstant=!1;holdUntil="evaluate";eq;neq;cmp;collection;subscriptEvaluate;constructor(e,t,i){if(this._engine=e,this.name=t,i.wikidata&&(this.wikidata=i.wikidata),i.description&&(this.description=i.description),i.url&&(this.url=i.url),i.holdUntil&&(this.holdUntil=i.holdUntil),i.isConstant&&(this._isConstant=i.isConstant,this._defValue=i.value),i.type){let r=i.type instanceof R?i.type:F(i.type);if(!hi(r))throw new Error([`Symbol "${this.name}"`,`The type "${i.type}" is invalid `].join(`
|   `));this._type=new R(r,e._typeResolver),this.inferredType=i.inferred??!1,e.listenToConfigurationChange(this)}if(this._value=Vg(this._engine,i.value),this._value){if(!this._type||this._type.isUnknown)this.isConstant?(this._type=this._value.type,this.inferredType=!1):(this._type=T0(e,this._value),this.inferredType=!0);else if(!this._value.type.matches(this._type))throw new Error([`Symbol "${this.name}"`,`The value "${this._value.toString()}" of type "${this._value.type}" is not compatible with the type "${this._type}"`].join(`
|   `))}if(i.eq&&(this.eq=i.eq),i.neq&&(this.neq=i.neq),i.cmp&&(this.cmp=i.cmp),i.collection&&(this.collection=aa(i.collection)),i.subscriptEvaluate&&(this.subscriptEvaluate=i.subscriptEvaluate),this.holdUntil==="never"&&!this.isConstant)throw new Error([`Symbol "${this.name}"`,'The "holdUntil" property cannot be "never" for a non-constant symbol'].join(`
|   `))}toJSON(){let e={name:this.name,isConstant:this._isConstant};return this.wikidata&&(e.wikidata=this.wikidata),this.description&&(e.description=this.description),this.url&&(e.url=this.url),this._type&&(e.type=this._type.toString()),e.inferredType=this.inferredType,e.holdUntil=this.holdUntil,this.collection&&(e.collection=this.collection),e}get isConstant(){return this._isConstant}get value(){return this._value===null&&(this._value=Vg(this._engine,this._defValue)),this._value}get type(){return this._type??this._value?.type??R.unknown}set type(e){if(this._isConstant)throw new Error(`The type of the constant "${this.name}" cannot be changed`);this._type=e instanceof R?e:new R(e,this._engine._typeResolver),this._type.isUnknown&&(this._defValue=void 0,this._value=void 0)}onConfigurationChange(){this.isConstant&&(this._value=null)}}});function Pa(n){let e=n.operator;if(["Ln","Log","Log2","Log10","Sin","Cos","Tan","Exp"].includes(e)&&n.op1?.isConstant)return!n.simplify().isRational;if(n.ops){for(let i of n.ops)if(Pa(i))return!0}return!1}function $g(n){return n!=null&&n instanceof ue&&n.type.matches("dictionary")}function ei(n){return n instanceof ue}function Ce(n){return n.precision>Et}function Hn(n){let e=0;for(let t=0;t<n.length;t++)e=Math.imul(31,e)+n.charCodeAt(t)|0;return Math.abs(e)}function as(n){return n==null?[]:typeof n=="string"?[n]:ei(n)?as(n.symbol):typeof n[Symbol.iterator]=="function"?Array.from(n).map(e=>typeof e=="string"?e:e.symbol):[]}function Ca(n){return n.symbol==="Numbers"?"number":n.symbol==="ComplexNumbers"?"complex":n.symbol==="ImaginaryNumbers"?"imaginary":n.symbol==="RealNumbers"?"real":n.symbol==="RationalNumbers"?"rational":n.symbol==="Integers"?"integer":"unknown"}function S0(n){if(!n)return n;let e=n.engine,t=e.angularUnit;return t==="rad"||(t==="deg"&&(n=n.mul(e.Pi).div(180)),t==="grad"&&(n=n.mul(e.Pi).div(200)),t==="turn"&&(n=n.mul(e.Pi).mul(2))),n}function Ea(n){if(!n)return n;let e=S0(n);if(!e)return;if(e.N().im!==0)return e;let t=e.engine,[i,r]=or(e);if(i.isZero)return t.number(r);let o=t._numericValue(i.bignumRe?i.bignumRe.mod(2):i.re%2);return t.number(r.add(t.Pi.mul(o).N().numericValue))}function Qr(n){if(typeof n=="number")return;let e=n.engine;if(n.symbol==="ImaginaryUnit")return e.One;if(n.re===0)return e.number(n.im);if(n.operator==="Negate")return Qr(n.op1)?.neg();if(n.operator==="Complex")return n.op1.is(0)&&!isNaN(n.op2.re)?e.number(n.op2.re):void 0;if(n.operator==="Multiply"&&n.nops===2){let[t,i]=n.ops;if(t.symbol==="ImaginaryUnit")return i;if(i.symbol==="ImaginaryUnit")return t;if(i.isNumberLiteral&&i.re===0&&i.im!==0)return t.mul(i.im);if(t.isNumberLiteral&&t.re===0&&t.im!==0)return i.mul(t.im)}if(n.operator==="Divide"){let t=n.op2;return t.is(0)?void 0:Qr(n.op1)?.div(t)}}function us(n){let{engine:e}=n;return n===e.I?!0:n.isNumberLiteral?n.re===0&&n.im===1:n.symbol!==null?n.canonical.isSame(e.I):!1}function or(n){let e=n.engine;if(n.symbol==="Pi")return[e._numericValue(1),e._numericValue(0)];if(n.operator==="Negate"){let[t,i]=or(n.ops[0]);return[t.neg(),i.neg()]}if(n.operator==="Add"&&n.nops===2){let[t,i]=or(n.op1),[r,o]=or(n.op2);return[t.add(r),i.add(o)]}if(n.operator==="Multiply"&&n.nops===2){if(n.op1.isNumberLiteral){let[t,i]=or(n.op2),r=n.op1.numericValue;return[t.mul(r),i.mul(r)]}if(n.op2.isNumberLiteral){let[t,i]=or(n.op1),r=n.op2.numericValue;return[t.mul(r),i.mul(r)]}}if(n.operator==="Divide"&&n.op2.isNumberLiteral){let[t,i]=or(n.op1),r=n.op2.numericValue;return[t.div(r),i.div(r)]}return[e._numericValue(0),e._numericValue(n.N().numericValue??0)]}function ls(n){if(n==null||typeof n!="object"||ei(n))return!1;if(("signature"in n||"complexity"in n)&&"constant"in n)throw new Error("Operator definition cannot have a `constant` field and value definition cannot have a `signature` field.");if(!("evaluate"in n)&&!("signature"in n)&&!("sgn"in n)&&!("complexity"in n)&&!("canonical"in n))return!1;if("type"in n&&n.type!==void 0&&typeof n.type!="function")throw new Error("The `type` field of an operator definition should be a function");if("sgn"in n&&n.sgn!==void 0&&typeof n.sgn!="function")throw new Error("The `sgn` field of an operator definition should be a function");return!0}function cs(n){if(n==null||typeof n!="object"||ei(n))return!1;if("value"in n||"constant"in n||"inferred"in n||"subscriptEvaluate"in n){if("type"in n&&typeof n.type=="function")return!1;if("signature"in n)throw new Error("Value definition cannot have a `signature` field. Use a `type` field instead.");if("sgn"in n)throw new Error("Value definition cannot have a `sgn` field. Use a `flags.sgn` field instead.");return!0}if("type"in n&&n.type!==void 0&&typeof n.type!="function")return!0;if("description"in n)throw new Error("Definitions should have a `type` or `value` field.");return!1}function re(n){return n!==void 0&&"value"in n}function le(n){return n!==void 0&&"operator"in n}function sr(n,e,t,i){i instanceof ct?(delete t.operator,t.value=i.value):cs(i)?(delete t.operator,t.value=new ct(n,e,i)):i instanceof rr?(delete t.value,t.operator=i):ls(i)&&(delete t.value,t.operator=new rr(n,e,i))}var me=k(()=>{en();ac();Da();lt()});function Vn(n,e,t){if(e=he(e),!n.strict||e.length===t)return e;let i=[...e.slice(0,t)],r=Math.min(t,e.length);for(;r<t;)i.push(n.error("missing")),r+=1;for(;r<e.length;)i.push(n.error("unexpected-argument",e[r].toString())),r+=1;return i}function Rn(n,e,t){let i=typeof t=="number"?t:t?.count,r=typeof t=="number"?void 0:t?.flatten;if(e=he(e,r),!n.strict){let a="real";for(let u of e)if(w("complex",u.type.type)){a="number";break}for(let u of e)ke(u)||u.infer(a);return e}let o=!0;i??=e.length;let s=[];for(let a=0;a<=Math.max(i-1,e.length-1);a++){let u=e[a];if(a>i-1)o=!1,s.push(n.error("unexpected-argument",u.toString()));else if(u===void 0)o=!1,s.push(n.error("missing"));else if(!u.isValid)o=!1,s.push(u);else if(u.isNumber)s.push(u);else if(u.symbol&&!n.lookupDefinition(u.symbol))s.push(u);else if(u.type.isUnknown)s.push(u);else if(Z(u))s.push(u);else if(ke(u)){for(let l of u.each())if(!l.isNumber){o=!1;break}o?s.push(u):s.push(n.typeError("number",u.type,u))}else u.valueDefinition?.inferredType&&w("number",u.type.type)||u.operatorDefinition?.inferredSignature&&w("number",u.type.type)||u.operator==="Hold"||u.valueDefinition?.value?.operator==="Hold"?s.push(u):(o=!1,s.push(n.typeError("number",u.type,u)))}if(o){let a="real";for(let u of s)if(w("complex",u.type.type)){a="number";break}for(let u of s)if(ke(u))for(let l of u.each())l.infer(a);else u.infer(a)}return s}function We(n,e,t){return e==null?n.error("missing"):t===void 0?n.error("unexpected-argument",e.toString()):(e=e.canonical,!e.isValid||e.type.matches(t)?e:n.typeError(t,e.type,e))}function Xo(n,e,t){if(e.length===t.length&&e.every((r,o)=>r.type.matches(t[o])))return e;let i=[];for(let r=0;r<=t.length-1;r++)i.push(We(n,e[r],t[r]));for(let r=t.length;r<=e.length-1;r++)i.push(n.error("unexpected-argument",e[r].toString()));return i}function ro(n,e,t,i,r){if(!n.strict||typeof t=="string"||t.kind!=="signature")return null;let o=[],s=!0,a=t.args?.map(p=>p.type)??[],u=t.optArgs?.map(p=>p.type)??[],l=t.variadicArg?.type,c=t.variadicMin??0,f=0;for(let p of a){let d=e[f++];if(!d){o.push(n.error("missing")),s=!1;continue}if(i){o.push(d);continue}if(!d.isValid){o.push(d),s=!1;continue}if(d.type.isUnknown){o.push(d);continue}if(r&&ke(d)){o.push(d);continue}if(d.valueDefinition?.inferredType&&d.type.matches(p)){o.push(d);continue}if(d.operatorDefinition?.inferredSignature&&d.type.matches(p)){o.push(d);continue}if(!d.type.matches(p)){o.push(n.typeError(p,d.type,d)),s=!1;continue}o.push(d)}for(let p of u){let d=e[f];if(!d)break;if(i){o.push(d),f+=1;continue}if(!d.isValid){o.push(d),s=!1,f+=1;continue}if(d.type.isUnknown){o.push(d),f+=1;continue}if(r&&ke(d)){o.push(d),f+=1;continue}if(d.valueDefinition?.inferredType&&d.type.matches(p)){o.push(d),f+=1;continue}if(!d.type.matches(p)){o.push(n.typeError(p,d.type,d)),s=!1,f+=1;continue}o.push(d),f+=1}if(l){let p=0;for(let d of e.slice(f)){if(f+=1,p+=1,i){o.push(d);continue}if(!d.isValid){o.push(d),s=!1;continue}if(d.type.isUnknown){o.push(d);continue}if(r&&ke(d)){o.push(d);continue}if(d.valueDefinition?.inferredType&&d.type.matches(l)){o.push(d);continue}if(!d.type.matches(l)){o.push(n.typeError(l,d.type,d)),s=!1;continue}o.push(d)}p<c&&(o.push(n.error("missing")),s=!1)}if(f<e.length)for(let p of e.slice(f))o.push(n.error("unexpected-argument",p.toString())),s=!1;if(!s)return o;f=0;for(let p of a)i||(!r||!ke(e[f]))&&e[f].infer(p),f+=1;for(let p of u){if(!e[f])break;(!r||!ke(e[f]))&&e[f]?.infer(p),f+=1}if(l)for(let p of e.slice(f))i||(!r||!ke(p))&&p.infer(l),f+=1;return null}function jg(n){let e={},t=B0(n.engine),i=I0(n.engine);if(n.symbol&&!e[n.symbol]&&!n.symbol.startsWith("_")){if(!t.includes(n.symbol)){let r=Gs(n.symbol,t);r&&(e[n.symbol]=r)}}else if(n.ops&&!e[n.operator]&&!n.operator.startsWith("_")){let r=n.operator;if(!i.includes(r)){let o=Gs(r,i);o&&(e[r]=o)}for(let o of n.ops)e={...e,...jg(o)}}return e}function I0(n){let e=[],t=n.context.lexicalScope;for(;t;){for(let i of t.bindings.keys()){let r=t.bindings.get(i);le(r)&&e.push(i)}t=t.parent}return e}function B0(n){let e=[],t=n.context.lexicalScope;for(;t;){for(let i of t.bindings.keys()){let r=t.bindings.get(i);re(r)&&e.push(i)}t=t.parent}return e}function Xn(n){let e=jg(n);if(Object.keys(e).length===0)return"";if(Object.keys(e).length===1){let[i,r]=Object.entries(e)[0];return`Unknown symbol "${i}". Did you mean "${r}"?`}let t=[];for(let[i,r]of Object.entries(e))t.push(`- "${i}" -> "${r}"?`);return`Unknown symbols found:
${t.join(`
`)}`}var kt=k(()=>{Yt();zn();Nn();Eu();me();Yr()});var Ug=k(()=>{});function oo(n){if(n<0)return NaN;let e=Math.PI,t=n*n*n;return n*Math.log(n)-n-.5*Math.log(n)+.5*Math.log(2*e)+1/(12*n)-1/(360*t)+1/(1260*t*n*n)}function Ci(n){if(n<.5)return Math.PI/(Math.sin(Math.PI*n)*Ci(1-n));if(n>100)return Math.exp(oo(n));n-=1;let e=Gg[0];for(let i=1;i<9;i++)e+=Gg[i]/(n+i);let t=n+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(t,n+.5)*Math.exp(-t)*e}function zg(n){let e=Math.PI,t=e*e,i=t*e,r=n*n,o=n*r,s=o*r,a=s*r;return Math.sqrt(e)/2*(n+e/12*o+7*t/480*s+127*i/40320*a+4369*t*t/5806080*a*r+34807*i*t/182476800*a*r*r)}function uc(n){let e=.254829592,t=-.284496736,i=1.421413741,r=-1.453152027,o=1.061405429,s=.3275911,a=n<0?-1:1;n=Math.abs(n);let u=1/(1+s*n),l=((((o*u+r)*u+i)*u+t)*u+e)*u;return a*(1-l*Math.exp(-n*n))}function lc(n,e){if(e.isNegative())return n._BIGNUM_NAN;let t=n._cache("gamma-p-ln",()=>["0.99999999999999709182","57.156235665862923517","-59.597960355475491248","14.136097974741747174","-0.49191381609762019978","0.33994649984811888699e-4","0.46523628927048575665e-4","-0.98374475304879564677e-4","0.15808870322491248884e-3","-0.21026444172410488319e-3","0.2174396181152126432e-3","-0.16431810653676389022e-3","0.84418223983852743293e-4","-0.2619083840158140867e-4","0.36899182659531622704e-5"].map(s=>n.bignum(s))),i=t[0];for(let s=t.length-1;s>0;--s)i=i.add(t[s].div(e.add(s)));let r=n._cache("gamma-g-ln",()=>n.bignum(607).div(128)),o=e.add(r).add(n._BIGNUM_HALF);return n._BIGNUM_NEGATIVE_ONE.acos().mul(n._BIGNUM_TWO).log().mul(n._BIGNUM_HALF).add(o.log().mul(e.add(n._BIGNUM_HALF)).minus(o).add(i.log()).minus(e.log()))}function cc(n,e){if(e.lessThan(n._BIGNUM_HALF)){let o=n._BIGNUM_NEGATIVE_ONE.acos();return o.div(o.mul(e).sin().mul(cc(n,n._BIGNUM_ONE.sub(e))))}if(e.greaterThan(100))return lc(n,e).exp();e=e.sub(1);let t=n._cache("lanczos-7-c",()=>["0.99999999999980993227684700473478","676.520368121885098567009190444019","-1259.13921672240287047156078755283","771.3234287776530788486528258894","-176.61502916214059906584551354","12.507343278686904814458936853","-0.13857109526572011689554707","9.984369578019570859563e-6","1.50563273514931155834e-7"].map(o=>n.bignum(o))),i=t[0];for(let o=1;o<9;o++)i=i.add(t[o].div(e.add(o)));let r=e.add(7).add(n._BIGNUM_HALF);return n._BIGNUM_NEGATIVE_ONE.acos().times(n._BIGNUM_TWO).sqrt().mul(i.mul(r.neg().exp()).mul(r.pow(e.add(n._BIGNUM_HALF))))}var Gg,Oa=k(()=>{Gg=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23]});function fc(n){if(n!==void 0)return isNaN(n)?"unsigned":n>0?"positive":n<0?"negative":"zero"}function pc(n){return n==="positive"?"negative":n==="non-negative"?"non-positive":n==="negative"?"positive":n==="non-positive"?"non-negative":n}function so(n){if(n.isGreater(1))return"positive";if(n.isGreaterEqual(1))return"non-negative";if(n.isLessEqual(1)&&n.isGreaterEqual(0))return"non-positive";if(n.isLess(1)&&n.isGreaterEqual(0))return"negative";if(n.is(1))return"zero";if(n.isNegative||n.isReal===!1)return"unsigned"}function w0(n){let e=n.engine,t=n.numericValue;if(t!==null)return typeof t=="number"?e.number(Math.abs(t)):e.number(t.abs());if(n.isNonNegative)return n;if(n.isNegative)return n.neg()}function Wg(n,e){let t=n.engine,i=e==="Max"||e==="Supremum";if(n.operator==="Interval"){let r=i?n.op2:n.op1;return!r.isNumber||r.numericValue===null?[void 0,[n]]:[r,[]]}if(n.operator==="Range")if(i){let r=Qn(n),o=og(r);return[t.number(Math.max(r[0],o)),[]]}else return[t.number(Qn(n)[0]),[]];if(n.operator==="Linspace")return n.nops===1?n=i?n.op1:t.One:i?n=n.op2:n=n.op1,[n,[]];if(n.isCollection){let r,o=[];for(let s of n.each()){let[a,u]=Wg(s,e);a&&(r?(i&&a.isGreater(r)||!i&&a.isLess(r))&&(r=a):r=a),o.push(...u)}return[r,o]}return!n.isNumber||n.numericValue===null?[void 0,[n]]:[n,[]]}function La(n,e,t){let i=t==="Max"||t==="Supremum";if(e=he(e),e.length===0)return i?n.NegativeInfinity:n.PositiveInfinity;let r,o=[];for(let s of e){let[a,u]=Wg(s,t);a&&(r?(i&&a.isGreater(r)||!i&&a.isLess(r))&&(r=a):r=a),o.push(...u)}return o.length>0?n.box(r?[t,r,...o]:[t,...o]):r??(i?n.NegativeInfinity:n.PositiveInfinity)}function Zg(n,e){let t=n[0].engine,i=e==="LCM"?ji:un,r=e==="LCM"?Nm:gl,o=[];if(Ce(t)){let a=null;for(let u of n)if(a===null)a=hl(u),(a===null||!a.isInteger())&&o.push(u);else{let l=hl(u);l&&l.isInteger()?a=r(a,l):o.push(u)}return o.length===0?a===null?t.One:t.number(a):a===null?t._fn(e,o):t._fn(e,[t.number(a),...o])}let s=null;for(let a of n)s===null?a.isInteger&&o.push(a):a.isInteger?s=i(s,a.re):o.push(a);return o.length===0?s===null?t.One:t.number(s):s===null?t._fn(e,o):t._fn(e,[t.number(s),...o])}function ka(n){if(!n.isInteger||n.isNegative||n.numericValue===null)return;let t=G(n);if(t!==null)return Su(t);let i=Kt(n);if(i!==null)return Kp(i)}var Hg,rc=k(()=>{_n();kt();me();Xe();ut();Wo();zn();Ug();$o();ca();Oa();en();St();Js();tn();cn();ns();ii();Tn();_a();Vo();Yo();Hg=[{Abs:{wikidata:"Q3317982",broadcastable:!0,idempotent:!0,complexity:1200,signature:"(number) -> number",type:([n])=>n.type,sgn:([n])=>n.is(0)?"zero":n.isNumberLiteral?"positive":"non-negative",evaluate:([n])=>w0(n)},Add:{wikidata:"Q32043",associative:!0,commutative:!0,commutativeOrder:Ho,broadcastable:!0,idempotent:!0,complexity:1300,lazy:!0,signature:"(value+) -> value",type:Lm,sgn:n=>{if(n.some(e=>e.isNaN))return"unsigned";if(n.every(e=>e.is(0)))return"zero";if(n.every(e=>e.isNonNegative))return n.some(e=>e.isPositive)?"positive":"non-negative";if(n.every(e=>e.isNonPositive))return n.some(e=>e.isNegative)?"negative":"non-positive"},evaluate:(n,{numericApproximation:e})=>e?qm(...n):X(...n.map(t=>t.evaluate()))},Ceil:{description:"Rounds a number up to the next largest integer",complexity:1250,broadcastable:!0,signature:"(number) -> integer",sgn:([n])=>{if(n.isLessEqual(-1))return"negative";if(n.isPositive)return"positive";if(n.isNonNegative)return"non-negative";if(n.isNonPositive&&n.isGreater(-1))return"zero";if(n.isNonPositive)return"non-positive";if(n.isReal==!1&&n.isNumberLiteral)return n.im>0||n.im<=-1?"unsigned":fc(n.re)},evaluate:([n])=>Ee(n,Math.ceil,e=>e.ceil(),e=>e.ceil(0))},Chop:{associative:!0,broadcastable:!0,idempotent:!0,complexity:1200,signature:"(number) -> number",type:([n])=>n.type,evaluate:n=>{let e=n[0],t=e.engine;return Ee(e,i=>t.chop(i),i=>t.chop(i),i=>t.complex(t.chop(i.re),t.chop(i.im)))}},Divide:{wikidata:"Q1226939",complexity:2500,broadcastable:!0,signature:"(number, number+) -> number",type:([n,e])=>e.is(1)?n.type:e.isNaN||n.isNaN?"number":e.isFinite===!1||n.isFinite===!1?"non_finite_number":e.isInteger&&n.isInteger?"finite_rational":e.isReal&&n.isReal?"finite_real":"finite_number",sgn:n=>{let[e,t]=[n[0],n[1]];if(t.is(0))return"unsigned";if(t.isPositive)return e.sgn;if(t.isNegative)return pc(e.sgn);let i=t.sgn;if(e.is(0)&&i==="not-zero"||e.isFinite&&t.isInfinity)return"zero";if(e.sgn==="not-zero"&&i==="not-zero")return"not-zero"},canonical:(n,{engine:e})=>{let t=e;n=Rn(t,n);let i=n[0];if(i===void 0)return t.error("missing");if(n.length<2)return i;let r=n.slice(1);for(let o of r)i=Zn(i,o);return i},evaluate:([n,e])=>n.div(e)},Exp:{wikidata:"Q168698",broadcastable:!0,complexity:3500,signature:"(number) -> number",canonical:(n,{engine:e})=>(n=Rn(e,n,1),e.function("Power",[e.E,...n]))},Factorial:{description:"Factorial function: the product of all positive integers less than or equal to n",wikidata:"Q120976",broadcastable:!0,complexity:9e3,signature:"(integer) -> integer",sgn:([n])=>n.isNonNegative?"positive":n.isNegative||n.isReal===!1?"unsigned":void 0,canonical:(n,{engine:e})=>{let t=n[0];return t.isNumberLiteral&&t.isNegative?e._fn("Factorial",[t.neg()]).neg():e._fn("Factorial",[t])},evaluate:([n])=>{let e=n.engine;if(n.isNumberLiteral){if(n.im!==0&&n.im!==void 0)return e.number(e.complex(n.re,n.im).add(1));if(n.isFinite){if(n.isNegative)return e.number(Ci(1+n.re));try{return e.number(Vr(la(BigInt((n.bignumRe??n.re).toFixed())),e._timeRemaining))}catch{return}}}},evaluateAsync:async([n],{signal:e})=>{let t=n.engine;if(n.isNumberLiteral){if(n.im!==0&&n.im!==void 0)return t.number(t.complex(n.re,n.im).add(1));if(n.isFinite){if(n.isNegative)return t.number(Ci(1+n.re));try{return t.number(await Fr(la(BigInt((n.bignumRe??n.re).toFixed())),(t._deadline??1/0)-Date.now(),e))}catch{return}}}}},Factorial2:{description:"Double Factorial Function",complexity:9e3,broadcastable:!0,signature:"(integer) -> integer",sgn:([n])=>n.isNonNegative?"positive":n.isNegative||n.isReal===!1?"unsigned":void 0,evaluate:n=>{let e=n[0],t=G(e);if(t===null)return;let i=e.engine;return Ce(i)?i.number(Tm(i,i.bignum(t))):i.number(nd(t))}},Floor:{wikidata:"Q56860783",complexity:1250,broadcastable:!0,signature:"(number) -> integer",sgn:([n])=>{if(n.isNegative)return"negative";if(n.isGreaterEqual(1))return"positive";if(n.isNonNegative&&n.isLess(1))return"zero";if(n.isNonNegative)return"non-negative";if(n.isReal==!1&&n.isNumberLiteral)return n.im<0||n.im>=1?"unsigned":fc(n.re)},evaluate:([n])=>Ee(n,Math.floor,e=>e.floor(),e=>e.floor(0))},Gamma:{wikidata:"Q190573",complexity:8e3,broadcastable:!0,signature:"(number) -> number",sgn:([n])=>n.isPositive?"positive":n.is(0)?"zero":void 0,evaluate:([n],{numericApproximation:e,engine:t})=>e?Ee(n,i=>Ci(i),i=>cc(t,i),i=>i):void 0},GammaLn:{complexity:8e3,broadcastable:!0,signature:"(number) -> number",evaluate:(n,{numericApproximation:e,engine:t})=>e?Ee(n[0],i=>oo(i),i=>lc(t,i),i=>i):void 0},Digamma:{description:"Digamma function, the logarithmic derivative of the gamma function",wikidata:"Q1142755",complexity:8200,broadcastable:!0,signature:"(number) -> number"},Trigamma:{description:"Trigamma function, the derivative of the digamma function",wikidata:"Q2371722",complexity:8400,broadcastable:!0,signature:"(number) -> number"},PolyGamma:{description:"Polygamma function, the n-th derivative of the digamma function",wikidata:"Q1817679",complexity:8500,broadcastable:!0,signature:"(order: integer, number) -> number"},Zeta:{description:"Riemann zeta function",wikidata:"Q187235",complexity:8500,broadcastable:!0,signature:"(number) -> number"},Beta:{description:"Euler beta function",wikidata:"Q189062",complexity:8200,broadcastable:!0,signature:"(number, number) -> number"},LambertW:{description:"Lambert W function (product logarithm)",wikidata:"Q429963",complexity:8300,broadcastable:!0,signature:"(number) -> number"},BesselJ:{description:"Bessel function of the first kind",wikidata:"Q627488",complexity:8500,broadcastable:!0,signature:"(order: number, number) -> number"},BesselY:{description:"Bessel function of the second kind (Neumann function)",wikidata:"Q627488",complexity:8500,broadcastable:!0,signature:"(order: number, number) -> number"},BesselI:{description:"Modified Bessel function of the first kind",wikidata:"Q627488",complexity:8500,broadcastable:!0,signature:"(order: number, number) -> number"},BesselK:{description:"Modified Bessel function of the second kind (Macdonald function)",wikidata:"Q627488",complexity:8500,broadcastable:!0,signature:"(order: number, number) -> number"},AiryAi:{description:"Airy function of the first kind",wikidata:"Q403629",complexity:8400,broadcastable:!0,signature:"(number) -> number"},AiryBi:{description:"Airy function of the second kind",wikidata:"Q403629",complexity:8400,broadcastable:!0,signature:"(number) -> number"},Ln:{description:"Natural Logarithm",wikidata:"Q204037",complexity:4e3,broadcastable:!0,signature:"(number, base: number?) -> number",sgn:([n])=>so(n),evaluate:([n],{numericApproximation:e,engine:t})=>e?Ee(n,i=>i===0?-1/0:i>=0?Math.log(i):t.complex(i).log(),i=>i.isZero()?-1/0:i.isNeg()?t.complex(i.toNumber()).log():i.ln(),i=>i.isZero()?NaN:i.log()):n.ln()},Log:{description:"Log(z, b = 10) = Logarithm of base b",wikidata:"Q11197",complexity:4100,broadcastable:!0,signature:"(number, base: number?) -> number",sgn:([n,e])=>{if(!e)return so(n);if(e.is(1)||e.isReal==!1)return"unsigned";if(e.isGreater(1))return so(n);if(e.isLess(1))return pc(so(n))},evaluate:(n,{numericApproximation:e,engine:t})=>{if(!e)return n[0]?.ln(n[1]??10)??void 0;let i=t;return n[1]===void 0?Ee(n[0],r=>r===0?-1/0:r>=0?Math.log10(r):i.complex(r).log().div(Math.LN10),r=>r.isZero()?-1/0:r.isNeg()?i.complex(r.toNumber()).log().div(Math.LN10):U.log10(r),r=>r.isZero()?NaN:r.log().div(Math.LN10)):wt(n[0],n[1],(r,o)=>Math.log(r)/Math.log(o),(r,o)=>r.log(o),(r,o)=>r.log().div(typeof o=="number"?Math.log(o):o.log()))}},Lb:{description:"Base-2 Logarithm",wikidata:"Q581168",complexity:4100,broadcastable:!0,signature:"(number) -> number",sgn:([n])=>so(n),canonical:([n],{engine:e})=>e._fn("Log",[n,e.number(2)])},Lg:{description:"Base-10 Logarithm",wikidata:"Q966582",complexity:4100,broadcastable:!0,signature:"(number) -> number",sgn:([n])=>so(n),canonical:([n],{engine:e})=>e._fn("Log",[n])},Mod:{description:"Modulo",wikidata:"Q1799665",complexity:2500,broadcastable:!0,signature:"(number, number) -> number",sgn:n=>{let e=n[1];if(!(e===void 0||e.isReal==!1)){if(e.is(0))return"unsigned";if(n[0].isNumberLiteral&&e.isNumberLiteral)return wt(n[0],e,(i,r)=>(i%r+r)%r,(i,r)=>i.modulo(r))?.sgn??void 0}},evaluate:([n,e])=>wt(n,e,(t,i)=>(t%i+i)%i,(t,i)=>t.modulo(i))},Multiply:{wikidata:"Q40276",associative:!0,commutative:!0,idempotent:!0,complexity:2100,broadcastable:!0,lazy:!0,signature:"(number*) -> number",type:n=>n.length===0?"finite_integer":n.length===1?n[0].type:n.some(e=>e.isNaN)?"number":n.some(e=>e.isFinite===!1)?"non_finite_number":n.every(e=>e.isInteger)?"finite_integer":n.every(e=>e.isReal)?"finite_real":n.every(e=>e.isRational)?"finite_rational":"finite_number",sgn:n=>{if(!n.some(e=>e.sgn===void 0||e.isReal===!1)){if(n.some(e=>e.is(0)))return n.every(e=>e.isFinite)?"zero":n.some(e=>e.isFinite===!1)?"unsigned":void 0;if(!(n.some(e=>e.isFinite===!1||e.isFinite===void 0)&&n.some(e=>{let t=e.sgn}))){if(n.every(e=>e.isPositive||e.isNegative)){let e=0;return n.forEach(t=>{t.isNegative&&e++}),e%2===0?"positive":"negative"}if(n.every(e=>e.isNonPositive||e.isNonNegative)){let e=0;return n.forEach(t=>{t.isNonPositive&&e++}),e%2===0?"non-positive":"non-negative"}if(n.every(e=>e.sgn==="not-zero"||e.sgn==="positive"||e.sgn==="negative"))return"not-zero"}}},evaluate:(n,{numericApproximation:e})=>e?km(...n):pe(...n.map(t=>t.evaluate()))},Negate:{description:"Additive Inverse",wikidata:"Q715358",complexity:2e3,broadcastable:!0,signature:"(number) -> number",type:([n])=>n.type,sgn:([n])=>pc(n.sgn),canonical:(n,{engine:e})=>(n=Rn(e,n),n.length===0?e.error("missing"):n[0].neg()),evaluate:([n])=>n.neg()},PlusMinus:{description:"Plus or Minus",wikidata:"Q120812",complexity:1200,signature:"(value, value) -> tuple",canonical:(n,{engine:e})=>(n=Rn(e,n,2),n.length===0?e.error("missing"):e._fn("PlusMinus",[n[0],n[1].abs()])),type:([n,e])=>F(`tuple<${n.type}, ${e.type}>`),evaluate:([n,e],{engine:t})=>t.tuple(n.add(e.neg()),n.add(e))},Power:{wikidata:"Q33456",broadcastable:!0,complexity:3500,signature:"(number, number) -> number",type:([n,e])=>n.isNaN||e.isNaN?"number":e.isFinite?n.isInteger&&e.isInteger?"finite_integer":n.isRational&&e.isInteger?"finite_rational":n.isReal&&e.isReal?"finite_real":"finite_number":"non_finite_number",canonical:(n,{engine:e})=>{if(n=Rn(e,n,2),n.length!==2)return e._fn("Power",n);let[t,i]=n;return ti(t,i)},sgn:([n,e])=>{let t=n.sgn,i=e.sgn;if(!(n.isReal===!1||e.isReal===!1||n.isNaN||e.isNaN||t===void 0||i===void 0)){if(n.is(0))return e.isNonPositive?"unsigned":e.isPositive?"zero":void 0;if(n.is(0)&&e.is(0))return"unsigned";if(n.isNonNegative||e.numerator.isOdd&&e.denominator.isOdd)return n.sgn;if(e.numerator.isEven&&e.denominator.isOdd){if(n.isReal){let r=n.sgn;return r==="positive"||r==="not-zero"||r==="negative"?"positive":"non-negative"}return n.type.matches("complex")?"negative":n.is(0)?void 0:"not-zero"}if(e.isRational===!1||e.numerator.isOdd&&e.denominator.isEven&&n.isNonPositive)return"unsigned"}},evaluate:([n,e],{numericApproximation:t})=>Oe(n,e,{numericApproximation:t??!1})},Rational:{complexity:2400,signature:"(number, integer?) -> rational",sgn:([n])=>n.sgn,canonical:(n,{engine:e})=>{let t=e;return n=he(n),n.length===0?t._fn("Rational",[t.error("missing")]):n.length===1?t._fn("Rational",[We(t,n[0],"real")]):(n=Xo(t,n,["integer","integer"]),n.length!==2||!n[0].isValid||!n[1].isValid?t._fn("Rational",n):n[0].div(n[1]))},evaluate:(n,{numericApproximation:e,engine:t})=>{let i=t;if(n.length===1){let s=n[0].N();return s.numericValue===null||s.im!==0?void 0:i.number(ym(s.re))}if(e)return wt(n[0],n[1],(s,a)=>s/a,(s,a)=>s.div(a),(s,a)=>s.div(a));let[r,o]=[J(n[0]),J(n[1])];if(r!==null&&o!==null)return i.number([r,o])}},Root:{complexity:3200,broadcastable:!0,signature:"(number, number) -> number",type:([n,e])=>n.isNaN||e.isNaN?"number":n.isFinite===!1||e.isFinite===!1?"non_finite_number":e.is(0)?"finite_integer":e.is(1)?n.type:n.isReal&&e.isReal&&n.isPositive===!0?"finite_real":"finite_number",sgn:([n,e])=>{if(n.isReal===!1||e.isReal===!1)return"unsigned";if(n.is(0)){if(e.isNonPositive)return"unsigned";if(e.isPositive)return"zero"}if(n.isPositive===!0)return"positive";if(n.isNonNegative===!0)return"non-negative";if(e.isOdd===!0||e.numerator.isOdd&&e.denominator.isOdd)return n.sgn;if(n.isNegative&&e.isOdd===!1)return"unsigned"},canonical:(n,{engine:e})=>{n=Rn(e,n,2);let[t,i]=n;return er(t,i)},evaluate:([n,e],{numericApproximation:t})=>ba(n,e,{numericApproximation:t})},Round:{complexity:1250,broadcastable:!0,signature:"(number) -> integer",type:([n])=>n.isNaN?"number":n.isFinite===!1||n.isReal===!1?"non_finite_number":"finite_integer",sgn:([n])=>{if(n.isNaN)return"unsigned";if(n.isNumberLiteral)return n.im>=.5||n.im<=-.5?"unsigned":fc(Math.round(n.re));if(n.isGreaterEqual(.5))return"positive";if(n.isLessEqual(-.5))return"negative";if(n.isLess(.5)&&n.isGreater(-.5))return"zero";if(n.isNonNegative)return"non-negative";if(n.isNonPositive)return"non-positive"},evaluate:([n])=>Ee(n,Math.round,e=>e.round(),e=>e.round(0))},Sign:{complexity:1200,broadcastable:!0,signature:"(number) -> integer",sgn:([n])=>n.sgn,evaluate:([n],{engine:e})=>{if(n.is(0))return e.Zero;if(n.isPositive)return e.One;if(n.isNegative)return e.NegativeOne}},Sqrt:{description:"Square Root",wikidata:"Q134237",complexity:3e3,broadcastable:!0,signature:"(number) -> number",type:([n])=>n.isNaN?"number":n.isFinite===!1?"non_finite_number":n.isReal?n.isNegative?"complex":"finite_real":"finite_number",sgn:([n])=>{if(n.isPositive)return"positive";if(n.isNegative)return"unsigned";if(n.isNonNegative)return"non-negative";if(n.sgn==="not-zero")return"not-zero"},evaluate:([n],{numericApproximation:e,engine:t})=>{if(!e)return n.sqrt();let[i,r]=n.toNumericValue();return r.is(1)?t.number(i.sqrt().N()):t.number(i.sqrt().N()).mul(r)}},Square:{wikidata:"Q3075175",complexity:3100,broadcastable:!0,signature:"(number) -> number",sgn:([n])=>{if(n.is(0))return"zero";if(n.isReal){let e=n.sgn;return e==="not-zero"||e==="positive"||e==="negative"?"positive":"non-negative"}if(n.type.matches("complex"))return"negative";if(n.isReal==!1||n.isNaN)return"unsigned"},canonical:(n,{engine:e})=>{let t=e;return n=he(n),n.length!==1?t._fn("Square",n):t._fn("Power",[n[0],t.number(2)]).canonical}},Subtract:{wikidata:"Q40754",complexity:1350,broadcastable:!0,signature:"(number+) -> number",canonical:(n,{engine:e})=>{if(n=Rn(e,n),n.length===0)return e.error("missing");let t=n[0],i=n.slice(1);return qn(e,[t,...i.map(r=>r.neg())])}}},{ImaginaryUnit:{type:"imaginary",isConstant:!0,holdUntil:"never",wikidata:"Q193796",value:n=>n.I},i:{type:"imaginary",isConstant:!0,holdUntil:"never",value:n=>n.I},ExponentialE:{type:"finite_real",wikidata:"Q82435",isConstant:!0,holdUntil:"N",value:n=>n.number(Ce(n)?n._BIGNUM_ONE.exp():Math.exp(1))},e:{type:"finite_real",isConstant:!0,holdUntil:"never",value:"ExponentialE"},ComplexInfinity:{type:"complex",isConstant:!0,holdUntil:"never",value:n=>n.ComplexInfinity},PositiveInfinity:{type:"non_finite_number",isConstant:!0,holdUntil:"never",value:1/0},NegativeInfinity:{type:"non_finite_number",isConstant:!0,holdUntil:"never",value:-1/0},NaN:{type:"number",isConstant:!0,holdUntil:"never",value:n=>n.NaN},ContinuationPlaceholder:{description:"This symbol indicates that some elements in a collection have been omitted, for example in a long list of numbers, or in an infinite set",type:"unknown",isConstant:!0},MachineEpsilon:{type:"finite_real",holdUntil:"N",isConstant:!0,value:{num:Number.EPSILON.toString()}},Half:{type:"finite_rational",isConstant:!0,holdUntil:"never",value:["Rational",1,2]},GoldenRatio:{type:"finite_real",wikidata:"Q41690",isConstant:!0,holdUntil:"N",value:["Divide",["Add",1,["Sqrt",5]],2]},CatalanConstant:{type:"finite_real",wikidata:"Q855282",isConstant:!0,holdUntil:"N",value:{num:`0.91596559417721901505460351493238411077414937428167
                  21342664981196217630197762547694793565129261151062
                  48574422619196199579035898803325859059431594737481
                  15840699533202877331946051903872747816408786590902
                  47064841521630002287276409423882599577415088163974
                  70252482011560707644883807873370489900864775113225
                  99713434074854075532307685653357680958352602193823
                  23950800720680355761048235733942319149829836189977
                  06903640418086217941101917532743149978233976105512
                  24779530324875371878665828082360570225594194818097
                  53509711315712615804242723636439850017382875977976
                  53068370092980873887495610893659771940968726844441
                  66804621624339864838916280448281506273022742073884
                  31172218272190472255870531908685735423498539498309
                  91911596738846450861515249962423704374517773723517
                  75440708538464401321748392999947572446199754961975
                  87064007474870701490937678873045869979860644874974
                  64387206238513712392736304998503539223928787979063
                  36440323547845358519277777872709060830319943013323
                  16712476158709792455479119092126201854803963934243
                  `}},EulerGamma:{type:"finite_real",wikidata:"Q273023",holdUntil:"N",isConstant:!0,value:{num:`0.57721566490153286060651209008240243104215933593992359880576723488486772677766
          467093694706329174674951463144724980708248096050401448654283622417399764492353
          625350033374293733773767394279259525824709491600873520394816567085323315177661
          152862119950150798479374508570574002992135478614669402960432542151905877553526
          733139925401296742051375413954911168510280798423487758720503843109399736137255
          306088933126760017247953783675927135157722610273492913940798430103417771778088
          154957066107501016191663340152278935867965497252036212879226555953669628176388
          792726801324310104765059637039473949576389065729679296010090151251959509222435
          014093498712282479497471956469763185066761290638110518241974448678363808617494
          551698927923018773910729457815543160050021828440960537724342032854783670151773
          943987003023703395183286900015581939880427074115422278197165230110735658339673`}}},{PreIncrement:{signature:"(number) -> number"},PreDecrement:{signature:"(number) -> number"}},{IsPrime:{description:"`IsPrime(n)` returns `True` if `n` is a prime number",wikidata:"Q49008",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",evaluate:([n],{engine:e})=>{let t=ka(n);if(t!==void 0)return e.symbol(t?"True":"False")}},IsComposite:{description:"`IsComposite(n)` returns `True` if `n` is not a prime number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",canonical:(n,{engine:e})=>e.box(["Not",["IsPrime",...n]])},IsOdd:{description:"`IsOdd(n)` returns `True` if `n` is an odd number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",evaluate:(n,{engine:e})=>{let t=!1,i=n.every(r=>{if(r.im!==0)return!1;let o=Kt(r);if(o!==null)return o%BigInt(2)!==BigInt(0);let s=r.re;return Number.isInteger(s)?s%2!==0:(t=!0,!1)});if(!t)return e.symbol(i?"True":"False")}},IsEven:{description:"Even Number",complexity:1200,broadcastable:!0,signature:"(number) -> boolean",canonical:(n,{engine:e})=>e.box(["Not",["IsOdd",...n]])}},{GCD:{description:"Greatest Common Divisor",complexity:1200,broadcastable:!1,signature:"(any*) -> integer",sgn:()=>"positive",evaluate:n=>Zg(n,"GCD")},LCM:{description:"Least Common Multiple",complexity:1200,broadcastable:!1,signature:"(any*) -> integer",sgn:()=>"positive",evaluate:n=>Zg(n,"LCM")},Numerator:{description:"Numerator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> number | nothing",canonical:(n,{engine:e})=>{if(n.length===0)return e.Nothing;let t=n[0];return t.operator==="Rational"||t.operator==="Divide"?t.op1:e._fn("Numerator",Fn(e,n))},sgn:([n])=>n.sgn,evaluate:(n,{engine:e})=>{let t=e;if(n.length===0)return t.Nothing;let i=n[0];return i.operator==="Rational"||i.operator==="Divide"?i.op1.evaluate():i.numerator}},Denominator:{description:"Denominator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> number | nothing",canonical:(n,{engine:e})=>{if(n.length===0)return e.Nothing;let t=n[0];if(t.operator==="Rational"||t.operator==="Divide")return t.op2;let i=Qe(t);return i!==void 0?e.number(i[1]):e._fn("Denominator",Fn(e,n))},sgn:()=>"positive",evaluate:(n,{engine:e})=>{let t=e;if(n.length===0)return t.Nothing;let i=n[0];return i.operator==="Rational"||i.operator==="Divide"?i.op2.evaluate():i.denominator}},NumeratorDenominator:{description:"Sequence of Numerator and Denominator of an expression",complexity:1200,broadcastable:!0,lazy:!0,signature:"(number) -> tuple<number, number> | nothing",canonical:(n,{engine:e})=>{if(n.length===0)return e.Nothing;let t=n[0];if(t.operator==="Rational"||t.operator==="Divide")return e.tuple(...t.ops);let i=Qe(t.evaluate());return i!==void 0?e.tuple(e.number(i[0]),e.number(i[1])):e._fn("NumeratorDenominator",n.map(r=>r.evaluate()))},evaluate:(n,{engine:e})=>{let t=e;if(n.length===0)return t.Nothing;let i=n[0];return i.operator==="Rational"||i.operator==="Divide"?t.tuple(...i.ops):t.tuple(...i.numeratorDenominator)}}},{Max:{description:"Maximum of two or more numbers",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",sgn:n=>{if(n.some(e=>e.isReal==!1||e.isNaN))return"unsigned";if(!n.some(e=>e.isReal==!1||e.isNaN!==!1)){if(n.some(e=>e.isPositive))return"positive";if(n.every(e=>e.isNonPositive))return n.some(e=>e.is(0))?"zero":"non-positive";if(n.some(e=>e.isNonNegative))return"non-negative";if(n.every(e=>e.isNegative))return"negative";if(n.some(e=>!e.is(0)))return"not-zero"}},evaluate:(n,{engine:e})=>La(e,n,"Max")},Min:{description:"Minimum of two or more numbers",complexity:1200,broadcastable:!1,signature:"(value+) -> number | list",sgn:n=>{if(n.some(e=>e.isReal==!1||e.isNaN))return"unsigned";if(!n.some(e=>e.isReal==!1||e.isNaN!==!1)){if(n.some(e=>e.isNegative))return"negative";if(n.every(e=>e.isNonNegative))return n.some(e=>e.is(0))?"zero":"non-negative";if(n.some(e=>e.isNonPositive))return"non-positive";if(n.every(e=>e.isPositive))return"positive"}},evaluate:(n,{engine:e})=>La(e,n,"Min")},Supremum:{description:"Like Max, but defined for open sets",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",evaluate:(n,{engine:e})=>La(e,n,"Supremum")},Infimum:{description:"Like Min, but defined for open sets",complexity:1200,broadcastable:!1,signature:"(value*) -> number | list",evaluate:(n,{engine:e})=>La(e,n,"Infimum")},Product:{description:"`Product(f, a, b)` computes the product of `f` from `a` to `b`",wikidata:"Q901718",complexity:1e3,broadcastable:!1,scoped:!0,lazy:!0,signature:"((number+) -> number, (tuple<integer>|tuple<integer, integer>)+) -> number",canonical:([n,...e],{scope:t})=>nc("Product",n,e,t),evaluate:(n,e)=>{let t=e.engine,i=Vr(es(n[0],n.slice(1),(r,o)=>r.mul(o.evaluate(e)),t.One),t._timeRemaining);if(i!==eo)return i?.evaluate()??t.NaN},evaluateAsync:async(n,e)=>{let t=e.engine,i=await Fr(es(n[0],n.slice(1),(r,o)=>r.mul(o.evaluate(e)),t.One),t._timeRemaining,e.signal);if(i!==eo)return i?.evaluate()??t.NaN}},Sum:{description:"`Sum(f, [a, b])` computes the sum of `f` from `a` to `b`",wikidata:"Q218005",complexity:1e3,broadcastable:!1,scoped:!0,lazy:!0,signature:"((number) -> number, bounds:tuple+) -> number",canonical:([n,...e],{scope:t})=>nc("Sum",n,e,t),evaluate:([n,...e],{engine:t})=>{let i=Vr(es(n,e,(r,o)=>r.add(o.evaluate()),t.Zero),t._timeRemaining);if(i!==eo)return i?.evaluate()??t.NaN},evaluateAsync:async(n,{engine:e,signal:t})=>{let i=await Fr(es(n[0],n.slice(1),(r,o)=>r.add(o.evaluate()),e.Zero),e._timeRemaining,t);if(i!==eo)return i?.evaluate()??e.NaN}}}]});var __={};yr(__,{BaseCompiler:()=>Je,BoxedType:()=>R,ComputeEngine:()=>_o,GLSLTarget:()=>hr,JavaScriptTarget:()=>gr,NumericValue:()=>ae,version:()=>v_});Fi();_n();var mn="\x1B[0m";var _r="\x1B[30;1m";var _p="\x1B[33m",mu="\x1B[34;1m";var So="\x1B[36;1m",Np="\x1B[101;97m";var Vs="\x1B[1m";di();an();Tn();In();gi();function _u(n,e){if(n.length>6)return`${n.length}${Hp(n.length)}`,[];let t=[],i=(r,o=[])=>{if(r.length===0)(!e||e(o))&&t.push([...o]);else for(let s=0;s<r.length;s++){let a=r.slice(),u=a.splice(s,1);i(a.slice(),o.concat(u))}};return i(n),t}function Hp(n){return n<=1?1:n*Hp(n-1)}function Wp(n){for(let e in n)e.startsWith("_")&&n.hasOwnProperty(e)&&Object.defineProperty(n,e,{enumerable:!1,configurable:!0,writable:!0,value:n[e]})}var Ws=class{_listeners=new Array(300);_pending=!1;_version=0;listen(e){for(let i of this._listeners)if(i.deref()===e)return()=>this._unsubscribe(e);let t=new WeakRef(e);return this._listeners.push(t),()=>this._unsubscribe(e)}_unsubscribe(e){this._listeners=this._listeners.filter(t=>{let i=t.deref();return i!==void 0&&i!==e})}notify(){if(this._pending)return;this._pending=!0;let e=this._version+1;queueMicrotask(()=>{if(e!==this._version+1){this._pending=!1;return}this.notifyNow()})}notifyNow(){this._version++,this._listeners=this._listeners.filter(e=>{let t=e.deref();try{t?.onConfigurationChange?.()}catch(i){console.error("Listener error:",i)}return t!==void 0}),this._pending=!1}};en();di();Ye();Gn();Gt();var hd=[{name:"To",latexTrigger:["\\to"],kind:"infix",precedence:270}];Ye();Gt();Gu();Gn();function Ub(n){if(S(n)!=="Multiply")return[[],[]];let e=[],t=[];for(let i of A(n))if(S(i)==="Power"){let r=b(i,1),o=b(i,2);if(S(o)==="Negate"){let s=b(o,1);r&&s&&t.push(["Power",r,s])}else{let s=z(o)??NaN;s===-1?r&&t.push(r):s<0?r&&t.push(["Power",r,-s]):e.push(i)}}else if(S(i)==="Rational"&&de(i)===2||S(i)==="Divide"){let r=b(i,1),o=b(i,2);z(r)!==1&&e.push(r),z(o)!==1&&t.push(o)}else{let r=Ar(i);r!==null?(r[0]!==1&&e.push(r[0]),t.push(r[1])):e.push(i)}return[e,t]}function Gb(n){let e=n.parseOptionalGroup(),t=n.parseGroup()??n.parseToken();return fe(t)?e!==null?["Root",Bo,ne(e)]:["Sqrt",Bo]:e!==null?["Root",t,e]:["Sqrt",t]}function Co(n,e,t,i){return t==null?"\\sqrt{}":(i=i??2,e==="solidus"?n.wrapShort(t)+"^{1/"+n.serialize(i)+"}":e==="quotient"?n.wrapShort(t)+"^{\\frac{1}{"+n.serialize(i)+"}}":z(i)===2?"\\sqrt{"+n.serialize(t)+"}":"\\sqrt["+n.serialize(i)+"]{"+n.serialize(t)+"}")}function zb(n,e){n.level-=1;let t=S(e),i="",r=b(e,1);if(t==="Negate")i="-"+n.wrap(r,Ae+1);else if(t==="Subtract"){i=n.wrap(r,Ae);let o=b(e,2);if(o!==null){let s=n.wrap(o,Ae);s[0]==="-"?i+="+"+s.slice(1):s[0]==="+"?i+="-"+s.slice(1):i=i+"-"+s}}else if(t==="Add"){if(n.options.prettify&&de(e)===2&&n.options.invisiblePlus!=="+"){let[a,u]=[b(e,1),b(e,2)],[l,c]=[a,u],f=z(l),p=Ar(c);if((f===null||p===null)&&([l,c]=[u,a],f=z(l),p=Ar(c)),f!==null&&p!==null&&isFinite(f)&&Number.isInteger(f)&&f>=0&&f<=1e3&&isFinite(p[0])&&isFinite(p[1])&&p[0]>0&&p[0]<=100&&p[1]<=100)return i=Cr(n.options.invisiblePlus,n.serialize(l),n.serialize(c)),n.level+=1,i}if(n.options.prettify&&de(e)===2){let[a,u]=Ro(r),[l,c]=Ro(b(e,2));if(u<0&&c>0)return i=n.wrap(l,Ae)+"-"+n.wrap(a,Ae),n.level+=1,i}i=n.serialize(r);let o=de(e)+1,s=A(e);for(let a=2;a<o;a++)if(r=s[a-1],n.options.prettify){let[u,l]=Ro(r),c=n.wrap(u,Ae);l>0?c.startsWith("+")||c.startsWith("-")?i+=c:i+="+"+c:c.startsWith("+")?i+="-"+c.slice(1):c.startsWith("-")?i+="+"+c.slice(1):i+="-"+c}else{let u=n.wrap(r,Ae);u[0]==="-"||u[0]==="+"?i+=u:i+="+"+u}}return n.level+=1,i}function kd(n,e){if(e===null)return"";n.level-=1;let t="";if(n.options.prettify===!0){let[u,l]=Ub(e);l.length>0&&(l.length===1&&l[0]===1?u.length===0?t="1":u.length===1?t=n.serialize(u[0]):t=kd(n,["Multiply",...u]):t=n.serialize(["Divide",u.length===1?u[0]:["Multiply",...u],l.length===1?l[0]:["Multiply",...l]]))}if(t)return n.level+=1,t;let i=!1,r=null,o=de(e)+1,s=A(e);n.options.prettify===!0&&s.length===2&&$t(s[1])&&!$t(s[0])&&(s=[s[1],s[0]]);let a=!1;for(let u=1;u<o;u++){if(r=s[u-1],r===null)continue;let l;if($t(r)){l=n.serialize(r),l==="-1"&&!t?(t="",i=!i):(l[0]==="-"&&(l=l.slice(1),i=!i),t?t=Cr(n.options.multiply,t,l):t=l),a=!0;continue}if(S(r)==="Power"){let c=Ar(b(r,2));if(c!=null){let[f,p]=c;if(f===1&&p!==null){t+=Co(n,n.rootStyle(r,n.level),b(r,1),p),a=!1;continue}}}if(S(r)==="Power"&&!isNaN(z(b(r,1))??NaN)){l=n.serialize(r),t?t=Cr(n.options.multiply,t,l):t=l,a=!0;continue}if(S(r)==="Negate"&&(r=b(r,1),i=!i),l=n.wrap(r,wn),!t)t=l;else{let c=S(r);a&&(c==="Divide"||c==="Rational")?t=Cr(n.options.multiply,t,l):n.options.invisibleMultiply?t=Cr(n.options.invisibleMultiply,t,l):t=C([t,l])}a=!1}return n.level+=1,i?"-"+t:t}function Zb(n){let e=n.parseGroup(),t=null;if(e===null?(e=n.parseToken(),t=n.parseToken()):t=n.parseGroup(),e=ne(e),t=ne(t),S(e)==="PartialDerivative"&&(S(t)==="PartialDerivative"||S(t)==="Multiply"&&S(b(t,1))==="PartialDerivative")){let o=b(e,3)??null,s=b(e,1);s==null&&(s=ne(n.parseExpression()));let a=[];if(S(t)==="Multiply"){for(let u of A(t))if(S(u)==="PartialDerivative"){let l=b(u,2);l&&a.push(l)}}else{let u=b(t,2);u&&a.push(u)}return a.length>1&&(a=["List",...a]),["PartialDerivative",s,...a,o===null?1:o]}let i=M(e);if(i==="d"||i==="d_upright"||i==="differentialD"){let o=[],s=a=>{if(!a)return;let u=M(a);if(u&&u!=="d"&&u!=="d_upright"&&u!=="differentialD"){o.push(a);return}let l=S(a);if(l==="Sequence"||l==="Multiply"||l==="InvisibleOperator")for(let c of A(a))s(c)};if(s(t),o.length===0){let a=M(t);a&&a.length>1&&a[0]==="d"&&o.push(a.slice(1))}if(o.length>0)return["D",ne(n.parseExpression()),...o]}return["Divide",e,t]}function Td(n,e){if(e===null)return"";let t=ne(b(e,1)),i=ne(b(e,2)),r=n.options.prettify?n.fractionStyle(e,n.level):"quotient";if(r==="inline-solidus"||r==="nice-solidus"){let u=n.wrapShort(t),l=n.wrapShort(i);return r==="inline-solidus"?`${u}/${l}`:`{}^{${u}}\\!\\!/\\!{}_{${l}}`}else{if(r==="reciprocal")return z(t)===1?n.wrap(i)+"^{-1}":n.wrap(t)+n.wrap(i)+"^{-1}";if(r==="factor")return z(i)===1?n.wrap(t):"\\frac{1}{"+n.serialize(i)+"}"+n.wrapString(n.serialize(t),n.groupStyle(e,1))}let o="\\frac";r==="block-quotient"?o="\\dfrac":r==="inline-quotient"&&(o="\\tfrac");let s=n.serialize(t),a=n.serialize(i);return`${o}{${s}}{${a}}`}function zu(n,e){if(!e)return"";let t=S(e),i=ne(b(e,1));if(t==="Sqrt")return Co(n,n.rootStyle(e,n.level-1),i,2);let r=ne(b(e,2));if(t==="Root")return Co(n,n.rootStyle(e,n.level-1),i,r);if(n.options.prettify){let s=z(r)??1;if(s===-1)return n.serialize(["Divide","1",i]);if(s<0)return n.serialize(["Divide","1",["Power",i,-s]]);if(S(r)==="Divide"||S(r)==="Rational"){let a=z(b(r,1)),u=z(b(r,2));if(a===1){let l=n.rootStyle(e,n.level);return Co(n,l,i,b(r,2))}if(a===-1)return u===2?n.serialize(["Divide","1",["Sqrt",i]]):n.serialize(["Divide","1",["Root",i,b(r,2)]]);if(u===2)return`${n.serialize(["Sqrt",i])}^{${n.serialize(b(r,1))}}`}else if(S(r)==="Power"&&z(b(r,2))===-1){let a=n.rootStyle(e,n.level);return Co(n,a,i,b(r,1))}}let o=s=>s.startsWith("-")?n.wrapString(s,"normal"):s;if(S(i)==="Power"){let s=b(i,1),a=b(i,2),u=o(n.wrapShort(s)),l=n.wrapShort(a);return`
      ${u}^{${Ei("^",l,n.serialize(r))}}`}return Ei("^",o(n.wrapShort(i)),n.serialize(r))}var Cd=[{name:"CatalanConstant",symbolTrigger:"G"},{name:"GoldenRatio",latexTrigger:"\\varphi"},{name:"EulerGamma",latexTrigger:"\\gamma"},{name:"Degrees",latexTrigger:["\\degree"],kind:"postfix",precedence:880,parse:(n,e)=>["Degrees",e],serialize:(n,e)=>C([n.serialize(b(e,1)),"\\degree"])},{latexTrigger:["\\degree"],kind:"postfix",precedence:880,parse:(n,e)=>["Degrees",e]},{latexTrigger:["^","<{>","\\circ","<}>"],kind:"postfix",parse:(n,e)=>["Degrees",e]},{latexTrigger:["^","\\circ"],kind:"postfix",parse:(n,e)=>["Degrees",e]},{latexTrigger:["\xB0"],kind:"postfix",precedence:880,parse:(n,e)=>["Degrees",e]},{latexTrigger:["\\ang"],parse:n=>{let e=n.parseGroup();return e===null?["Degrees"]:["Degrees",e]}},{latexTrigger:["\\infty"],parse:"PositiveInfinity"},{name:"PositiveInfinity",serialize:n=>n.options.positiveInfinity},{name:"NegativeInfinity",serialize:n=>n.options.negativeInfinity},{name:"ComplexInfinity",latexTrigger:["\\tilde","\\infty"],serialize:"\\tilde\\infty"},{latexTrigger:["\\tilde","<{>","\\infty","<}>"],parse:"ComplexInfinity"},{name:"Pi",kind:"symbol",latexTrigger:["\\pi"]},{latexTrigger:["\u03C0"],parse:"Pi"},{name:"ExponentialE",latexTrigger:["\\exponentialE"],parse:"ExponentialE",serialize:"\\exponentialE"},{latexTrigger:"\\operatorname{e}",parse:"ExponentialE"},{latexTrigger:"\\mathrm{e}",parse:"ExponentialE"},{kind:"function",symbolTrigger:"exp",parse:n=>{let e=n.parseArguments("implicit");return e===null?"Exp":["Exp",...e]}},{latexTrigger:"\\exp",parse:n=>{let e=n.parseArguments("implicit");return e===null?"Exp":["Exp",...e]}},{name:"ImaginaryUnit",latexTrigger:["\\imaginaryI"]},{latexTrigger:"\\operatorname{i}",parse:"ImaginaryUnit"},{latexTrigger:"\\mathrm{i}",parse:"ImaginaryUnit"},{name:"Abs",kind:"matchfix",openTrigger:"|",closeTrigger:"|",parse:(n,e)=>fe(e)?null:["Abs",e]},{kind:"matchfix",openTrigger:["\\vert"],closeTrigger:["\\vert"],parse:(n,e)=>fe(e)?null:["Abs",e]},{symbolTrigger:"abs",kind:"function",parse:"Abs"},{name:"Add",latexTrigger:["+"],kind:"infix",associativity:"any",precedence:Ae,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:Ae});return i===null?null:kr("Add",e,i)},serialize:zb},{kind:"prefix",latexTrigger:["+"],precedence:Ae,parse:(n,e)=>n.parseExpression({...e,minPrec:400})},{name:"Ceil",kind:"matchfix",openTrigger:"\\lceil",closeTrigger:"\\rceil",parse:(n,e)=>fe(e)?null:["Ceil",e]},{kind:"matchfix",openTrigger:["\u2308"],closeTrigger:["\u2309"],parse:(n,e)=>fe(e)?null:["Ceil",e]},{symbolTrigger:"ceil",kind:"function",parse:"Ceil"},{name:"Chop",symbolTrigger:"chop",kind:"function",parse:"Chop"},{name:"Complex",precedence:Ae-1,serialize:(n,e)=>{let t=n.serialize(b(e,1)),i=z(b(e,2));if(i===0)return t;let r=i===1?"\\imaginaryI":i===-1?"-\\imaginaryI":C([n.serialize(b(e,2)),"\\imaginaryI"]);return z(b(e,1))===0?r:i!==null&&i<0?C([t,r]):C([t,"+",r])}},{name:"Divide",latexTrigger:"\\frac",precedence:Ut,parse:Zb,serialize:Td},{kind:"infix",latexTrigger:"\\over",associativity:"none",precedence:Ut,parse:"Divide"},{latexTrigger:["\\/"],kind:"infix",associativity:"left",precedence:Ut,parse:"Divide"},{latexTrigger:["/"],kind:"infix",associativity:"left",precedence:Ut,parse:"Divide"},{latexTrigger:["\\div"],kind:"infix",associativity:"left",precedence:Ut,parse:"Divide"},{name:"Exp",serialize:(n,e)=>{let t=b(e,1);return M(t)||z(t)!==null?C(["\\exponentialE^{",n.serialize(t),"}"]):C(["\\exp",n.wrap(ne(t))])}},{name:"Factorial",latexTrigger:["!"],kind:"postfix",precedence:$u},{name:"Factorial2",latexTrigger:["!","!"],kind:"postfix",precedence:$u},{name:"Floor",kind:"matchfix",openTrigger:"\\lfloor",closeTrigger:"\\rfloor",parse:(n,e)=>fe(e)?null:["Floor",e]},{kind:"matchfix",openTrigger:["\u230A"],closeTrigger:["\u230B"],parse:(n,e)=>fe(e)?null:["Floor",e]},{symbolTrigger:"floor",kind:"function",parse:"Floor"},{latexTrigger:["\\Gamma"],parse:"Gamma"},{latexTrigger:["\\zeta"],kind:"function",parse:"Zeta"},{latexTrigger:["\\Beta"],kind:"function",parse:"Beta"},{name:"LambertW",latexTrigger:["\\operatorname{W}"],kind:"function",serialize:(n,e)=>"\\operatorname{W}"+n.wrapArguments(e)},{name:"BesselJ",latexTrigger:["\\operatorname{J}"],kind:"function",serialize:(n,e)=>{let t=b(e,1),i=b(e,2);return t!==void 0&&i!==void 0?"\\operatorname{J}_{"+n.serialize(t)+"}"+n.wrapArguments(["BesselJ",i]):"\\operatorname{J}"+n.wrapArguments(e)}},{name:"BesselY",latexTrigger:["\\operatorname{Y}"],kind:"function",serialize:(n,e)=>{let t=b(e,1),i=b(e,2);return t!==void 0&&i!==void 0?"\\operatorname{Y}_{"+n.serialize(t)+"}"+n.wrapArguments(["BesselY",i]):"\\operatorname{Y}"+n.wrapArguments(e)}},{name:"BesselI",latexTrigger:["\\operatorname{I}"],kind:"function",serialize:(n,e)=>{let t=b(e,1),i=b(e,2);return t!==void 0&&i!==void 0?"\\operatorname{I}_{"+n.serialize(t)+"}"+n.wrapArguments(["BesselI",i]):"\\operatorname{I}"+n.wrapArguments(e)}},{name:"BesselK",latexTrigger:["\\operatorname{K}"],kind:"function",serialize:(n,e)=>{let t=b(e,1),i=b(e,2);return t!==void 0&&i!==void 0?"\\operatorname{K}_{"+n.serialize(t)+"}"+n.wrapArguments(["BesselK",i]):"\\operatorname{K}"+n.wrapArguments(e)}},{name:"AiryAi",latexTrigger:["\\operatorname{Ai}"],kind:"function",serialize:(n,e)=>"\\operatorname{Ai}"+n.wrapArguments(e)},{name:"AiryBi",latexTrigger:["\\operatorname{Bi}"],kind:"function",serialize:(n,e)=>"\\operatorname{Bi}"+n.wrapArguments(e)},{name:"GCD",latexTrigger:["\\gcd"],kind:"function"},{symbolTrigger:"gcd",kind:"function",parse:"GCD"},{symbolTrigger:"GCD",kind:"function",parse:"GCD"},{name:"Half",serialize:"\\frac12"},{name:"Lg",latexTrigger:["\\lg"],serialize:(n,e)=>"\\log_{10}"+n.wrapArguments(e),parse:n=>{let e=n.parseArguments("implicit");return e===null?"Lg":["Log",...e,10]}},{name:"Lb",latexTrigger:"\\lb",parse:n=>{let e=n.parseArguments("implicit");return e===null?"Log":["Log",e[0],2]}},{name:"Ln",latexTrigger:["\\ln"],parse:n=>Ad("Ln",n),serialize:(n,e)=>"\\ln"+n.wrapArguments(e)},{name:"Log",latexTrigger:["\\log"],parse:n=>Ad("Log",n),serialize:(n,e)=>{let[t,i]=A(e);return i?C(["\\log_{",n.serialize(i),"}",n.wrap(t)]):"\\log"+n.wrapArguments(e)}},{name:"LCM",latexTrigger:["\\lcm"],kind:"function"},{symbolTrigger:"lcm",kind:"function",parse:"LCM"},{symbolTrigger:"LCM",kind:"function",parse:"LCM"},{symbolTrigger:"max",kind:"function",parse:"Max"},{symbolTrigger:"min",kind:"function",parse:"Min"},{name:"Max",latexTrigger:"\\max",kind:"function"},{name:"Min",latexTrigger:"\\min",kind:"function"},{name:"Supremum",latexTrigger:"\\sup",kind:"function"},{name:"Infimum",latexTrigger:"\\inf",kind:"function"},{name:"Limit",latexTrigger:"\\lim",kind:"expression",parse:n=>{if(!n.match("_"))return null;let e=n.parseGroup();if(S(e)!=="To")return null;let t=n.parseArguments("implicit");return t?["Limit",["Function",t[0],b(e,1)],b(e,2)]:null},serialize:(n,e)=>{let t=b(e,1),i=b(t,2),r=b(e,2);return C(["\\lim_{",n.serialize(i),"\\to",n.serialize(r),"}",n.serialize(b(t,1))])}},{name:"MinusPlus",latexTrigger:["\\mp"],kind:"infix",associativity:"any",precedence:jt},{name:"Multiply",latexTrigger:["\\times"],kind:"infix",associativity:"any",precedence:wn,serialize:kd},{latexTrigger:["\\cdot"],kind:"infix",associativity:"any",precedence:wn,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:wn+2});return i===null?null:kr("Multiply",e,i)}},{latexTrigger:["*"],kind:"infix",associativity:"any",precedence:wn,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:wn+2});return i===null?["Multiply",e,Bo]:kr("Multiply",e,i)}},{name:"Mod",latexTrigger:"\\bmod",kind:"infix",precedence:Ut,serialize:(n,e)=>{if(de(e)!==2)return"";let t=n.serialize(b(e,1)),i=n.serialize(b(e,2));return C([t,"\\bmod",i])}},{latexTrigger:"\\mod",kind:"infix",precedence:Ut,parse:"Mod"},{latexTrigger:"\\pmod",kind:"prefix",precedence:W,parse:n=>{let e=n.parseGroup()??n.parseToken();return["Mod",ne(e)]}},{name:"Congruent",serialize:(n,e)=>{let t=n.serialize(b(e,1)),i=n.serialize(b(e,2));if(b(e,3)===null)return C([t,"\\equiv",i]);let r=n.serialize(b(e,3));return C([t,"\\equiv",i,"\\pmod{",r,"}"])}},{name:"Negate",latexTrigger:["-"],kind:"prefix",precedence:Vu+1,parse:(n,e)=>{n.skipSpace();let t=n.parseExpression({...e,minPrec:Vu+3});return t===null?null:["Negate",t]}},{kind:"matchfix",openTrigger:"||",closeTrigger:"||",parse:(n,e)=>fe(e)?null:["Norm",e]},{name:"Norm",kind:"matchfix",openTrigger:["\\left","\\Vert"],closeTrigger:["\\right","\\Vert"],parse:(n,e)=>fe(e)?null:["Norm",e]},{name:"PlusMinus",latexTrigger:["\\pm"],kind:"infix",associativity:"any",precedence:jt,serialize:(n,e)=>{let t=b(e,1);if(t===null)return"\\pm";if(de(e)===1)return C(["\\pm",n.serialize(t)]);let i=b(e,2);return C([n.serialize(t),"\\pm",n.serialize(i)])}},{latexTrigger:["\\pm"],kind:"prefix",precedence:jt,parse:(n,e)=>{let t=n.parseExpression({...e,minPrec:400});return["PlusMinus",0,ne(t)]}},{latexTrigger:["\\plusmn"],kind:"infix",associativity:"any",precedence:jt,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:400});return["PlusMinus",e,ne(i)]}},{latexTrigger:["\\plusmn"],kind:"prefix",precedence:jt,parse:(n,e)=>{let t=n.parseExpression({...e,minPrec:400});return["PlusMinus",ne(t)]}},{name:"Power",latexTrigger:["^"],kind:"infix",serialize:zu},{latexTrigger:"\\prod",precedence:wn,name:"Product",parse:Id("Product","Multiply",wn),serialize:wd("\\prod")},{name:"Rational",precedence:Ut,serialize:(n,e)=>e&&de(e)===1?"\\operatorname{Rational}"+n.wrapArguments(e):Td(n,e)},{name:"Reduce",serialize:(n,e)=>{let t=b(e,1);if(!t)return"";let i=b(e,2);return M(i)==="Add"?`\\sum ${n.serialize(t)}`:M(i)==="Multiply"?`\\prod ${n.serialize(t)}`:`\\operatorname{Reduce}\\left(${n.serialize(t)}, ${n.serialize(b(e,2))}\\right)`}},{name:"Root",serialize:zu},{name:"Round",symbolTrigger:"round",kind:"function"},{name:"Square",precedence:720,serialize:(n,e)=>{let t=n.wrapShort(b(e,1));return(t.startsWith("-")?n.wrapString(t,"normal"):t)+"^2"}},{latexTrigger:["\\sum"],precedence:Ae,name:"Sum",parse:Id("Sum","Add",wn),serialize:wd("\\sum")},{name:"Sign",symbolTrigger:"sgn",kind:"function"},{name:"Sqrt",latexTrigger:["\\sqrt"],parse:Gb,serialize:zu},{name:"Subtract",latexTrigger:["-"],kind:"infix",associativity:"left",precedence:Ae+2,parse:(n,e,t)=>{n.index-=1;let i=n.parseExpression({...t,minPrec:Ae+3});return i===null?null:["Add",e,i]},serialize:(n,e)=>{let t=n.wrap(b(e,1),Ae+2),i=n.wrap(b(e,2),Ae+3);return C([t,"-",i])}}];function Hb(n,e){if(n!==null){if(M(n))return{index:M(n)??"Nothing",upper:e};if(S(n)==="GreaterEqual"){let t=M(b(n,1))??"Nothing",i=b(n,2)??1;return{index:t,lower:i,upper:e}}if(S(n)==="Equal"){let t=M(b(n,1))??"Nothing",i=b(n,2);if(S(i)==="Range"){let o=b(i,1)??1,s=b(i,2)??void 0;return{index:t,lower:o,upper:s}}return{index:t,lower:i??1,upper:e}}if(S(n)==="Element")return{index:M(b(n,1))??"Nothing",element:n}}}function Wb(n){let e=S(n);return e?new Set(["Less","LessEqual","Greater","GreaterEqual","NotEqual","And","Or","Not"]).has(e):!1}function Sd(n){if(n===null)return[];let e=bi(n);if(e)return[...e];if(S(n)==="Tuple"){let t=A(n);return t?[...t]:[n]}return[n]}function Jb(n,e){fe(n)&&(n=null),fe(e)&&(e=null);let t=Sd(n),i=Sd(e),r=[],o=0;for(;o<t.length;){let s=t[o],a=Hb(s,i[o]);if(a){if(a.element&&o+1<t.length){let u=t[o+1];if(Wb(u)&&S(u)!=="Element"&&S(u)!=="Equal"){let l=a.element;if(Array.isArray(l)&&l.length>=3){let c=[l[0],...l.slice(1),u];a.element=c}o++}}r.push(a)}o++}return r}function Id(n,e,t){return i=>{i.skipSpace(),i.pushSymbolTable();let r=null,o=null;for(;!(o&&r)&&(i.peek==="_"||i.peek==="^");)i.match("_")?o=i.parseGroup()??i.parseToken():i.match("^")&&(r=i.parseGroup()??i.parseToken()),i.skipSpace();if(!r&&!o){let l=i.parseExpression({minPrec:t});return i.popSymbolTable(),l?["Reduce",l,e]:null}let s=Jb(o,r),a=i.parseExpression({minPrec:t});if(i.popSymbolTable(),a===null)return[n];let u=[];for(let l of s){if(l.element){u.push(l.element);continue}let c=l.lower,f=l.upper,p=l.index??"Nothing";f!=null?u.push(["Tuple",p,c??1,f]):c!=null?u.push(["Tuple",p,c]):u.push(["Tuple",p])}return[n,a,...u]}}var Yb=new Set(["Tuple","Triple","Pair","Single","Limits","Element"]);function Bd(n){return n==null||M(n)==="Nothing"?null:n}function Qb(n){let e=[],t=A(n);if(t.length<=1)return e;for(let i of t.slice(1)){let r=S(i);if(r&&Yb.has(r)){e.push(i);continue}break}return e}function Xb(n,e){if(S(e)==="Element"){let l=n.serialize(b(e,1)),c=n.serialize(b(e,2));return{sub:`${l}\\in ${c}`}}let t=b(e,1);t!==null&&S(t)==="Hold"&&(t=b(t,1));let i=Bd(b(e,2)),r=Bd(b(e,3)),o={},s=t?M(t):null,a=s!==null&&s!=="Nothing",u=a&&t?n.serialize(t):void 0;return a&&i!==null&&u?o.sub=`${u}=${n.serialize(i)}`:a&&u?o.sub=u:i!==null&&(o.sub=n.serialize(i)),r!==null&&(o.sup=n.serialize(r)),o}function wd(n){return(e,t)=>{let i=b(t,1);if(!i)return n;let r=Qb(t),o=n;if(r.length>0){let s=[],a=[];for(let u of r){let l=Xb(e,u);l.sub&&s.push(l.sub),l.sup&&a.push(l.sup)}s.length>0&&(o=Ei("_",o,s.join(", "))),a.length>0&&(o=Ei("^",o,a.join(", ")))}return C([o,e.serialize(i)])}}function Ad(n,e){let t=null;e.match("_")&&(t=e.parseGroup()??e.parseToken());let i=e.parseArguments("implicit");return i===null&&t===null?[n]:i===null?[n,t]:t===null?[n,...i]:t===10?["Log",i[0]]:t===2?["Lb",...i]:["Log",i[0],t]}function Ro(n){let e=1,t=n;do{n=t;let i=S(n);if(i==="Negate")e*=-1,t=b(n,1);else if(i==="Multiply"){let[r,o]=Ro(b(n,1));o<0&&(e*=-1,r===1?t=["Multiply",...A(n).slice(1)]:t=["Multiply",r,...A(n).slice(1)])}else if(i==="Divide"||i==="Rational"){let[r,o]=Ro(b(n,1));o<0&&(e*=-1,t=[i,r,b(n,2)])}else{let r=z(n);r!==null&&r<0&&(e*=-1,t=-r)}}while(t!==n);return[n,e]}ia();na();Ye();Gn();ia();var Pd=[{name:"Matrix",serialize:(n,e)=>{let t=A(b(e,1));return Dd(n,t,se(b(e,2)),se(b(e,3)))}},{name:"Vector",serialize:(n,e)=>{let t=A(e);return Dd(n,t.map(i=>["List",i]),se(b(e,2)),se(b(e,3)))}},{kind:"environment",symbolTrigger:"pmatrix",parse:n=>{let e=Wt(n),[t,i]=Ht(n);return e?[t,i,{str:"()"},{str:e}]:[t,i]}},{kind:"environment",symbolTrigger:"bmatrix",parse:n=>{let e=Wt(n),[t,i]=Ht(n);return e?[t,i,{str:"[]"},{str:e}]:[t,i,{str:"[]"}]}},{kind:"environment",symbolTrigger:"Bmatrix",parse:n=>{let e=Wt(n),[t,i]=Ht(n);return e?[t,i,{str:"{}"},{str:e}]:[t,i,{str:"{}"}]}},{kind:"environment",symbolTrigger:"vmatrix",parse:n=>{let e=Wt(n),[t,i]=Ht(n);return e?[t,i,{str:"||"},{str:e}]:[t,i,{str:"||"}]}},{kind:"environment",symbolTrigger:"Vmatrix",parse:n=>{let e=Wt(n),[t,i]=Ht(n);return e?[t,i,{str:"\u2016\u2016"},{str:e}]:[t,i,{str:"\u2016\u2016"}]}},{kind:"environment",symbolTrigger:"smallmatrix",parse:n=>{let e=Wt(n),[t,i]=Ht(n);return e?[t,i,{str:"()"},{str:e}]:[t,i]}},{kind:"environment",symbolTrigger:"array",parse:n=>{let e=Wt(n,!1),[t,i]=Ht(n);return e?[t,i,{str:".."},{str:e}]:[t,i,{str:".."}]}},{kind:"environment",symbolTrigger:"matrix",parse:n=>{let e=Wt(n),[t,i]=Ht(n);return e?[t,i,{str:".."},{str:e}]:[t,i,{str:".."}]}},{kind:"environment",symbolTrigger:"matrix*",parse:n=>{let e=Wt(n),[t,i]=Ht(n);return e?[t,i,{str:".."},{str:e}]:[t,i,{str:".."}]}},{name:"ConjugateTranspose",kind:"postfix",latexTrigger:["^","\\star"]},{kind:"postfix",latexTrigger:["^","\\H"],parse:"ConjugateTranspose"},{kind:"postfix",latexTrigger:["^","\\dagger"],parse:(n,e)=>["ConjugateTranspose",e]},{kind:"postfix",latexTrigger:["^","\\ast"],parse:(n,e)=>["ConjugateTranspose",e]},{kind:"postfix",latexTrigger:["^","\\top"],parse:(n,e)=>["Transpose",e]},{kind:"postfix",latexTrigger:["^","\\intercal"],parse:(n,e)=>["Transpose",e]},{name:"Transpose",kind:"postfix",latexTrigger:["^","T"]},{name:"PseudoInverse",kind:"postfix",latexTrigger:["^","+"]},{name:"Trace",kind:"function",symbolTrigger:"tr"},{name:"Determinant",kind:"function",symbolTrigger:"det"},{name:"MatrixMultiply",serialize:(n,e)=>{let t=n.serialize(b(e,1)),i=n.serialize(b(e,2));return`${t} \\cdot ${i}`}}];function Ht(n){let e=n.parseTabular();return e?["Matrix",["List",...e.map(t=>["List",...t])]]:["",null]}function Wt(n,e=!0){let t=n.parseStringGroup(e)?.trim();if(!t)return"";let i="";for(let r of t)r==="c"&&(i+="="),r==="l"&&(i+="<"),r==="r"&&(i+=">"),r==="|"&&(i+="|"),r===":"&&(i+=":");return i}function Dd(n,e,t,i){t??="()";let[r,o]=["",""];typeof t=="string"&&t.length===2&&([r,o]=t);let s="";if(i)for(let c of i)c==="<"?s+="l":c===">"?s+="r":c==="="?s+="c":c==="|"?s+="|":c===":"&&(s+=":");let a=[];for(let c of e??[]){let f=[];for(let p of A(c))f.push(n.serialize(p));a.push(f.join(" & "))}let u=a.join(`\\\\
`),l=s.length>0?`[${s}]`:"";return r==="("&&o===")"?C(["\\begin{pmatrix}",l,u,"\\end{pmatrix}"]):r==="["&&o==="]"?C(["\\begin{bmatrix}",l,u,"\\end{bmatrix}"]):r==="{"&&o==="}"?C(["\\begin{Bmatrix}",l,u,"\\end{Bmatrix}"]):r==="|"&&o==="|"?C(["\\begin{vmatrix}",l,u,"\\end{vmatrix}"]):r==="\u2016"&&o==="\u2016"?C(["\\begin{Vmatrix}",l,u,"\\end{Vmatrix}"]):r==="{"&&o==="."?C(["\\begin{dcases}",l,u,"\\end{dcases}"]):r==="."&&o==="}"?C(["\\begin{rcases}",l,u,"\\end{rcases}"]):s||r!=="."||o!=="."?C(["\\left",Dr[r]??r,"\\begin{array}",`{${s}}`,u,"\\end{array}","\\right",Dr[o]??o]):C(["\\begin{matrix}",u,"\\end{matrix}"])}Ye();na();var Ld=[{name:"True",kind:"symbol",latexTrigger:["\\top"]},{kind:"symbol",latexTrigger:"\\mathrm{True}",parse:"True"},{kind:"symbol",latexTrigger:"\\operatorname{True}",parse:"True"},{kind:"symbol",latexTrigger:"\\mathsf{T}",parse:"True"},{name:"False",kind:"symbol",latexTrigger:["\\bot"]},{kind:"symbol",latexTrigger:"\\operatorname{False}",parse:"False"},{kind:"symbol",latexTrigger:"\\mathsf{F}",parse:"False"},{name:"And",kind:"infix",latexTrigger:["\\land"],precedence:235},{kind:"infix",latexTrigger:["\\wedge"],parse:"And",precedence:235},{kind:"infix",latexTrigger:"\\&",parse:"And",precedence:235},{kind:"infix",latexTrigger:"\\operatorname{and}",parse:"And",precedence:235},{name:"Or",kind:"infix",latexTrigger:["\\lor"],precedence:230},{kind:"infix",latexTrigger:["\\vee"],parse:"Or",precedence:230},{kind:"infix",latexTrigger:"\\parallel",parse:"Or",precedence:230},{kind:"infix",latexTrigger:"\\operatorname{or}",parse:"Or",precedence:230},{name:"Xor",kind:"infix",latexTrigger:["\\veebar"],precedence:232},{name:"Not",kind:"prefix",latexTrigger:["\\lnot"],precedence:880},{kind:"prefix",latexTrigger:["\\neg"],parse:"Not",precedence:880},{name:"Nand",kind:"infix",latexTrigger:["\\barwedge"],precedence:232},{name:"Nor",kind:"infix",latexTrigger:["\u22BD"],precedence:232},{kind:"function",symbolTrigger:"and",parse:"And"},{kind:"function",symbolTrigger:"or",parse:"Or"},{kind:"function",symbolTrigger:"not",parse:"Not"},{name:"Implies",kind:"infix",precedence:220,associativity:"right",latexTrigger:["\\implies"],serialize:"\\implies"},{latexTrigger:["\\Rightarrow"],kind:"infix",precedence:220,associativity:"right",parse:"Implies"},{latexTrigger:["\\rightarrow"],kind:"infix",precedence:220,associativity:"right",parse:"Implies"},{latexTrigger:["\\Longrightarrow"],kind:"infix",precedence:220,associativity:"right",parse:"Implies"},{latexTrigger:["\\longrightarrow"],kind:"infix",precedence:220,associativity:"right",parse:"Implies"},{name:"Equivalent",latexTrigger:["\\iff"],kind:"infix",associativity:"right",precedence:219},{latexTrigger:["\\Leftrightarrow"],kind:"infix",associativity:"right",precedence:219,parse:"Equivalent"},{latexTrigger:["\\leftrightarrow"],kind:"infix",associativity:"right",precedence:219,parse:"Equivalent"},{latexTrigger:["\\Longleftrightarrow"],kind:"infix",associativity:"right",precedence:219,parse:"Equivalent"},{latexTrigger:["\\longleftrightarrow"],kind:"infix",associativity:"right",precedence:219,parse:"Equivalent"},{latexTrigger:["\\equiv"],kind:"infix",associativity:"right",precedence:219,parse:(n,e,t)=>{let i=n.parseExpression({...t,minPrec:219}),r=n.index,o=n.parseExpression({...t,minPrec:219});return o!==null&&S(o)==="Mod"?["Congruent",e,i,ne(b(o,1))]:(n.index=r,["Equivalent",e,ne(i)])}},{name:"Proves",kind:"infix",latexTrigger:["\\vdash"],precedence:220,associativity:"right",serialize:"\\vdash"},{name:"Entails",kind:"infix",latexTrigger:["\\vDash"],precedence:220,associativity:"right",serialize:"\\vDash"},{name:"Satisfies",kind:"infix",latexTrigger:["\\models"],precedence:220,associativity:"right",serialize:"\\models"},{name:"ForAll",kind:"prefix",latexTrigger:["\\forall"],precedence:200,serialize:Mo("\\forall"),parse:Do("ForAll")},{name:"Exists",kind:"prefix",latexTrigger:["\\exists"],precedence:200,serialize:Mo("\\exists"),parse:Do("Exists")},{name:"ExistsUnique",kind:"prefix",latexTrigger:["\\exists","!"],precedence:200,serialize:Mo("\\exists!"),parse:Do("ExistsUnique")},{name:"NotForAll",kind:"prefix",latexTrigger:["\\lnot","\\forall"],precedence:200,serialize:Mo("\\lnot\\forall"),parse:Do("NotForAll")},{name:"NotExists",kind:"prefix",latexTrigger:["\\lnot","\\exists"],precedence:200,serialize:Mo("\\lnot\\exists"),parse:Do("NotExists")},{name:"KroneckerDelta",kind:"prefix",latexTrigger:["\\delta","_"],precedence:200,serialize:(n,e)=>{let t=A(e);return t.length===0?"\\delta":t.every(i=>M(i))?`\\delta_{${t.map(i=>n.serialize(i)).join("")}}`:`\\delta_{${t.map(i=>n.serialize(i)).join(", ")}}`},parse:n=>{let e=n.parseGroup();if(e===null){let i=n.parseToken();return i?["KroneckerDelta",i]:null}let t=bi(e);return t&&t.length<=2?["KroneckerDelta",...t]:S(e)==="InvisibleOperator"?["KroneckerDelta",...A(e)]:e!==null?["KroneckerDelta",e]:null}},{name:"Boole",kind:"matchfix",openTrigger:"[",closeTrigger:"]",parse:(n,e)=>{let t=S(e);return!t||!Ui.some(i=>i.name===t)?null:["Boole",e]}},{kind:"matchfix",openTrigger:"\\llbracket",closeTrigger:"\\rrbracket",parse:(n,e)=>{let t=S(e);return!t||!Ui.some(i=>i.name===t)?null:["Boole",e]}},{name:"Predicate",serialize:(n,e)=>{let t=A(e);if(t.length===0)return"";let i=t[0],r=typeof i=="string"?i:n.serialize(i);if(t.length===1)return r;let o=t.slice(1).map(s=>n.serialize(s));return`${r}(${o.join(", ")})`}}];function Mo(n){return(e,t)=>{let i=A(t);if(i.length===0)return n;if(i.length===1)return`${n} ${e.serialize(i[0])}`;let r=e.serialize(i[0]),o=e.serialize(i[1]);return`${n} ${r}, ${o}`}}function Od(n,e){return n.peek==="\\to"||n.peek==="\\rightarrow"||n.peek==="\\implies"||n.peek==="\\Rightarrow"||n.peek==="\\iff"||n.peek==="\\Leftrightarrow"||n.peek==="\\land"||n.peek==="\\wedge"||n.peek==="\\lor"||n.peek==="\\vee"||(e.condition?.(n)??!1)}function Do(n){return(e,t)=>{let i=e.index,r=e.options.quantifierScope!=="loose",o=e.parseSymbol(t);if(o){if(e.skipSpace(),e.match(",")||e.match("\\mid")||e.match(".")||e.match(":")||e.match("\\colon")){let u=r?{...t,condition:c=>Od(c,t)}:t;e.enterQuantifierScope();let l=e.parseExpression(u);return e.exitQuantifierScope(),[n,o,ne(l)]}e.enterQuantifierScope();let a=e.parseEnclosure();if(e.exitQuantifierScope(),a)return[n,o,ne(a)]}e.index=i;let s=e.parseExpression(t);if(s===null)return null;if(e.skipSpace(),e.matchAny([",","\\mid",":","\\colon"])){let a=r?{...t,condition:l=>Od(l,t)}:t;e.enterQuantifierScope();let u=e.parseExpression(a);return e.exitQuantifierScope(),[n,s,ne(u)]}if(e.match("(")){e.enterQuantifierScope();let a=e.parseExpression(t);return e.exitQuantifierScope(),e.match(")")?[n,s,ne(a)]:null}return null}}Ye();Gn();function An(n){return e=>{let t=e.parseGroup();return t===null?[n]:[n,t]}}var qd=[{name:"Overscript",latexTrigger:["\\overset"],kind:"infix",precedence:700},{name:"Underscript",latexTrigger:["\\underset"],kind:"infix",precedence:700},{name:"Increment",latexTrigger:["+","+"],kind:"postfix",precedence:880,parse:(n,e)=>M(e)===null?null:["Increment",e]},{name:"Decrement",latexTrigger:["-","-"],kind:"postfix",precedence:880,parse:(n,e)=>M(e)===null?null:["Decrement",e]},{name:"PreIncrement",latexTrigger:["+","+"],kind:"prefix",precedence:880,parse:(n,e)=>{let t=n.parseExpression(e);return M(t)===null?null:["PreIncrement",t]}},{name:"PreDecrement",latexTrigger:["-","-"],kind:"prefix",precedence:880,parse:(n,e)=>{let t=n.parseExpression(e);return M(t)===null?null:["PreDecrement",t]}},{name:"Ring",latexTrigger:["\\circ"],kind:"infix",precedence:265},{name:"StringJoin",latexTrigger:["\\lt","\\gt"],kind:"infix",precedence:780},{name:"Starstar",latexTrigger:["\\star","\\star"],kind:"infix",precedence:780},{name:"PartialDerivative",latexTrigger:["\\partial"],kind:"prefix",parse:n=>{let e=!1,t="Nothing",i="Nothing";for(;!e;)n.skipSpace(),n.match("_")?i=n.parseGroup()??n.parseToken():n.match("^")?t=n.parseGroup()??n.parseToken():e=!0;let r=bi(i);if(r&&(i=["List",...r]),i===null||t===null)return null;let o=n.parseGroup()??"Nothing";if(!fe(o)){let s=n.parseArguments()??["Nothing"];o=[o,...s]}return["PartialDerivative",o,i,t]},serialize:(n,e)=>{let t="\\partial",i=b(e,1),r=b(e,2),o=b(e,3);return r!==null&&r!=="Nothing"&&(S(r)==="List"?t+="_{"+n.serialize(["Sequence",...A(r)])+"}":t+="_{"+n.serialize(r)+"}"),o!==null&&o!=="Nothing"&&(t+="^{"+n.serialize(o)+"}"),i!==null&&i!=="Nothing"&&(t+=n.serialize(i)),t},precedence:740},{name:"OverBar",latexTrigger:["\\overline"],parse:An("OverBar")},{name:"UnderBar",latexTrigger:["\\underline"],parse:An("UnderBar")},{name:"OverVector",latexTrigger:["\\vec"],parse:An("OverVector")},{name:"OverTilde",latexTrigger:["\\tilde"],parse:An("OverTilde")},{name:"OverHat",latexTrigger:["\\hat"],parse:An("OverHat")},{name:"OverRightArrow",latexTrigger:["\\overrightarrow"],parse:An("OverRightArrow")},{name:"OverLeftArrow",latexTrigger:["\\overleftarrow"],parse:An("OverLeftArrow")},{name:"OverRightDoubleArrow",latexTrigger:["\\Overrightarrow"],parse:An("OverRightDoubleArrow")},{name:"OverLeftHarpoon",latexTrigger:["\\overleftharpoon"],parse:An("OverLeftHarpoon")},{name:"OverRightHarpoon",latexTrigger:["\\overrightharpoon"],parse:An("OverRightHarpoon")},{name:"OverLeftRightArrow",latexTrigger:["\\overleftrightarrow"],parse:An("OverLeftRightArrow")},{name:"OverBrace",latexTrigger:["\\overbrace"],parse:An("OverBrace")},{name:"OverLineSegment",latexTrigger:["\\overlinesegment"],parse:An("OverLineSegment")},{name:"OverGroup",latexTrigger:["\\overgroup"],parse:An("OverGroup")},{latexTrigger:["\\textcolor"],parse:n=>{let e=n.index,t=n.parseStringGroup(),i=n.parseGroup();return t!==null?i!==null?["Annotated",i,{dict:{color:t}}]:"Nothing":(n.index=e,"Nothing")}},{latexTrigger:["\\displaystyle"],parse:()=>"Nothing"},{latexTrigger:["\\textstyle"],parse:()=>"Nothing"},{latexTrigger:["\\scriptstyle"],parse:()=>"Nothing"},{latexTrigger:["\\scriptscriptstyle"],parse:()=>"Nothing"},{latexTrigger:["\\tiny"],parse:()=>"Nothing"},{latexTrigger:["\\scriptsize"],parse:()=>"Nothing"},{latexTrigger:["\\footnotesize"],parse:()=>"Nothing"},{latexTrigger:["\\small"],parse:()=>"Nothing"},{latexTrigger:["\\normalsize"],parse:()=>"Nothing"},{latexTrigger:["\\large"],parse:()=>"Nothing"},{latexTrigger:["\\Large"],parse:()=>"Nothing"},{latexTrigger:["\\LARGE"],parse:()=>"Nothing"},{latexTrigger:["\\huge"],parse:()=>"Nothing"},{latexTrigger:["\\Huge"],parse:()=>"Nothing"},{name:"Annotated",serialize:(n,e)=>{let t=n.serialize(b(e,1)),i=Ou(b(e,2));if(i==null)return t;i.dict.mathStyle==="normal"?t=C(["{\\displaystyle",t,"}"]):i.dict.mathStyle==="compact"&&(t=C(["{\\textstyle",t,"}"]));let r=i.dict.size;return r!==null&&r>=1&&r<=10&&(t=C(["{",{1:"\\tiny",2:"\\scriptsize",3:"\\footnotesize",4:"\\small",5:"\\normalsize",6:"\\large",7:"\\Large",8:"\\LARGE",9:"\\huge",10:"\\Huge"}[r],t,"}"])),t}},{latexTrigger:["\\!"],parse:()=>["HorizontalSpacing",-3]},{latexTrigger:["\\ "],parse:()=>["HorizontalSpacing",6]},{latexTrigger:["\\:"],parse:()=>["HorizontalSpacing",4]},{latexTrigger:["\\enskip"],parse:()=>["HorizontalSpacing",9]},{latexTrigger:["\\quad"],parse:()=>["HorizontalSpacing",18]},{latexTrigger:["\\qquad"],parse:()=>["HorizontalSpacing",36]},{latexTrigger:["\\,"],parse:()=>["HorizontalSpacing",3]},{latexTrigger:["\\;"],parse:()=>["HorizontalSpacing",5]},{latexTrigger:["\\enspace"],parse:()=>["HorizontalSpacing",9]},{latexTrigger:["\\phantom"],parse:n=>(n.parseGroup(),"Nothing")},{latexTrigger:["\\vphantom"],parse:n=>(n.parseGroup(),"Nothing")},{latexTrigger:["\\hphantom"],parse:n=>(n.parseGroup(),"Nothing")},{latexTrigger:["\\placeholder"],parse:n=>(n.parseOptionalGroup(),n.parseGroup()??"Nothing")},{latexTrigger:["\\smash"],parse:n=>(n.parseGroup(),"Nothing")},{latexTrigger:["\\strut"],parse:n=>"Nothing"},{latexTrigger:["\\mathstrut"],parse:n=>"Nothing"},{name:"HorizontalSpacing",serialize:(n,e)=>{if(b(e,2)!==null)return n.serialize(b(e,1));let t=z(b(e,1));return t===null?"":{"-3":"\\!",6:"\\ ",3:"\\,",4:"\\:",5:"\\;",9:"\\enspace",18:"\\quad",36:"\\qquad"}[t]??""}}];Gt();function P(n){return(e,t)=>{let i={"\\arcsin":"Arcsin","\\arccos":"Arccos","\\arctan":"Arctan","\\arctg":"Arctan","\\arcctg":"Arccot","\\arcsec":"Arcsec","\\arccsc":"Arccsc","\\arsinh":"Arsinh","\\arcsinh":"Arsinh","\\arcosh":"Arcosh","\\arccosh":"Arcosh","\\artanh":"Artanh","\\arctanh":"Artanh","\\arsech":"Arsech","\\arcsech":"Arsech","\\arcsch":"Arcsch","\\arccsch":"Arcsch","\\arcoth":"Arcoth","\\arccoth":"Arcoth","\\ch":"Cosh","\\cos":"Cos","\\cosh":"Cosh","\\cosec":"Csc","\\cot":"Cot","\\cotg":"Cot","\\ctg":"Cot","\\csc":"Csc","\\csch":"Csch","\\coth":"Coth","\\cth":"Coth","\\sec":"Sec","\\sech":"Sech","\\sin":"Sin","\\sinh":"Sinh","\\sh":"Sinh","\\tan":"Tan","\\tg":"Tan","\\tanh":"Tanh","\\th":"Tanh"},r=i[n??""]??n??"";if(e.atTerminator(t))return r;let o=r;do{let l=e.parsePostfixOperator(o,t);if(l===null)break;o=l}while(!0);e.skipSpace();let s=null;e.match("^")&&(s=e.parseGroup()??e.parseToken()),e.skipSpace();let a=e.parseArguments("implicit",{minPrec:wn,condition:l=>i[l.peek]||(t?.condition?.(l)??!1)}),u=a===null?o:typeof o=="string"?[o,...a]:["Apply",o,...a];return s===null?u:["Power",u,s]}}var Fd=[{name:"Arcsin",latexTrigger:["\\arcsin"],parse:P("Arcsin")},{name:"Arccos",latexTrigger:["\\arccos"],parse:P("Arccos")},{name:"Arctan",latexTrigger:["\\arctan"],parse:P("Arctan")},{latexTrigger:["\\arctg"],parse:P("Arctan")},{symbolTrigger:"arctg",parse:P("Arctan")},{name:"Arccot",symbolTrigger:"arcctg",parse:P("Arccot")},{latexTrigger:["\\arcctg"],parse:P("Arccot")},{name:"Arcoth",symbolTrigger:"arcoth",parse:P("Arcoth")},{symbolTrigger:"arccoth",parse:P("Arcoth")},{latexTrigger:["\\arcoth"],parse:P("Arcoth")},{latexTrigger:["\\arccoth"],parse:P("Arcoth")},{name:"Arcsec",symbolTrigger:"arcsec",parse:P("Arcsec")},{latexTrigger:["\\arcsec"],parse:P("Arcsec")},{name:"Arccsc",symbolTrigger:"arccsc",parse:P("Arccsc")},{latexTrigger:["\\arccsc"],parse:P("Arccsc")},{name:"Arsinh",symbolTrigger:"arsinh",parse:P("Arsinh")},{symbolTrigger:"arcsinh",parse:P("Arsinh")},{latexTrigger:["\\arsinh"],parse:P("Arsinh")},{latexTrigger:["\\arcsinh"],parse:P("Arsinh")},{name:"Arcosh",symbolTrigger:"arcosh",parse:P("Arcosh")},{symbolTrigger:"arccosh",parse:P("Arcosh")},{latexTrigger:"\\arcosh",parse:P("Arcosh")},{latexTrigger:"\\arccosh",parse:P("Arcosh")},{name:"Artanh",symbolTrigger:"artanh",parse:P("Artanh")},{symbolTrigger:"arctanh",parse:P("Artanh")},{latexTrigger:"\\artanh",parse:P("Artanh")},{latexTrigger:["\\arctanh"],parse:P("Artanh")},{name:"Arsech",symbolTrigger:"arsech",parse:P("Arsech")},{symbolTrigger:"arcsech",parse:P("Arsech")},{latexTrigger:["\\arsech"],parse:P("Arsech")},{latexTrigger:["\\arcsech"],parse:P("Arsech")},{name:"Arcsch",symbolTrigger:"arcsch",parse:P("Arcsch")},{symbolTrigger:"arccsch",parse:P("Arcsch")},{latexTrigger:["\\arcsch"],parse:P("Arcsch")},{latexTrigger:["\\arccsch"],parse:P("Arcsch")},{name:"Cosec",symbolTrigger:"cosec",parse:P("Cosec")},{latexTrigger:["\\cosec"],parse:P("Cosec")},{name:"Cosh",latexTrigger:["\\cosh"],parse:P("Cosh")},{latexTrigger:["\\ch"],parse:P("Cosh")},{name:"Cot",latexTrigger:["\\cot"],parse:P("Cot")},{latexTrigger:["\\cotg"],parse:P("Cot")},{latexTrigger:["\\ctg"],parse:P("Cot")},{name:"Csc",latexTrigger:["\\csc"],parse:P("Csc")},{name:"Csch",latexTrigger:["\\csch"],parse:P("Csch")},{name:"Coth",latexTrigger:["\\coth"],parse:P("Coth")},{latexTrigger:["\\cth"],parse:P("Coth")},{symbolTrigger:"cth",parse:P("Coth")},{latexTrigger:["\\coth"],parse:P("Coth")},{name:"Sec",latexTrigger:["\\sec"],parse:P("Sec")},{name:"Sech",symbolTrigger:"sech",parse:P("Sech")},{latexTrigger:["\\sech"],parse:P("Sech")},{name:"Sinh",latexTrigger:["\\sinh"],parse:P("Sinh")},{latexTrigger:["\\sh"],parse:P("Sinh")},{name:"Tan",latexTrigger:["\\tan"],parse:P("Tan")},{latexTrigger:["\\tg"],parse:P("Tan")},{name:"Tanh",latexTrigger:["\\tanh"],parse:P("Tanh")},{latexTrigger:["\\th"],parse:P("Tanh")},{name:"Cos",latexTrigger:["\\cos"],parse:P("Cos")},{name:"Sin",latexTrigger:["\\sin"],parse:P("Sin")}];Ye();Gn();Gt();function _t(n,e,t){if(fe(n))return null;let i,r=S(n);if(r==="Delimiter"){let l=se(b(n,2));if(l!==","&&l!=="(,)"&&l!=="[,]")return null;let c=b(n,1);S(c)==="Sequence"?i=[...A(c)]:i=c?[c]:[]}else if(r==="Sequence")i=[...A(n)];else return null;if(i.length!==2)return null;let[o,s]=i;return["Interval",e?["Open",o]:o,t?["Open",s]:s]}var $d=[{name:"AlgebraicNumbers",latexTrigger:"\\overline\\Q"},{latexTrigger:"\\bar\\Q",parse:"AlgebraicNumbers"},{name:"ComplexNumbers",latexTrigger:["\\C"]},{latexTrigger:"\\mathbb{C}",parse:"ComplexNumbers"},{name:"ImaginaryNumbers",latexTrigger:["\\imaginaryI","\\R"]},{name:"EmptySet",latexTrigger:["\\emptyset"]},{latexTrigger:["\\varnothing"],parse:"EmptySet"},{name:"Integers",latexTrigger:["\\Z"]},{latexTrigger:"\\mathbb{Z}",parse:"Integers"},{name:"RationalNumbers",latexTrigger:["\\Q"]},{latexTrigger:"\\mathbb{Q}",parse:"RationalNumbers"},{name:"RealNumbers",latexTrigger:["\\R"]},{latexTrigger:"\\mathbb{R}",parse:"RealNumbers"},{name:"TranscendentalNumbers",latexTrigger:"\\R-\\bar\\Q"},{latexTrigger:"\\R\\backslash\\bar\\Q",parse:"TranscendentalNumbers"},{name:"NegativeNumbers",latexTrigger:"\\R_{<0}"},{latexTrigger:"\\R^-",parse:"NegativeNumbers"},{latexTrigger:"\\R^{-}",parse:"NegativeNumbers"},{latexTrigger:"\\R^-",parse:"NegativeNumbers"},{latexTrigger:"\\R_-",parse:"NegativeNumbers"},{latexTrigger:"\\R_{-}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{\\lt}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{<}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{\\lt0}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{<0}",parse:"NegativeNumbers"},{name:"NonPositiveNumbers",latexTrigger:"\\R_{\\le0}"},{latexTrigger:"\\R^{\\leq0}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{-0}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{\\leq}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{0-}",parse:"NonPositiveNumbers"},{name:"PositiveNumbers",latexTrigger:"\\R_{>0}"},{latexTrigger:"\\R^+",parse:"PositiveNumbers"},{latexTrigger:"\\R^{+}",parse:"PositiveNumbers"},{latexTrigger:"\\R_+",parse:"PositiveNumbers"},{latexTrigger:"\\R_{+}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{\\gt}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{\\gt 0}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{>}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{>0}",parse:"PositiveNumbers"},{name:"NonNegativeNumbers",latexTrigger:"\\R_{\\geq0}"},{latexTrigger:"\\R^{0+}",parse:"NonNegativeNumbers"},{latexTrigger:"\\R^{\\geq}",parse:"NonNegativeNumbers"},{name:"ExtendedRealNumbers",latexTrigger:"\\overline\\R"},{latexTrigger:"\\bar\\R",parse:"ExtendedRealNumbers"},{name:"NegativeIntegers",latexTrigger:"\\Z_{<0}"},{latexTrigger:"\\Z_{\\lt0}",parse:"NegativeIntegers"},{latexTrigger:"\\Z^-",parse:"NegativeIntegers"},{latexTrigger:"\\Z^{-}",parse:"NegativeIntegers"},{latexTrigger:"\\Z_-",parse:"NegativeIntegers"},{latexTrigger:"\\Z_{-}",parse:"NegativeIntegers"},{latexTrigger:"\\Z^{\\lt}",parse:"NegativeIntegers"},{name:"NonPositiveIntegers",latexTrigger:"\\Z_{\\le0}"},{latexTrigger:"\\Z_{\\leq0}",parse:"NonPositiveIntegers"},{latexTrigger:"\\Z_{<0}",parse:"NonPositiveIntegers"},{name:"PositiveIntegers",latexTrigger:"\\N^*"},{latexTrigger:"\\Z_{>0}",parse:"PositiveIntegers"},{latexTrigger:"\\Z_{\\gt0}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{+}",parse:"PositiveIntegers"},{latexTrigger:"\\Z_+",parse:"PositiveIntegers"},{latexTrigger:"\\Z_{+}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{\\gt}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{\\gt0}",parse:"PositiveIntegers"},{latexTrigger:"\\N^+",parse:"PositiveIntegers"},{latexTrigger:"\\N^{+}",parse:"PositiveIntegers"},{latexTrigger:"\\N^*",parse:"PositiveIntegers"},{latexTrigger:"\\N^{*}",parse:"PositiveIntegers"},{latexTrigger:"\\N^\\star",parse:"PositiveIntegers"},{latexTrigger:"\\N^{\\star}",parse:"PositiveIntegers"},{latexTrigger:"\\N_1",parse:"PositiveIntegers"},{latexTrigger:"\\N_{1}",parse:"PositiveIntegers"},{name:"NonNegativeIntegers",latexTrigger:["\\N"]},{latexTrigger:"\\Z^{+0}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{\\geq}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{\\geq0}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{0+}",parse:"NonNegativeIntegers"},{latexTrigger:"\\mathbb{N}",parse:"NonNegativeIntegers"},{latexTrigger:"\\N_0",parse:"NonNegativeIntegers"},{latexTrigger:"\\N_{0}",parse:"NonNegativeIntegers"},{name:"ExtendedIntegers",latexTrigger:"\\overline\\Z"},{latexTrigger:"\\bar\\Z",parse:"ExtendedIntegers"},{name:"ExtendedRationalNumbers",latexTrigger:"\\overline\\Q"},{latexTrigger:"\\bar\\Q",parse:"ExtendedRationalNumbers"},{name:"ExtendedComplexNumbers",latexTrigger:"\\overline\\C"},{latexTrigger:"\\bar\\C",parse:"ExtendedComplexNumbers"},{latexTrigger:["^","\\complement"],kind:"postfix",parse:(n,e)=>["Complement",e]},{name:"Complement",latexTrigger:["^","<{>","\\complement","<}>"],kind:"postfix"},{name:"Intersection",latexTrigger:["\\cap"],kind:"infix",precedence:350},{name:"Interval",serialize:Vd},{kind:"matchfix",openTrigger:["["],closeTrigger:[")"],parse:(n,e)=>_t(e,!1,!0)},{kind:"matchfix",openTrigger:["\\lbrack"],closeTrigger:["\\rparen"],parse:(n,e)=>_t(e,!1,!0)},{kind:"matchfix",openTrigger:["\\lbrack"],closeTrigger:[")"],parse:(n,e)=>_t(e,!1,!0)},{kind:"matchfix",openTrigger:["["],closeTrigger:["\\rparen"],parse:(n,e)=>_t(e,!1,!0)},{kind:"matchfix",openTrigger:["("],closeTrigger:["]"],parse:(n,e)=>_t(e,!0,!1)},{kind:"matchfix",openTrigger:["\\lparen"],closeTrigger:["\\rbrack"],parse:(n,e)=>_t(e,!0,!1)},{kind:"matchfix",openTrigger:["\\lparen"],closeTrigger:["]"],parse:(n,e)=>_t(e,!0,!1)},{kind:"matchfix",openTrigger:["("],closeTrigger:["\\rbrack"],parse:(n,e)=>_t(e,!0,!1)},{kind:"matchfix",openTrigger:["]"],closeTrigger:["["],parse:(n,e)=>_t(e,!0,!0)},{kind:"matchfix",openTrigger:["\\rbrack"],closeTrigger:["\\lbrack"],parse:(n,e)=>_t(e,!0,!0)},{name:"Multiple",serialize:Vd},{name:"Union",latexTrigger:["\\cup"],kind:"infix",precedence:350},{name:"Set",kind:"matchfix",openTrigger:"{",closeTrigger:"}",parse:(n,e)=>fe(e)?"EmptySet":(S(e)=="Delimiter"&&se(b(e,2))===","&&(e=b(e,1)),S(e)!=="Sequence"?["Set",e]:["Set",...A(e)]),serialize:(n,e)=>C(["\\lbrace",A(e).map(t=>n.serialize(t)).join(", "),"\\rbrace"])},{name:"SetMinus",latexTrigger:["\\setminus"],kind:"infix",precedence:650},{name:"SymmetricDifference",latexTrigger:["\\triangle"],kind:"infix",precedence:W},{latexTrigger:["\\ni"],kind:"infix",associativity:"none",precedence:160,parse:(n,e,t)=>{let i=n.parseExpression(t);return i===null?null:["Element",i,e]}},{name:"Element",latexTrigger:["\\in"],kind:"infix",precedence:240},{name:"NotElement",latexTrigger:["\\notin"],kind:"infix",precedence:240},{name:"NotSubset",latexTrigger:["\\nsubset"],kind:"infix",associativity:"none",precedence:240},{name:"NotSuperset",latexTrigger:["\\nsupset"],kind:"infix",associativity:"none",precedence:240},{name:"NotSubsetNotEqual",latexTrigger:["\\nsubseteq"],kind:"infix",associativity:"none",precedence:240},{name:"NotSupersetNotEqual",latexTrigger:["\\nsupseteq"],kind:"infix",associativity:"none",precedence:240},{name:"SquareSubset",latexTrigger:["\\sqsubset"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSubsetEqual",latexTrigger:["\\sqsubseteq"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSuperset",latexTrigger:["\\sqsupset"],kind:"infix",associativity:"none",precedence:265},{name:"SquareSupersetEqual",latexTrigger:["\\sqsupseteq"],kind:"infix",associativity:"none",precedence:265},{name:"Subset",latexTrigger:["\\subset"],kind:"infix",associativity:"none",precedence:240},{latexTrigger:["\\subsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Subset"},{latexTrigger:["\\varsubsetneqq"],kind:"infix",associativity:"none",precedence:240,parse:"Subset"},{name:"SubsetEqual",latexTrigger:["\\subseteq"],kind:"infix",associativity:"none",precedence:240},{name:"Superset",latexTrigger:["\\supset"],kind:"infix",associativity:"none",precedence:240},{latexTrigger:["\\supsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Superset"},{latexTrigger:["\\varsupsetneq"],kind:"infix",associativity:"none",precedence:240,parse:"Superset"},{name:"SupersetEqual",latexTrigger:["\\supseteq"],kind:"infix",associativity:"none",precedence:240}];function Vd(n,e){if(e===null)return"";let t=S(e);if(!t)return"";if(t==="Set")return de(e)===0?"\\emptyset":de(e)===2&&S(b(e,2))==="Condition"?C(["\\left\\lbrace",n.serialize(b(e,1)),"\\middle\\mid",n.serialize(b(e,2)),"\\right\\rbrace"]):C(["\\left\\lbrace",...A(e).map(r=>n.serialize(r)+" ,"),"\\right\\rbrace"]);if(t==="Range")return C(["\\mathopen\\lbrack",n.serialize(b(e,1)),", ",n.serialize(b(e,2)),"\\mathclose\\rbrack"]);if(t==="Interval"){let r=b(e,1),o=b(e,2),s=!1,a=!1;return S(r)==="Open"&&(r=b(r,1),s=!0),S(o)==="Open"&&(o=b(o,1),a=!0),C([s?"\\lparen":"\\lbrack",n.serialize(r),", ",n.serialize(o),a?"\\rparen":"\\rbrack"])}let i=n.numericSetStyle(e,n.level);return""}Ye();function Pr(n){return e=>{let t=!1,i=[],r=[];for(;!t;){e.skipVisualSpace(),e.match("\\limits"),e.skipSpace();let a=null,u=null;for(;!(u!==null&&a!==null)&&(e.peek==="_"||e.peek==="^");)e.match("_")?u=e.parseGroup()??e.parseToken():e.match("^")&&(a=e.parseGroup()??e.parseToken()),e.skipSpace();fe(u)&&(u=null),fe(a)&&(a=null),i.push(u??"Nothing"),r.push(a??"Nothing"),e.skipVisualSpace(),t=!e.match(n)}let[o,s]=o1(e);if(o&&s.length===0){if(S(o)==="Add"||S(o)==="Subtract"){let a=[],u=[];for(let l of A(o))if(s)u.push(l);else{let c;[c,s]=Jt(l),a.push(c??l)}if(s!==null&&u.length>0)return["Add",jd(n,["Add",...a],{indexes:s,subs:i,sups:r})??"Nothing",...u]}else if(S(o)==="Divide"){let a;[a,s]=Jt(b(o,1)),a!==null&&s!==null&&(o=["Divide",a,b(o,2)])}}return jd(n,o,{indexes:s,subs:i,sups:r})}}function jd(n,e,t){if(!e)return null;if(t.sups.length===0&&t.subs.length===0)return[n,e,...t.indexes];let i=t.indexes.length===0?S(e)==="Function"?A(e).slice(1):[]:t.indexes,r=Math.max(t.sups.length,t.subs.length,i.length);if(i.length===0)for(let s=0;s<r;s++)i.push("Nothing");else if(i.length!==r)for(let s=i.length;s<r;s++)i.push(["Error","'missing'"]);if(t.subs.length!==r)for(let s=t.subs.length;s<r;s++)t.subs.push("Nothing");if(t.sups.length!==r)for(let s=t.sups.length;s<r;s++)t.sups.push("Nothing");let o=i.map((s,a)=>{let u=t.sups[a],l=t.subs[a];return l==="Nothing"&&u==="Nothing"?s:["Tuple",s,l,u]});return[n,e,...o]}function o1(n){let e=!1,t=n.parseExpression({minPrec:266,condition:()=>{let i=n.index;return e=zd(n),n.index=i,e}});return t!==null&&!e?Jt(t):[t,s1(n)]}function s1(n){let e=[];for(;zd(n);){n.skipVisualSpace();let t=M(n.parseSymbol());if(t===null)return e;e.push(t)}return e}function Jt(n){let e=S(n),t=b(n,1);if(!t)return[n,[]];if(e==="Sequence"&&de(n)===1)return Jt(t);if(e==="Multiply"||e==="InvisibleOperator"){let i=A(n);if(i){let[r,o]=a1(i);return r.length>0?[[e,...r],o]:[null,o]}}else if(e==="Delimiter"){let[i,r]=Jt(t);if(r)return i?[["Delimiter",["Sequence",i],...A(n).slice(1)],r]:[null,r]}else if(e==="Add"){let i=A(n);if(i.length>0){let[r,o]=Jt(i[i.length-1]);if(o.length>0){if(r)return[["Add",...i.slice(0,-1),r],o];if(i.length>2)return[["Add",...i.slice(0,-1)],o];if(i.length>2)return[i[0],o]}}}else if(e==="Negate"){let[i,r]=Jt(t);if(r.length>0)return[i?["Negate",i]:null,r]}else if(e==="Divide"){let[i,r]=Jt(t);if(r.length>0)return[["Divide",i??1,b(n,2)],r]}else{let i=A(n);if(i.length===1){let[r,o]=Jt(i[0]);if(o.length>0)return[[S(n),r],o]}}return[n,[]]}function Ud(n){return(e,t)=>{if(!b(t,1))return n;let i=b(t,1),r=[];S(i)==="BuiltInFunction"?(r=["x"],i=[b(i,1),"x"]):S(i)==="Function"?(r=A(i).slice(1),i=b(i,1)):M(i)?r=[]:r=[];let o=A(t).slice(1),s=[],a=o.map((l,c)=>{if(M(l)==="Nothing")return s.push(M(r[c])??"Nothing"),"";if(M(l))return s.push(M(l)??"Nothing"),"";let f=S(l);if(f==="Tuple"||f==="Pair"||f==="Limits"||f==="Range"){if(de(l)===3){let p=b(l,1);s.push(M(p)??"Nothing");let d=b(l,2),m=b(l,3);return M(d)==="Nothing"&&(d=null),M(m)==="Nothing"&&(m=null),d!==null&&m!==null?`_{${e.serialize(d)}}^{${e.serialize(m)}}`:d!==null?`_{${e.serialize(d)}}`:m!==null?`^{${e.serialize(m)}}`:""}return`_{${e.serialize(l)}}`}if(de(l)===2){if(M(b(l,1))){s.push(M(b(l,1))??"Nothing");let m=b(l,2);return M(m)==="Nothing"?"":`_{${e.serialize(m)}}`}s.push(M(r[c])??"Nothing");let p=b(l,1),d=b(l,2);if(M(p)==="Nothing"&&(p=null),M(d)==="Nothing"&&(d=null),p!==null&&d!==null)return`_{${e.serialize(p)}}^{${e.serialize(d)}}`;if(p!==null)return`_{${e.serialize(p)}}`;if(d!==null)return`^{${e.serialize(d)}}`}else s.push(M(r[c])??"Nothing")}),u=s.filter(l=>M(l)!=="Nothing").map(l=>`\\mathrm{d}${e.serialize(M(l)??"x")}`);return u.length>0&&(u=["\\,",...u]),a.length===0?`${n}\\,${e.serialize(i)}\\!${u.join(" ")}`:a.reverse().map(l=>`${n}${l}`).join("")+"\\!"+e.serialize(i)+u.join(" ")}}var Gd=[{kind:"expression",name:"Integrate",latexTrigger:["\\int"],parse:Pr("Integrate"),serialize:Ud("\\int")},{kind:"expression",latexTrigger:["\\iint"],parse:Pr("Integrate")},{kind:"expression",latexTrigger:["\\iiint"],parse:Pr("Integrate")},{kind:"expression",name:"CircularIntegrate",latexTrigger:["\\oint"],parse:Pr("CircularIntegrate"),serialize:Ud("\\oint")},{kind:"expression",latexTrigger:["\\oiint"],parse:Pr("CircularIntegrate")},{kind:"expression",latexTrigger:["\\oiiint"],parse:Pr("CircularIntegrate")}];function zd(n){let e=n.index;for(;n.match("\\cdot")||n.skipVisualSpace(););return n.matchAll(["\\mathrm","<{>","d","<}>"])||n.matchAll(["\\operatorname","<{>","d","<}>"])||n.match("d")||n.match("\\differentialD")?!0:(n.index=e,!1)}function a1(n){let e=[...n],t=[];for(;e.length>0;){let i;if([e,i]=u1(e),!i)break;t.push(i)}return[e,t]}function u1(n){if(n.length<2)return[n,""];let e=n[n.length-2];if(e==="d"||e==="d_upright"){let t=M(n[n.length-1]);if(t)return[n.slice(0,-2),t]}return[n,""]}ra();var Hd=[{name:"Real",kind:"function",latexTrigger:["\\Re"]},{name:"Imaginary",kind:"function",latexTrigger:["\\Im"]},{name:"Argument",kind:"function",latexTrigger:["\\arg"]},{name:"Conjugate",latexTrigger:["^","\\star"],kind:"postfix"}];Ye();var Wd=[{name:"Mean",kind:"function",symbolTrigger:"mean"},{name:"Median",kind:"function",symbolTrigger:"median"},{name:"StandarDeviation",kind:"function",symbolTrigger:"stddev"},{latexTrigger:["\\bar"],kind:"expression",parse:(n,e)=>{let t=n.parseGroup()??n.parseToken();return!t||!M(t)?null:["Mean",t]}}];var l1={"(":["\\lparen","("],")":["\\rparen",")"],"[":["\\lbrack","\\[","["],"]":["\\rbrack","\\]","]"],"<":["<","\\langle"],">":[">","\\rangle"],"{":["\\{","\\lbrace"],"}":["\\}","\\rbrace"],":":[":","\\colon"],"|":["|","\\|","\\lvert","\\rvert"],"||":["||","\\Vert","\\lVert","\\rVert"]};function c1(n){return"kind"in n&&n.kind==="matchfix"}var Jd={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","|":"\\vert","||":"\\Vert","\\lceil":"\\lceil","\\lfloor":"\\lfloor","\\rceil":"\\rceil","\\rfloor":"\\rfloor"};function Yd(n,e,t){let i=f1(e,t);if(i===null)return;let r="kind"in e?e.kind:"expression",o=i.latexTrigger;typeof o=="string"&&(n.lookahead=Math.max(n.lookahead,Ks(o)));let s=Ve(o??"");if(s.length===2&&/[_^]/.test(s[0])&&s[1]!=="<{>"&&r!=="function"&&r!=="environment"&&r!=="matchfix"){let a=e.parse;!a&&e.name&&(r==="postfix"||r==="prefix"?a=(u,l)=>[e.name,l]:a=e.name),Yd(n,{...e,kind:r,name:void 0,serialize:void 0,parse:a,latexTrigger:[s[0],"<{>",s[1],"<}>"]},t)}if(n.defs.push(i),c1(i)){let a=i.openTrigger,u=[];if(typeof a=="string"){let l=l1[a];l?u.push(...l):u.push(a),a==="||"&&u.push("|")}else Array.isArray(a)&&a.length>0&&u.push(a[0]);for(let l of u){let c=n.matchfixByOpen.get(l);c?c.unshift(i):n.matchfixByOpen.set(l,[i])}}if(i.latexTrigger&&i.latexTrigger!==""){let a=i.latexTrigger,u;switch(i.kind){case"infix":u=n.infixByTrigger;break;case"prefix":u=n.prefixByTrigger;break;case"postfix":u=n.postfixByTrigger;break;case"function":u=n.functionByTrigger;break;case"symbol":u=n.symbolByTrigger;break;case"expression":u=n.expressionByTrigger;break}if(u){let l=u.get(a);l?l.unshift(i):u.set(a,[i])}}i.name!==void 0&&(n.ids.has(i.name)&&t({severity:"warning",message:["invalid-dictionary-entry",i.name,"Duplicate definition. The name (MathJSON symbol) must be unique, but triggers can be shared by multiple definitions."]}),n.ids.set(i.name,i))}function Ju(n,e){let t={lookahead:1,ids:new Map,defs:[],matchfixByOpen:new Map,infixByTrigger:new Map,prefixByTrigger:new Map,postfixByTrigger:new Map,functionByTrigger:new Map,symbolByTrigger:new Map,expressionByTrigger:new Map};for(let r of n)Yd(t,r,e);let i={"(":[")","\\rparen"],"\\lparen":[")","\\rparen"],"[":["]","\\rbrack","\\]"],"\\lbrack":["]","\\rbrack","\\]"],"\\[":["]","\\rbrack","\\]"],"{":["}","\\rbrace"],"\\lbrace":["}","\\rbrace"],"\\{":["}","\\rbrace"],"<":[">","\\rangle"],"\\langle":[">","\\rangle"],"|":["|","\\|","\\rvert","\\lvert"],"\\|":["|","\\|","\\rvert","\\lvert"],"\\lvert":["|","\\|","\\rvert","\\lvert"],"||":["||","\\Vert","\\lVert","\\rVert"],"\\Vert":["||","\\Vert","\\lVert","\\rVert"],"\\lVert":["||","\\Vert","\\lVert","\\rVert"]};for(let[r,o]of t.matchfixByOpen.entries())t.matchfixByOpen.set(r,o.sort((s,a)=>{let u=h=>typeof h=="string"?h:h[0]||"",l=h=>typeof h=="string"?h:h[0]||"",c=u(s.openTrigger),f=l(s.closeTrigger),p=i[c]?.includes(f)??!1,d=u(a.openTrigger),m=l(a.closeTrigger),g=i[d]?.includes(m)??!1;return p&&!g?-1:!p&&g?1:0}));return t}function f1(n,e){if(!m1(n,e))return null;let t={kind:"kind"in n?n.kind:"expression"},i=null;"latexTrigger"in n&&(typeof n.latexTrigger=="string"?i=Ve(n.latexTrigger):i=n.latexTrigger);let r=null;"symbolTrigger"in n&&(r=n.symbolTrigger),i!==null&&(t.latexTrigger=ot(i)),r!==null&&(t.symbolTrigger=r),n.name&&(t.name=n.name,t.serialize=p1(n,i,r)),t.kind==="matchfix"&&ko(n)&&(t.openTrigger=n.openTrigger,t.closeTrigger=n.closeTrigger),t.kind==="symbol"&&md(n)&&(t.precedence=n.precedence??1e4),t.kind==="expression"&&dd(n)&&(t.precedence=n.precedence??1e4),(t.kind==="prefix"||t.kind==="postfix")&&(ea(n)||Uu(n))&&(i&&(i[0]==="^"||i[0]==="_")?(t.precedence=720,n.precedence):t.precedence=n.precedence??1e4),t.kind==="infix"&&ju(n)&&(!i||i[0]!=="^"&&i[0]!=="_"||!n.associativity||n.associativity,t.associativity=n.associativity??"none",t.precedence=n.precedence??1e4);let o=d1(n,i,r);return o&&(t.parse=o),t}function p1(n,e,t){if(typeof n.serialize=="function")return n.serialize;let i=n.kind??"expression";if(i==="environment"){let a=n.symbolTrigger??n.name??"unknown";return(u,l)=>C([`\\begin{${a}}`,u.serialize(b(l,1)),`\\end{${a}}`])}if(ko(n)){let a=typeof n.openTrigger=="string"?Jd[n.openTrigger]:ot(n.openTrigger),u=typeof n.closeTrigger=="string"?Jd[n.closeTrigger]:ot(n.closeTrigger);return(l,c)=>C([a,l.serialize(b(c,1)),u])}let r=n.serialize;if(r===void 0&&e&&(r=ot(e)),r){let a=n.precedence??1e4;return i==="postfix"?(u,l)=>C([u.wrap(b(l,1),a),r]):i==="prefix"?(u,l)=>C([r,u.wrap(b(l,1),a)]):i==="infix"?(u,l)=>{let c=de(l);if(c===0)return"";let f=n.precedence??1e4;return C(A(l).flatMap((p,d)=>{let m=u.wrap(p,f+1);return d<c-1?[m,r]:[m]}))}:(u,l)=>S(l)?C([r,u.wrapArguments(l)]):r}let o=t??n.name??"unknown",s=n.precedence??1e4;return i==="postfix"?(a,u)=>C([a.wrap(b(u,1),s),a.serializeSymbol(o)]):i==="prefix"?(a,u)=>C([a.serializeSymbol(o),a.wrap(b(u,1),s)]):i==="infix"?(a,u)=>C([a.wrap(b(u,1),s+1),a.serializeSymbol(o),a.wrap(b(u,2),s+1)]):(a,u)=>S(u)?C([a.serializeSymbol(o),a.wrapArguments(u)]):a.serializeSymbol(o)}function d1(n,e,t){if("parse"in n&&typeof n.parse=="function")return n.parse;let i=("kind"in n?n.kind:"expression")??"expression";if(i==="environment"){let r=n.parse??n.name??t;if(r)return(o,s)=>{let a=o.parseTabular();return a===null?null:[r,["List",a.map(u=>["List",...u])]]}}if(i==="function"){let r=n.parse??n.name??t;if(r)return(o,s)=>{let a=o.parseArguments("enclosure",s);return a===null?r:[r,...a]}}if(i==="symbol"){let r=n.parse??n.name??t;if(r)return(o,s)=>r}if(i==="prefix"){let r=n.parse??n.name??t;if(r){let o=n.precedence??1e4;return(s,a)=>{let u=s.parseExpression({...a??[],minPrec:o});return u===null?null:[r,u]}}}if(i==="postfix"){let r=n.parse??n.name;if(r)return(o,s)=>s===null?null:[r,s]}if(i==="infix"){if(/[_^]/.test(e?.[0]??"")){let o=n.name??n.parse;return(s,a)=>[o,ne(b(a,1)),ne(b(a,2))]}let r=n.parse??n.name??t;if(r){let o=n.precedence??1e4,s=n.associativity??"none";return s==="none"?(a,u,l)=>{if(u===null)return null;let c=ne(a.parseExpression({...l,minPrec:o}));return[r,u,c]}:s==="left"?(a,u,l)=>{if(u===null)return null;let c=ne(a.parseExpression({...l,minPrec:o+1}));return typeof r!="string"?[r,u,c]:[r,u,c]}:s==="right"?(a,u,l)=>{if(u===null)return null;let c=ne(a.parseExpression({...l,minPrec:o}));return typeof r!="string"?[r,u,c]:[r,u,c]}:(a,u,l)=>{if(u===null)return null;let c=ne(a.parseExpression({...l,minPrec:o}));return typeof r!="string"?[r,u,c]:kr(r,u,c)}}}if(i==="matchfix"){let r=n.parse??n.name;if(r)return(o,s)=>fe(s)?null:[r,s]}if(i==="expression"){let r=n.parse??n.name??t;if(r)return()=>r}if("parse"in n){let r=n.parse;return()=>r}}function m1(n,e){let t=n.name??n.latexTrigger??n.symbolTrigger??n.openTrigger;if(!t)try{t=JSON.stringify(n)}catch{t="???"}if(Array.isArray(t)&&(t=ot(t)),"trigger"in n&&e({severity:"warning",message:["invalid-dictionary-entry",t,"The 'trigger' property is deprecated. Use 'latexTrigger' or 'symbolTrigger' instead"]}),"kind"in n&&!["expression","symbol","function","infix","postfix","prefix","matchfix","environment"].includes(n.kind)&&e({severity:"warning",message:["invalid-dictionary-entry",t,"The 'kind' property must be one of 'expression', 'symbol', 'function', 'infix', 'postfix', 'prefix', 'matchfix', 'environment'"]}),n.serialize!==void 0&&!n.name)return e({severity:"warning",message:["invalid-dictionary-entry",t,"A 'name' property must be provided if a 'serialize' handler is provided"]}),!1;if("symbolTrigger"in n&&(!("kind"in n)||n.kind!=="environment")&&(typeof n.symbolTrigger!="string"||!ze(n.symbolTrigger))&&e({severity:"warning",message:["invalid-dictionary-entry",t,"The 'symbolTrigger' property must be a valid symbol"]}),"name"in n&&(typeof n.name!="string"?n.name!==void 0&&e({severity:"warning",message:["invalid-dictionary-entry",t,"The 'name' property must be a string"]}):ze(n.name)||e({severity:"warning",message:["invalid-dictionary-entry",n.name,"The 'name' property must be a valid symbol"]})),ko(n)){if("latexTrigger"in n||"symbolTrigger"in ea)return e({severity:"warning",message:["invalid-dictionary-entry",t,"'matchfix' operators use a 'openTrigger' and 'closeTrigger' instead of a 'latexTrigger' or 'symbolTrigger'. "]}),!1;if(!n.openTrigger||!n.closeTrigger)return e({severity:"warning",message:["invalid-dictionary-entry",t,"Expected `openTrigger` and a `closeTrigger` for matchfix operator"]}),!1;if(typeof n.openTrigger!=typeof n.closeTrigger)return e({severity:"warning",message:["invalid-dictionary-entry",t,"Expected `openTrigger` and `closeTrigger` to both be strings or array of LatexToken"]}),!1}if(ju(n)||Uu(n)||ea(n)){if(Array.isArray(n.latexTrigger)&&(n.latexTrigger[0]==="_"||n.latexTrigger[0]==="^")||typeof n.latexTrigger=="string"&&(n.latexTrigger.startsWith("^")||n.latexTrigger.startsWith("_"))){if(n.precedence!==void 0||n.associativity!==void 0)return e({severity:"warning",message:["invalid-dictionary-entry",t,'Unexpected "precedence" or "associativity" for superscript/subscript operator']}),!1}else if(n.precedence===void 0)return e({severity:"warning",message:["invalid-dictionary-entry",t,`Expected a "precedence" for ${n.kind} operator`]}),!1}else if(n.associativity!==void 0)return e({severity:"warning",message:["invalid-dictionary-entry",t,'Unexpected "associativity" operator']}),!1;return!ko(n)&&!gd(n)&&!n.latexTrigger&&!n.symbolTrigger&&!n.name?(e({severity:"warning",message:["invalid-dictionary-entry",t,"Expected a 'name', a 'latexTrigger' or a 'symbolTrigger'"]}),!1):n.parse===void 0&&n.name===void 0?(e({severity:"warning",message:["invalid-dictionary-entry",t,"Expected a 'parse' or 'name'"]}),!1):!0}var Po={symbols:Zd,algebra:hd,arithmetic:Cd,calculus:Gd,complex:Hd,core:Rd,"linear-algebra":Pd,logic:Ld,relop:Ui,other:qd,physics:[{name:"mu0",kind:"symbol",latexTrigger:"\\mu_0"}],sets:$d,statistics:Wd,trigonometry:Fd};function Qd(n="all"){if(n==="all"){let e=[];for(let t of Object.keys(Po))Po[t]&&e.push(...Po[t]);return e}return Po[n]?Object.freeze([...Po[n]]):[]}Ye();Gt();Gn();di();ra();var g1={"\\mathord":"","\\mathop":"","\\mathbin":"","\\mathrel":"","\\mathopen":"","\\mathclose":"","\\mathpunct":"","\\mathinner":"","\\operatorname":"","\\text":"","\\mathrm":"_upright","\\mathit":"_italic","\\mathbf":"_bold","\\mathscr":"_script","\\mathcal":"_calligraphic","\\mathfrak":"_fraktur","\\mathsf":"_sansserif","\\mathtt":"_monospace","\\mathbb":"_doublestruck"},h1={"\\mathring":"_ring","\\hat":"_hat","\\tilde":"_tilde","\\vec":"_vec","\\overline":"_bar","\\underline":"_underbar","\\dot":"_dot","\\ddot":"_ddot","\\dddot":"_dddot","\\ddddot":"_ddddot","\\acute":"_acute","\\grave":"_grave","\\breve":"_breve","\\check":"_check"};function Xd(n,e){if(n.atEnd)return null;let t=n.peek,i={"\\_":"_","\\#":"hash"}[t];if(!i&&!e.toplevel&&(i={"+":"plus","-":"minus","\\plusmn":"pm","\\pm":"pm","\\ast":"ast","\\dag":"dag","\\ddag":"ddag","\\bot":"bottom","\\top":"top","\\bullet":"bullet","\\cir":"circle","\\diamond":"diamond","\\times":"times","\\square":"square","\\star":"star"}[t]),i)return n.nextToken(),i;let r=at.findIndex(o=>o[1]===t);return r>=0?(n.nextToken(),at[r][0]):n.parseChar()??n.nextToken()}function Oo(n){let e=Yu(n),t=h1[n.peek]??null;if(t){if(n.nextToken(),!n.match("<{>"))return null;let o=Oo(n);if(o===null||!n.match("<}>"))return null;e=`${o}${t}`}if(e===null){for(e="";!n.atEnd;){let o=n.peek;if(o==="<}>"||o==="_"||o==="^")break;let s=Xd(n,{toplevel:!1});if(s===null)return null;e+=s}for(;!n.atEnd&&/\d/.test(n.peek);)e+=n.nextToken()}for(;!n.atEnd;)if(n.match("\\degree"))e+="_deg";else if(n.matchAll(["^","\\circ"]))e+="_deg";else if(n.matchAll(["^","\\prime"]))e+="_prime";else if(n.matchAll(["^","<{>","\\prime","<}>"]))e+="_prime";else if(n.matchAll(["^","<{>","\\doubleprime","<}>"]))e+="_dprime";else if(n.matchAll(["^","<{>","\\prime","\\prime","<}>"]))e+="_dprime";else break;let i=[],r=[];for(;!n.atEnd;)if(n.match("_")){let o=n.match("<{>"),s=Oo(n);if(o&&!n.match("<}>")||s===null)return null;r.push(s)}else if(n.match("^")){let o=n.match("<{>"),s=Oo(n);if(o&&!n.match("<}>")||s===null)return null;i.push(s)}else break;return i.length>0&&(e+="__"+i.join("")),r.length>0&&(e+="_"+r.join("")),e}function Yu(n){let e=g1[n.peek]??null;if(e===null)return null;if(n.nextToken(),n.match("<{>")){let t="",i={0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"}[n.peek]??"";return i&&(t=i,n.nextToken()),t+=Oo(n),t===null||!n.match("<}>")?null:e==="_upright"&&t.length>1?t:t+e}return null}function Qu(n){let e=n.index,t=Yu(n);return t===null||ze(t)?null:n.error(["invalid-symbol",{str:jn(t)}],e)}function Lo(n){if(/^[a-zA-Z]$/.test(n.peek)||/^\p{XIDS}$/u.test(n.peek)){let i=n.nextToken(),o=n.getSymbolType(i).matches("indexed_collection"),s=n.hasSubscriptEvaluate(i);for(;!n.atEnd&&!o&&!s&&n.peek==="_";){let u=n.index;if(n.nextToken(),n.match("<{>")){let c=n.peek;if(c==="("||c==="\\lparen"||c==="\\left"){n.index=u;break}let f=Oo(n),p=f!==null&&/plus|minus|times|ast/.test(f);if(f===null||f.includes(",")||p||n.peek!=="<}>"){n.index=u;break}n.match("<}>"),i+="_"+f}else{let c=n.peek;if(/^[a-zA-Z0-9]$/.test(c)||/^\p{XIDS}$/u.test(c))n.nextToken(),i+="_"+c;else{n.index=u;break}}}return i}let e=Yu(n);if(!e){for(e="";!n.atEnd&&Nr.test(e+n.peek);)e+=n.nextToken();e||(e=null)}let t=n.index;return e??=Xd(n,{toplevel:!0}),e&&(e=e.normalize(),ze(e))?e:(n.index=t,null)}en();In();var Xu={"(":["\\lparen","("],")":["\\rparen",")"],"[":["\\lbrack","\\[","["],"]":["\\rbrack","\\]","]"],"<":["<","\\langle"],">":[">","\\rangle"],"{":["\\{","\\lbrace"],"}":["\\}","\\rbrace"],":":[":","\\colon"],"|":["|","\\|","\\lvert","\\rvert"],"||":["||","\\Vert","\\lVert","\\rVert"]},oa={"\\left":"\\right","\\bigl":"\\bigr","\\Bigl":"\\Bigr","\\biggl":"\\biggr","\\Biggl":"\\Biggr","\\big":"\\big","\\Big":"\\Big","\\bigg":"\\bigg","\\Bigg":"\\Bigg","\\mathopen":"\\mathclose"},el={"(":")","[":"]","|":"|","\\{":"\\}","\\[":"\\]","\\lbrace":"\\rbrace","\\lparen":"\\rparen","\\langle":"\\rangle","\\lfloor":"\\rfloor","\\lceil":"\\rceil","\\vert":"\\vert","\\lvert":"\\rvert","\\Vert":"\\Vert","\\lVert":"\\rVert","\\lbrack":"\\rbrack","\\ulcorner":"\\urcorner","\\llcorner":"\\lrcorner","\\lgroup":"\\rgroup","\\lmoustache":"\\rmoustache","\\llbracket":"\\rrbracket"},nl=class{options;_index=0;symbolTable={parent:null,ids:{}};pushSymbolTable(){this.symbolTable={parent:this.symbolTable,ids:{}}}popSymbolTable(){this.symbolTable=this.symbolTable.parent??this.symbolTable}addSymbol(e,t){if(typeof t=="string"&&(t=new R(t)),e in this.symbolTable.ids&&this.symbolTable.ids[e].is(t.type))throw new Error(`Symbol ${e} already declared as a different type`);this.symbolTable.ids[e]=t}_quantifierScopeDepth=0;get inQuantifierScope(){return this._quantifierScopeDepth>0}enterQuantifierScope(){this._quantifierScopeDepth++}exitQuantifierScope(){this._quantifierScopeDepth>0&&this._quantifierScopeDepth--}get index(){return this._index}set index(e){this._index=e,this._lastPeek="",this._peekCounter=0}_tokens;_positiveInfinityTokens;_negativeInfinityTokens;_notANumberTokens;_decimalSeparatorTokens;_wholeDigitGroupSeparatorTokens;_fractionalDigitGroupSeparatorTokens;_exponentProductTokens;_beginExponentMarkerTokens;_endExponentMarkerTokens;_truncationMarkerTokens;_imaginaryUnitTokens;_dictionary;_boundaries=[];_lastPeek="";_peekCounter=0;constructor(e,t,i){this._tokens=e,this.options=i,this._dictionary=t,this._positiveInfinityTokens=Ve(this.options.positiveInfinity),this._negativeInfinityTokens=Ve(this.options.negativeInfinity),this._notANumberTokens=Ve(this.options.notANumber),this._decimalSeparatorTokens=Ve(this.options.decimalSeparator),this._wholeDigitGroupSeparatorTokens=[],this._fractionalDigitGroupSeparatorTokens=[],this.options.digitGroupSeparator&&(typeof this.options.digitGroupSeparator=="string"?(this._wholeDigitGroupSeparatorTokens=Ve(this.options.digitGroupSeparator),this._fractionalDigitGroupSeparatorTokens=this._wholeDigitGroupSeparatorTokens):Array.isArray(this.options.digitGroupSeparator)&&(this._wholeDigitGroupSeparatorTokens=Ve(this.options.digitGroupSeparator[0]),this._fractionalDigitGroupSeparatorTokens=Ve(this.options.digitGroupSeparator[1]))),this._exponentProductTokens=Ve(this.options.exponentProduct),this._beginExponentMarkerTokens=Ve(this.options.beginExponentMarker),this._endExponentMarkerTokens=Ve(this.options.endExponentMarker),this._truncationMarkerTokens=Ve(this.options.truncationMarker),this._imaginaryUnitTokens=Ve(this.options.imaginaryUnit)}getSymbolType(e){let t=this.symbolTable;for(;t;){if(e in t.ids)return t.ids[e];t=t.parent}return this.options.getSymbolType?this.options.getSymbolType(e):R.unknown}hasSubscriptEvaluate(e){return this.options.hasSubscriptEvaluate?this.options.hasSubscriptEvaluate(e):!1}get peek(){let e=this._tokens[this.index];if(e===this._lastPeek?this._peekCounter+=1:this._peekCounter=0,this._peekCounter>=1024){let t=`Infinite loop detected while parsing "${this.latex(0)}" at "${this._lastPeek}" (index ${this.index})`;throw console.error(t),new Error(t)}return this._lastPeek=e,e}nextToken(){return this._tokens[this.index++]}get atEnd(){return this.index>=this._tokens.length}atTerminator(e){return this.atBoundary||((e?.condition&&e.condition(this))??!1)}get atBoundary(){if(this.atEnd)return!0;let e=this.index;for(let t of this._boundaries)if(this.matchAll(t.tokens))return this.index=e,!0;return!1}addBoundary(e){this._boundaries.push({index:this.index,tokens:e})}removeBoundary(){this._boundaries.pop()}matchBoundary(){let e=this._boundaries[this._boundaries.length-1],t=e&&this.matchAll(e.tokens);return t&&this._boundaries.pop(),t}boundaryError(e){let t=this._boundaries[this._boundaries.length-1];return this._boundaries.pop(),this.error(e,t.index)}canSkipMatchfixReparsing(e,t,i){return!i&&t.length===1&&(e==="("||e==="\\lparen")&&(t[0]==="]"||t[0]==="\\rbrack")}latex(e,t){return ot(this._tokens.slice(e,t))}latexAhead(e){return this.latex(this.index,this.index+e)}lookAhead(){let e=Math.min(this._dictionary.lookahead,this._tokens.length-this.index);if(e<=0)return[];let t=[];for(;e>0;)t.push([e,this.latexAhead(e--)]);return t}peekDefinitions(e){if(this.atEnd)return[];let t=[],i;switch(e){case"infix":i=this._dictionary.infixByTrigger;break;case"prefix":i=this._dictionary.prefixByTrigger;break;case"postfix":i=this._dictionary.postfixByTrigger;break;case"function":i=this._dictionary.functionByTrigger;break;case"symbol":i=this._dictionary.symbolByTrigger;break;case"expression":i=this._dictionary.expressionByTrigger;break;case"operator":i=void 0;break}if(i){let r=[];for(let o of this.getDefs(e))(o.latexTrigger===""||o.symbolTrigger)&&r.push(o);for(let o of r)o.latexTrigger===""&&t.push([o,0]);for(let[o,s]of this.lookAhead()){let a=i.get(s);if(a)for(let u of a)t.push([u,o])}for(let o of r)if(o.symbolTrigger){let s=Kd(this,o.symbolTrigger);s>0&&t.push([o,s])}}else{let r=[...this.getDefs(e)];for(let o of r)o.latexTrigger===""&&t.push([o,0]);for(let[o,s]of this.lookAhead())for(let a of r)a.latexTrigger===s&&t.push([a,o]);for(let o of r)if(o.symbolTrigger){let s=Kd(this,o.symbolTrigger);s>0&&t.push([o,s])}}return t}skipSpaceTokens(){for(;this.match("<space>"););}skipSpace(){if(!this.atEnd&&this.peek==="<{>"){let t=this.index;for(this.nextToken();this.match("<space>"););if(this.nextToken()==="<}>")return this.skipSpace(),!0;this.index=t}if(!this.options.skipSpace)return!1;let e=!1;for(;this.match("<space>");)e=!0;return e&&this.skipSpace(),e}skipVisualSpace(){this.options.skipSpace&&(this.skipSpace(),["\\!","\\,","\\:","\\;","\\enskip","\\enspace","\\space","\\quad","\\qquad"].includes(this.peek)&&(this.nextToken(),this.skipVisualSpace()),this.skipSpace())}match(e){return this._tokens[this.index]!==e?!1:(this.index++,!0)}matchAll(e){if(e.length===0)return!1;let t,i=0;do t=this._tokens[this.index+i]===e[i++];while(t&&i<e.length);return t&&(this.index+=i),t}matchAny(e){return e.includes(this._tokens[this.index])?this._tokens[this.index++]:""}parseLatexNumber(e=!0){let t=!1,i=this.peek;for(;i==="<space>"||i==="+"||i==="-";)i==="-"&&(t=!t),this.nextToken(),i=this.peek;let r=10,o=["0","1","2","3","4","5","6","7","8","9"];if(this.match("'"))r=8,o=["0","1","2","3","4","5","6","7"],e=!0;else if(this.match('"')||this.match("x"))r=16,o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],e=!0;else if(this.match("`"))return i=this.nextToken(),i?i.startsWith("\\")&&i.length===2?(t?-1:1)*(i.codePointAt(1)??0):(t?-1:1)*(i.codePointAt(0)??0):null;let s="";for(;o.includes(this.peek);)s+=this.nextToken();if(!e&&this.match("."))for(s+=".";o.includes(this.peek);)s+=this.nextToken();let a=e?Number.parseInt(s,r):Number.parseFloat(s);return Number.isNaN(a)?null:t?-a:a}parseChar(){let e=this.index,t=0;for(;this.match("^");)t+=1;if(t<2&&(this.index=e),t>=2){let i="",r=0;for(;r!=t;){let o=this.matchAny(["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]);if(!o)break;i+=o,r+=1}if(i.length===t)return String.fromCodePoint(Number.parseInt(i,16))}else if(this.match("\\char")){let i=Math.floor(this.parseLatexNumber()??Number.NaN);return(!Number.isFinite(i)||i<0||i>1114111)&&(i=10067),String.fromCodePoint(i)}else if(this.match("\\unicode"))if(this.skipSpaceTokens(),this.match("<{>")){let i=this.parseLatexNumber();if(this.match("<}>")&&i!==null&&i>=0&&i<=1114111)return String.fromCodePoint(i)}else{let i=this.parseLatexNumber();if(i!==null&&i>=0&&i<=1114111)return String.fromCodePoint(i)}return this.index=e,null}matchDelimiter(e,t){let i=this.index,r=oa[this.peek];r&&this.nextToken();let o=r&&this.peek==="<{>";if(o&&this.nextToken(),Array.isArray(e)){if(Array.isArray(t),e.length===1){if(!(Xu[e[0]]??[e[0]]).includes(this.peek))return this.index=i,!1;let c=this.nextToken().startsWith("\\");if(o&&!this.match("<}>"))return this.index=i,!1;let f=Xu[t[0]]??[t[0]],p=f.find(m=>c?m.startsWith("\\"):!m.startsWith("\\"))??f[0],d=r?o?[r,"<{>",p,"<}>"]:[r,p]:[p];return this.addBoundary(d),!0}if(!this.matchAll(e))return this.index=i,!1;let a=r?[r,...t]:t;return this.addBoundary(a),!0}if(Array.isArray(t),e==="||"&&this.matchAll(["|","|"]))return this.addBoundary(["|","|"]),!0;if(!(Xu[e]??[e]).includes(this.peek))return this.index=i,!1;if(e=this.nextToken(),o&&!this.match("<}>"))return this.index=i,!1;t=el[e]??t;let s=r?o?[r,"<{>",t,"<}>"]:[r,t]:[t];return this.addBoundary(s),!0}parseGroup(){let e=this.index;if(this.skipSpaceTokens(),this.match("<{>")){this.addBoundary(["<}>"]);let t=this.parseExpression();if(this.skipSpace(),this.matchBoundary())return t??"Nothing";for(;!this.matchBoundary()&&!this.atEnd;)this.nextToken();if(S(t)==="Error")return t;let i=this.error("expected-closing-delimiter",e);return t!==null?["InvisibleOperator",t,i]:i}return this.index=e,null}parseOptionalGroup(){let e=this.index;if(this.skipSpaceTokens(),this.match("[")){this.addBoundary(["]"]);let t=this.parseExpression();return this.skipSpace(),this.matchBoundary()?t:this.boundaryError("expected-closing-delimiter")}return this.index=e,null}parseToken(){return this.skipSpace(),[...'!"#$%&(),/;:?@[]\\`|~'.split(""),"\\left","\\bigl"].includes(this.peek)?null:/^[0-9]$/.test(this.peek)?parseInt(this.nextToken(),10):this.parseGenericExpression()??this.parseSymbol()}parseTabular(){let e=[],t=[],i=null;for(;!this.atBoundary;)if(this.skipSpace(),this.match("&"))t.push(i??"Nothing"),i=null;else if(this.match("\\\\")||this.match("\\cr"))this.skipSpace(),this.parseOptionalGroup(),i!==null&&t.push(i),e.push(t),t=[],i=null;else{let r=[],o=this.peek;for(;o!=="&"&&o!=="\\\\"&&o!=="\\cr"&&!this.atBoundary;)i=this.parseExpression({minPrec:0,condition:s=>{let a=s.peek;return a==="&"||a==="\\\\"||a==="\\cr"}}),i!==null?r.push(i):(r.push(["Error","'unexpected-token'",{str:ot(o)}]),this.nextToken()),this.skipSpace(),o=this.peek;r.length>1?i=["Sequence",...r]:i=r[0]??"Nothing"}return i!==null&&t.push(i),t.length>0&&e.push(t),e}parseStringGroupContent(){let e=this.index,t="",i=0;for(;!this.atBoundary||i>0;){let r=this.nextToken();if(r==="<$>"||r==="<$$>")return this.index=e,"";r==="<{>"?(i+=1,t+="\\{"):r==="<}>"?(i-=1,t+="\\}"):r==="<space>"?t+=" ":(r[0],t+=r)}return t}parseStringGroup(e){e===void 0&&(e=!1);let t=this.index;for(;this.match("<space>"););if(this.match(e?"[":"<{>")){this.addBoundary([e?"]":"<}>"]);let i=this.parseStringGroupContent();if(this.matchBoundary())return i;this.removeBoundary()}return this.index=t,null}parseEnvironment(e){let t=this.index;if(!this.match("\\begin"))return null;let i=this.parseStringGroup()?.trim();if(!i)return this.error("expected-environment-name",t);this.addBoundary(["\\end","<{>",...i.split(""),"<}>"]);for(let r of this.getDefs("environment"))if(r.symbolTrigger===i){let o=r.parse(this,e);return this.skipSpace(),this.matchBoundary()?o!==null?this.decorate(o,t):(this.index=t,null):this.boundaryError("unbalanced-environment")}return this.parseTabular(),this.skipSpace(),this.matchBoundary()?this.error(["unknown-environment",{str:i}],t):this.boundaryError("unbalanced-environment")}parseOptionalSign(){let e=!!this.matchAny(["-","\u2212"]);for(;this.matchAny(["+","\uFE62"])||this.skipSpace();)this.matchAny(["-","\u2212"])&&(e=!e);return e?"-":"+"}parseDecimalDigits(e="whole"){let t=[],i=!1;for(;!i;){for(;/^[0-9]$/.test(this.peek);)t.push(this.nextToken()),this.skipVisualSpace();i=!0;let r=e==="whole"?this._wholeDigitGroupSeparatorTokens:this._fractionalDigitGroupSeparatorTokens;if(e!=="none"&&r.length>0){let o=this.index;this.skipVisualSpace(),this.matchAll(r)&&(this.skipVisualSpace(),/^[0-9]$/.test(this.peek)?i=!1:this.index=o)}}return t.join("")}parseSignedInteger(e){let t=this.index,i=this.parseOptionalSign(),r=this.parseDecimalDigits(e);return r?i==="-"?"-"+r:r:(this.index=t,"")}parseExponent(){let e=this.index;if(this.skipVisualSpace(),this.matchAny(["e","E"])){let t=this.parseSignedInteger("none");if(t)return t}if(this.index=e,this.match("\\times")&&(this.skipVisualSpace(),this.matchAll(["1","0"])&&(this.skipVisualSpace(),this.match("^")))){if(this.skipVisualSpace(),/^[0-9]$/.test(this.peek))return this.nextToken();if(this.match("<{>")){this.skipVisualSpace();let t=this.parseSignedInteger("whole");if(this.skipVisualSpace(),t&&this.match("<}>"))return t}}if(this.index=e,this.skipVisualSpace(),this.match("\\%"))return"-2";if(this.index=e,this.matchAll(this._exponentProductTokens)&&(this.skipVisualSpace(),this.matchAll(this._beginExponentMarkerTokens))){this.skipVisualSpace();let t=this.parseSignedInteger("none");if(this.skipVisualSpace(),t&&this.matchAll(this._endExponentMarkerTokens))return t}return this.index=e,""}parseRepeatingDecimal(){let e=this.index,t=this.options.repeatingDecimal,i="";if((t==="auto"||t==="parentheses")&&this.match("("))return i=this.parseDecimalDigits("fraction"),i&&this.match(")")?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="parentheses")&&this.matchAll(["\\left","("]))return i=this.parseDecimalDigits("fraction"),i&&this.matchAll(["\\right",")"])?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="vinculum")&&this.matchAll(["\\overline","<{>"]))return i=this.parseDecimalDigits("fraction"),i&&this.match("<}>")?`(${i})`:(this.index=e,"");if(this.index=e,(t==="auto"||t==="arc")&&(this.matchAll(["\\wideparen","<{>"])||this.matchAll(["\\overarc","<{>"])))return i=this.parseDecimalDigits("fraction"),i&&this.match("<}>")?`(${i})`:(this.index=e,"");if(this.index=e,t==="auto"||t==="dots"){let r=em(this);if(r!==null){if(i=this.parseDecimalDigits("fraction"),!i)return`(${r})`;let o=em(this);if(o!==null)return`(${r}${i}${o})`}}return this.index=e,""}parseNumber(){if(this.options.parseNumbers===!1||this.options.parseNumbers==="never")return null;let e=this.index;this.skipVisualSpace();let t=1;for(;this.peek==="-"||this.peek==="+";)this.match("-")?t=-t:this.match("+"),this.skipVisualSpace();let i="",r="",o=!1;if(this.match(".")||this.matchAll(this._decimalSeparatorTokens)){let c=this.peek;(/^[\d]$/.test(c)||y1(this))&&(o=!0,i="0")}else i=this.parseDecimalDigits("whole");if(!i)return this.index=e,null;let s=this.index,a=!1;(o||this.match(".")||this.matchAll(this._decimalSeparatorTokens))&&(r=this.parseDecimalDigits("fraction"),a=!0);let u=!1;if(a){let c=this.parseRepeatingDecimal();c&&(r+=c,u=!0),this.match("\\ldots")||this.matchAll(this._truncationMarkerTokens)}if(a&&!r)return this.index=s,i.length<10?Ku(t*parseInt(i,10)):{num:t<0?"-"+i:i};let l=this.parseExponent();if(!a&&!l&&i.length<10)return Ku(t*parseInt(i,10));if(!u&&this.options.parseNumbers==="rational"){let c=i.length>16||i.length===16&&i>"9007199254740991";if(!r){if(c){let y=t<0?"-"+i:i;return l?["Multiply",{num:y},["Power",10,l]]:{num:y}}let x=parseInt(i,10);return l?["Multiply",t*x,["Power",10,l]]:Ku(t*x)}let f=r.length;if(i.length+f>15){let x=BigInt(i),y=BigInt(r),v=BigInt(10)**BigInt(f),E=x*v+y,_=t<0?-E:E;return l?["Multiply",["Rational",{num:_.toString()},Number(v)],["Power",10,l]]:["Rational",{num:_.toString()},Number(v)]}let d=parseInt(i,10),m=parseInt(r,10),g=d*10**f+m,h=10**f;return l?["Multiply",["Rational",t*g,h],["Power",10,l]]:["Rational",t*g,h]}return{num:(t<0?"-":"")+i+(a?"."+r:"")+(l?"e"+l:"")}}parsePrefixOperator(e){e||(e={minPrec:0}),e.minPrec||(e={...e,minPrec:0});let t=this.index;for(let[i,r]of this.peekDefinitions("prefix")){this.index=t+r;let o=i.parse(this,{...e,minPrec:i.precedence+1});if(o!==null)return o}return this.index=t,null}parseInfixOperator(e,t){t??={minPrec:0},t.minPrec,t.minPrec===void 0&&(t={...t,minPrec:0});let i=this.index;for(let[r,o]of this.peekDefinitions("infix"))if(r.precedence>=t.minPrec){this.index=i+o;let s=r.parse(this,e,t);if(s!==null)return s}return this.index=i,null}parseArguments(e="enclosure",t){if(this.atTerminator(t))return null;let i=this.index,r=this.parseEnclosure();if(e==="enclosure")return r===null?null:bi(r)??[];if(e==="implicit"){if(S(r)==="Delimiter"){let s=b(r,1);return S(s)==="Sequence"?A(s):s===null?[]:[s]}if(r!==null)return[r];let o=this.parseExpression({...t,minPrec:wn});return o===null?null:[o]}return this.index=i,null}parseEnclosure(){let e=this.index,t=this.peek,i=oa[t],r=i?this._tokens[this.index+1]:t;i&&r==="<{>"&&(r=this._tokens[this.index+2]);let o=this._dictionary.matchfixByOpen.get(r)??[];o.length===0&&!r&&(o=[...this.getDefs("matchfix")]);for(let s of o){if(this.index=e,!this.matchDelimiter(s.openTrigger,s.closeTrigger))continue;let u=this.index;this.skipSpace();let l=this.parseExpression();this.skipSpace();let c=this._boundaries[this._boundaries.length-1]?.tokens,f=this.matchBoundary(),p=typeof s.openTrigger=="string"&&typeof s.closeTrigger=="string"&&s.openTrigger===s.closeTrigger||Array.isArray(s.openTrigger)&&Array.isArray(s.closeTrigger)&&s.openTrigger.length===s.closeTrigger.length&&s.openTrigger.every((m,g)=>m===s.closeTrigger[g]);if(f&&fe(l)&&p&&c){if(this.index=u,this.skipSpace(),l=this.parseExpression(),this.skipSpace(),!this.matchAll(c)){if(this.index=e,!this.atEnd)continue;return null}}else if(!f){let m=this._boundaries[this._boundaries.length-1]?.tokens;if(!m){this.index=e;continue}if(this.canSkipMatchfixReparsing(r,m,p)){this.removeBoundary(),this.index=e;continue}else if(this.removeBoundary(),this.index=u,this.skipSpace(),l=this.parseExpression(),this.skipSpace(),!this.matchAll(m)){if(this.index=e,!this.atEnd)continue;return null}}let d=s.parse(this,l??"Nothing");if(d!==null)return d}return this.index=e,null}parseGenericExpression(e){if(this.atTerminator(e))return null;let t=this.index,i=null,r=this.peekDefinitions("expression")??[];for(let[o,s]of r)if(this.index=t+s,typeof o.parse=="function"){if(i=o.parse(this,e),i!==null)return i}else return o.name;return this.index=t,null}parseFunction(e){if(this.atTerminator(e))return null;let t=this.index,i=null;for(let[s,a]of this.peekDefinitions("function"))if(this.index=t+a,typeof s.parse=="function"){if(i=s.parse(this,e),i!==null)return i}else{i=s.name;break}let r=!1;if(i===null&&(this.index=t,i=Lo(this),!this.isFunctionOperator(i))){if(!this.looksLikePredicate(i))return this.index=t,null;r=!0}do{let s=this.parsePostfixOperator(i,e);if(s===null)break;i=s}while(!0);let o=this.parseArguments("enclosure",e);return o===null?i:r&&typeof i=="string"&&(this.inQuantifierScope||i==="D"||i==="N")?["Predicate",i,...o]:typeof i=="string"?[i,...o]:["Apply",i,...o]}parseSymbol(e){if(this.atTerminator(e))return null;let t=this.index;for(let[r,o]of this.peekDefinitions("symbol"))if(this.index=t+o,typeof r.parse=="function"){let s=r.parse(this,e);if(s!==null)return s}else return r.name;this.index=t;let i=Lo(this);return i!==null&&!this.getSymbolType(i).matches("error")?i:(this.index=t,null)}tryParseBareFunction(e){if(this.options.strict!==!1)return null;let t=this.index,i="";for(;!this.atEnd&&/^[a-zA-Z]$/.test(this.peek);)i+=this.peek,this.index++;if(!i)return this.index=t,null;if(this.skipSpace(),this.peek!=="(")return this.index=t,null;let o={sin:"Sin",cos:"Cos",tan:"Tan",cot:"Cot",sec:"Sec",csc:"Csc",sinh:"Sinh",cosh:"Cosh",tanh:"Tanh",coth:"Coth",sech:"Sech",csch:"Csch",arcsin:"Arcsin",arccos:"Arccos",arctan:"Arctan",arccot:"Arccot",arcsec:"Arcsec",arccsc:"Arccsc",asin:"Arcsin",acos:"Arccos",atan:"Arctan",arcsinh:"Arsinh",arccosh:"Arcosh",arctanh:"Artanh",arccoth:"Arcoth",arcsech:"Arsech",arccsch:"Arcsch",asinh:"Arsinh",acosh:"Arcosh",atanh:"Artanh",log:"Log",ln:"Ln",exp:"Exp",lg:"Lg",lb:"Lb",sqrt:"Sqrt",abs:"Abs",sgn:"Sgn",sign:"Sgn",floor:"Floor",ceil:"Ceil",round:"Round",max:"Max",min:"Min",gcd:"Gcd",lcm:"Lcm"}[i];if(!o)return this.index=t,null;let s=this.parseArguments("enclosure",e);return s===null?(this.index=t,null):[o,...s]}parseSupsub(e){if(this.atEnd)return e;let t=this.index;this.skipSpace();let i=[],r=[],o=t;for(;this.peek==="_"||this.peek==="^";){if(this.match("_"))if(o=this.index,this.match("_")||this.match("^"))r.push(this.error("syntax-error",o));else{let a=this.parseGroup()??this.parseToken();if(a===null&&this.options.strict===!1&&this.peek==="("&&(a=this.parseEnclosure()),a??=this.parseStringGroup(),a===null)return this.error("missing",t);r.push(a)}else if(this.match("^"))if(o=this.index,this.match("_")||this.match("^"))i.push(this.error("syntax-error",o));else{let a=this.parseGroup()??this.parseToken();if(a===null&&this.options.strict===!1&&this.peek==="("&&(a=this.parseEnclosure()),a===null)return this.error("missing",t);i.push(a)}o=this.index,this.skipSpace()}if(i.length===0&&r.length===0)return this.index=t,e;let s=e;if(r.length>0){let a=[...this.getDefs("infix")].filter(u=>u.latexTrigger==="_");if(a){let u=["Subscript",s,r.length===1?r[0]:["List",...r]];for(let l of a)if(typeof l.parse=="function"?s=l.parse(this,u,{minPrec:0}):s=u,s!==null)break}}if(i.length>0){let a=[...this.getDefs("infix")].filter(u=>u.latexTrigger==="^");if(a){let u=i.filter(l=>!fe(l));if(u.length!==0){let l=u.length===1?u[0]:["List",...u],c=["Superscript",s,l];for(let f of a)if(typeof f.parse=="function"?s=f.parse(this,c,{minPrec:0}):s=c,s!==null)break}}}return s===null&&(this.index=t),s}parsePostfixOperator(e,t){if(e===null||this.atEnd)return null;let i=this.index;for(let[r,o]of this.peekDefinitions("postfix")){this.index=i+o;let s=r.parse(this,e,t);if(s!==null)return s}return this.index=i,null}parseSyntaxError(){let e=this.index;if(this.peek==="^")return this.index+=1,["Superscript",this.error("missing",e),ne(this.parseGroup())];let t=this.peekDefinitions("operator");if(t.length>0){if(t=this.peekDefinitions("postfix"),t.length>0){let[a,u]=t[0];if(this.index+=u,typeof a.parse=="function"){let l=a.parse(this,this.error("missing",e));if(l!==null)return l}return this.error("unexpected-operator",e)}if(t=this.peekDefinitions("prefix"),t.length>0){let[a,u]=t[0];if(this.index+=u,typeof a.parse=="function"){let l=a.parse(this,{minPrec:0});if(l!==null)return l}return a.name?[a.name,this.parseExpression()??this.error("missing",e)]:this.error("unexpected-operator",e)}if(t=this.peekDefinitions("infix"),t.length>0){let[a,u]=t[0];this.index+=u;let l=a.parse(this,this.error("missing",e),{minPrec:0});return l!==null?l:this.error("unexpected-operator",e)}}let i=this.index,r=Qu(this);if(r!==null)return r;if(r=Lo(this),r!==null)return this.error(["unexpected-symbol",{str:r}],i);let o=this.peek;if(!o)return this.error("syntax-error",e);if(x1(this))return this.error("unexpected-delimiter",e);if(o[0]!=="\\")return this.error(["unexpected-token",{str:ot(o)}],e);let s=this.nextToken();if(this.skipSpaceTokens(),s==="\\end"){let a=this.parseStringGroup();return a===null?this.error("expected-environment-name",e):this.error(["unbalanced-environment",{str:a}],e)}for(;this.match("[");){let a=0;for(;!this.atEnd&&a===0&&this.peek!=="]";)this.peek==="["&&(a+=1),this.peek==="]"&&(a-=1),this.nextToken();this.match("]")}for(;this.match("<{>");){let a=0;for(;!this.atEnd&&a===0&&this.peek!=="<}>";)this.peek==="<{>"&&(a+=1),this.peek==="<}>"&&(a-=1),this.nextToken();this.match("<}>")}return this.error(["unexpected-command",{str:ot(s)}],e)}parsePrimary(e){if(this.atBoundary||this.atTerminator(e))return null;let t=null,i=this.index;if(this.match("<}>"))return this.error("unexpected-closing-delimiter",i);if(t??=this.parseGroup(),t??=this.parseNumber(),t??=this.parseEnclosure(),t??=this.parseEnvironment(e),t===null&&this.matchAll(this._positiveInfinityTokens)&&(t="PositiveInfinity"),t===null&&this.matchAll(this._negativeInfinityTokens)&&(t="NegativeInfinity"),t===null&&this.matchAll(this._notANumberTokens)&&(t="NaN"),t===null&&this.matchAll(this._imaginaryUnitTokens)&&(t="ImaginaryUnit"),t??=this.tryParseBareFunction(e),t??=this.parseGenericExpression(e)??this.parseFunction(e)??this.parseSymbol(e)??Qu(this),t!==null&&fe(t))return this.parsePrimary(e);if(t!==null){t=this.decorate(t,i);let r=null,o=this.index;do{if(r=this.parsePostfixOperator(t,e),t=r??t,this.index===o&&r!==null){this.index;break}o=this.index}while(r!==null)}return t!==null&&(t=this.parseSupsub(t)),t===null&&(t=this.options.parseUnexpectedToken?.(null,this)??null,t===null&&this.peek.startsWith("\\")&&(this.nextToken(),t=this.error("unexpected-command",i))),this.decorate(t,i)}parseExpression(e){this.skipSpace();let t=this.index;if(this.atBoundary)return this.index=t,null;e??={minPrec:0},e.minPrec,e.minPrec===void 0&&(e={...e,minPrec:0});let i=this.parsePrefixOperator({...e,minPrec:0});if(i??=this.parsePrimary(e),i!==null){let r=!1;for(;!r&&!this.atTerminator(e);){this.skipSpace();let o=this.parseInfixOperator(i,e);if(o===null&&e.minPrec<=Fu&&this.peekDefinitions("operator").length===0){let s=this.parseExpression({...e,minPrec:Fu+1});s!==null?S(i)==="InvisibleOperator"?S(s)==="InvisibleOperator"?o=["InvisibleOperator",...A(i),...A(s)]:o=["InvisibleOperator",...A(i),s]:S(s)==="InvisibleOperator"?o=["InvisibleOperator",i,...A(s)]:o=["InvisibleOperator",i,s]:o===null&&(o=this.options.parseUnexpectedToken?.(i,this)??null)}o!==null?i=o:r=!0}}return this.decorate(i,t)}decorate(e,t){if(e===null)return null;if(!this.options.preserveLatex)return e;let i=this.latex(t,this.index);return Array.isArray(e)?e={latex:i,fn:e}:typeof e=="number"?e={latex:i,num:Number(e).toString()}:typeof e=="string"?e.startsWith("'")?e={latex:i,str:e.slice(1,-1)}:e={latex:i,sym:e}:typeof e=="object"&&e!==null&&(e.latex=i),e}error(e,t){let i;typeof e=="string"?(e.startsWith("'"),i={str:e}):(e[0].startsWith("'"),i=["ErrorCode",{str:e[0]},...e.slice(1)]);let r=this.latex(t,this.index);return r?["Error",i,["LatexString",{str:r}]]:["Error",i]}isFunctionOperator(e){return e===null||e==="D"||e==="N"?!1:!!this.getSymbolType(e).matches("function")}looksLikePredicate(e){return e===null||typeof e!="string"||!/^[A-Z]$/.test(e)?!1:(this.skipSpace(),this.peek==="("||this.peek==="\\left")}*getDefs(e){if(e==="operator")for(let t=this._dictionary.defs.length-1;t>=0;t--){let i=this._dictionary.defs[t];/^prefix|infix|postfix/.test(i.kind)&&(yield i)}else for(let t=this._dictionary.defs.length-1;t>=0;t--){let i=this._dictionary.defs[t];i.kind===e&&(yield i)}}};function Kd(n,e){let t=n.index,i=Lo(n)?.trim();if(i===null)return 0;let r=i!==e?0:n.index-t;return n.index=t,r}function x1(n){let e=n.peek;return Object.values(el).includes(e)||el[e]?(n.nextToken(),!0):oa[e]||Object.values(oa).includes(e)?(n.nextToken(),n.nextToken(),!0):!1}function em(n){let e=n.index;if(n.matchAll(["\\overset","<{>"])&&(n.match(".")||n.match("\\cdots"))&&n.matchAll(["<}>","<{>"])){let t=n.nextToken();if(t&&/^\d$/.test(t)&&n.match("<}>"))return t}return n.index=e,null}function y1(n){let e=n.peek;return e==="\\overline"||e==="\\overset"||e==="\\wideparent"||e==="\\overarc"||e==="("||e==="\\left"}function nm(n,e,t){let i=new nl(Ve(n),e,t),r=i.parseExpression();if(!i.atEnd){let o=i.parseSyntaxError();r=r!==null?["Sequence",r,o]:o}if(r??="Nothing",t.preserveLatex){if(Array.isArray(r))return{latex:n,fn:r};if(typeof r=="number")return{latex:n,num:Number(r).toString()};if(typeof r=="string"){if(Qs(r))return{latex:n,str:se(r)};if(Bn(r))return{latex:n,sym:r};if(Un(r))return{latex:n,num:r}}typeof r=="object"&&r!==null&&(r.latex=n)}return r}function Ku(n){return n===0?{num:"0"}:Number.isInteger(n)&&Math.abs(n)<K?n:{num:n.toString()}}Pn();rc();kt();me();At();function A0(n,e){if(e===0)return{estimate:n,error:e};let t=Math.abs(e),i=Math.floor(Math.log10(t)),r=2,o=Math.pow(10,i-(r-1)),s=Math.round(e/o)*o,a=Math.max(0,-(i-(r-1)));return{estimate:Number(n.toFixed(a)),error:s}}function ao(n,e,t,i=1e5){let r=0,o=0;if(e===-1/0&&t===1/0)for(let d=0;d<i;d++){let m=Math.random(),g=Math.tan(Math.PI*(m-.5)),h=Math.PI*(1+g*g),x=n(g)/h;r+=x,o+=x*x}else if(e===-1/0)for(let d=0;d<i;d++){let m=Math.random(),g=t-Math.log(1-m),h=1/(1-m),x=n(g)/h;r+=x,o+=x*x}else if(t===1/0)for(let d=0;d<i;d++){let m=Math.random(),g=e+Math.log(m),h=1/m,x=n(g)/h;r+=x,o+=x*x}else for(let d=0;d<i;d++){let m=n(e+Math.random()*(t-e));r+=m,o+=m*m}let s=r/i,a=(o-i*s*s)/(i-1),u=Math.sqrt(a/i),l=t-e,c=s*l,f=u*l;return A0(c,f)}en();At();cn();tn();var Jg=100;var k0={Sin:["Cos","_"],Cos:["Negate",["Sin","_"]],Tan:["Power",["Sec","_"],2],Sec:["Multiply",["Tan","_"],["Sec","_"]],Csc:["Multiply",["Negate",["Cot","_"]],["Csc","_"]],Cot:["Negate",["Power",["Csc","_"],2]],Arcsin:["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],Arccos:["Negate",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]]],Arctan:["Power",["Add",1,["Power","_",2]],-1],Arcsec:["Multiply",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],["Negate",["Power","_",2]]],Arccsc:["Multiply",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],["Negate",["Power","_",2]]],Arccot:["Negate",["Power",["Add",1,["Power","_",2]],-1]],Sinh:["Cosh","_"],Cosh:["Sinh","_"],Tanh:["Power",["Sech","_"],2],Sech:["Negate",["Multiply",["Tanh","_"],["Sech","_"]]],Csch:["Negate",["Multiply",["Coth","_"],["Csch","_"]]],Coth:["Negate",["Power",["Csch","_"],2]],Arsinh:["Power",["Add",["Power","_",2],1],["Negate","Half"]],Arcosh:["Power",["Subtract",["Power","_",2],1],["Negate","Half"]],Artanh:["Power",["Subtract",1,["Power","_",2]],-1],Arsech:["Negate",["Divide",1,["Multiply","_",["Sqrt",["Subtract",1,["Power","_",2]]]]]],Arcsch:["Negate",["Divide",1,["Multiply",["Abs","_"],["Sqrt",["Add",1,["Power","_",2]]]]]],Arcoth:["Negate",["Power",["Subtract",1,["Power","_",2]],-1]],Ln:["Divide",1,"_"],Log:["Power",["Multiply","_",["Ln","10"]],-1],Sqrt:["Multiply",["Power","_",["Negate","Half"]],"Half"],Abs:["Sign","_"],Floor:0,Ceil:0,Round:0,Erf:["Multiply",["Divide","2",["Sqrt","Pi"]],["Exp",["Negate",["Square","_"]]]],Gamma:["Multiply",["Gamma","_"],["Digamma","_"]],Erfc:["Negate",["Multiply",["Divide",2,["Sqrt","Pi"]],["Exp",["Negate",["Square","_"]]]]],LogGamma:["Digamma","_"],Digamma:["Trigamma","_"],LambertW:["Divide",["LambertW","_"],["Multiply","_",["Add",1,["LambertW","_"]]]],FresnelS:["Sin",["Multiply",["Divide","Pi",2],["Square","_"]]],FresnelC:["Cos",["Multiply",["Divide","Pi",2],["Square","_"]]],Erfi:["Multiply",["Divide",2,["Sqrt","Pi"]],["Exp",["Square","_"]]]};function Yg(n,e){if(e===0)return n;let t=n.engine,i="_";n.symbol&&n.operatorDefinition&&(n=Rt(t.symbol(n.symbol),[t.symbol("_")])),n.operator==="Function"&&(i=n.ops[1]?.symbol??"_",n=n.ops[0]);let r=n;for(;e-- >0&&r;)r=_e(r,i);return r}function _e(n,e,t=0){if(t>Jg){`${Jg}`;return}let i=n.engine;if(n.string)return;if(n.isNumberLiteral)return n.engine.Zero;if(n.symbol===e)return n.engine.One;if(n.symbol)return n.engine.Zero;if(!n.operator)return;if(n.operator==="Negate"){let u=_e(n.op1,e,t+1);return u?u.neg():i._fn("D",[n.op1,i.symbol(e)]).neg()}if(n.operator==="Block")return _e(n.op1,e,t+1);if(n.operator==="D"){let u=n.evaluate();return u.operator==="D"?void 0:_e(u,e,t+1)}if(n.operator==="Add"){let u=n.ops.map(l=>_e(l,e,t+1));return u.some(l=>l===void 0)?void 0:X(...u)}if(n.operator==="Multiply"){let u=n.ops.map((l,c)=>{let f=n.ops.slice();f.splice(c,1);let p=pe(...f);return(_e(l,e,t+1)??i._fn("D",[l,i.symbol(e)])).mul(p)});return u.some(l=>l===void 0)?void 0:X(...u)}if(n.operator==="Root"){let[u,l]=n.ops;if(!u.has(e))return i.Zero;let c=i.One.div(l),f=_e(u,e,t+1)??i._fn("D",[u,i.symbol(e)]),p=c.sub(i.One),d=i.function("Power",[u,p],{structural:!0});return c.mul(d).mul(f)}if(n.operator==="Power"){let[u,l]=n.ops,c=u.has(e),f=l.has(e);if(!c&&!f)return i.Zero;if(c&&!f){let v=_e(u,e,t+1)??i._fn("D",[u,i.symbol(e)]);return l.mul(u.pow(l.add(i.NegativeOne))).mul(v)}if(!c&&f){let v=_e(l,e,t+1)??i._fn("D",[l,i.symbol(e)]),E=i._fn("Ln",[u]);return n.mul(E).mul(v)}let p=u,d=l,m=_e(p,e,t+1)??i._fn("D",[p,i.symbol(e)]),g=_e(d,e,t+1)??i._fn("D",[d,i.symbol(e)]),h=i._fn("Ln",[p]),x=g.mul(h),y=d.mul(m).div(p);return n.mul(x.add(y))}if(n.operator==="Divide"){let[u,l]=n.ops,c=_e(u,e,t+1)??i._fn("D",[u,i.symbol(e)]),f=_e(l,e,t+1)??i._fn("D",[l,i.symbol(e)]);return c.mul(l).sub(f.mul(u)).div(l.pow(2))}if(n.operator==="Log"&&n.nops===2){let[u,l]=n.ops,c=u.has(e),f=l.has(e);if(!c&&!f)return i.Zero;if(c&&!f){let m=_e(u,e,t+1)??i._fn("D",[u,i.symbol(e)]),g=i._fn("Ln",[l]);return m.div(u.mul(g))}let p=i._fn("Ln",[u]),d=i._fn("Ln",[l]);return _e(p.div(d),e,t+1)}if(["Mod","GCD","LCM"].includes(n.operator))return i.Zero;if(["BesselJ","BesselY","BesselI","BesselK"].includes(n.operator)&&n.nops===2){let[u,l]=n.ops,c=l.has(e),f=u.has(e);if(!c&&!f)return i.Zero;if(f)return;let p=_e(l,e,t+1)??i._fn("D",[l,i.symbol(e)]),d=n.operator,m=u.sub(i.One),g=u.add(i.One),h;if(d==="BesselJ"||d==="BesselY"){let x=i._fn(d,[m,l]),y=i._fn(d,[g,l]);h=x.sub(y).div(2)}else if(d==="BesselI"){let x=i._fn(d,[m,l]),y=i._fn(d,[g,l]);h=x.add(y).div(2)}else{let x=i._fn(d,[m,l]),y=i._fn(d,[g,l]);h=x.add(y).div(2).neg()}return h.mul(p)}let r=k0[n.operator];if(r===void 0){if(n.nops>1)return;let u=i._fn("Derivative",[i.symbol(n.operator),i.One]);if(!u.isValid)return;let l=n.ops[0],c=_e(l,e,t+1)??i._fn("D",[l,i.symbol(e)]);return c.isValid?i._fn("Apply",[u,l]).mul(c):void 0}if(n.nops>1)return i._fn("D",[n,i.symbol(e)]);let o=n.ops[0],s=_e(o,e,t+1)??i._fn("D",[o,i.symbol(e)]),a=i.box(r).subs({_:o});return a.mul(s)}cn();tn();oi();Ni();to();Ki();function Qg(n,e){if(!n.has(e))return 0;let t=n.operator;return t==="Ln"||t==="Log"||t==="Log2"||t==="Log10"?5:t==="Arcsin"||t==="Arccos"||t==="Arctan"||t==="Arcsec"||t==="Arccsc"||t==="Arccot"?4:n.symbol===e||t==="Power"&&n.op1.symbol===e&&!n.op2.has(e)||t==="Sqrt"&&n.op1.has(e)?3:t==="Sin"||t==="Cos"||t==="Tan"||t==="Sec"||t==="Csc"||t==="Cot"?2:t==="Exp"||t==="Power"&&!n.op1.has(e)&&n.op2.has(e)?1:3}function nh(n,e,t=0){if(n.length<2||t>2)return null;let i=n[0].engine,r=[...n].sort((d,m)=>Qg(m,e)-Qg(d,e)),o=r[0],s=r.slice(1),a=s.length===1?s[0]:pe(...s),u=_e(o,e);if(!u)return null;let l=qa(a,e);if(!l||l.operator==="Integrate")return null;let c=o.mul(l),f=l.mul(u),p=C0(f,e,t+1);return!p||p.operator==="Integrate"?null:c.sub(p).simplify()}function qa(n,e){let t=n.engine;if(n.symbol===e)return t.box(["Divide",["Power",n,2],2]).simplify();if(!n.has(e))return t.box(["Multiply",n,t.symbol(e)]).simplify();if(n.operator==="Sin"&&n.op1.symbol===e)return t.box(["Negate",["Cos",e]]);if(n.operator==="Cos"&&n.op1.symbol===e)return t.box(["Sin",e]);if(n.operator==="Exp"&&n.op1.symbol===e||n.operator==="Power"&&n.op1.symbol==="ExponentialE"&&n.op2.symbol===e)return n;if(n.operator==="Power"&&n.op1.symbol===e){let i=n.op2;if(!i.has(e)&&!i.is(-1))return t.box(["Divide",["Power",e,["Add",i,1]],["Add",i,1]]).simplify()}return null}function C0(n,e,t){let i=qa(n,e);if(i)return i;if(n.operator==="Multiply"){let r=n.ops.filter(o=>o.has(e));if(r.length>=2){let o=nh(r,e,t);if(o){let s=n.ops.filter(a=>!a.has(e));return s.length>0?pe(...s).mul(o):o}}}return xn(n,e)}function Xg(n,e){if(n.operator!=="Multiply")return null;let t=n.engine,i=n.ops;for(let r=0;r<i.length;r++){let o=i[r],s=th(o,e);if(!s)continue;let{outer:a,inner:u}=s,l=_e(u,e);if(!l)continue;let c=i.filter((x,y)=>y!==r),f=c.length===1?c[0]:pe(...c),p=M0(f,l,e);if(p===null)continue;let d=t.symbol("_u_"),m=ih(a,d,t),g=qa(m,"_u_");if(!g)continue;let h=g.subs({_u_:u});return p.is(1)?h.simplify():p.mul(h).simplify()}return null}function th(n,e){let t=n.operator;if(!t)return null;if(["Sin","Cos","Tan","Sec","Csc","Cot","Exp","Ln","Sinh","Cosh","Tanh","Sqrt"].includes(t)&&n.nops===1){let r=n.op1;if(r.symbol===e)return null;if(r.has(e))return{outer:t,inner:r}}if(t==="Power"&&n.op1.symbol==="ExponentialE"){let r=n.op2;if(r.symbol===e)return null;if(r.has(e))return{outer:"Exp",inner:r}}return null}function ih(n,e,t){return n==="Exp"?t.box(["Power","ExponentialE",e]):t.box([n,e])}function R0(n,e){let t=n.engine,i=th(n,e);if(!i)return null;let{outer:r,inner:o}=i,s=null;if(o.operator==="Multiply"){let f=o.ops,p=f.find(d=>d.symbol===e);if(p){let d=f.filter(m=>m!==p);d.every(m=>!m.has(e))&&(s=d.length===1?d[0]:t.box(["Multiply",...d]))}}else if(o.operator==="Add"){let f=o.ops,p=null,d=[];for(let m of f)if(!m.has(e))d.push(m);else if(m.symbol===e)p=t.One;else if(m.operator==="Multiply"){let g=m.ops,h=g.find(x=>x.symbol===e);if(h){let x=g.filter(y=>y!==h);x.every(y=>!y.has(e))&&(p=x.length===1?x[0]:t.box(["Multiply",...x]))}}else return null;p&&(s=p)}if(!s)return null;let a=t.symbol("_u_"),u=ih(r,a,t),l=qa(u,"_u_");return l?l.subs({_u_:o}).div(s).simplify():null}function M0(n,e,t){let i=n.engine;if(n.isSame(e))return i.One;let r=n.div(e).simplify();return r.has(t)?null:r}function Kg(n,e){if(n.length!==2)return null;let t=n[0].engine,i=null,r=null;for(let u of n)u.operator==="Exp"&&u.op1.symbol===e||u.operator==="Power"&&u.op1.symbol==="ExponentialE"&&u.op2.symbol===e?i=u:(u.operator==="Sin"||u.operator==="Cos")&&(r=u);if(!i||!r)return null;let o=r.operator,s=r.op1;if(s.symbol===e)return o==="Sin"?t.box(["Multiply",["Rational",1,2],["Exp",e],["Subtract",["Sin",e],["Cos",e]]]).simplify():t.box(["Multiply",["Rational",1,2],["Exp",e],["Add",["Sin",e],["Cos",e]]]).simplify();if(s.operator==="Multiply"&&s.ops){let u=null,l=!1;for(let c of s.ops)c.symbol===e?l=!0:c.has(e)||(u=u?u.mul(c):c);if(l&&u){let c=u,f=t.box(["Exp",e]),p=t.box(["Add",["Power",c.json,2],1]),d=f.div(p);if(o==="Sin"){let m=r,g=t.box(["Cos",s.json]);return d.mul(m.sub(c.mul(g))).simplify()}else{let m=t.box(["Sin",s.json]),g=r;return d.mul(c.mul(m).add(g)).simplify()}}}let a=fs(s,e);if(a){let{a:u}=a,l=t.box(["Exp",e]),c=t.box(["Add",["Power",u.json,2],1]),f=l.div(c);if(o==="Sin"){let p=r,d=t.box(["Cos",s.json]);return f.mul(p.sub(u.mul(d))).simplify()}else{let p=t.box(["Sin",s.json]),d=r;return f.mul(u.mul(p).add(d)).simplify()}}return null}function L(n){for(let[e,t]of Object.entries(n))if(e!=="x"&&e!=="_x"&&t.has("_x"))return!1;return!0}var D0=[{match:["Power",["Add",["Multiply","_a","_x"],"__b"],"_n"],replace:["Divide",["Power",["Add",["Multiply","_a","_x"],"__b"],["Add","_n",1]],["Multiply","_a",["Add","_n",1]]],condition:n=>L(n)&&!n._n.is(-1)},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],1/2],replace:["Divide",["Multiply",2,["Power",["Add",["Multiply","_a","_x"],"__b"],3]],["Multiply",3,"_a"]],condition:n=>L(n)&&n._a.isNumberLiteral},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],1/3],replace:["Divide",["Multiply",3,["Power",["Add",["Multiply","_a","_x"],"__b"],4]],["Multiply",4,"_a"]],condition:n=>L(n)&&n._a.isNumberLiteral},{match:["Power","_a","_x"],replace:["Divide",["Power","_a","_x"],["Ln","_a"]],condition:n=>L(n)&&!n._a.has("_x")},{match:["Power",["Add",["Multiply","_a","_x"],"__b"],-1],replace:["Divide",["Ln",["Abs",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:L},{match:["Power",["Add","_x","__b"],-1],replace:["Ln",["Abs",["Add","_x","__b"]]],condition:n=>L(n)&&n._x.symbol!==null},{match:["Divide",1,["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:L},{match:["Divide",1,["Add","_x","__b"]],replace:["Ln",["Abs",["Add","_x","__b"]]],condition:n=>L(n)&&n._x.symbol!==null},{match:["Ln",["Add",["Multiply","_a","_x"],"__b"]],replace:["Subtract",["Multiply",["Add",["Multiply","_a","_x"],"__b"],["Ln","_x"]],["Subtract",["Multiply","_a","_x"],"__b"]],condition:L},{match:["Exp",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Exp",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:L},{match:["Power",["Sech",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Tanh",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:L},{match:["Power",["Sin",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Add","_x",["Divide",["Sin",["Multiply",2,"_a","_x"]],2]],2],condition:L},{match:["Power",["Cos",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Add","_x",["Divide",["Sin",["Multiply",2,"_a","_x"]],2]],2],condition:L},{match:["Sin",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Cos",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:L},{match:["Cos",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Sin",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:L},{match:["Tan",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sec",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:L},{match:["Sec",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Add",["Sec",["Add",["Multiply","_a","_x"],"__b"]],["Tan",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:L},{match:["Csc",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Add",["Csc",["Add",["Multiply","_a","_x"],"__b"]],["Cot",["Add",["Multiply","_a","_x"],"__b"]]]]]],"_a"],condition:L},{match:["Cot",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Sin",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:L},{match:["Power",["Sec",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Tan",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:L},{match:["Power",["Csc",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Negate",["Cot",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:L},{match:["Multiply",["Sec",["Add",["Multiply","_a","_x"],"__b"]],["Tan",["Add",["Multiply","_a","_x"],"__b"]]],replace:["Divide",["Sec",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:L},{match:["Multiply",["Csc",["Add",["Multiply","_a","_x"],"__b"]],["Cot",["Add",["Multiply","_a","_x"],"__b"]]],replace:["Divide",["Negate",["Csc",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:L},{match:["Sinh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Cosh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:L},{match:["Cosh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sinh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:L},{match:["Tanh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Sech",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:L},{match:["Sech",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Abs",["Tanh",["Add",["Multiply","_a","_x"],"__b"]]]],"_a"],condition:L},{match:["Csch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Coth",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:L},{match:["Coth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Abs",["Csch",["Add",["Multiply","_a","_x"],"__b"]]]]],"_a"],condition:L},{match:["Arsinh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]],"_a"],condition:L},{match:["Arcosh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]],"_a"],condition:L},{match:["Artanh",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Divide",["Add",1,["Add",["Multiply","_a","_x"],"__b"]],["Subtract",1,["Add",["Multiply","_a","_x"],"__b"]]]],["Multiply",2,"_a"]],condition:L},{match:["Arsech",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:L},{match:["Arcsch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:L},{match:["Arcoth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Ln",["Divide",["Add",["Add",["Multiply","_a","_x"],"__b"],1],["Subtract",["Add",["Multiply","_a","_x"],"__b"],1]]],["Multiply",2,"_a"]],condition:L},{match:["Arcsch",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:L},{match:["Arcoth",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Negate",["Ln",["Add",["Add",["Multiply","_a","_x"],"__b"],["Sqrt",["Subtract",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]]]]],"_a"],condition:L},{match:["Arctan",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Subtract",["Multiply",["Add",["Multiply","_a","_x"],"__b"],["Arctan",["Add",["Multiply","_a","_x"],"__b"]]],["Multiply",["Rational",1,2],["Ln",["Add",1,["Power",["Add",["Multiply","_a","_x"],"__b"],2]]]]],"_a"],condition:L},{match:["Arccos",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Subtract",["Multiply",["Add",["Multiply","_a","_x"],"__b"],["Arccos",["Add",["Multiply","_a","_x"],"__b"]]],["Sqrt",["Subtract",1,["Power",["Add",["Multiply","_a","_x"],"__b"],2]]]],"_a"],condition:L},{match:["Arcsin",["Add",["Multiply","_a","_x"],"__b"]],replace:["Divide",["Add",["Multiply",["Add",["Multiply","_a","_x"],"__b"],["Arcsin",["Add",["Multiply","_a","_x"],"__b"]]],["Sqrt",["Subtract",1,["Power",["Add",["Multiply","_a","_x"],"__b"],2]]]],"_a"],condition:L},{match:["Divide",1,["Add",["Power",["Add",["Multiply","_a","_x"],"__b"],2],1]],replace:["Divide",["Arctan",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:L},{match:["Divide",1,["Add",1,["Power",["Add",["Multiply","_a","_x"],"__b"],2]]],replace:["Divide",["Arctan",["Add",["Multiply","_a","_x"],"__b"]],"_a"],condition:L},{match:["Power",["Csch",["Add",["Multiply","_a","_x"],"__b"]],2],replace:["Divide",["Negate",["Coth",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:L},{match:["Multiply",["Sech",["Add",["Multiply","_a","_x"],"__b"]],["Tanh",["Add",["Multiply","_a","_x"],"__b"]]],replace:["Divide",["Negate",["Sech",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:L},{match:["Multiply",["Csch",["Add",["Multiply","_a","_x"],"__b"]],["Coth",["Add",["Multiply","_a","_x"],"__b"]]],replace:["Divide",["Negate",["Csch",["Add",["Multiply","_a","_x"],"__b"]]],"_a"],condition:L},{match:["Multiply",["Exp","_x"],["Sin","_x"]],replace:["Multiply",["Rational",1,2],["Exp","_x"],["Subtract",["Sin","_x"],["Cos","_x"]]],condition:n=>L(n)&&n._x.symbol!==null},{match:["Multiply",["Exp","_x"],["Cos","_x"]],replace:["Multiply",["Rational",1,2],["Exp","_x"],["Add",["Sin","_x"],["Cos","_x"]]],condition:n=>L(n)&&n._x.symbol!==null},{match:["Multiply",["Sin","_x"],["Exp","_x"]],replace:["Multiply",["Rational",1,2],["Exp","_x"],["Subtract",["Sin","_x"],["Cos","_x"]]],condition:n=>L(n)&&n._x.symbol!==null},{match:["Multiply",["Cos","_x"],["Exp","_x"]],replace:["Multiply",["Rational",1,2],["Exp","_x"],["Add",["Sin","_x"],["Cos","_x"]]],condition:n=>L(n)&&n._x.symbol!==null},{match:["Multiply",["Exp","_x"],["Sin",["Multiply","_a","_x"]]],replace:["Multiply",["Divide",["Exp","_x"],["Add",["Power","_a",2],1]],["Subtract",["Sin",["Multiply","_a","_x"]],["Multiply","_a",["Cos",["Multiply","_a","_x"]]]]],condition:L},{match:["Multiply",["Exp","_x"],["Cos",["Multiply","_a","_x"]]],replace:["Multiply",["Divide",["Exp","_x"],["Add",["Power","_a",2],1]],["Add",["Multiply","_a",["Sin",["Multiply","_a","_x"]]],["Cos",["Multiply","_a","_x"]]]],condition:L},{match:["Multiply",["Sin",["Multiply","_a","_x"]],["Exp","_x"]],replace:["Multiply",["Divide",["Exp","_x"],["Add",["Power","_a",2],1]],["Subtract",["Sin",["Multiply","_a","_x"]],["Multiply","_a",["Cos",["Multiply","_a","_x"]]]]],condition:L},{match:["Multiply",["Cos",["Multiply","_a","_x"]],["Exp","_x"]],replace:["Multiply",["Divide",["Exp","_x"],["Add",["Power","_a",2],1]],["Add",["Multiply","_a",["Sin",["Multiply","_a","_x"]]],["Cos",["Multiply","_a","_x"]]]],condition:L},{match:["Multiply",["Exp","_x"],["Sin",["Add",["Multiply","_a","_x"],"__b"]]],replace:["Multiply",["Divide",["Exp","_x"],["Add",["Power","_a",2],1]],["Subtract",["Sin",["Add",["Multiply","_a","_x"],"__b"]],["Multiply","_a",["Cos",["Add",["Multiply","_a","_x"],"__b"]]]]],condition:L},{match:["Multiply",["Exp","_x"],["Cos",["Add",["Multiply","_a","_x"],"__b"]]],replace:["Multiply",["Divide",["Exp","_x"],["Add",["Power","_a",2],1]],["Add",["Multiply","_a",["Sin",["Add",["Multiply","_a","_x"],"__b"]]],["Cos",["Add",["Multiply","_a","_x"],"__b"]]]],condition:L},{match:["Multiply",["Sin",["Add",["Multiply","_a","_x"],"__b"]],["Exp","_x"]],replace:["Multiply",["Divide",["Exp","_x"],["Add",["Power","_a",2],1]],["Subtract",["Sin",["Add",["Multiply","_a","_x"],"__b"]],["Multiply","_a",["Cos",["Add",["Multiply","_a","_x"],"__b"]]]]],condition:L},{match:["Multiply",["Cos",["Add",["Multiply","_a","_x"],"__b"]],["Exp","_x"]],replace:["Multiply",["Divide",["Exp","_x"],["Add",["Power","_a",2],1]],["Add",["Multiply","_a",["Sin",["Add",["Multiply","_a","_x"],"__b"]]],["Cos",["Add",["Multiply","_a","_x"],"__b"]]]],condition:L}];function fs(n,e){let t=n.engine;if(n.symbol===e)return{a:t.One,b:t.Zero};if(n.operator!=="Add")return null;let i=n.ops,r=null,o=t.Zero;for(let s of i)if(!s.has(e))o=o.add(s);else if(s.symbol===e)r=r?r.add(t.One):t.One;else if(s.operator==="Multiply"){let a=s.ops;if(a.find(l=>l.symbol===e)){let l=a.filter(c=>c.symbol!==e);if(l.every(c=>!c.has(e))){let c=l.length===1?l[0]:pe(...l);r=r?r.add(c):c}else return null}else return null}else return null;return r===null?null:{a:r,b:o}}function uo(n,e){let t=n.engine;if(n.operator!=="Add"){if(n.operator==="Power"&&n.op1.symbol===e&&n.op2.is(2))return{a:t.One,b:t.Zero,c:t.Zero};if(n.operator==="Multiply"){let a=n.ops,u=a.find(l=>l.operator==="Power"&&l.op1.symbol===e&&l.op2.is(2));if(u){let l=a.filter(f=>f!==u),c=l.length===0?t.One:l.length===1?l[0]:t.box(["Multiply",...l]);if(!c.has(e))return{a:c,b:t.Zero,c:t.Zero}}}return null}let i=n.ops,r=t.Zero,o=t.Zero,s=t.Zero;for(let a of i)if(!a.has(e))s=s.add(a);else if(a.symbol===e)o=o.add(t.One);else if(a.operator==="Power"&&a.op1.symbol===e&&a.op2.is(2))r=r.add(t.One);else if(a.operator==="Multiply"){let u=a.ops,l=u.find(f=>f.operator==="Power"&&f.op1.symbol===e&&f.op2.is(2));if(l){let f=u.filter(p=>p!==l);if(f.every(p=>!p.has(e))){let p=f.length===0?t.One:f.length===1?f[0]:t.box(["Multiply",...f]);r=r.add(p);continue}}if(u.find(f=>f.symbol===e)){let f=u.filter(p=>p.symbol!==e);if(f.every(p=>!p.has(e))){let p=f.length===0?t.One:f.length===1?f[0]:t.box(["Multiply",...f]);o=o.add(p);continue}}return null}else return null;return r.is(0)?null:{a:r.simplify(),b:o.simplify(),c:s.simplify()}}function xn(n,e){if(n.operator==="Function"||n.operator==="Block"||n.operator==="Delimiter")return xn(n.op1,e);let t=n.engine;if(n.symbol===e)return t.box(["Divide",["Power",n,2],2]);if(!n.has(e))return t.box(["Multiply",n,t.symbol(e)]);if(n.operator==="Add"){let a=n.ops.map(u=>xn(u,e));return X(...a).evaluate()}if(n.operator==="Negate")return xn(n.op1,e).neg();if(n.operator==="Multiply"){let a=[],u=[];for(let f of n.ops)f.has(e)?u.push(f):a.push(f);if(a.length>0){let f=pe(...a);if(u.length===0)return f.mul(t.symbol(e));let p=u.length===1?u[0]:pe(...u);if(u.length>1){let m=Xg(p,e);if(m)return f.mul(m).evaluate()}if(u.length===2){let m=Kg(u,e);if(m)return f.mul(m).evaluate()}let d=xn(p,e);return f.mul(d).evaluate()}let l=Xg(n,e);if(l)return l;let c=Kg(n.ops,e);if(c)return c;if(n.ops.length>=2){let f=nh(n.ops,e,0);if(f)return f}}if(n.operator==="Divide"){let a=Xr(n,e);if(!a.isSame(n))return xn(a,e);let u=ge(n.op1,e),l=ge(n.op2,e);if(u>=0&&l>=0&&u>=l){let c=ni(n.op1,n.op2,e);if(c){let[f,p]=c,d=xn(f,e);if(!p.is(0)){let m=p.div(n.op2),g=xn(m,e);return X(d,g)}return d}}if(!n.op2.has(e)){let c=xn(n.op1,e);return n.engine.box(["Divide",c,n.op2])}if(n.op1.is(1)&&n.op2.symbol===e)return t.box(["Ln",["Abs",e]]);if(!n.op1.has(e)&&n.op2.symbol===e)return t.box(["Multiply",n.op1,["Ln",["Abs",e]]]);if(!n.op1.has(e)&&n.op2.operator==="Add"&&n.op2.nops===2){let c=n.op2.ops,f=c.find(d=>d.operator==="Power"&&d.op1.symbol===e&&d.op2.is(2)),p=c.find(d=>d.is(1));if(f&&p){let d=t.box(["Arctan",e]);return n.op1.is(1)?d:n.op1.mul(d)}}if(n.op1.is(1)&&n.op2.operator==="Multiply"&&n.op2.nops===2){let c=n.op2.ops,f=c.find(d=>d.symbol===e),p=c.find(d=>d.operator==="Sqrt");if(f&&p){let d=p.op1;if(d.operator==="Add"&&d.nops===2){let m=d.ops,g=m.find(x=>x.operator==="Power"&&x.op1.symbol===e&&x.op2.is(2)),h=m.find(x=>x.is(-1));if(g&&h)return t.box(["Arcsec",e])}}}if(n.op1.has(e)){let c=_e(n.op2,e);if(c&&!c.is(0)){let f=n.op1.div(c).simplify();if(!f.has(e)){let p=t.box(["Ln",["Abs",n.op2]]);return f.is(1)?p:f.mul(p)}}}if((n.op1.is(1)||!n.op1.has(e))&&n.op2.operator==="Multiply"){let c=n.op2.ops;for(let f=0;f<c.length;f++){let p=c[f],d=_e(p,e);if(!d||d.is(0))continue;let m=c.filter((x,y)=>y!==f),g=m.length===1?m[0]:pe(...m),h=n.op1.div(g.mul(d)).simplify();if(!h.has(e)){let x=t.box(["Ln",["Abs",p]]);return h.is(1)?x:h.mul(x)}}}if(n.op1.is(1)||!n.op1.has(e)){let c=fs(n.op2,e);if(c){let{a:f,b:p}=c,d=t.box(["Ln",["Abs",n.op2]]);if(f.is(1))return n.op1.is(1)?d:n.op1.mul(d);let m=d.div(f);return n.op1.is(1)?m:n.op1.mul(m)}}if(n.op1.is(1)||!n.op1.has(e)){let c=n.op2;if(c.operator==="Power"){let f=c.op1,d=c.op2.re;if(d!==null&&Number.isInteger(d)&&d>1){let m=fs(f,e);if(m){let{a:g}=m,h=t.number(-(d-1)),y=t.One.div(g.mul(t.number(d-1))).neg().mul(t.box(["Power",f,h]));return n.op1.is(1)||(y=n.op1.mul(y)),y.simplify()}}}}if(n.op1.is(1)||!n.op1.has(e)){let c=uo(n.op2,e);if(c){let{a:f,b:p,c:d}=c,g=p.mul(p).sub(t.number(4).mul(f).mul(d)).simplify().N().re;if(g!==null&&g<0){let h=t.number(4).mul(f).mul(d).sub(p.mul(p)).simplify(),x=t.box(["Sqrt",h]).simplify(),v=t.number(2).mul(f).mul(t.symbol(e)).add(p).simplify().div(x).simplify(),E=t.box(["Arctan",v]),_=t.number(2).div(x).mul(E).simplify();return n.op1.is(1)||(_=n.op1.mul(_)),_}}}if(n.op1.is(1)||!n.op1.has(e)){let c=n.op2;if(c.operator==="Power"){let f=c.op1,d=c.op2.re;if(d!==null&&Number.isInteger(d)&&d>1){let m=uo(f,e);if(m&&m.b.is(0)&&m.a.is(1)){let g=m.c,h=t.symbol(e),x=t.box(["Power",f,t.number(d-1)]),v=t.One.div(t.number(2).mul(g).mul(t.number(d-1))).mul(h).div(x),E=t.number(2*d-3).div(t.number(2).mul(g).mul(t.number(d-1))),_=d===2?t.One.div(f):t.One.div(t.box(["Power",f,t.number(d-1)])),N=xn(_,e),T=X(v,E.mul(N)).simplify();return n.op1.is(1)||(T=n.op1.mul(T)),T}}}}if(n.op1.is(1)||!n.op1.has(e)){let c=n.op1,f=n.op2;if(f.operator==="Multiply"&&f.nops===2){let d=f.ops,m=null,g=null,h=null;for(let x of d){let y=fs(x,e);if(y&&y.a.is(1)){m=x,h=y.b.neg();continue}let v=uo(x,e);if(v&&v.a.is(1)){let _=v.b.mul(v.b).sub(t.number(4).mul(v.c)).simplify().N().re;_!==null&&_<0&&(g=x)}}if(m&&g&&h){let x=uo(g,e),{b:y,c:v}=x,E=h,_=E.mul(E).add(y.mul(E)).add(v).simplify(),N=t.One.div(_),T=N.neg(),B=y.add(E).simplify(),O=N.neg().mul(B),Y=N.mul(t.box(["Ln",["Abs",m]])),we=T.div(t.number(2)).mul(t.box(["Ln",["Abs",g]])),qe=O.sub(T.mul(y).div(t.number(2))).simplify(),Fe=t.number(4).mul(v).sub(y.mul(y)).simplify(),ce=t.box(["Sqrt",Fe]).simplify(),ui=t.number(2).mul(t.symbol(e)).add(y).simplify().div(ce).simplify(),Lt=t.number(2).div(ce).simplify(),xt=qe.mul(Lt).mul(t.box(["Arctan",ui])),qt=X(Y,we,xt).simplify();return c.is(1)||(qt=c.mul(qt)),qt}}let p=Kn(f,e);if(p.length>=2){let d=p.map(g=>g.N().re);if(d.every((g,h)=>g!==null&&isFinite(g)&&d.every((x,y)=>h===y||Math.abs(g-x)>1e-10))){let g=[];for(let x=0;x<p.length;x++){let y=t.One;for(let _=0;_<p.length;_++)x!==_&&(y=y.mul(p[x].sub(p[_])));let v=t.One.div(y),E=t.box(["Ln",["Abs",["Add",t.symbol(e),p[x].neg()]]]);g.push(v.mul(E))}let h=X(...g);return c.is(1)||(h=c.mul(h)),h.simplify()}}if(p.length===1){let d=p[0],m=t.symbol(e).sub(d),g=ni(f,m,e);if(g){let[h,x]=g;if(x.is(0)){let y=uo(h,e);if(y){let{a:v,b:E,c:_}=y,T=E.mul(E).sub(t.number(4).mul(v).mul(_)).simplify().N().re;if(T!==null&&T<0&&v.is(1)){let B=d,O=B.mul(B).add(E.mul(B)).add(_).simplify(),Y=t.One.div(O),H=Y.neg(),we=E.add(B).simplify(),qe=Y.neg().mul(we),Fe=Y.mul(t.box(["Ln",["Abs",m]])),oe=H.div(t.number(2)).mul(t.box(["Ln",["Abs",h]])),ui=qe.sub(H.mul(E).div(t.number(2))).simplify(),Lt=t.number(4).mul(_).sub(E.mul(E)).simplify(),xt=t.box(["Sqrt",Lt]).simplify(),xr=t.number(2).mul(t.symbol(e)).add(E).simplify().div(xt).simplify(),ap=t.number(2).div(xt).simplify(),ou=ui.mul(ap).mul(t.box(["Arctan",xr])),su=X(Fe,oe,ou).simplify();return c.is(1)||(su=c.mul(su)),su}}}}}}return eh(n,e)}if(n.operator==="Sqrt"){let a=n.op1;if(a.operator==="Divide"&&a.op1.is(1)){let u=a.op2;if(u.operator==="Add"&&u.nops===2){let l=u.ops,c=l.find(m=>m.is(1)),f=l.find(m=>m.operator==="Negate"&&m.op1.operator==="Power"&&m.op1.op1.symbol===e&&m.op1.op2.is(2));if(c&&f)return t.box(["Arcsin",e]);let p=l.find(m=>m.operator==="Power"&&m.op1.symbol===e&&m.op2.is(2));if(c&&p)return t.box(["Arsinh",e]);if(l.find(m=>m.is(-1))&&p)return t.box(["Arcosh",e])}}if(a.operator==="Add"&&a.nops===2){let u=a.ops,l=u.find(f=>f.operator==="Power"&&f.op1.symbol===e&&f.op2.is(2)),c=u.find(f=>f.operator==="Negate"&&f.op1.operator==="Power"&&f.op1.op1.symbol===e&&f.op1.op2.is(2));if(l||c){let f=u.find(p=>p!==l&&p!==c);if(f&&!f.has(e)){let p=f.N().re;if(c&&p!==null&&p>0){let d=f,m=t.box(["Sqrt",d]).simplify(),g=n,h=t.box(["Multiply",e,g]),x=m.is(1)?t.box(["Arcsin",e]):t.box(["Arcsin",["Divide",e,m]]),y=d.mul(x);return t.box(["Multiply",["Rational",1,2],["Add",h,y]])}else if(l&&p!==null&&p>0){let d=f,m=t.box(["Sqrt",d]).simplify(),g=n,h=t.box(["Multiply",e,g]),x=m.is(1)?t.box(["Arsinh",e]):t.box(["Arsinh",["Divide",e,m]]),y=d.mul(x);return t.box(["Multiply",["Rational",1,2],["Add",h,y]])}else if(l&&p!==null&&p<0){let d=f.neg(),m=t.box(["Sqrt",d]).simplify(),g=n,h=t.box(["Multiply",e,g]),x=m.is(1)?t.box(["Arcosh",e]):t.box(["Arcosh",["Divide",e,m]]),y=d.mul(x);return t.box(["Multiply",["Rational",1,2],["Subtract",h,y]])}}}}}if(n.operator==="Exp"&&n.op1.symbol===e)return n;if(n.operator==="Sin"&&n.op1.symbol===e)return t.box(["Negate",["Cos",e]]);if(n.operator==="Cos"&&n.op1.symbol===e)return t.box(["Sin",e]);if(n.operator==="Ln"&&n.op1.symbol===e)return t.box(["Subtract",["Multiply",e,["Ln",e]],e]);if(n.operator==="Power"){if(n.op1.symbol==="ExponentialE"&&n.op2.symbol===e)return n;if(n.op1.symbol===e){let l=n.op2;if(l.isNumberLiteral)return l.is(-1)?t.box(["Ln",["Abs",e]]):t.box(["Divide",["Power",e,["Add",l,1]],["Add",l,1]])}let u=n.op2.re;if(u!==null&&Number.isInteger(u)&&u<-1){let l=n.op1,c=fs(l,e);if(c){let{a:p}=c,d=t.number(u+1);return t.One.div(p.mul(d)).mul(t.box(["Power",l,d])).simplify()}let f=uo(l,e);if(f&&f.b.is(0)&&f.a.is(1)){let p=f.c,d=-u,m=t.symbol(e),g=t.box(["Power",l,t.number(u+1)]),x=t.One.div(t.number(2).mul(p).mul(t.number(d-1))).mul(m).mul(g),y=t.number(2*d-3).div(t.number(2).mul(p).mul(t.number(d-1))),v=t.box(["Power",l,t.number(u+1)]),E=xn(v,e);return X(x,y.mul(E)).simplify()}}}let i=R0(n,e);if(i)return i;let r=t.rules(D0),o=(Ur(n)??n).subs({[e]:"_x"},{canonical:!0}),s=tr(o,r,{_x:t.symbol("_x")},{useVariations:!0,canonical:!0});return s&&s[0]?s[0].subs({_x:e}):eh(n,e)}function eh(n,e){let t=n.engine;return t.function("Integrate",[n,t.symbol(e,{canonical:!1})])}ns();var rh=[{Derivative:{broadcastable:!1,lazy:!0,signature:"(function, order:number?) -> function",canonical:(n,{engine:e})=>{let t=Le(n[0].canonical);if(!t)return null;if(!n[1])return e._fn("Derivative",[t]);let i=We(e,n[1]?.canonical,"number");return e._fn("Derivative",[t,i])},evaluate:n=>{let e=n[0].evaluate(),t=Math.floor(n[1]?.N().re);return Yg(e,isNaN(t)?1:t)}},D:{broadcastable:!1,scoped:!0,lazy:!0,signature:"(expression, variable:symbol, variables:symbol+) -> expression",canonical:(n,{engine:e,scope:t})=>{let i=ir(e,n);return i?e._fn("D",[i,...n.slice(1)],{scope:t}):null},evaluate:(n,{engine:e})=>{let t=n[0].canonical;t=t.evaluate();let i=n.slice(1);i.length===0&&(t=void 0);for(let r of i){if(!r.symbol){t=void 0;break}if(t&&t.operator==="Function"&&(t=t.op1),t=_e(t,r.symbol),t===void 0)break}return t=t?.canonical,t?.operator==="D"||t?.operator==="Apply"&&t.op1?.operator==="Derivative"||t&&Pa(t)?t:t?.evaluate()}},ND:{broadcastable:!1,lazy:!0,signature:"(function, at:number) -> number",canonical:(n,{engine:e})=>{let t=Le(n[0]);if(!t)return null;let i=We(e,n[1]?.canonical,"number");return e._fn("ND",[t,i])},evaluate:([n,e],{engine:t})=>{let i=e.N().re;if(!isNaN(i))return t.number(td(n.compile(),i))}},Integrate:{wikidata:"Q80091",broadcastable:!1,lazy:!0,signature:"(function, limits+) -> number",canonical:(n,{engine:e})=>{if(!n[0])return null;let t=Le(n[0]);if(!t)return null;let i=Eg(n.slice(1),{engine:e});return e._fn("Integrate",[t,...i])},evaluate:(n,{engine:e,numericApproximation:t})=>{if(t){let a=n[0],u=n[1],[l,c]=[u.op2.N().re,u.op3.N().re];if(isNaN(l)||isNaN(c))return;let f=u.op1.symbol??"x",d=(a.operator==="Function"?a:e.box(["Function",a,f])).compile(),m=ao(d,l,c,d.isCompiled?1e7:1e4);return e.box(["PlusMinus",e.number(m.estimate),e.number(m.error)])}let i=n[0],r=i.ops?.slice(1)?.map(a=>a.symbol)??[],o=n.slice(1);if(o.length===0)return;let s=!0;for(let a=o.length-1;a>=0;a--){let[u,l,c]=o[a].ops,f=u.symbol;(!f||f==="Nothing")&&a<r.length&&(f=r[a]),f||(f="x");let p=xn(i,f);if(p.operator!=="Integrate"){let d=p;if(l.symbol==="Nothing"&&c.symbol==="Nothing")i=d;else{s=!1;let m=e.box(["Function",p,f]);i=e.box(["EvaluateAt",m,l,c])}}else if(l.symbol==="Nothing"&&c.symbol==="Nothing")i=p;else{s=!1;let d=e.box(["Function",p,f]);i=e.box(["EvaluateAt",d,l,c])}}return i.operator!=="Integrate"?s?Pa(i)?i:i.simplify():i.evaluate({numericApproximation:t}):i}},NIntegrate:{broadcastable:!1,lazy:!0,signature:"(function, limits:(tuple|symbol)?) -> number",canonical:(n,{engine:e})=>{let[t,i,r]=n,o=Le(t);return!o||!i||!r?null:e._fn("NIntegrate",[o,i.canonical,r.canonical])},evaluate:([n,e,t],{engine:i})=>{let[r,o]=[e.N().re,t.N().re];if(isNaN(r)||isNaN(o))return;let s=n.compile();return i.number(ao(s,r,o,s.isCompiled?1e7:1e4).estimate)}},Limits:{description:"Limits of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(index:symbol, lower:value, upper:value) -> tuple",canonical:(n,{engine:e})=>ki(n,{engine:e})??null}},{Limit:{description:"Limit of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(function, point:number, direction:number?) -> number",canonical:([n,e,t],{engine:i})=>{let r=Le(n);return!r||!e?null:t===void 0?i._fn("Limit",[r,e.canonical]):i._fn("Limit",[r,e.canonical,t.canonical])},evaluate:([n,e,t],{engine:i,numericApproximation:r})=>{if(r){let o=e.N().re;if(Number.isNaN(o))return;let s=n.compile();return i.number(xi(s,o,t?t.re:1))}}},NLimit:{description:"Numerical approximation of the limit of a function",complexity:5e3,broadcastable:!1,lazy:!0,signature:"(function, point:number, direction:number?) -> number",canonical:([n,e,t],{engine:i})=>{let r=Le(n);return!r||!e?null:t===void 0?i._fn("NLimit",[r,e.canonical]):i._fn("NLimit",[r,e.canonical,t.canonical])},evaluate:([n,e,t],{engine:i})=>{let r=e.N().re;if(Number.isNaN(r))return;let o=n.compile();return i.number(xi(o,r,t?t.re:1))}}}];_a();At();oi();an();Vo();kt();var sh=[{Block:{lazy:!0,scoped:!0,signature:"(unknown*) -> unknown",type:n=>n.length===0?"nothing":n[n.length-1].type,canonical:L0,evaluate:O0},Condition:{lazy:!0,signature:"(value, symbol) -> boolean",evaluate:([n,e],{engine:t})=>{let i=[];return e.symbol?i=[e.symbol]:e.operator==="And"&&(i=e.ops.map(r=>r.symbol??"")),Ag(n,i)?t.True:t.False}},If:{lazy:!0,signature:"(expression, expression, expression) -> any",type:([n,e,t])=>ve(e.type.type,t.type.type),canonical:([n,e,t],{engine:i})=>i._fn("If",[n.canonical,e.canonical,t.canonical]),evaluate:([n,e,t],{engine:i})=>{let r=n.evaluate().symbol;if(r==="True")return e?.evaluate()??i.Nothing;if(r==="False")return t?.evaluate()??i.Nothing;throw new Error(`Condition must evaluate to "True" or "False". ${Xn(n)}`)}},Loop:{lazy:!0,signature:"(body:expression, collection:expression) -> any",type:([n])=>n.type,evaluate:([n,e],{engine:t})=>Vr(oh(n,e,t),t._timeRemaining),evaluateAsync:async([n,e],{engine:t,signal:i})=>Fr(oh(n,e,t),t._timeRemaining,i)},Which:{lazy:!0,signature:"(expression+) -> unknown",type:n=>n.length%2!==0?"nothing":ve(...n.filter((e,t)=>t%2===1).map(e=>e.type.type)),canonical:(n,e)=>n.length%2!==0?e.engine.Nothing:e.engine._fn("Which",n.map(t=>t.canonical)),evaluate:(n,e)=>P0(n,e)},FixedPoint:{lazy:!0,signature:"(any) -> unknown"}}];function P0(n,e){let t=0;for(;t<n.length-1;){let i=n[t].evaluate().symbol;if(i==="True")return n[t+1]?n[t+1].evaluate(e):e.engine.symbol("Undefined");if(i!=="False")throw new Error(`Condition must evaluate to "True" or "False". ${Xn(n[t])}`);t+=2}return e.engine.symbol("Undefined")}function O0(n,{engine:e}){if(n.length===0)return e.Nothing;let t;for(let i of n){let r=i.operator;if(r==="Return"){t=i.op1.evaluate();break}if(r==="Break"||r==="Continue"){t=e.box([r,i.op1.evaluate()]);break}t=i.evaluate()}return t??e.Nothing}function L0(n,e){let{engine:t,scope:i}=e;return n.length===0?null:t._fn("Block",t._inScope(i,()=>n.map(o=>o.canonical)),{scope:i})}function*oh(n,e,t){if(n??=t.Nothing,n.symbol==="Nothing")return n;if(e?.isCollection){let r,o=Te(n),s=0;for(let a of e.each()){if(r=o([a])??t.Nothing,r.operator==="Break")return r.op1;if(r.operator==="Return")return r;if(s+=1,s%1e3===0&&(yield r),s>t.iterationLimit)throw new On({cause:"iteration-limit-exceeded"})}return r}let i=0;for(;;){let r=n.evaluate();if(r.operator==="Break")return r.op1;if(r.operator==="Return")return r;if(i+=1,i%1e3===0&&(yield r),i>t.iterationLimit)throw new On({cause:"iteration-limit-exceeded"})}}Xe();Ni();var ah=[{Choose:{complexity:1200,signature:"(n:number, m:number) -> number",evaluate:(n,{engine:e})=>{let t=n[0].re,i=n[1].re;if(!(!Number.isFinite(t)||!Number.isFinite(i)))return t<0||i<0||i>t?e.NaN:e.number(da(t,i))}}},{Fibonacci:{description:"Compute the nth Fibonacci number.",wikidata:"Q47577",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null)return;if(t<0n)return e.function("Negate",["Fibonacci",e.number(-t)]);if(t===0n)return e.Zero;if(t===1n)return e.One;let i=0n,r=1n;for(let o=2n;o<=t;o++){let s=i+r;i=r,r=s}return e.number(r)}},Binomial:{description:"Compute the binomial coefficient C(n, k) = n! / (k! (n-k)!).",wikidata:"Q209875",signature:"(integer, integer) -> integer",evaluate:([n,e],{engine:t})=>{let i=De(n),r=De(e);if(i===null||r===null)return;if(r<0n||r>i)return t.number(0);if(r===0n||r===i)return t.number(1);let o=1n;for(let s=1n;s<=r;s++)o*=i-(r-s),o/=s;return t.number(o)}},CartesianProduct:{description:"Return the Cartesian product of input sets.",wikidata:"Q173740",signature:"(set+) -> set",collection:{contains:(n,e)=>{let t=n.ops;return!e.isCollection||e.ops.length!==t.length?!1:t.every((i,r)=>i.contains(e.ops[r])??!1)},count:n=>{let e=n.ops.map(t=>t.count);return e.includes(1/0)?1/0:e.reduce((t,i)=>t*i,1)},iterator:q0}},PowerSet:{description:"Return the power set of a set (set of all subsets).",wikidata:"Q205170",signature:"(set) -> set",collection:{contains:(n,e)=>{let t=n.ops[0];return e.isCollection?e.ops.every(i=>t.contains(i)??!1):!1},count:n=>{let e=n.ops[0];return e.isEmptyCollection?1:e.isFiniteCollection===!1?1/0:2**e.count},iterator:F0}},Permutations:{description:"Return all permutations of length k (default full length) of a collection.",signature:"(collection, integer?) -> list<list>",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Array.from(n.each()),r=e?G(e):i.length;if(r===null||r<0||r>i.length)return;function*o(s,a){if(s.length===r){yield s;return}for(let u=0;u<a.length;u++){let l=a.slice(),[c]=l.splice(u,1);yield*o([...s,c],l)}}return t.function("List",[...o([],i)].map(s=>t.function("List",s)))}},Combinations:{description:"Return all k-element combinations of a collection.",wikidata:"Q193606",signature:"(collection, integer) -> list<list>",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Array.from(n.each()),r=G(e);if(r===null||r<0||r>i.length)return;function*o(s,a){if(a.length===r){yield a;return}for(let u=s;u<i.length;u++)yield*o(u+1,[...a,i[u]])}return t.function("List",[...o(0,[])].map(s=>t.function("List",s)))}},Multinomial:{description:"Compute the multinomial coefficient for multiple integers.",wikidata:"Q20820114",signature:"(integer+) -> integer",evaluate:(n,{engine:e})=>{let t=n.map(G);if(t.some(o=>o===null||o<0))return;let i=t.reduce((o,s)=>o+(s??0),0),r=1;for(let o=1;o<=i;o++)r*=o;for(let o of t)for(let s=1;s<=o;s++)r/=s;return e.number(r)}},Subfactorial:{description:"Compute the number of derangements (subfactorial) of n items.",wikidata:"Q2361661",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=G(n);if(t===null||t<0)return;let i=1;for(let r=1;r<=t;r++)i=Math.round(i*r*(1-1/r));return e.number(i)}},BellNumber:{description:"Compute the Bell number B(n), the number of partitions of a set of n elements.",wikidata:"Q816063",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=G(n);if(t===null||t<0)return;let i=[1];for(let r=1;r<=t;r++){let o=0;for(let s=0;s<r;s++)o+=V0(r-1,s)*i[s];i[r]=o}return e.number(i[t])}}}];function*q0(n){let e=n.ops,t=e.map(o=>[...o.each()]),i=t.map(o=>o.length);if(i.some(o=>o===0))return;let r=Array(e.length).fill(0);for(;;){let o=r.map((a,u)=>t[u][a]);yield n.engine._fn("Tuple",o);let s=r.length-1;for(;s>=0&&(r[s]++,!(r[s]<i[s]));)r[s]=0,s--;if(s<0)break}}function*F0(n){let e=[...n.ops[0].each()],t=e.length,i=n.engine,r=1<<t;for(let o=0;o<r;o++){let s=[];for(let a=0;a<t;a++)(o&1<<a)!==0&&s.push(e[a]);yield s.length===0?i.symbol("EmptySet"):i._fn("Set",s)}}function V0(n,e){if(e<0||e>n)return 0;if(e===0||e===n)return 1;let t=1;for(let i=1;i<=e;i++)t*=n-(e-i),t/=i;return t}var uh=[{Real:{broadcastable:!0,complexity:1200,signature:"(number) -> real",sgn:([n])=>{let e=n.re;if(!isNaN(e))return e===0?"zero":e>0?"positive":"negative"},evaluate:(n,{engine:e})=>{let t=n[0].numericValue;if(t!==null)return typeof t=="number"?n[0]:e.number(t.bignumRe??t.re)}},Imaginary:{broadcastable:!0,complexity:1200,signature:"(number) -> real",sgn:([n])=>{let e=n.im;if(!isNaN(e))return e===0?"zero":e>0?"positive":"negative"},evaluate:(n,{engine:e})=>{let t=n[0].numericValue;if(t!==null)return typeof t=="number"?e.Zero:e.number(t.im)}},Argument:{broadcastable:!0,complexity:1200,signature:"(number) -> real",evaluate:(n,{engine:e})=>{let t=n[0].numericValue;if(t!==null)return typeof t=="number"?t>=0?e.Zero:e.Pi:t.im===0?t.re>=0?e.Zero:e.Pi:e.function("ArcTan2",[t.im,t.re]).evaluate()}},AbsArg:{broadcastable:!0,complexity:1200,signature:"(number) -> tuple<real, real>",evaluate:(n,{engine:e})=>{if(n[0].numericValue!==null)return e.tuple(e.function("Abs",n).evaluate(),e.function("Argument",n).evaluate())}},Conjugate:{broadcastable:!0,complexity:1200,signature:"(number) -> number",type:([n])=>n.type,sgn:([n])=>n.sgn,evaluate:(n,{engine:e})=>{let t=n[0].numericValue;if(t!==null)return typeof t=="number"||t.im===0?n[0]:e.number(e.complex(t.re,-t.im))}},ComplexRoots:{broadcastable:!0,complexity:1200,signature:"(number, number) -> list<number>",evaluate:(n,{engine:e})=>{let t=n[0].re;if(isNaN(t))return;let i=n[1].re;if(!Number.isInteger(i)||i<=0)return;let r=[],o=n[0].im??0,s=Math.atan2(o,t),a=Math.sqrt(t*t+o*o);for(let u=0;u<i;u++){let l=(s+2*Math.PI*u)/i,c=Math.pow(a,1/i);r.push([c*Math.cos(l),c*Math.sin(l)])}return e.function("List",r.map(u=>e.number(u[1]!==0?e.complex(u[0],u[1]):u[0])))}}}];Gn();kt();zn();me();function Fa(n,{engine:e}){if(n.length===0)return null;let t=n[0];if(n.length===1)return t.canonical;if(n.length===2){let i=ch(t);if(!Number.isNaN(i)){let s=n[1];if(s.operator==="Divide"||s.operator==="Rational"){let[a,u]=[s.op1.canonical.re,s.op2.canonical.re];if(a>0&&a<=1e3&&u>1&&u<=1e3&&Number.isInteger(a)&&Number.isInteger(u)){let l=s.canonical;return i<0&&(l=l.neg()),e._fn("Add",[t.canonical,l])}}}let r=n[1];if(!Number.isNaN(i)&&us(r))return e.number(e.complex(0,i));let o=t.canonical;if(o.symbol&&r.operator==="Delimiter"){if(r.nops===0){let u=e.lookupDefinition(o.symbol);return u?le(u)?e.box([o.symbol]):u.value.type.isUnknown?(o.infer("function"),e.box([o.symbol])):u.value.type.matches("function")?e.box([o.symbol]):e.typeError("function",u.value.type,o):(e.declare(o.symbol,"function"),e.box([o.symbol]))}let s=r.op1.operator==="Sequence"?r.op1.ops:[r.op1];s=he(s);let a=e.lookupDefinition(o.symbol);if(!a)return e.declare(o.symbol,"function"),e.function(o.symbol,s);if(le(a)||a.value?.type?.matches("function"))return e.function(o.symbol,s);if(a.value?.type?.isUnknown)return o.infer("function"),e.function(o.symbol,s)}if(o.symbol&&r.operator==="Delimiter"&&(r.op2.string==="[,]"||r.op2.string==="[;]")){let s=r.op1.operator==="Sequence"?r.op1.ops:[r.op1];return e.function("At",[o,...s])}}return n=lh(n),n=he(n),n.every(i=>i.isValid&&(i.type.isUnknown||i.type.matches("number")||i.isIndexedCollection&&!i.string))?e._fn("Multiply",n):e._fn("Tuple",n)}function lh(n){let e=[];for(let t of n)t.operator==="InvisibleOperator"?e.push(...lh(t.ops)):e.push(t);return e}function ch(n){if(n.isNumberLiteral){let e=n.re;if(Number.isInteger(e))return e}if(n.operator==="Negate"){let e=ch(n.op1);if(!Number.isNaN(e))return-e}return Number.NaN}zn();tn();cn();ii();ut();Xe();me();function ar(n,e,t){if(e===!1)return n;if(e===!0)return n.engine._inScope(t,()=>n.canonical);typeof e=="string"&&(e=[e]),n=mh(n);for(let i of e)switch(i){case"InvisibleOperator":n=mc(n);break;case"Number":n=fh(n);break;case"Multiply":n=ph(n);break;case"Add":n=dh(n);break;case"Power":n=Va(n);break;case"Divide":n=gh(n);break;case"Flatten":n=dc(n);break;case"Order":n=Ml(n,{recursive:!0});break;default:throw Error("Invalid canonical form")}return n}function dc(n){if(!n.operator||!n.ops||n.nops===0)return n;if(n.operator==="Delimiter")return dc(n.op1);let e=n.engine,t=n.operator==="Add"||n.operator==="Multiply";if(!t){let i=e.lookupDefinition(n.operator);le(i)&&i.operator.associative&&(t=!0)}return t?e.function(n.operator,_i(n.ops.map(dc),n.operator)):n}function mc(n){return n.ops?n.operator==="InvisibleOperator"?Fa(n.ops.map(mc),{engine:n.engine})??n:n.engine._fn(n.operator,n.ops.map(mc)):n}function fh(n){if(n.isNumberLiteral)return n.canonical;if(us(n))return n.engine.I;if(!n.isFunctionExpression)return n;let{engine:e}=n,t=n.ops.map(fh),{operator:i}=n;if((i==="Divide"||i==="Rational")&&t.length===2){let r=Kt(t[0]);if(r!==null){let o=Kt(t[1]);if(o!==null)return e.number([r,o])}return i="Divide",e._fn("Divide",t,{canonical:!1})}if(i==="Complex"){if(t.length===1){let r=t[0];return r.isNumberLiteral?e.number(e.complex(0,r.re)):e._fn("Multiply",[r,e.I],{canonical:!1})}if(t.length===2){let r=t[0].re,o=t[1].re;return o!==null&&r!==null&&!isNaN(o)&&!isNaN(r)?o===0&&r===0?e.Zero:o!==0?e.number(e._numericValue({re:r,im:o})):t[0]:e._fn("Add",[t[0],e._fn("Multiply",[t[1],e.I],{canonical:!1})],{canonical:!1})}throw new Error("Expected one or two arguments with `Complex` expression")}if(i==="Negate"&&t.length===1){let r=t[0],{numericValue:o}=r;if(o!==null)return e.number(typeof o=="number"?-o:o.neg());if(us(r))return e.number(e.complex(0,-1))}return t.every((r,o)=>r===n.ops[o])?n:e._fn(i,t,{canonical:!1})}function ph(n){if(!n.ops)return n;let e=n.ops.map(ph);return n.operator==="Multiply"?$e(n.engine,e.map(t=>t.canonical)):n.operator==="Negate"?$e(n.engine,[e[0],n.engine.NegativeOne]):n}function dh(n){if(!n.ops)return n;let e=n.ops.map(dh);return n.operator==="Add"?qn(n.engine,e):n.operator==="Subtract"?qn(n.engine,[e[0],e[1].neg()]):n.engine._fn(n.operator,e)}function Va(n){if(!n.ops)return n;let e=n.ops.map(t=>Va(t));return n.operator==="Power"?ti(e[0],e[1]):n.engine._fn(n.operator,e,{canonical:!1})}function mh(n){return n.symbol!==null?n.canonical:n.isFunctionExpression?n.engine._fn(n.operator,n.ops.map(mh),{canonical:!1}):n}function gh(n){return n.operator==="Divide"?Zn(Va(n.op1),Va(n.op2)):n.ops?n.engine._fn(n.operator,n.ops.map(gh)):n}Xe();me();var si=new WeakMap;function $0(n){return si.has(n)||si.set(n,new Map),si.get(n)}function j0(n,e){$0(n).set(e.name,e)}function U0(n){if(typeof n=="number")return{type:"exact",values:[n]};let t=n.split(",").map(r=>r.trim()).map(r=>{let o=Number(r);return isNaN(o)?r:o});return{type:t.some(r=>typeof r=="string")?"pattern":"exact",values:t}}function G0(n,e){if(n.values.length!==e.length)return!1;let t=new Map;for(let i=0;i<n.values.length;i++){let r=n.values[i],o=e[i];if(typeof r=="number"){if(r!==o)return!1}else if(t.has(r)){if(t.get(r)!==o)return!1}else t.set(r,o)}return!0}function z0(n){let e=[];for(let[t,i]of n){let r=U0(t),o=r.values.filter(s=>typeof s=="string").length;e.push({pattern:r,value:i,variableCount:o})}return e.sort((t,i)=>t.pattern.type!==i.pattern.type?t.pattern.type==="exact"?-1:1:t.variableCount-i.variableCount),e}function Z0(n,e){for(let{pattern:t,value:i}of n)if(G0(t,e))return i}function H0(n,e,t){for(let i=0;i<e.length;i++){let r=e[i],o=n[i],s=t[r];if(s&&(s.min!==void 0&&o<s.min||s.max!==void 0&&o>s.max))return!1}return!0}function W0(n,e,t,i){let r={};for(let a=0;a<t.length;a++)r[t[a]]=n.number(i[a]);let s=e.subs(r).evaluate();return s.symbol==="True"?!0:s.symbol==="False"?!1:s.isNumberLiteral?s.re!==0:!1}function gc(n,e,t){let i=t.variables!==void 0&&t.variables.length>1,r=t.variables??[t.variable??"n"],o=r[0],s=t.memoize??!0,a=s?new Map:null,u=t.domain??{},l=t.recurrence,c=null,f=null;t.constraints&&(f=typeof t.constraints=="string"?n.parse(t.constraints):t.constraints);let p=new Map;for(let[m,g]of Object.entries(t.base)){let h=i?String(m):Number(m);p.set(h,typeof g=="number"?n.number(g):g)}let d=i?z0(p):null;return j0(n,{name:e,variable:i?void 0:o,variables:i?r:void 0,isMultiIndex:i,base:p,memoize:s,memo:a,domain:u,constraints:f??void 0}),(m,{engine:g,numericApproximation:h})=>{c===null&&(c=typeof l=="string"?g.parse(l):l);let x;if(m.operator==="Sequence"&&m.ops?x=m.ops.map(N=>N.evaluate().re):m.operator==="Tuple"&&m.ops?x=m.ops.map(N=>N.evaluate().re):m.operator==="Delimiter"&&m.ops?x=m.ops.map(N=>N.evaluate().re):x=[m.evaluate().re],!x.every(N=>Number.isInteger(N)))return;if(i){let N=u;if(Object.keys(N).length>0&&!H0(x,r,N))return}else{let N=u,T=x[0];if(N.min!==void 0&&T<N.min||N.max!==void 0&&T>N.max)return}if(f&&!W0(g,f,r,x))return;let y=i?x.join(","):x[0];if(a?.has(y))return a.get(y);if(i){let N=Z0(d,x);if(N!==void 0)return a&&a.set(y,N),N}else{let N=x[0];if(p.has(N))return p.get(N)}let v={};for(let N=0;N<r.length;N++)v[r[N]]=g.number(x[N]);let E=c.subs(v),_=h?E.N():E.evaluate();return a&&_.isNumberLiteral&&a.set(y,_),_.isNumberLiteral?_:void 0}}function hc(n,e,t){return!t.base||Object.keys(t.base).length===0?{valid:!1,error:`Sequence "${e}" requires at least one base case`}:t.recurrence?(typeof t.recurrence=="string"?n.parse(t.recurrence):t.recurrence).isValid?{valid:!0}:{valid:!1,error:`Invalid recurrence for "${e}": expression contains errors`}:{valid:!1,error:`Sequence "${e}" requires a recurrence relation`}}var ps=new WeakMap;function ds(n,e){ps.has(n)||ps.set(n,new Map);let t=ps.get(n);return t.has(e)||t.set(e,{base:new Map,isMultiIndex:!1}),t.get(e)}function xc(n,e,t,i){ds(n,e).base.set(t,i),ja(n,e)}function yc(n,e,t,i){let r=ds(n,e);r.base.set(t,i),r.isMultiIndex=!0,ja(n,e)}function $a(n,e,t,i){let r=ds(n,e);r.recurrence={variable:t,latex:i.latex},ja(n,e)}function hh(n,e,t,i){let r=ds(n,e);r.recurrence={variables:t,latex:i.latex},r.isMultiIndex=!0,ja(n,e)}function ja(n,e){let t=ds(n,e);if(t.base.size===0||!t.recurrence)return;let i={};for(let[l,c]of t.base)i[l]=c;let r={base:i,recurrence:t.recurrence.latex};t.isMultiIndex||t.recurrence.variables?r.variables=t.recurrence.variables:r.variable=t.recurrence.variable;let o=hc(n,e,r);if(!o.valid)throw new Error(o.error);let s=gc(n,e,r),u=n.context.lexicalScope.bindings.get(e);u?sr(n,e,u,{subscriptEvaluate:s}):n.declare(e,{subscriptEvaluate:s}),ps.get(n).delete(e)}function lo(n,e){return n.operator==="Subscript"&&n.op1?.symbol===e?!0:n.ops?n.ops.some(t=>lo(t,e)):!1}function bc(n){if(n.symbol)return n.symbol;let e=n.symbols;if(e.length===1)return e[0];let t=["n","k","i","j","m"];for(let i of t)if(e.includes(i))return i}function xh(n,e){let i=ps.get(n)?.get(e);if(i){let o=Array.from(i.base.keys());return i.isMultiIndex||o.sort((s,a)=>s-a),{status:"pending",hasBase:i.base.size>0,hasRecurrence:!!i.recurrence,baseIndices:o,variable:i.recurrence?.variable,variables:i.recurrence?.variables}}let r=n.lookupDefinition(e);if(r&&re(r)&&r.value.subscriptEvaluate){let s=si.get(n)?.get(e);if(s){let a=Array.from(s.base.keys());return s.isMultiIndex||a.sort((u,l)=>u-l),{status:"complete",hasBase:!0,hasRecurrence:!0,baseIndices:a,variable:s.variable,variables:s.variables}}return{status:"complete",hasBase:!0,hasRecurrence:!0,baseIndices:[]}}return{status:"not-a-sequence",hasBase:!1,hasRecurrence:!1,baseIndices:[]}}function yh(n,e){let i=si.get(n)?.get(e);if(!i)return;let r=Array.from(i.base.keys());return i.isMultiIndex||r.sort((o,s)=>o-s),{name:i.name,variable:i.variable,variables:i.variables,baseIndices:r,memoize:i.memoize,domain:i.domain,cacheSize:i.memo?.size??0,isMultiIndex:i.isMultiIndex}}function bh(n){let e=si.get(n);return e?Array.from(e.keys()):[]}function Ec(n,e){return si.get(n)?.has(e)??!1}function Eh(n,e){let t=si.get(n);if(t)if(e!==void 0){let i=t.get(e);i?.memo&&i.memo.clear()}else for(let i of t.values())i.memo&&i.memo.clear()}function vh(n,e){let i=si.get(n)?.get(e);if(i?.memo)return new Map(i.memo)}function _h(n,e,t,i,r=1){if(!Number.isInteger(t)||!Number.isInteger(i)||r<=0||!Number.isInteger(r)||!Ec(n,e))return;let o=[];for(let s=t;r>0?s<=i:s>=i;s+=r){let u=n.parse(`${e}_{${s}}`).evaluate();if(u.isNumberLiteral)o.push(u);else return}return o}At();zn();Ji();function ms(n){return n[Math.floor(Math.random()*n.length)]}function Nh(n,e){if(n==="Add"||n==="Multiply"){let t=[],i=1+Math.floor(Math.random()*12);for(;i>0;)t.push(Mt(e+1)),i-=1;return[n,...t]}return n==="Divide"||n==="Power"?[n,Mt(e+1),Mt(e+1)]:n==="Root"?[n,Mt(e+1),Mt(10)]:n==="trig"?J0():[n,Mt(e+1)]}function J0(){return[ms(["Cos","Sin","Tan","Sinh","Arccos","Arsinh"]),ms(["Pi","-1","0","1",["Divide","Pi",-5],["Multiply",-2,["Divide","Pi",11]],["Multiply","Half","Pi"],["Multiply",5,"Pi"],["Multiply",12,"Pi"],["Divide","Pi",5],["Divide","Pi",9],["Multiply",5,["Divide","Pi",9]],["Multiply",2,["Divide","Pi",11]],["Multiply",2,["Divide","Pi",3]]])]}function Mt(n){if(n??=1,n===1){let e=ms([["Sqrt",["Multiply",6,["Sum",["Divide",1,["Power","n",2]],["Triple",["Hold","n"],1,"PositiveInfinity"]]]],"Add","Add","Add","Add","Add","Multiply","Multiply","Multiply","Multiply","Divide","Divide","Divide","Root","Sqrt","Subtract","Negate","trig"]);return typeof e=="string"?Nh(e,1):e}if(n===2){let e=Math.random();if(e>.75)return Mt(1);if(e>.5)return Mt(3);let t=ms(["Multiply","Multiply","Add","Power","trig","Ln","Exp"]);return Nh(t,2)}return ms([-12345e-9,-2,-2,-2,-3,-5,-6,-12,-1654e-60,0,0,12345e-8,1654e-60,1,2,2,2,2,3,3,5,5,6,6,1234.5678,5678.1234,10,15,18,30,60,1234e54,"123456789.12345678912345e200","987654321.12345678912345",["Rational",-6,10],["Rational",-12,15],["Rational",-15,12],["Rational",3,5],["Rational",12,15],["Rational",15,12],"ExponentialE",["Sqrt",3],["Sqrt",5],["Sqrt",15],["Sqrt",25],["Complex",-1.1,1.1],["Complex",4,5],"x","x","x","x",["Add","x",1],["Divide","x",3],["Square","x"],["Power","x",3],["Power","x",4],["Subtract","x",1],["Add","x",1],"Pi"])}an();Tn();cn();Yo();me();var Th=[{Nothing:{type:"nothing"}},{InvisibleOperator:{complexity:9e3,lazy:!0,signature:"function",canonical:(n,{engine:e})=>{let t=Fa(n,{engine:e});return t?t.operator==="Multiply"?$e(e,t.ops):t:e.Nothing}},Sequence:{lazy:!0,signature:"function",type:n=>n.length===0?"nothing":n.length===1?n[0].type:"any",canonical:(n,{engine:e})=>{let t=he(n);return t.length===0?e.Nothing:t.length===1?t[0]:e._fn("Sequence",t)}},Delimiter:{complexity:9e3,lazy:!0,signature:"(any, string?) -> any",type:n=>n.length===0?"nothing":n[0].type,canonical:(n,{engine:e})=>{if(n.length===0)return e._fn("Tuple",[]);if(n.length>2)return e._fn("Delimiter",Vn(e,n,2));let t=n[0];if(t.operator==="Sequence")return e._fn("Tuple",Fn(e,t.ops));t=t.canonical;let i=n[1]?.string;return!i||i.startsWith("(")&&i.endsWith(")")?t:(i?.length??0)>3?e._fn("Delimiter",[t,e.error("invalid-delimiter",n[1].toString())]):e._fn("Delimiter",[n[0],We(e,n[1],"string")])},evaluate:(n,e)=>{let t=e.engine;if(n.length===0)return t.Nothing;let i=n[0];return(i.operator==="Sequence"||i.operator==="Delimiter")&&(n=il(n[0].ops)),n.length===1?n[0].evaluate(e):t._fn("Tuple",n.map(r=>r.evaluate(e)))}},Error:{lazy:!0,complexity:500,signature:"((string|expression<ErrorCode>), expression?) -> nothing",canonical:(n,{engine:e})=>e._fn("Error",n)},ErrorCode:{complexity:500,lazy:!0,signature:"(string, any*) -> error",canonical:(n,{engine:e})=>{let t=We(e,n[0],"string").string;return t==="incompatible-type"?e._fn("ErrorCode",[e.string(t),n[1],n[2]]):e._fn("ErrorCode",n)}},Unevaluated:{description:"Prevent an expression from being evaluated",lazy:!0,signature:"(any) -> unknown",type:([n])=>n.type,canonical:(n,{engine:e,scope:t})=>e._fn("Unevaluated",Fn(e,n,t)),evaluate:([n],e)=>n.evaluate(e)},Hold:{description:"Hold an expression, preventing it from being canonicalized or evaluated until `ReleaseHold` is applied to it",lazy:!0,signature:"(any) -> unknown",type:([n])=>n.symbol?"symbol":n.string?"string":n.isNumberLiteral?n.type:n.ops?Mn(n.type.type)??"unknown":"unknown",eq:(n,e)=>(e.operator==="Hold"&&(e=e.ops[0]),n.ops[0].isSame(e)),evaluate:([n],{engine:e})=>e.hold(n)},ReleaseHold:{description:"Release an expression held by `Hold`",lazy:!0,signature:"(any) -> unknown",type:([n])=>n.operator==="Hold"?n.op1.type:n.type,evaluate:([n],e)=>(n.operator==="Hold"&&(n=n.op1),n.canonical.evaluate(e))},HorizontalSpacing:{signature:"(number) -> nothing",canonical:(n,{engine:e})=>n.length===2?n[0].canonical:e.Nothing},Annotated:{signature:"(expression, dictionary) -> expression",type:([n])=>n.type,complexity:9e3,lazy:!0,canonical:([n,e],{engine:t})=>(n=n.canonical,e=e.canonical,!$g(e)||e.keys.length===0?n:t._fn("Annotated",[n,e])),evaluate:([n,e],t)=>n.evaluate(t)},Text:{description:"A sequence of strings, annotated expressions and other Text expressions",signature:"(any*) -> expression"}},{About:{description:"Return information about an expression",lazy:!0,signature:"(any) -> string",evaluate:([n],{engine:e})=>{let t=[n.toString()];if(t.push(""),n.string)t.push("string");else if(n.symbol)if(n.valueDefinition){let i=n.valueDefinition;i.isConstant&&t.push("constant"),typeof i.description=="string"?t.push(i.description):Array.isArray(i.description)&&t.push(i.description.join(`
`)),i.wikidata&&t.push(`WikiData: ${i.wikidata}`),i.url&&t.push(`Read More: ${i.url}`)}else t.push("symbol"),t.push(`value: ${n.evaluate().toString()}`);else n.isNumberLiteral?t.push(n.type.toString()):n.ops?(t.push(n.type.toString()),t.push(n.isCanonical?"canonical":"non-canonical")):t.push("Unknown expression's type");return e.string(t.join(`
`))}},Head:{description:"Return the head of an expression, the name of the operator",lazy:!0,signature:"(any) -> symbol",canonical:(n,{engine:e})=>{if(n.length!==1)return null;let t=n[0];return t.operator?e.box(t.operator):e._fn("Head",Fn(e,n))},evaluate:(n,{engine:e})=>e.symbol(n[0]?.operator??"Undefined")},Tail:{description:"Return the tail of an expression, the operands of the expression",lazy:!0,signature:"(any) -> collection",canonical:(n,{engine:e})=>{if(n.length!==1)return null;let t=n[0];return t.ops?e._fn("Sequence",t.ops):e._fn("Tail",Fn(e,n))},evaluate:([n],{engine:e})=>n?.ops?e._fn("Sequence",n.ops):e.Nothing},Identity:{description:"Return the argument unchanged",signature:"(any) -> unknown",type:([n])=>n.type,evaluate:([n])=>n}},{Apply:{description:"Apply a function to a list of arguments",signature:"(name:symbol, arguments:expression*) -> unknown",type:([n])=>Mn(n.type.type)??"unknown",canonical:(n,{engine:e})=>n[0].symbol?e.function(n[0].symbol,n.slice(1)):e._fn("Apply",n),evaluate:n=>Rt(n[0],n.slice(1))},Assign:{description:"Assign a value to a symbol or define a sequence",lazy:!0,pure:!1,signature:"(symbol | expression, any) -> any",type:([n,e])=>e.type,canonical:(n,{engine:e})=>{if(n.length!==2)return null;let t=n[0];if(t.operator==="Subscript")return e._fn("Assign",[t.canonical,n[1].canonical]);let i=t;return i.symbol||(i=We(e,t,"symbol")),e._fn("Assign",[i,n[1].canonical])},evaluate:([n,e],{engine:t})=>{if(n.symbol&&n.symbol.includes("_")){let o=n.symbol.indexOf("_"),s=n.symbol.substring(0,o),a=n.symbol.substring(o+1),u=parseInt(a,10);if(!isNaN(u)&&String(u)===a){let c=e.evaluate();return xc(t,s,u,c),t.Nothing}if(lo(e,s))return $a(t,s,a,e),t.Nothing;let l=t.function("Function",[e,t.symbol(a)]);return t.assign(s,l),t.Nothing}if(n.operator==="Subscript"&&n.op1?.symbol){let o=n.op1.symbol,s=n.op2;if(s?.operator==="Sequence"&&s.ops){let a=s.ops;if(a.every(f=>f.isNumberLiteral&&Number.isInteger(f.re))){let f=a.map(p=>p.re).join(",");return yc(t,o,f,e.evaluate()),t.Nothing}let u=[],l=!1,c=!0;for(let f of a)if(f.symbol)u.push(f.symbol),l=!0;else if(f.isNumberLiteral&&Number.isInteger(f.re))u.push(String(f.re));else{let p=bc(f);if(p)u.push(p),l=!0;else{c=!1;break}}if(c&&u.length===a.length){if(lo(e,o)){let f=a.filter(p=>p.symbol).map(p=>p.symbol);if(f.length>0)return hh(t,o,f,e),t.Nothing}else if(l){let f=u.join(",");return yc(t,o,f,e.evaluate()),t.Nothing}}}if(s?.isNumberLiteral&&Number.isInteger(s.re)){let a=s.re,u=e.evaluate();return xc(t,o,a,u),t.Nothing}if(s?.symbol){let a=s.symbol;if(lo(e,o))return $a(t,o,a,e),t.Nothing;{let u=t.function("Function",[e,t.symbol(a)]);return t.assign(o,u),t.Nothing}}if(lo(e,o)){let a=bc(s);if(a)return $a(t,o,a,e),t.Nothing}}let i=n.evaluate();if(!i.symbol)return;let r=e.evaluate();return t.assign(i.symbol,r),r}},Assume:{description:"Assume a type for a symbol",lazy:!0,pure:!1,signature:"(any) -> symbol",evaluate:(n,{engine:e})=>e.symbol(e.assume(n[0]))},Declare:{lazy:!0,pure:!1,signature:"(symbol, type: string | symbol) -> nothing",canonical:(n,{engine:e})=>{let t=n[0];return t.symbol||(t=We(e,n[0],"symbol")),n.length===1?e._fn("Declare",[t]):n.length!==2?null:e._fn("Declare",[t,n[1]])},evaluate:(n,{engine:e})=>{let t=n[0].evaluate().symbol;if(!t)return;if(!n[1])return e.declare(t,{inferred:!0,type:"unknown"}),e.Nothing;let i=n[1].canonical.evaluate(),r=F(i.string??i.symbol??void 0);if(hi(r))return e.declare(t,r),e.Nothing}},Type:{lazy:!0,signature:"(any) -> string",evaluate:([n],{engine:e})=>e.string(n.type.toString()??"unknown")},Evaluate:{lazy:!0,signature:"(any) -> unknown",type:([n])=>n.type,canonical:(n,{engine:e})=>e._fn("Evaluate",Vn(e,n,1)),evaluate:([n],e)=>n.evaluate(e)},EvaluateAt:{lazy:!0,signature:"(function, lower:number, upper:number) -> number",type:([n])=>Mn(n.type.type)??"number",canonical:(n,{engine:e})=>{if(n.length===0)return null;let t=Le(n[0]);return t?e._fn("EvaluateAt",[t,...n.slice(1).map(i=>We(e,i,"value"))]):null},evaluate:([n,e,t],{engine:i})=>{if(t===void 0){let s=Rt(n,[e]);return s&&s.isNumberLiteral?s:i._fn("EvaluateAt",[n,e])}let r=Rt(n,[e]),o=Rt(n,[t]);return r&&o&&r.N().isNumberLiteral&&o.N().isNumberLiteral?o.sub(r):i._fn("EvaluateAt",[n,e,t])}},BuiltinFunction:{complexity:9876,lazy:!0,signature:"(symbol | string) -> symbol",canonical:([n],{engine:e})=>e.symbol(n.symbol??n.string??"Undefined")},Function:{description:"A function literal",complexity:9876,lazy:!0,signature:"(expression, symbol*) -> function",type:([n,...e])=>`(${e.map(t=>t.type.type)}) -> ${n.type.type}`,canonical:(n,{engine:e})=>ir(e,n)??null,evaluate:n=>{}},Rule:{lazy:!0,signature:"(match: expression, replace: expression, predicate: function?) -> expression",evaluate:([n,e,t],{engine:i})=>{}},Simplify:{lazy:!0,signature:"(any) -> expression",canonical:(n,{engine:e})=>e._fn("Simplify",Vn(e,n,1)),evaluate:([n])=>n.simplify()??void 0},CanonicalForm:{description:["Return the canonical form of an expression","Can be used to sort arguments of an expression.",'Sorting arguments of commutative functions is a weak form of canonicalization that can be useful in some cases, for example to accept "x+1" and "1+x" while rejecting "x+1" and "2x-x+1"'],complexity:8200,lazy:!0,signature:"(any, symbol*) -> any",canonical:n=>{if(n.length===1)return n[0].canonical;let e=n.slice(1).map(t=>t.symbol??t.string).filter(t=>t!=null);return ar(n[0],e)}},N:{description:"Numerically evaluate an expression",lazy:!0,signature:"(any) -> unknown",type:([n])=>n.type,canonical:(n,{engine:e})=>{if(n.length!==1)return e._fn("N",Vn(e,n,1));let t=n[0].operator;return t==="N"||t==="Evaluate"?n[0].canonical:e._fn("N",n)},evaluate:([n])=>n.N()},Random:{description:["Random(): Return a random number between 0 and 1","Random(n): Return a random integer between 0 and n-1","Random(m, n): Return a random integer between m and n-1"],pure:!1,signature:"(lower:integer?, upper:integer?) -> finite_number",type:([n,e])=>n===void 0&&e===void 0?"finite_number":"finite_integer",sgn:()=>"non-negative",evaluate:(n,{engine:e})=>{if(n.length===0)return e.number(Math.random());let[t,i]=n,r,o;return i===void 0?(r=0,o=Math.floor(t.re-1),isNaN(o)&&(o=0)):(r=Math.floor(t.re),o=Math.floor(i.re),isNaN(r)&&(r=0),isNaN(o)&&(o=0)),e.number(r+Math.floor(Math.random()*(o-r)))}},Signature:{lazy:!0,signature:"(symbol) -> string | nothing",evaluate:([n],{engine:e})=>n.operatorDefinition?e.string(n.operatorDefinition.signature.toString()):e.Nothing},Subscript:{lazy:!0,signature:"(collection, any) -> any",type:([n,e],{engine:t})=>{if(n.string&&J(e)!==null)return"integer";if(n.isIndexedCollection)return Sn(n.type.type)??"any";if(n.symbol){let i=Sn(n.type.type);if(i)return i}if(n.symbol){let i=t.lookupDefinition(n.symbol);return re(i)&&i.value.subscriptEvaluate?"number":(e.string??e.symbol??J(e)?.toString())||e.operator==="InvisibleOperator"&&e.ops&&e.ops.map(s=>s.symbol??J(s)?.toString()).every(s=>s!=null)?"symbol":"unknown"}return"expression"},canonical:([n,e],{engine:t})=>{if(n=n.canonical,n.string){let r=J(e.canonical);if(r!==null&&r>1&&r<=36){let[o,s]=jo(n.string,r);return s?t.error(["unexpected-digit",s[0]],n.toString()):t.number(o)}return t._fn("Baseform",[n,t.error(["invalid-base",e.toString()])])}if(n.isIndexedCollection)return t._fn("At",[n,e.canonical]);if(n.symbol&&Sn(n.type.type))return(e.operator==="Sequence"||e.operator==="Tuple")&&e.ops?t._fn("At",[n,...e.ops.map(r=>r.canonical)]):t._fn("At",[n,e.canonical]);if(n.symbol){let r=t.lookupDefinition(n.symbol);if(re(r)&&r.value.subscriptEvaluate)return t._fn("Subscript",[n,e.canonical])}if(n.symbol){let r=e.string??e.symbol??J(e)?.toString();if(r)return t.symbol(n.symbol+"_"+r);if(e.operator==="InvisibleOperator"&&e.ops){let o=e.ops.map(s=>s.symbol??J(s)?.toString());if(o.every(s=>s!=null))return t.symbol(n.symbol+"_"+o.join(""))}}e.operator==="Sequence"&&t._fn("Subscript",[n,t._fn("List",e.ops)]);let i=e;return e.operator==="Delimiter"&&e.op1&&(i=e.op1.canonical),t._fn("Subscript",[n,i])},evaluate:(n,{engine:e,numericApproximation:t})=>{let[i,r]=n;if(i.symbol){let o=i.valueDefinition;if(o?.subscriptEvaluate){let s=r.evaluate({numericApproximation:t}),a=o.subscriptEvaluate(s,{engine:e,numericApproximation:t});if(a!==void 0)return a}}}},Symbol:{complexity:500,description:"Construct a new symbol with a name formed by concatenating the arguments",broadcastable:!0,lazy:!0,signature:"function",type:n=>n.length===0?"nothing":"symbol",canonical:(n,{engine:e})=>n.length===0?e.Nothing:e._fn("Symbol",n.map(t=>t.symbol?t:t.canonical)),evaluate:(n,{engine:e})=>{n.length>0;let t=n.map(i=>i.symbol??i.string??J(i)?.toString()??"").join("");return e.symbol(t)}},Timing:{description:"`Timing(expr)` evaluates `expr` and return a `Pair` of the number of second elapsed for the evaluation, and the value of the evaluation",signature:"(value, repeat: integer?) -> tuple<result:value, time:number>",evaluate:(n,{engine:e})=>{if(n[1].symbol==="Nothing"){let u=globalThis.performance.now(),l=n[0].evaluate(),c=1e3*(globalThis.performance.now()-u);return e.tuple(e.number(c),l)}let t=Math.max(3,G(n[1])??3),i=[],r;for(;t>0;){let u=globalThis.performance.now();r=n[0].evaluate(),i.push(1e3*(globalThis.performance.now()-u)),t-=1}let o=Math.max(...i),s=Math.min(...i);i=i.filter(u=>u>s&&u<o);let a=i.reduce((u,l)=>u+l,0);return a===0?e.tuple(e.number(o),r):e.tuple(e.number(a/i.length),r)}}},{Wildcard:{signature:"(symbol) -> symbol",canonical:(n,{engine:e})=>n.length!==1?e.symbol("_"):e.symbol("_"+n[0].symbol)},WildcardSequence:{signature:"(symbol) -> symbol",canonical:(n,{engine:e})=>n.length!==1?e.symbol("__"):e.symbol("__"+n[0].symbol)},WildcardOptionalSequence:{signature:"(symbol) -> symbol",canonical:(n,{engine:e})=>n.length!==1?e.symbol("___"):e.symbol("___"+n[0].symbol)}},{LatexString:{description:"Value preserving type conversion/tag indicating the string is a LaTeX string",signature:"(string) -> string",evaluate:([n])=>n},Latex:{description:"Serialize an expression to LaTeX",signature:"(any+) -> string",evaluate:(n,{engine:e})=>e.box(["LatexString",e.string(C(n.map(t=>t.latex)))])},Parse:{description:"Parse a LaTeX string and evaluate to a corresponding expression",signature:"(string) -> any",evaluate:([n],{engine:e})=>e.parse(n.string)??e.Nothing}},{String:{description:"A string created by joining its arguments. The arguments are converted to their default string representation.",broadcastable:!0,signature:"(any*) -> string",evaluate:(n,{engine:e})=>n.length===0?e.string(""):e.string(n.map(t=>t.toString()).join(""))},StringFrom:{description:"Create a string by converting its arguments to a string and joining them.",broadcastable:!0,signature:"(any, format:string?) -> string",evaluate:([n,e],{engine:t})=>{if(n===void 0)return t.string("");let i=e?.string??"default";if(i==="default")return t.string(n.toString());if(i==="utf-8")return n.isIndexedCollection?t.string(new TextDecoder("utf-8").decode(new Uint8Array([...n.each()].map(r=>G(r)??65533)))):t.typeError(F("indexed_collection<integer>"),n.type);if(i==="utf-16")return n.isIndexedCollection?t.string(new TextDecoder("utf-16").decode(new Uint16Array([...n.each()].map(r=>G(r)??65533)))):t.typeError(F("indexed_collection<integer>"),n.type);if(i==="unicode-scalars"){let r=G(n);return r!==null?t.string(String.fromCodePoint(r)):n.isIndexedCollection?t.string(String.fromCodePoint(...[...n.each()].map(o=>G(o)??65533))):t.typeError(F("indexed_collection<integer>|integer"),n.type)}return t.string(n.toString())}},Utf8:{description:"A collection of UTF-8 code units from a string.",signature:"(string) -> list<integer>",evaluate:([n],{engine:e})=>{if(!n.string)return;let t=n.buffer;return e.function("List",Array.from(t,i=>e.number(i)))}},Utf16:{description:"A collection of UTF-16 code units from a string.",signature:"(string) -> list<integer>",evaluate:([n],{engine:e})=>{if(!n.string)return;let t=[];for(let i=0;i<n.string.length;i++){let r=n.string.charCodeAt(i);t.push(r)}return e.function("List",t.map(i=>e.number(i)))}},UnicodeScalars:{description:"A collection of Unicode scalars from a string, same as UTF-32",signature:"(string) -> list<integer>",evaluate:([n],{engine:e})=>{if(!n.string)return;let t=n.unicodeScalars;return e.function("List",t.map(i=>e.number(i)))}},GraphemeClusters:{description:"A collection of grapheme clusters from a string.",signature:"(string) -> list<string>",evaluate:([n],{engine:e})=>{if(!n.string)return;let t=new Intl.Segmenter("en",{granularity:"grapheme"}),i=Array.from(t.segment(n.string),r=>e.string(r.segment));return e.function("List",i)}},BaseForm:{description:"`BaseForm(expr, base=10)`",complexity:9e3,signature:"(number, (string|integer)?) -> string | nothing",type:([n])=>n===void 0?"nothing":n.type,evaluate:([n])=>n},DigitsFrom:{description:"Return an integer representation of the string `s` in base `base`.",signature:"(string, (string|integer)?) -> integer",evaluate:(n,{engine:e})=>{let t=n[0]?.string,i=e;if(!t)return i.typeError("string",n[0]?.type,n[0]);if(t=t.trim(),t.startsWith("0x"))return i.number(parseInt(t.slice(2),16));if(t.startsWith("0b"))return i.number(parseInt(t.slice(2),2));let r=n[1]??i.Nothing;if(r.symbol==="Nothing")return i.number(Number.parseInt(t,10));let o=r.re;if(!r.isInteger||!Number.isFinite(o)||o<2||o>36)return i.error(["unexpected-base",o.toString()],r.toString());let[s,a]=jo(t,r.string??r.symbol??10);return a?i.error(["unexpected-digit",a[0]],a):i.number(s)}},IntegerString:{description:"`IntegerString(n, base=10)`       return a string representation of the integer `n` in base `base`.",broadcastable:!0,signature:"(integer, integer?) -> string",evaluate:(n,{engine:e})=>{let t=e,i=n[0];if(!i.isInteger)return t.typeError("integer",i.type,i);let r=i.re;if(!Number.isFinite(r))return t.typeError("integer",i.type,i);let o=n[1]??t.Nothing;if(o.symbol==="Nothing")return i.bignumRe!==void 0?t.string(i.bignumRe.abs().toString()):t.string(Math.abs(r).toString());let s=J(o);return s===null?t.typeError("integer",o.type,o):s<2||s>36?t.error(["out-of-range","2","36",s.toString()],o.toString()):t.string(Math.abs(r).toString(s))}}},{RandomExpression:{signature:"() -> expression",evaluate:(n,{engine:e})=>e.box(Mt())}}];Tn();Nn();Yr();kt();Yt();var Ih=[{Matrix:{complexity:9e3,lazy:!0,signature:"(matrix, string?, string?) -> matrix",type:([n])=>n.type,canonical:sE,evaluate:(n,e)=>n[0].evaluate(e)},Vector:{complexity:9e3,lazy:!0,signature:"(number+) -> vector",type:n=>F(`vector<${n.length}>`,n[0].engine._typeResolver),canonical:(n,{engine:e})=>e._fn("Matrix",[e.function("List",n.map(t=>e.function("List",[t])))])}},{Shape:{complexity:8200,signature:"(value) -> tuple",evaluate:([n],{engine:e})=>e.tuple(...n.shape)},Rank:{description:"The length of the shape of the expression. Note this is not the matrix rank (the number of linearly independent rows or columns in the matrix)",complexity:8200,signature:"(value) -> number",sgn:()=>"positive",evaluate:([n],{engine:e})=>e.number(n.rank)},Reshape:{complexity:8200,signature:"(value, tuple) -> value",type:([n,e])=>{if(n.isNumber)return F(`list<number^${e.ops.map(i=>i.toString()).join("x")}>`);if(!n.type.matches("list"))return"nothing";let t=n.type.type;return w(t.elements,"number")?F(`list<number^${e.ops.map(i=>i.toString()).join("x")}>`):"nothing"},evaluate:(n,{engine:e})=>{let t=n[0].evaluate(),i=n[1].ops?.map(r=>r.re)??[];if(i.length===0){if(t.isNumber)return t;if(Z(t)){let r=t.tensor.flatten();return r.length>0?e.box(r[0]):e.Zero}return}if(t.isNumber)return Sh(e,[t],i);if(!Z(t)&&ke(t)&&(t=e.function("List",[...t.each()])),Z(t)){if(i.join("x")===t.shape.join("x"))return t;let o=t.tensor.flatten().map(s=>e.box(s));return Sh(e,o,i)}}},Flatten:{complexity:8200,signature:"(value) -> list",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(t.isNumber)return e.box(["List",t]);if(Z(t))return e.box(["List",...t.tensor.flatten().map(i=>e.box(i))]);if(ke(t))return e.function("List",[...t.each()])}},Transpose:{complexity:8200,signature:"(value, axis1: integer?, axis2: integer?) -> value",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(t.isNumber)return t;if(!Z(t)&&ke(t)&&(t=e.function("List",[...t.each()])),Z(t)){let i=t.shape.length;if(i===1)return t;let r=i-1,o=i;return n.length===3&&(r=n[1].re??r,o=n[2].re??o,r>0&&o>0),r===o?t:r<=0||r>i||o<=0||o>i?void 0:t.tensor.transpose(r,o)?.expression}}},ConjugateTranspose:{complexity:8200,signature:"(value, axis1: integer?, axis2: integer?) -> value",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(t.isNumber)return e.box(["Conjugate",t]).evaluate();if(Z(t)){let i=t.shape.length;if(i===1){let s=[...t.each()].map(a=>e.box(["Conjugate",a]).evaluate());return e.box(["List",...s])}let r=i-1,o=i;return n.length===3&&(r=n[1].re??r,o=n[2].re??o,r>0&&o>0),r===o?t:r<=0||r>i||o<=0||o>i?void 0:t.tensor.conjugateTranspose(r,o)?.expression}}},Determinant:{complexity:8200,signature:"(matrix) -> number",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(t.isNumber)return t;if(Z(t)){let i=t.shape;return i.length===1||i.length>2||i.length===2&&i[0]!==i[1]?e.error("expected-square-matrix",t.toString()):t.tensor.determinant()}}},Inverse:{complexity:8200,signature:"(matrix) -> matrix",type:([n])=>n.type,evaluate:([n],{engine:e})=>{let t=n.evaluate();if(t.isNumber)return e.box(["Divide",1,t]).evaluate();if(Z(t)){let i=t.shape;return i.length===1||i.length>2||i.length===2&&i[0]!==i[1]?e.error("expected-square-matrix",t.toString()):t.tensor.inverse()?.expression}}},PseudoInverse:{complexity:8200,signature:"(matrix) -> matrix",evaluate:([n],{engine:e})=>{let t=n.evaluate();if(t.isNumber)return t.isZero?e.Zero:e.box(["Divide",1,t]).evaluate();if(Z(t))return t.tensor.pseudoInverse()?.expression}},AdjugateMatrix:{complexity:8200,signature:"(matrix) -> matrix",evaluate:n=>{let e=n[0].evaluate();if(Z(e))return e.tensor.adjugateMatrix()?.expression}},Trace:{complexity:8200,signature:"(value, axis1: integer?, axis2: integer?) -> value",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(t.isNumber)return t;if(Z(t)){let i=t.shape;if(i.length===1)return e.error("expected-matrix-or-tensor",t.toString());let r=i.length-1,o=i.length;if(n.length>=3&&(r=n[1].re??r,o=n[2].re??o),r<=0||r>i.length)return e.error("invalid-axis",r.toString());if(o<=0||o>i.length)return e.error("invalid-axis",o.toString());if(r===o)return e.error("invalid-axis","axes must be different");if(i[r-1]!==i[o-1])return e.error("expected-square-matrix",t.toString());let s=t.tensor.trace(r,o);return s===void 0?void 0:typeof s=="number"||typeof s=="boolean"||!("expression"in s)?e.box(s):s.expression}}},MatrixMultiply:{complexity:8300,signature:"(matrix|vector, matrix|vector) -> matrix|vector",evaluate:(n,{engine:e})=>{let t=n[0].evaluate(),i=n[1].evaluate();if(!Z(t)||!Z(i))return;let r=t.shape,o=i.shape;if(r.length===1&&o.length===1){if(r[0]!==o[0])return e.error("incompatible-dimensions",`${r[0]} vs ${o[0]}`);let s=r[0],a=e.Zero;for(let u=0;u<s;u++){let l=t.tensor.at(u+1)??e.Zero,c=i.tensor.at(u+1)??e.Zero;a=a.add(e.box(l).mul(e.box(c)))}return a.evaluate()}if(r.length===2&&o.length===1){let[s,a]=r;if(a!==o[0])return e.error("incompatible-dimensions",`${a} vs ${o[0]}`);let u=[];for(let l=0;l<s;l++){let c=e.Zero;for(let f=0;f<a;f++){let p=t.tensor.at(l+1,f+1)??e.Zero,d=i.tensor.at(f+1)??e.Zero;c=c.add(e.box(p).mul(e.box(d)))}u.push(c.evaluate())}return e.box(["List",...u])}if(r.length===1&&o.length===2){let[s,a]=o;if(r[0]!==s)return e.error("incompatible-dimensions",`${r[0]} vs ${s}`);let u=[];for(let l=0;l<a;l++){let c=e.Zero;for(let f=0;f<s;f++){let p=t.tensor.at(f+1)??e.Zero,d=i.tensor.at(f+1,l+1)??e.Zero;c=c.add(e.box(p).mul(e.box(d)))}u.push(c.evaluate())}return e.box(["List",...u])}if(r.length===2&&o.length===2){let[s,a]=r,[u,l]=o;if(a!==u)return e.error("incompatible-dimensions",`${a} vs ${u}`);let c=a,f=[];for(let p=0;p<s;p++){let d=[];for(let m=0;m<l;m++){let g=e.Zero;for(let h=0;h<c;h++){let x=t.tensor.at(p+1,h+1)??e.Zero,y=i.tensor.at(h+1,m+1)??e.Zero;g=g.add(e.box(x).mul(e.box(y)))}d.push(g.evaluate())}f.push(e.box(["List",...d]))}return e.box(["List",...f])}}},Diagonal:{complexity:8200,signature:"(value) -> value",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(t.isNumber)return t;if(Z(t)){let i=t.shape;if(i.length===1){let r=i[0],o=[],s=[...t.each()];for(let a=0;a<r;a++){let u=[];for(let l=0;l<r;l++)u.push(a===l?s[a]:e.Zero);o.push(e.box(["List",...u]))}return e.box(["List",...o])}if(i.length===2){let[r,o]=i,s=Math.min(r,o),a=[];for(let u=0;u<s;u++)a.push(t.tensor.at(u+1,u+1)??e.Zero);return e.box(["List",...a])}return e.error("expected-square-matrix",t.toString())}}},IdentityMatrix:{complexity:8100,signature:"(integer) -> matrix",evaluate:(n,{engine:e})=>{let t=n[0].evaluate(),i=t.re;if(i===void 0||!Number.isInteger(i)||i<1)return e.error("expected-positive-integer",t.toString());let r=[];for(let o=0;o<i;o++){let s=[];for(let a=0;a<i;a++)s.push(o===a?e.One:e.Zero);r.push(e.box(["List",...s]))}return e.box(["List",...r])}},ZeroMatrix:{complexity:8100,signature:"(integer, integer?) -> matrix",evaluate:(n,{engine:e})=>{let t=n[0].evaluate(),i=t.re;if(i===void 0||!Number.isInteger(i)||i<1)return e.error("expected-positive-integer",t.toString());let r=i;if(n.length>1){let s=n[1].evaluate();if(r=s.re??i,!Number.isInteger(r)||r<1)return e.error("expected-positive-integer",s.toString())}let o=[];for(let s=0;s<i;s++){let a=[];for(let u=0;u<r;u++)a.push(e.Zero);o.push(e.box(["List",...a]))}return e.box(["List",...o])}},OnesMatrix:{complexity:8100,signature:"(integer, integer?) -> matrix",evaluate:(n,{engine:e})=>{let t=n[0].evaluate(),i=t.re;if(i===void 0||!Number.isInteger(i)||i<1)return e.error("expected-positive-integer",t.toString());let r=i;if(n.length>1){let s=n[1].evaluate();if(r=s.re??i,!Number.isInteger(r)||r<1)return e.error("expected-positive-integer",s.toString())}let o=[];for(let s=0;s<i;s++){let a=[];for(let u=0;u<r;u++)a.push(e.One);o.push(e.box(["List",...a]))}return e.box(["List",...o])}},Norm:{complexity:8200,signature:"(value, number|string?) -> number",evaluate:(n,{engine:e})=>{let t=n[0].evaluate(),i=n.length>1?n[1].evaluate():void 0;if(t.isNumber)return e.box(["Abs",t]).evaluate();if(!Z(t))return;let r=t.shape,o=2;if(i&&(i.string==="Infinity"||i.symbol==="Infinity"||i.re===1/0?o="infinity":i.string==="Frobenius"?o="frobenius":i.re!==void 0&&(o=i.re)),r.length===1){let s=[],a=r[0];for(let u=0;u<a;u++){let l=t.tensor.at(u+1);s.push(l!==void 0?e.box(l):e.Zero)}if(o===1){let u=e.Zero;for(let l of s)u=u.add(e.box(["Abs",l]).evaluate());return u.evaluate()}if(o===2){let u=e.Zero;for(let l of s){let c=e.box(["Abs",l]).evaluate();u=u.add(c.mul(c))}return e.box(["Sqrt",u]).evaluate()}if(o==="infinity"){let u=e.Zero;for(let l of s){let c=e.box(["Abs",l]).evaluate(),f=c.re??0,p=u.re??0;f>p&&(u=c)}return u}if(typeof o=="number"&&o>0){let u=o,l=e.Zero;for(let c of s){let f=e.box(["Abs",c]).evaluate();l=l.add(e.box(["Power",f,u]).evaluate())}return Number.isInteger(u)?e.box(["Root",l,u]).N():e.box(["Power",l,e.box(["Divide",1,u])]).N()}return}if(r.length===2){let[s,a]=r;if(o===2||o==="frobenius"){let u=e.Zero;for(let l=0;l<s;l++)for(let c=0;c<a;c++){let f=t.tensor.at(l+1,c+1),p=f!==void 0?e.box(f):e.Zero,d=e.box(["Abs",p]).evaluate();u=u.add(d.mul(d))}return e.box(["Sqrt",u]).evaluate()}if(o===1){let u=0;for(let l=0;l<a;l++){let c=0;for(let f=0;f<s;f++){let p=t.tensor.at(f+1,l+1),d=p!==void 0?e.box(p):e.Zero,m=e.box(["Abs",d]).evaluate();c+=m.re??0}c>u&&(u=c)}return e.number(u)}if(o==="infinity"){let u=0;for(let l=0;l<s;l++){let c=0;for(let f=0;f<a;f++){let p=t.tensor.at(l+1,f+1),d=p!==void 0?e.box(p):e.Zero,m=e.box(["Abs",d]).evaluate();c+=m.re??0}c>u&&(u=c)}return e.number(u)}return}}},Eigenvalues:{complexity:8500,signature:"(matrix) -> list",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(!Z(t))return;let i=t.shape;if(i.length!==2||i[0]!==i[1])return e.error("expected-square-matrix",t.toString());let r=i[0];if(r===1){let s=t.tensor.at(1,1);return e.box(["List",s!==void 0?e.box(s):e.Zero])}if(eE(t,r)){let s=[];for(let a=0;a<r;a++){let u=t.tensor.at(a+1,a+1);s.push(u!==void 0?e.box(u):e.Zero)}return e.box(["List",...s])}if(r===2){let s=rn(t,1,1,e),a=rn(t,1,2,e),u=rn(t,2,1,e),l=rn(t,2,2,e),c=s.add(l),f=s.mul(l).sub(a.mul(u)),p=c.mul(c).sub(f.mul(e.number(4))),d=e.box(["Sqrt",p]).evaluate(),m=c.add(d).div(e.number(2)).evaluate(),g=c.sub(d).div(e.number(2)).evaluate();return e.box(["List",m,g])}return r===3?nE(t,e):Bh(t,r,e)}},Eigenvectors:{complexity:8600,signature:"(matrix) -> list",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(!Z(t))return;let i=t.shape;if(i.length!==2||i[0]!==i[1])return e.error("expected-square-matrix",t.toString());let r=i[0],o=e.box(["Eigenvalues",t]).evaluate();if(o.operator!=="List"||!o.ops||o.ops.length===0)return;let s=o.ops,a=[];for(let u of s){let l=iE(t,u,r,e);if(l)a.push(l);else return}return e.box(["List",...a])}},Eigen:{complexity:8700,signature:"(matrix) -> tuple",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(!Z(t))return;let i=t.shape;if(i.length!==2||i[0]!==i[1])return e.error("expected-square-matrix",t.toString());let r=e.box(["Eigenvalues",t]).evaluate(),o=e.box(["Eigenvectors",t]).evaluate();return r.operator==="Error"?r:o.operator==="Error"?o:e.box(["Tuple",r,o])}},LUDecomposition:{complexity:8600,signature:"(matrix) -> tuple",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(!Z(t))return;let i=t.shape;if(i.length!==2||i[0]!==i[1])return e.error("expected-square-matrix",t.toString());let r=i[0],o=Y0(t,r,e);if(!o)return;let{P:s,L:a,U:u}=o;return e.box(["Tuple",s,a,u])}},QRDecomposition:{complexity:8600,signature:"(matrix) -> tuple",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(!Z(t))return;let i=t.shape;if(i.length!==2)return e.error("expected-matrix",t.toString());let[r,o]=i,s=Q0(t,r,o,e);if(!s)return;let{Q:a,R:u}=s;return e.box(["Tuple",a,u])}},CholeskyDecomposition:{complexity:8600,signature:"(matrix) -> matrix",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(!Z(t))return;let i=t.shape;if(i.length!==2||i[0]!==i[1])return e.error("expected-square-matrix",t.toString());let r=i[0];return X0(t,r,e)}},SVD:{complexity:8700,signature:"(matrix) -> tuple",evaluate:(n,{engine:e})=>{let t=n[0].evaluate();if(!Z(t))return;let i=t.shape;if(i.length!==2)return e.error("expected-matrix",t.toString());let[r,o]=i,s=K0(t,r,o,e);if(!s)return;let{U:a,S:u,V:l}=s;return e.box(["Tuple",a,u,l])}}}];function Y0(n,e,t){if(!Z(n))return;let i=[];for(let p=0;p<e;p++){i[p]=[];for(let d=0;d<e;d++){let m=n.tensor.at(p+1,d+1),g=typeof m=="number"?m:typeof m=="object"&&"re"in m?m.re??0:0;if(isNaN(g))return;i[p][d]=g}}let r=Array(e).fill(null).map((p,d)=>Array(e).fill(0).map((m,g)=>d===g?1:0)),o=i.map(p=>[...p]),s=Array(e).fill(0).map((p,d)=>d),a=1e-10;for(let p=0;p<e-1;p++){let d=Math.abs(o[p][p]),m=p;for(let g=p+1;g<e;g++)Math.abs(o[g][p])>d&&(d=Math.abs(o[g][p]),m=g);if(!(d<a)){if(m!==p){[o[p],o[m]]=[o[m],o[p]],[s[p],s[m]]=[s[m],s[p]];for(let g=0;g<p;g++)[r[p][g],r[m][g]]=[r[m][g],r[p][g]]}for(let g=p+1;g<e;g++){let h=o[g][p]/o[p][p];r[g][p]=h;for(let x=p;x<e;x++)o[g][x]-=h*o[p][x]}}}let u=[];for(let p=0;p<e;p++){u[p]=[];for(let d=0;d<e;d++)u[p][d]=s[p]===d?t.One:t.Zero}let l=t.box(["List",...u.map(p=>t.box(["List",...p]))]),c=t.box(["List",...r.map(p=>t.box(["List",...p.map(d=>t.number(d))]))]),f=t.box(["List",...o.map(p=>t.box(["List",...p.map(d=>t.number(d))]))]);return{P:l,L:c,U:f}}function Q0(n,e,t,i){if(!Z(n))return;let r=[];for(let c=0;c<e;c++){r[c]=[];for(let f=0;f<t;f++){let p=n.tensor.at(c+1,f+1),d=typeof p=="number"?p:typeof p=="object"&&"re"in p?p.re??0:0;if(isNaN(d))return;r[c][f]=d}}let o=Array(e).fill(null).map((c,f)=>Array(e).fill(0).map((p,d)=>f===d?1:0)),s=r.map(c=>[...c]),a=Math.min(e,t);for(let c=0;c<a;c++){let f=0;for(let x=c;x<e;x++)f+=s[x][c]*s[x][c];if(f=Math.sqrt(f),f<1e-10)continue;let p=s[c][c]>=0?1:-1,d=s[c][c]+p*f,m=Array(e).fill(0);m[c]=1;for(let x=c+1;x<e;x++)m[x]=s[x][c]/d;let g=1;for(let x=c+1;x<e;x++)g+=m[x]*m[x];let h=2/g;for(let x=c;x<t;x++){let y=0;for(let v=c;v<e;v++)y+=m[v]*s[v][x];for(let v=c;v<e;v++)s[v][x]-=h*m[v]*y}for(let x=0;x<e;x++){let y=0;for(let v=c;v<e;v++)y+=o[x][v]*m[v];for(let v=c;v<e;v++)o[x][v]-=h*y*m[v]}}for(let c=0;c<e;c++)for(let f=0;f<Math.min(c,t);f++)Math.abs(s[c][f])<1e-10&&(s[c][f]=0);let u=i.box(["List",...o.map(c=>i.box(["List",...c.map(f=>i.number(f))]))]),l=i.box(["List",...s.map(c=>i.box(["List",...c.map(f=>i.number(f))]))]);return{Q:u,R:l}}function X0(n,e,t){if(!Z(n))return;let i=[];for(let o=0;o<e;o++){i[o]=[];for(let s=0;s<e;s++){let a=n.tensor.at(o+1,s+1),u=typeof a=="number"?a:typeof a=="object"&&"re"in a?a.re??0:0;if(isNaN(u))return;i[o][s]=u}}let r=Array(e).fill(null).map(()=>Array(e).fill(0));for(let o=0;o<e;o++)for(let s=0;s<=o;s++){let a=0;if(s===o){for(let l=0;l<s;l++)a+=r[s][l]*r[s][l];let u=i[s][s]-a;if(u<0)return t.error("expected-positive-definite-matrix",n.toString());r[s][s]=Math.sqrt(u)}else{for(let u=0;u<s;u++)a+=r[o][u]*r[s][u];if(Math.abs(r[s][s])<1e-10)return t.error("expected-positive-definite-matrix",n.toString());r[o][s]=(i[o][s]-a)/r[s][s]}}return t.box(["List",...r.map(o=>t.box(["List",...o.map(s=>t.number(s))]))])}function K0(n,e,t,i){if(!Z(n))return;let r=[];for(let x=0;x<e;x++){r[x]=[];for(let y=0;y<t;y++){let v=n.tensor.at(x+1,y+1),E=typeof v=="number"?v:typeof v=="object"&&"re"in v?v.re??0:0;if(isNaN(E))return;r[x][y]=E}}let o=Array(t).fill(null).map(()=>Array(t).fill(0));for(let x=0;x<t;x++)for(let y=0;y<t;y++)for(let v=0;v<e;v++)o[x][y]+=r[v][x]*r[v][y];let s=Array(e).fill(null).map(()=>Array(e).fill(0));for(let x=0;x<e;x++)for(let y=0;y<e;y++)for(let v=0;v<t;v++)s[x][y]+=r[x][v]*r[y][v];let a=100,u=1e-10,l=Array(t).fill(null).map((x,y)=>Array(t).fill(0).map((v,E)=>y===E?1:0)),c=o.map(x=>[...x]);for(let x=0;x<a;x++){let{Q:y,R:v}=wh(c,t),E=Array(t).fill(null).map(()=>Array(t).fill(0));for(let T=0;T<t;T++)for(let B=0;B<t;B++)for(let O=0;O<t;O++)E[T][B]+=v[T][O]*y[O][B];let _=Array(t).fill(null).map(()=>Array(t).fill(0));for(let T=0;T<t;T++)for(let B=0;B<t;B++)for(let O=0;O<t;O++)_[T][B]+=l[T][O]*y[O][B];let N=0;for(let T=1;T<t;T++)for(let B=0;B<T;B++)N=Math.max(N,Math.abs(E[T][B]));if(c=E,l=_,N<u)break}let f=[];for(let x=0;x<t;x++)f.push(Math.sqrt(Math.max(0,c[x][x])));let p=Array(e).fill(null).map(()=>Array(e).fill(0));for(let x=0;x<Math.min(e,t);x++)if(f[x]>u)for(let y=0;y<e;y++){let v=0;for(let E=0;E<t;E++)v+=r[y][E]*l[E][x];p[y][x]=v/f[x]}if(e>t)for(let x=t;x<e;x++){let y=Array(e).fill(0);y[x]=1;for(let E=0;E<x;E++){let _=0;for(let N=0;N<e;N++)_+=y[N]*p[N][E];for(let N=0;N<e;N++)y[N]-=_*p[N][E]}let v=0;for(let E=0;E<e;E++)v+=y[E]*y[E];if(v=Math.sqrt(v),v>u)for(let E=0;E<e;E++)p[E][x]=y[E]/v}let d=Array(e).fill(null).map(()=>Array(t).fill(0));for(let x=0;x<Math.min(e,t);x++)d[x][x]=f[x];let m=i.box(["List",...p.map(x=>i.box(["List",...x.map(y=>i.number(y))]))]),g=i.box(["List",...d.map(x=>i.box(["List",...x.map(y=>i.number(y))]))]),h=i.box(["List",...l.map(x=>i.box(["List",...x.map(y=>i.number(y))]))]);return{U:m,S:g,V:h}}function rn(n,e,t,i){if(!Z(n))return i.Zero;let r=n.tensor.at(e,t);return r!==void 0?i.box(r):i.Zero}function eE(n,e){if(!Z(n))return!1;let t=!0,i=!0;for(let r=0;r<e&&(t||i);r++)for(let o=0;o<e;o++){let s=n.tensor.at(r+1,o+1),a=s===void 0||s===0||typeof s=="object"&&"re"in s&&s.re===0;r>o&&!a&&(t=!1),r<o&&!a&&(i=!1)}return t||i}function nE(n,e){if(!Z(n))return;let t=rn(n,1,1,e).re??0,i=rn(n,1,2,e).re??0,r=rn(n,1,3,e).re??0,o=rn(n,2,1,e).re??0,s=rn(n,2,2,e).re??0,a=rn(n,2,3,e).re??0,u=rn(n,3,1,e).re??0,l=rn(n,3,2,e).re??0,c=rn(n,3,3,e).re??0;if([t,i,r,o,s,a,u,l,c].some(E=>E===void 0||isNaN(E)))return Bh(n,3,e);let f=t+s+c,p=t*s-i*o,d=t*c-r*u,m=s*c-a*l,g=p+d+m,h=t*(s*c-a*l)-i*(o*c-a*u)+r*(o*l-s*u),x=g-f*f/3,y=2*f*f*f/27-f*g/3+h,v=tE(x,y,f/3);return e.box(["List",e.number(v[0]),e.number(v[1]),e.number(v[2])])}function tE(n,e,t){if(Math.abs(n)<1e-10&&Math.abs(e)<1e-10)return[t,t,t];let r=e*e/4+n*n*n/27;if(r>1e-10){let o=Math.sqrt(r),s=Math.cbrt(-e/2+o),a=Math.cbrt(-e/2-o),u=s+a+t,l=-(s+a)/2+t;return[u,l,l]}else if(r<-1e-10){let o=Math.sqrt(-n*n*n/27),s=Math.acos(-e/2/o),a=Math.cbrt(o),u=2*a*Math.cos(s/3),l=2*a*Math.cos((s+2*Math.PI)/3),c=2*a*Math.cos((s+4*Math.PI)/3);return[u+t,l+t,c+t]}else{let o=Math.cbrt(-e/2);return[2*o+t,-o+t,-o+t]}}function Bh(n,e,t){if(!Z(n))return;let i=[];for(let a=0;a<e;a++){i[a]=[];for(let u=0;u<e;u++){let l=n.tensor.at(a+1,u+1),c=typeof l=="number"?l:typeof l=="object"&&"re"in l?l.re??0:0;if(isNaN(c))return;i[a][u]=c}}let r=100,o=1e-10;for(let a=0;a<r;a++){let u=0;for(let f=1;f<e;f++)for(let p=0;p<f;p++)u=Math.max(u,Math.abs(i[f][p]));if(u<o)break;let{Q:l,R:c}=wh(i,e);for(let f=0;f<e;f++)for(let p=0;p<e;p++){i[f][p]=0;for(let d=0;d<e;d++)i[f][p]+=c[f][d]*l[d][p]}}let s=[];for(let a=0;a<e;a++)s.push(t.number(i[a][a]));return t.box(["List",...s])}function wh(n,e){let t=Array(e).fill(null).map(()=>Array(e).fill(0)),i=Array(e).fill(null).map(()=>Array(e).fill(0)),r=[];for(let s=0;s<e;s++){r[s]=[];for(let a=0;a<e;a++)r[s][a]=n[a][s]}let o=[];for(let s=0;s<e;s++){o[s]=[...r[s]];for(let u=0;u<s;u++){let l=vc(o[u],o[u]);if(Math.abs(l)>1e-10){let c=vc(r[s],o[u])/l;i[u][s]=c*Math.sqrt(l);for(let f=0;f<e;f++)o[s][f]-=c*o[u][f]}}let a=Math.sqrt(vc(o[s],o[s]));if(i[s][s]=a,a>1e-10)for(let u=0;u<e;u++)t[u][s]=o[s][u]/a}return{Q:t,R:i}}function vc(n,e){let t=0;for(let i=0;i<n.length;i++)t+=n[i]*e[i];return t}function iE(n,e,t,i){if(!Z(n))return;let r=e.re;if(r===void 0||isNaN(r))return t===2?rE(n,e,i):void 0;let o=[];for(let a=0;a<t;a++){o[a]=[];for(let u=0;u<t;u++){let l=n.tensor.at(a+1,u+1),c=typeof l=="number"?l:typeof l=="object"&&"re"in l?l.re??0:0;o[a][u]=c-(a===u?r:0)}}let s=oE(o,t);if(s)return i.box(["List",...s.map(a=>i.number(a))])}function rE(n,e,t){if(!Z(n))return;let i=rn(n,1,1,t),r=rn(n,1,2,t),o=rn(n,2,1,t),s=r.re;if(s!==void 0&&Math.abs(s)>1e-10){let c=e.sub(i).evaluate();return t.box(["List",r,c])}let a=o.re;if(a!==void 0&&Math.abs(a)>1e-10){let c=rn(n,2,2,t),f=e.sub(c).evaluate();return t.box(["List",f,o])}let u=i.re,l=e.re;if(u!==void 0&&l!==void 0)return Math.abs(u-l)<1e-10?t.box(["List",t.One,t.Zero]):t.box(["List",t.Zero,t.One])}function oE(n,e){let t=n.map(l=>[...l]),i=1e-10,r=0,o=[];for(let l=0;l<e&&r<e;l++){let c=Math.abs(t[r][l]),f=r;for(let p=r+1;p<e;p++)Math.abs(t[p][l])>c&&(c=Math.abs(t[p][l]),f=p);if(!(c<i)){[t[r],t[f]]=[t[f],t[r]];for(let p=r+1;p<e;p++){let d=t[p][l]/t[r][l];for(let m=l;m<e;m++)t[p][m]-=d*t[r][m]}o.push(l),r++}}let s=-1;for(let l=0;l<e;l++)if(!o.includes(l)){s=l;break}if(s===-1){let l=Array(e).fill(0);return l[0]=1,l}let a=Array(e).fill(0);a[s]=1;for(let l=o.length-1;l>=0;l--){let c=l,f=o[l],p=0;for(let d=f+1;d<e;d++)p+=t[c][d]*a[d];a[f]=-p/t[c][f]}let u=0;for(let l=0;l<e;l++)u+=a[l]*a[l];if(u=Math.sqrt(u),u>i)for(let l=0;l<e;l++)a[l]/=u;return a}function Sh(n,e,t){let i=t.reduce((o,s)=>o*s,1),r=[];for(let o=0;o<i;o++)r.push(e[o%e.length]);return Ah(n,r,t,0)}function Ah(n,e,t,i){if(t.length===1)return n.box(["List",...e.slice(i,i+t[0])]);let r=t[0],o=t.slice(1),s=o.reduce((u,l)=>u*l,1),a=[];for(let u=0;u<r;u++)a.push(Ah(n,e,o,i+u*s));return n.box(["List",...a])}function sE(n,{engine:e}){let t="Matrix";if(n.length===0)return e._fn(t,[]);let i=n[0].operator==="Vector"?n[0].canonical.ops[0]:n[0].canonical,r=n[1]?.canonical,o=n[2]?.canonical;return n.length>3?e._fn(t,Vn(e,n,3)):o?e._fn(t,[i,r,o]):r?e._fn(t,[i,r]):e._fn(t,[i])}Yl();ec();var Rh={True:{wikidata:"Q16751793",type:"boolean",isConstant:!0},False:{wikidata:"Q5432619",type:"boolean",isConstant:!0},And:{wikidata:"Q191081",broadcastable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:"(boolean+) -> boolean",evaluate:jl},Or:{wikidata:"Q1651704",broadcastable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:"(boolean+) -> boolean",evaluate:Ul},Not:{wikidata:"Q190558",broadcastable:!0,involution:!0,complexity:10100,signature:"(boolean) -> boolean",evaluate:Gl},Equivalent:{wikidata:"Q220433",broadcastable:!0,complexity:10200,signature:"(boolean, boolean) -> boolean",canonical:(n,{engine:e})=>{let t=n[0].symbol,i=n[1].symbol;return t==="True"&&i==="True"||t==="False"&&i==="False"?e.True:t==="True"&&i==="False"||t==="False"&&i==="True"?e.False:e._fn("Equivalent",n)},evaluate:zl},Implies:{wikidata:"Q7881229",broadcastable:!0,complexity:10200,signature:"(boolean, boolean) -> boolean",evaluate:Zl},Xor:{description:"Exclusive or: true when an odd number of operands are true",wikidata:"Q498186",broadcastable:!0,associative:!0,commutative:!0,complexity:10200,signature:"(boolean+) -> boolean",evaluate:Hl},Nand:{description:"Not-and: negation of conjunction",wikidata:"Q189550",broadcastable:!0,commutative:!0,complexity:10200,signature:"(boolean+) -> boolean",evaluate:Wl},Nor:{description:"Not-or: negation of disjunction",wikidata:"Q189561",broadcastable:!0,commutative:!0,complexity:10200,signature:"(boolean+) -> boolean",evaluate:Jl},Exists:{signature:"(value, boolean) -> boolean",lazy:!0,scoped:!0,evaluate:Ch},NotExists:{signature:"(value, boolean) -> boolean",lazy:!0,scoped:!0,evaluate:(n,e)=>{let t=Ch(n,e);if(t?.symbol==="True")return e.engine.False;if(t?.symbol==="False")return e.engine.True}},ExistsUnique:{signature:"(value, boolean) -> boolean",lazy:!0,scoped:!0,evaluate:aE},ForAll:{signature:"(value, boolean) -> boolean",lazy:!0,scoped:!0,evaluate:kh},NotForAll:{signature:"(value, boolean) -> boolean",lazy:!0,scoped:!0,evaluate:(n,e)=>{let t=kh(n,e);if(t?.symbol==="True")return e.engine.False;if(t?.symbol==="False")return e.engine.True}},Predicate:{description:"Apply a predicate to arguments, returning a boolean",signature:"(symbol, value+) -> boolean",lazy:!0,evaluate:(n,{engine:e})=>{n.length===0||n[0].symbol}},KroneckerDelta:{description:"Return 1 if the arguments are equal, 0 otherwise",signature:"(value+) -> integer",evaluate:(n,{engine:e})=>{if(n.length===1)return n[0].symbol==="True"?e.One:e.Zero;if(n.length===2)return n[0].isEqual(n[1])?e.One:e.Zero;for(let t=1;t<n.length;t++)if(!n[t].isEqual(n[0]))return e.Zero;return e.One}},Boole:{description:"Return 1 if the argument is true, 0 otherwise. Also known as the Iverson bracket",signature:"(boolean) -> integer",evaluate:(n,{engine:e})=>n[0].symbol==="True"?e.One:e.Zero}};function Mh(n){let e={And:jl,Or:Ul,Not:Gl,Equivalent:zl,Implies:Zl,Xor:Hl,Nand:Wl,Nor:Jl}[n.operator];if(!e||!n.ops)return;let t=e(n.ops,{engine:n.engine});if(t)return{value:t,because:"logic"}}function kh(n,{engine:e}){if(n.length<2)return;let t=n[0],i=n[1],r=i.canonical;if(r.symbol==="True")return e.True;if(r.symbol==="False")return e.False;let o=t.symbol??t.op1?.symbol;if(o&&!Ta(r,o))return r.evaluate();let s=Ko(t,e);if(s){let u=Sa(i,e);if(u.length>0)return cg([{variable:s.variable,values:s.values},...u],Ia(i),e);for(let l of s.values){let f=i.subs({[s.variable]:l}).canonical.evaluate();if(f.symbol==="False")return e.False;if(f.symbol!=="True")return}return e.True}let a=r.evaluate();if(a.symbol==="True")return e.True;if(a.symbol==="False")return e.False}function Ch(n,{engine:e}){if(n.length<2)return;let t=n[0],i=n[1],r=i.canonical;if(r.symbol==="True")return e.True;if(r.symbol==="False")return e.False;let o=t.symbol??t.op1?.symbol;if(o&&!Ta(r,o))return r.evaluate();let s=Ko(t,e);if(s){let u=Sa(i,e);if(u.length>0)return fg([{variable:s.variable,values:s.values},...u],Ia(i),e);for(let l of s.values)if(i.subs({[s.variable]:l}).canonical.evaluate().symbol==="True")return e.True;return e.False}let a=r.evaluate();if(a.symbol==="True")return e.True;if(a.symbol==="False")return e.False}function aE(n,{engine:e}){if(n.length<2)return;let t=n[0],i=n[1],r=Ko(t,e);if(r){let o=0;for(let s of r.values){let u=i.subs({[r.variable]:s}).canonical.evaluate();if(u.symbol==="True"){if(o++,o>1)return e.False}else if(u.symbol!=="False")return}return o===1?e.True:e.False}}var Dh={ToCNF:{signature:"(boolean) -> boolean",evaluate:([n],{engine:e})=>{if(n)return ag(n.evaluate(),e)}},ToDNF:{signature:"(boolean) -> boolean",evaluate:([n],{engine:e})=>{if(n)return ug(n.evaluate(),e)}},IsSatisfiable:{description:"Check satisfiability using brute-force enumeration. O(2^n) complexity, max 20 variables.",signature:"(boolean) -> boolean",evaluate:([n],{engine:e})=>{if(n)return pg(n,e)}},IsTautology:{description:"Check if expression is a tautology using brute-force enumeration. O(2^n) complexity, max 20 variables.",signature:"(boolean) -> boolean",evaluate:([n],{engine:e})=>{if(n)return dg(n,e)}},TruthTable:{description:"Generate truth table for expression. O(2^n) complexity, max 10 variables.",signature:"(boolean) -> list",evaluate:([n],{engine:e})=>{if(n)return mg(n,e)}},PrimeImplicants:{description:"Find all prime implicants using Quine-McCluskey. Max 12 variables.",signature:"(boolean) -> list",evaluate:([n],{engine:e})=>{if(!n)return;let t=gg(n,e);return t===null?e._fn("PrimeImplicants",[n]):e._fn("List",t)}},PrimeImplicates:{description:"Find all prime implicates using Quine-McCluskey. Max 12 variables.",signature:"(boolean) -> list",evaluate:([n],{engine:e})=>{if(!n)return;let t=hg(n,e);return t===null?e._fn("PrimeImplicates",[n]):e._fn("List",t)}},MinimalDNF:{description:"Convert to minimal DNF using Quine-McCluskey. Max 12 variables.",signature:"(boolean) -> boolean",evaluate:([n],{engine:e})=>{if(!n)return;let t=xg(n,e);return t===null?e._fn("MinimalDNF",[n]):t}},MinimalCNF:{description:"Convert to minimal CNF using Quine-McCluskey. Max 12 variables.",signature:"(boolean) -> boolean",evaluate:([n],{engine:e})=>{if(!n)return;let t=yg(n,e);return t===null?e._fn("MinimalCNF",[n]):t}}};Xe();ca();_n();var Ph=[{Totient:{wikidata:"Q190026",description:"Euler\u2019s totient function \u03C6(n): count of positive integers \u2264 n that are coprime to n.",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1)return;let i=1n;for(let r=2n;r<t;r++)Gi(r,t)===1n&&i++;return e.number(i)}},Sigma0:{description:"Number of positive divisors of n.",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1)return;let i=0;for(let r=1n;r<=t;r++)t%r===0n&&i++;return e.number(i)}},Sigma1:{description:"Sum of positive divisors of n.",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1)return;let i=e.bignum(0);for(let r=1n;r<=t;r++)t%r===0n&&(i=i.add(e.bignum(r)));return e.number(i)}},SigmaMinus1:{description:"Sum of reciprocals of positive divisors of n.",signature:"(integer) -> number",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1)return;let i=e.bignum(0);for(let r=1n;r<=t;r++)t%r===0n&&(i=i.add(e.bignum(1).div(e.bignum(r))));return e.number(i)}},IsPerfect:{wikidata:"Q170043",description:'Returns "True" if n is a perfect number, a positive integer which equals the sum of all its divisors.',signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1)return;let i=0n;for(let r=1n;r<t;r++)t%r===0n&&(i+=r);return e.symbol(i===t?"True":"False")}},Eulerian:{description:"Eulerian number A(n, m): number of permutations of {1..n} with exactly m ascents.",signature:"(integer, integer) -> integer",evaluate:([n,e],{engine:t})=>{let i=De(n),r=De(e);if(i===null||r===null||i<0n||r<0n||r>=i)return;let o=(s,a)=>a===0n?1n:a>=s?0n:(a+1n)*o(s-1n,a)+(s-a)*o(s-1n,a-1n);return t.number(o(i,r))}},Stirling:{description:"Stirling number of the second kind S(n, m): ways to partition n elements into m non-empty subsets.",signature:"(integer, integer) -> integer",evaluate:([n,e],{engine:t})=>{let i=De(n),r=De(e);if(i===null||r===null||i<0n||r<0n||r>i)return;let o=(s,a)=>s===0n&&a===0n?1n:s===0n||a===0n?0n:o(s-1n,a-1n)+a*o(s-1n,a);return t.number(o(i,r))}},NPartition:{description:"Number of integer partitions of n.",signature:"(integer) -> integer",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<0n)return;let i=new Map,r=o=>{if(o===0n)return 1n;if(o<0n)return 0n;if(i.has(o))return i.get(o);let s=0n;for(let a=1n;;a++){let u=a*(3n*a-1n)/2n,l=a*(3n*a+1n)/2n;if(u>o&&l>o)break;let c=a%2n===0n?-1n:1n;s+=c*(r(o-u)+r(o-l))}return i.set(o,s),s};return e.number(r(t))}},IsTriangular:{description:"True if n is a triangular number.",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1n)return e.False;let i=8n*t+1n,r=BigInt(To.sqrt(e.bignum(i)).toFixed(0));return e.symbol(r*r===i&&(r-1n)%2n===0n?"True":"False")}},IsSquare:{description:"True if n is a perfect square.",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<0n)return e.False;let i=BigInt(To.sqrt(e.bignum(t)).toFixed(0));return e.symbol(i*i===t?"True":"False")}},IsOctahedral:{description:"True if n is an octahedral number.",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1n)return e.False;let i=3n*t+1n,r=BigInt(To.sqrt(e.bignum(i)).toFixed(0));return e.symbol(r*r===i?"True":"False")}},IsCenteredSquare:{description:"True if n is a centered square number.",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1n||(t-1n)%4n!==0n)return e.False;let i=(t-1n)/4n,r=BigInt(To.sqrt(e.bignum(i)).toFixed(0));return e.symbol(r*r*4n+1n===t?"True":"False")}},IsHappy:{wikidata:"Q44535",description:"True if n is a happy number, a number which eventually reaches 1 when the number is replaced by the sum of the square of each digit",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=new Set,i=De(n);if(i===null)return e.False;for(;!t.has(i);){if(i===1n)return e.True;t.add(i),i=uE(i)}return e.False}},IsAbundant:{description:"True if n is an abundant number (sum of divisors > 2n).",signature:"(integer) -> boolean",evaluate:([n],{engine:e})=>{let t=De(n);if(t===null||t<1n)return e.False;let i=1n;for(let r=2n;r*r<=t;r++)if(t%r===0n){i+=r;let o=t/r;o!==r&&(i+=o)}return e.symbol(i>t?"True":"False")}}}];function uE(n){return n.toString().split("").map(e=>BigInt(e)).reduce((e,t)=>e+t*t,0n)}Pn();Gr();cn();tn();Ki();function gs(n){let e=n.engine,t=n.operator;if(Dn(t))return e.function(t,n.ops.map(gs));if(t==="Divide")return n.ops[0].div(n.ops[1]);if(t==="Negate")return gs(n.ops[0]).neg();if(t==="Add"){let[i,r]=n.ops.reduce((o,s)=>(s.operator==="Divide"?(o[0].push(s.ops[0]),o[1].push(s.ops[1])):o[0].push(s),o),[[],[]]);return X(...i).div(X(...r))}return n}function Ua(n){let e=n.engine;if(n.operator!=="Add")return null;let t=n.ops;if(t.length!==3)return null;for(let i=0;i<3;i++)for(let r=0;r<3;r++){if(i===r)continue;let o=3-i-r,s=t[i],a=t[r],u=t[o],l=_c(s,e),c=_c(a,e);if(l===null||c===null)continue;let f=e.number(2).mul(l).mul(c),p=f.neg();if(u.isSame(f))return e.box(["Square",l.add(c).json]);if(u.isSame(p))return e.box(["Square",l.sub(c).json])}return null}function _c(n,e){let t=n.sqrt().simplify();if(t.operator==="Sqrt")return null;if(t.isNumberLiteral&&t.numericValue){let i=t.numericValue;if(i.radical!==void 0&&i.radical!==1)return null}if(t.operator==="Abs")return t.op1;if(t.operator==="Multiply"&&t.ops.filter(r=>r.operator==="Abs").length>0){let r=t.ops.map(o=>o.operator==="Abs"?o.op1:o);return e.box(["Multiply",...r.map(o=>o.json)])}return t}function Ga(n){let e=n.engine;if(n.operator!=="Add")return null;let t=n.ops;if(t.length!==2)return null;let i=[];for(let u of t){let l=u.operator==="Negate",c=l?u.op1:u;if(!l&&u.isNumberLiteral&&u.isNegative===!0&&(l=!0,c=u.neg()),!l&&u.operator==="Multiply"){let p=u.ops;if(p[0].isNumberLiteral&&p[0].isNegative===!0){l=!0;let d=[p[0].neg(),...p.slice(1)];c=e.box(["Multiply",...d.map(m=>m.json)])}}let f=_c(c,e);if(f===null)return null;i.push({sqrt:f,isNegative:l})}let r=i.filter(u=>!u.isNegative),o=i.filter(u=>u.isNegative);if(r.length!==1||o.length!==1)return null;let s=r[0].sqrt,a=o[0].sqrt;return e.box(["Multiply",s.sub(a).json,s.add(a).json])}function Oh(n,e){let t=n.engine;if(ge(n,e)!==2)return null;let r=Jn(n,e);if(!r||r.length<3)return null;let o=r[0],s=r[1],a=r[2];if(a.is(0))return null;let u=s.pow(2).sub(t.number(4).mul(a).mul(o));if(u.isNegative===!0)return null;let l=u.sqrt();if(l.operator==="Sqrt")return null;if(l.isNumberLiteral&&l.numericValue){let x=l.numericValue;if(x.radical!==void 0&&x.radical!==1)return null}let c=t.number(2).mul(a),f=s.neg().add(l).div(c),p=s.neg().sub(l).div(c),d=x=>{if(x.operator==="Sqrt")return!0;if(x.isNumberLiteral&&x.numericValue){let y=x.numericValue;if(y.radical!==void 0&&y.radical!==1)return!0}if(x.ops){for(let y of x.ops)if(d(y))return!0}return!1};if(d(f)||d(p))return null;let m=t.symbol(e),g=m.sub(f),h=m.sub(p);return a.is(1)?t.box(["Multiply",g.json,h.json]):t.box(["Multiply",a.json,g.json,h.json])}function za(n,e){let t=Ua(n);if(t!==null)return t;let i=Ga(n);if(i!==null)return i;if(e!==void 0){let r=Oh(n,e);if(r!==null)return r}return Ri(n)}function Ri(n){let e=n.operator;if(Dn(e)){let t=fn.from(n.op1),i=fn.from(n.op2),[r,o]=zm(t,i),s=r.sgn()===-1;return r.isOne||(t.div(r),i.div(r)),o.is(1)||(o.isPositive?(t.div(o),i.div(o)):o.isNegative&&(t.div(o.neg()),i.div(o.neg()),s=!s)),s&&([t,i]=[i,t]),n.engine.function(e,[t.asExpression(),i.asExpression()])}if(e==="Negate")return Ri(n.ops[0]).neg();if(e==="Add"){let t=n.engine,i,r=[];for(let s of n.ops){let[a,u]=s.toNumericValue();i=i?i.gcd(a):a,a.isZero||r.push({coeff:a,term:u})}if(!i||i.isOne)return n;let o=r.map(({coeff:s,term:a})=>pe(a,t.box(s.div(i))));return pe(t.number(i),X(...o))}return fn.from(gs(n)).asExpression()}function Nc(n,e,t,i){let r=n.engine;return n.operator===t?r.box([i,...n.ops.map(o=>Nc(o,e,t,i))]):e.operator===t?r.box([i,...e.ops.map(o=>Nc(n,o,t,i))]):r.box([i,n,e])}function Lh(n,e="Add",t="Multiply"){if(n.operator!==t)return n;let i=n.ops;return!i||i.length<2?n:n.engine.box([e,i.slice(1).reduce((r,o)=>Nc(r,o,e,t),i[0])])}Ni();Ki();var qh=[{Expand:{description:"Expand out products and positive integer powers",lazy:!0,signature:"(value)-> value",evaluate:([n])=>Ln(n.canonical)??n.canonical},ExpandAll:{description:"Recursively expand out products and positive integer powers",lazy:!0,signature:"(value)-> value",evaluate:([n])=>Ur(n.canonical)??n.canonical},Factor:{description:"Factor a polynomial expression into a product of irreducible factors. Supports perfect square trinomials, difference of squares, and quadratic factoring with rational roots. Example: Factor(x\xB2 + 5x + 6) \u2192 (x+2)(x+3), Factor(x\xB2 + 2x + 1) \u2192 (x+1)\xB2",lazy:!0,signature:"(value, symbol?) -> value",evaluate:([n,e])=>{if(!n)return n;if(e){let t=e.canonical.symbol;return t?za(n.canonical,t):n.canonical}return za(n.canonical)}},Together:{description:"Combine rational expressions into a single fraction",lazy:!0,signature:"(value)-> value",evaluate:([n])=>gs(n.canonical)},Distribute:{description:"Distribute multiplication over addition",lazy:!0,signature:"(value)-> value",evaluate:([n])=>n&&Lh(n.canonical)},PolynomialDegree:{description:"Return the degree of a polynomial with respect to a variable. Example: PolynomialDegree(x\xB3 + 2x + 1, x) \u2192 3",lazy:!0,signature:"(value, symbol) -> integer",evaluate:([n,e])=>{if(!n||!e)return;let t=e.canonical.symbol;if(!t)return;let i=ge(n.canonical,t);return i>=0?n.engine.number(i):void 0}},CoefficientList:{description:"Return the list of coefficients of a polynomial, from lowest to highest degree. Example: CoefficientList(x\xB3 + 2x + 1, x) \u2192 [1, 2, 0, 1]",lazy:!0,signature:"(value, symbol) -> list<value>",evaluate:([n,e])=>{if(!n||!e)return;let t=e.canonical.symbol;if(!t)return;let i=Jn(n.canonical,t);if(i)return n.engine.box(["List",...i])}},PolynomialQuotient:{description:"Return the quotient of polynomial division of dividend by divisor. Example: PolynomialQuotient(x\xB3 - 1, x - 1, x) \u2192 x\xB2 + x + 1",lazy:!0,signature:"(dividend: value, divisor: value, variable: symbol) -> value",evaluate:([n,e,t])=>{if(!n||!e||!t)return;let i=t.canonical.symbol;return i?ni(n.canonical,e.canonical,i)?.[0]:void 0}},PolynomialRemainder:{description:"Return the remainder of polynomial division of dividend by divisor. Example: PolynomialRemainder(x\xB3 + 2x + 1, x + 1, x) \u2192 -2",lazy:!0,signature:"(dividend: value, divisor: value, variable: symbol) -> value",evaluate:([n,e,t])=>{if(!n||!e||!t)return;let i=t.canonical.symbol;return i?ni(n.canonical,e.canonical,i)?.[1]:void 0}},PolynomialGCD:{description:"Return the greatest common divisor of two polynomials. Example: PolynomialGCD(x\xB2 - 1, x - 1, x) \u2192 x - 1",lazy:!0,signature:"(a: value, b: value, variable: symbol) -> value",evaluate:([n,e,t])=>{if(!n||!e||!t)return;let i=t.canonical.symbol;if(i)return Cl(n.canonical,e.canonical,i)}},Cancel:{description:"Cancel common polynomial factors in the numerator and denominator of a rational expression. Example: Cancel((x\xB2 - 1)/(x - 1), x) \u2192 x + 1",lazy:!0,signature:"(value, symbol) -> value",evaluate:([n,e])=>{if(!n||!e)return;let t=e.canonical.symbol;if(t)return Xr(n.canonical,t)}}}];Pn();zn();Aa();var Vh={Congruent:{description:"Indicate that two expressions are congruent modulo a number",complexity:11e3,signature:"(number, number, modulo: integer) -> boolean",evaluate:(n,{engine:e})=>{if(n.length<3)return;let[t,i,r]=n,o=t.value,s=i.value,a=r.value;if(typeof o=="number"&&typeof s=="number"&&typeof a=="number")return o%a===s%a?e.True:e.False}},IsSame:{description:"Compare two expressions for structural equality",lazy:!0,signature:"(any, any) -> boolean",evaluate:(n,{engine:e})=>{if(n.length!==2)return;let[t,i]=n;return t.isSame(i)?e.True:e.False}},Equal:{complexity:11e3,signature:"(any, any) -> boolean",lazy:!0,canonical:(n,{engine:e})=>Ie(e,"Equal",n),eq:(n,e)=>{if(n.operator!==e.operator)return;let t=n.engine,i=n.op1.sub(n.op2),r=e.op1.sub(e.op2),o=i.simplify(),s=r.simplify(),a=o.is(0)||o.isNumberLiteral&&o.re===0,u=s.is(0)||s.isNumberLiteral&&s.re===0;if(a&&u)return!0;if(a||u)return!1;let l=[...new Set([...i.unknowns,...r.unknowns])];if(l.length===0){let d=i.N().re,m=r.N().re;return!Number.isFinite(d)||!Number.isFinite(m)?void 0:Math.abs(m)<t.tolerance?!1:Math.abs(d)>t.tolerance&&Math.abs(m)>t.tolerance&&Number.isFinite(d/m)}let c=[.5,1.5,2,-1,3,-.5,.7,2.3],f,p=t.tolerance;for(let d of c){let m={};for(let E of l)m[E]=d;let g=i.subs(m).N(),h=r.subs(m).N(),x=g.re,y=h.re;if(!Number.isFinite(x)||!Number.isFinite(y)||Math.abs(y)<p)continue;let v=x/y;if(Number.isFinite(v)){if(f===void 0)f=v;else if(Math.abs(v-f)>p)return!1}}if(f!==void 0&&Math.abs(f)>p)return!0},evaluate:(n,{engine:e})=>{if(n.length<2)return e.True;let t;for(let i of n)if(!t)t=i;else{let r=wa(t,i);if(r===!1)return e.False;if(r===void 0&&e.isVerifying)return;if(r===void 0)return e.False}return e.True}},NotEqual:{wikidata:"Q28113351",complexity:11e3,signature:"(any, any) -> boolean",canonical:(n,{engine:e})=>Ie(e,"NotEqual",n),eq:(n,e)=>n.operator!==e.operator?!1:!!(n.op1.isEqual(e.op1)&&n.op2.isEqual(e.op2)||n.op1.isEqual(e.op2)&&n.op2.isEqual(e.op1)),evaluate:(n,{engine:e})=>{if(n.length<2)return e.False;let t;for(let i of n)if(!t)t=i;else{let r=t.isEqual(i);if(r===!0)return e.False;if(r===void 0&&e.isVerifying)return}return e.True}},Less:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"Less",n),eq:(n,e)=>Fh(n,e,"Greater"),evaluate:(n,{engine:e})=>{if(n.length===2){let[i,r]=n,o=i.isLess(r);return o===void 0?void 0:o?e.True:e.False}if(n.length<2)return e.True;let t;for(let i of n)if(!t)t=i;else{let r=i.isLess(t);if(r===void 0)return;if(r===!1)return e.False;t=i}return e.True}},NotLess:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"Less",n)])},Greater:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"Less",[...n].reverse())},NotGreater:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[e._fn("Greater",n)])},LessEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"LessEqual",n),eq:(n,e)=>Fh(n,e,"LessGreater"),evaluate:(n,{engine:e})=>{if(n.length===2){let[i,r]=n,o=i.isLessEqual(r);return o===void 0?void 0:o?e.True:e.False}if(n.length<2)return e.True;let t;for(let i of n)if(!t)t=i;else{let r=i.isLessEqual(t);if(r===void 0)return;if(r===!1)return e.False;t=i}return e.True}},NotLessNotEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"LessEqual",n)])},GreaterEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"LessEqual",[...n].reverse())},NotGreaterNotEqual:{complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"GreaterEqual",n)])},TildeFullEqual:{description:"Indicate isomorphism, congruence and homotopic equivalence",signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"TildeFullEqual",n)},NotTildeFullEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"TildeFullEqual",n)])},TildeEqual:{description:"Approximately or asymptotically equal",complexity:11e3,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"TildeEqual",n)},NotTildeEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"TildeEqual",n)])},Approx:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"Approx",n)},NotApprox:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"Approx",n)])},ApproxEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"ApproxEqual",n)},NotApproxEqual:{complexity:11100,canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"ApproxEqual",n)])},ApproxNotEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"ApproxNotEqual",n)},NotApproxNotEqual:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"ApproxNotEqual",n)])},Precedes:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"Precedes",n)},NotPrecedes:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"Precedes",n)])},Succeeds:{signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>Ie(e,"Succeeds",n)},NotSucceeds:{complexity:11100,signature:"(any, any+) -> boolean",canonical:(n,{engine:e})=>e._fn("Not",[Ie(e,"Succeeds",n)])}};function Ie(n,e,t){t=he(t,e);let i=[],r=[];for(let o of t)Dn(o.operator)?(i.push(o),r.push(o.ops[o.ops.length-1])):r.push(o);return i.length===0?n._fn(e,r):n._fn("And",[n._fn(e,r),...i])}function Fh(n,e,t){return n.operator===e.operator?n.nops!==e.nops?!1:n.ops.every((i,r)=>i.isEqual(e.ops[r])):e.operator===t?n.nops!==e.nops?!1:n.ops.every((i,r)=>i.isEqual(e.ops[e.nops-1-r])):!1}In();Tn();Tn();gi();Nn();Tr();function yn(n){if(typeof n=="string")return wp(n)?n:"error";switch(n.kind){case"union":return cE(n);case"intersection":return fE(n);case"negation":return lE(n);case"collection":case"indexed_collection":return pE(n.kind,n);case"list":return dE(n);case"set":return mE(n);case"tuple":return gE(n);case"record":return hE(n);case"dictionary":return xE(n);case"signature":return yE(n);case"value":return n;case"reference":return n;default:throw new Error(`Unknown type kind: ${n}`)}}function bn(n){return typeof n!="object"||Object.defineProperty(n,"toString",{value:()=>te(n)}),n}function lE(n){let e=yn(n.type);return e==="nothing"?"any":e==="any"?"nothing":bn({kind:"negation",type:e})}function cE(n){let e=new Set(n.types.map(i=>te(yn(i)))),t=Array.from(e).map(i=>F(i));return t.length===0?"never":t.some(i=>i==="error")?"error":t.length===1?bn(t[0]):bn(t.reduce((i,r)=>(i.some(o=>w(r,o)||w(o,r))||i.push(r),i),[]).reduce((i,r,o,s)=>s.length===1?r:{kind:"union",types:s}))}function fE(n){let e=new Set(n.types.map(o=>te(yn(o)))),t=Array.from(e).map(o=>F(o));if(t.some(o=>t.some(s=>o!==s&&!w(o,s)&&!w(s,o))))return"nothing";let r=t.reduce((o,s)=>(o=o.filter(a=>w(a,s)),o.some(a=>w(a,s))||o.push(s),o),[]);return r.some(o=>o==="error")?"error":r.length===0?"nothing":r.length===1?bn(r[0]):bn({kind:"intersection",types:r})}function pE(n,e){let t=yn(e.elements);return t==="error"?"error":t==="nothing"?bn({kind:n,elements:"nothing"}):t==="any"?n:bn({...e,elements:t})}function dE(n){let e=yn(n.elements);if(e==="error")return"error";if(e==="nothing")return bn({kind:"list",elements:"nothing"});if(e==="any")return"list";let t=n.dimensions;return t&&(t=t.filter(i=>i>=1),t.length===0)?"nothing":bn({...n,dimensions:t,elements:e})}function mE(n){let e=yn(n.elements);return e==="error"?"error":e==="nothing"?bn({kind:"set",elements:"nothing"}):e==="any"?"set":bn({...n,elements:e})}function gE(n){let e=n.elements.map(t=>({...t,type:yn(t.type)}));return e.length===0?"nothing":e.some(t=>t.type==="error")?"error":(e=e.filter(t=>t.type!=="nothing"),bn({...n,elements:e}))}function hE(n){let e={};for(let[t,i]of Object.entries(n.elements))e[t]=yn(i);return Object.values(e).some(t=>t==="error")?"error":(e=Object.fromEntries(Object.entries(e).filter(([t,i])=>i!=="nothing")),Object.keys(e).length===0?"record":bn({...n,elements:e}))}function xE(n){let e=yn(n.values);return e==="error"||e==="nothing"?"error":e==="any"||e==="unknown"?"any":bn({kind:"dictionary",values:e})}function yE(n){let e=n.args?.map(o=>({...o,type:yn(o.type)})),t=n.optArgs?.map(o=>({...o,type:yn(o.type)})),i=n.variadicArg?{...n.variadicArg,type:yn(n.variadicArg.type)}:void 0,r=yn(n.result);return e?.some(o=>o.type==="error")||t?.some(o=>o.type==="error")||i?.type==="error"||r==="error"?"error":(t=t?.filter(o=>o.type!=="nothing"),e?.length===0&&(t=void 0),t?.length===0&&(t=void 0),i?.type==="nothing"&&(i=void 0),bn({...n,args:e,optArgs:t,variadicArg:i,variadicMin:i?n.variadicMin:void 0,result:r}))}zn();kt();Yt();en();function $h(n,e){return yn({kind:"intersection",types:[n,e]})}function ft(n,e){return e.operator==="List"&&e.nops===2?n.function("Interval",[e.op1.canonical,e.op2.canonical]):e.operator==="Tuple"&&e.nops===2?n.function("Interval",[n.function("Open",[e.op1.canonical]),n.function("Open",[e.op2.canonical])]):e.canonical}var Uh={EmptySet:{type:"set",isConstant:!0,wikidata:"Q226183",description:"The empty set, a set containing no elements.",eq:n=>n.type.matches("set")&&n.isEmptyCollection,collection:{iterator:()=>({next:()=>({value:void 0,done:!0})}),count:()=>0,isEmpty:()=>!0,isFinite:()=>!0,contains:()=>!1,subsetOf:()=>!0,eltsgn:()=>{},elttype:()=>"never"}},Numbers:{type:"set<number>",isConstant:!0,description:"The set of all numbers.",collection:{iterator:Tc,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches("number"),subsetOf:(n,e,t)=>e.operator==="Range"||e.operator==="Linspace"?!0:e.type.matches(R.setNumber)&&(!t||e.symbol!=="Numbers"),eltsgn:()=>"unsigned",elttype:()=>"number"}},ComplexNumbers:{type:"set<finite_complex>",isConstant:!0,description:"The set of all finite complex numbers.",collection:{iterator:Tc,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches("finite_complex"),subsetOf:(n,e,t)=>e.operator==="Range"||e.operator==="Linspace"?!0:e.type.matches(R.setComplex)&&(!t||e.symbol!=="ComplexNumbers"),eltsgn:()=>"unsigned",elttype:()=>"finite_complex"}},ExtendedComplexNumbers:{type:"set<complex>",isConstant:!0,description:"The set of all complex numbers, including infinities.",collection:{iterator:Tc,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches("complex"),subsetOf:(n,e,t)=>e.operator==="Range"||e.operator==="Linspace"?!0:e.type.matches(R.setComplex)&&(!t||e.symbol!=="ComplexNumbers"),eltsgn:()=>"unsigned",elttype:()=>"complex"}},ImaginaryNumbers:{type:"set<imaginary>",isConstant:!0,description:"The set of all imaginary numbers.",collection:{iterator:_E,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches(R.setImaginary),subsetOf:(n,e,t)=>e.type.matches(R.setImaginary)&&(!t||e.symbol!=="ImaginaryNumbers"),eltsgn:()=>"unsigned",elttype:()=>"imaginary"}},RealNumbers:{type:"set<finite_real>",isConstant:!0,description:"The set of all finite real numbers.",collection:{iterator:n=>Mi(n),contains:(n,e)=>e.type.matches("finite_real"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.type.matches(R.setReal)&&(!t||e.symbol!=="RealNumbers"),eltsgn:()=>{},elttype:()=>"finite_real"}},ExtendedRealNumbers:{type:"set<real>",isConstant:!0,description:"The set of all real numbers, including infinities.",collection:{iterator:n=>Mi(n),contains:(n,e)=>e.type.matches("real"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.type.matches(R.setReal)&&(!t||e.symbol!=="ExtendedRealNumbers"),eltsgn:()=>{},elttype:()=>"real"}},Integers:{type:"set<finite_integer>",isConstant:!0,description:"The set of all finite integers.",collection:{iterator:jh,contains:(n,e)=>e.type.matches("finite_integer"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.operator==="Range"?!0:e.type.matches(R.setFiniteInteger)&&(!t||e.symbol!=="Integers"),eltsgn:()=>{},elttype:()=>"finite_integer"}},ExtendedIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all integers, including infinities.",collection:{iterator:jh,contains:(n,e)=>e.type.matches("integer"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.operator==="Range"?!0:e.type.matches(R.setInteger)&&(!t||e.symbol!=="ExtendedIntegers"),eltsgn:()=>{},elttype:()=>"integer"}},RationalNumbers:{type:"set<finite_rational>",isConstant:!0,description:"The set of all finite rational numbers.",collection:{iterator:n=>Mi(n),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,contains:(n,e)=>e.type.matches("finite_rational"),subsetOf:(n,e,t)=>e.type.matches(R.setRational)&&(!t||e.symbol!=="RationalNumbers"),eltsgn:()=>{},elttype:()=>"finite_rational"}},ExtendedRationalNumbers:{type:"set<rational>",isConstant:!0,description:"The set of all rational numbers, including infinities.",collection:{iterator:n=>Mi(n),contains:(n,e)=>e.type.matches("rational"),count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>e.type.matches(R.setRational)&&(!t||e.symbol!=="ExtendedRationalNumbers"),eltsgn:()=>{},elttype:()=>"rational"}},NegativeNumbers:{type:"set<real>",isConstant:!0,description:"The set of all negative real numbers.",collection:{iterator:n=>Mi(n,{sign:"-",includeZero:!1}),count:()=>1/0,contains:(n,e)=>e.type.matches("real")&&e.isNegative===!0,subsetOf:(n,e,t)=>{if(e.operator==="Range"||e.operator==="Linspace"){let i=e.ops[0].re,r=e.ops[1].re;return i<0&&r<0}return e.type.matches(R.setReal)&&e.baseDefinition?.collection?.eltsgn?.(e)==="negative"&&(!t||e.symbol!=="NegativeNumbers")},eltsgn:()=>"negative",elttype:()=>"real"}},NonPositiveNumbers:{type:"set<real>",isConstant:!0,description:"The set of all non-positive real numbers.",collection:{iterator:n=>Mi(n,{sign:"-",includeZero:!0}),contains:(n,e)=>e.type.matches("real")&&e.isNonPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"||e.operator==="Linspace"){let i=e.ops[0].re,r=e.ops[1].re;return i>=0&&r>=0}return e.type.matches(R.setReal)&&e.baseDefinition?.collection?.eltsgn?.(e)==="non-positive"&&(!t||e.symbol!=="NonPositiveNumbers")},eltsgn:()=>"non-positive",elttype:()=>"real"}},NonNegativeNumbers:{type:"set<real>",isConstant:!0,description:"The set of all non-negative real numbers.",collection:{iterator:n=>Mi(n,{sign:"+",includeZero:!0}),contains:(n,e)=>e.type.matches("real")&&e.isNonNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"||e.operator==="Linspace"){let i=e.ops[0].re,r=e.ops[1].re;return i<=0&&r<=0}return e.type.matches(R.setReal)&&e.baseDefinition?.collection?.eltsgn?.(e)==="non-negative"&&(!t||e.symbol!=="NonNegativeNumbers")},eltsgn:()=>"non-negative",elttype:()=>"real"}},PositiveNumbers:{type:"set<real>",isConstant:!0,description:"The set of all positive real numbers.",collection:{iterator:n=>Mi(n,{sign:"+",includeZero:!1}),contains:(n,e)=>e.type.matches("real")&&e.isPositive===!0,count:()=>1/0,subsetOf:(n,e,t)=>{if(e.operator==="Range"||e.operator==="Linspace"){let i=e.ops[0].re,r=e.ops[1].re;return i>0&&r>0}return e.type.matches(R.setReal)&&e.baseDefinition?.collection?.eltsgn?.(e)==="positive"&&(!t||e.symbol!=="PositiveNumbers")},eltsgn:()=>"positive",elttype:()=>"real"}},NegativeIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all negative integers.",collection:{iterator:n=>Za(n.engine,-1,-1),contains:(n,e)=>e.type.matches("integer")&&e.isNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"){let i=e.ops[0].re,r=e.ops[1].re;return i<0&&r<0}return e.type.matches(R.setInteger)&&e.baseDefinition?.collection?.eltsgn?.(e)==="negative"&&(!t||e.symbol!=="NegativeIntegers")},eltsgn:()=>"negative",elttype:()=>"integer"}},NonPositiveIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all non-positive integers.",collection:{iterator:n=>Za(n.engine,0,-1),contains:(n,e)=>e.type.matches("integer")&&e.isNonPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"){let i=e.ops[0].re,r=e.ops[1].re;return i<=0&&r<=0}return e.type.matches(R.setInteger)&&e.baseDefinition?.collection?.eltsgn?.(e)==="non-positive"&&(!t||e.symbol!=="NonPositiveIntegers")},eltsgn:()=>"non-positive",elttype:()=>"integer"}},NonNegativeIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all non-negative integers.",collection:{iterator:n=>Za(n.engine,0,1),contains:(n,e)=>e.type.matches("integer")&&e.isNonNegative===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"){let i=e.ops[0].re,r=e.ops[1].re;return i>0&&r>0}return e.type.matches(R.setInteger)&&e.baseDefinition?.collection?.eltsgn?.(e)==="non-negative"&&(!t||e.symbol!=="NonNegativeIntegers")},eltsgn:()=>"non-negative",elttype:()=>"integer"}},PositiveIntegers:{type:"set<integer>",isConstant:!0,description:"The set of all positive integers.",collection:{iterator:n=>Za(n.engine,1,1),contains:(n,e)=>e.type.matches("integer")&&e.isPositive===!0,count:()=>1/0,isEmpty:()=>!1,isFinite:()=>!1,subsetOf:(n,e,t)=>{if(e.operator==="Range"){let i=e.ops[0].re,r=e.ops[1].re;return i>0&&r>0}return e.type.matches(R.setInteger)&&e.baseDefinition?.collection?.eltsgn?.(e)==="positive"&&(!t||e.symbol!=="PositiveIntegers")},eltsgn:()=>"positive",elttype:()=>"integer"}},Element:{complexity:11200,signature:"(value, collection, boolean?) -> boolean",description:`Test whether a value is an element of a collection. Optional third argument is a boolean expression (condition) for filtered iteration in Sum/Product.

Element supports two modes of operation:
1. Set membership: Element(3, [List, 1, 2, 3]) checks if 3 is in the list
2. Type-style membership: Element(x, integer) checks if x has type integer

Type-style membership works with:
- Mathematical sets: Integers, RealNumbers, ComplexNumbers, etc.
- Type names: integer, real, number, finite_real, positive_integer, etc.
- Invalid type names remain unevaluated (e.g., Element(2, "Booleans"))`,canonical:(n,{engine:e})=>{if(n.length===0)return e._fn("Element",[e.error("missing"),e.error("missing")]);if(n.length===1)return e._fn("Element",[n[0].canonical,e.error("missing")]);let[t,i,r]=n,o=ft(e,i);return!o.type.matches("collection")&&!o.symbol&&!o.isValid?e._fn("Element",[t.canonical,e.error(["incompatible-type","'collection'",o.type.toString()]),...r?[r.canonical]:[]]):r&&r.symbol!=="Nothing"?r.type.matches("boolean")?e._fn("Element",[t.canonical,o,r.canonical]):e._fn("Element",[t.canonical,o,e.error(["incompatible-type","'boolean'",i.type.toString()])]):e._fn("Element",[t.canonical,o])},evaluate:([n,e,t],{engine:i})=>{if(e&&typeof e.contains=="function"){let o=e.contains(n);if(o===!0)return i.True;if(o===!1)return i.False}let r=e?.symbol;if(r)try{let o=i.type(r);if(!o.isUnknown){let s=n.type;if(s.matches(o))return i.True;if($h(s.type,o.type)==="nothing")return i.False}}catch{}}},NotElement:{complexity:11200,signature:"(value, collection) -> boolean",description:"Test whether a value is not an element of a collection.",evaluate:([n,e],{engine:t})=>{let i=e.contains(n);if(i===!0)return t.False;if(i===!1)return t.True;let r=e.symbol;if(r){let o=t.type(r);if(!o.isUnknown){let s=n.type;if(s.matches(o))return t.False;if($h(s.type,o.type)==="nothing")return t.True}}}},Subset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a strict subset of the second.",canonical:(n,{engine:e})=>n.length!==2?e._fn("Subset",n):e._fn("Subset",[ft(e,n[0]),ft(e,n[1])]),evaluate:([n,e],{engine:t})=>{let i=ur(n,e);if(i===!0)return t.True;if(i===!1)return t.False}},SubsetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a subset (possibly equal) of the second.",canonical:(n,{engine:e})=>n.length!==2?e._fn("SubsetEqual",n):e._fn("SubsetEqual",[ft(e,n[0]),ft(e,n[1])]),evaluate:([n,e],{engine:t})=>{let i=ur(n,e,!1);if(i===!0)return t.True;if(i===!1)return t.False}},NotSubset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a strict subset of the second.",evaluate:([n,e],{engine:t})=>{let i=ur(n,e);if(i===!0)return t.False;if(i===!1)return t.True}},Superset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a strict superset of the second.",canonical:(n,{engine:e})=>n.length!==2?e._fn("Superset",n):e._fn("Superset",[ft(e,n[0]),ft(e,n[1])]),evaluate:([n,e],{engine:t})=>{let i=ur(e,n);if(i===!0)return t.True;if(i===!1)return t.False}},SupersetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is a superset (possibly equal) of the second.",canonical:(n,{engine:e})=>n.length!==2?e._fn("SupersetEqual",n):e._fn("SupersetEqual",[ft(e,n[0]),ft(e,n[1])]),evaluate:([n,e],{engine:t})=>{let i=ur(e,n,!0);if(i===!0)return t.True;if(i===!1)return t.False}},NotSuperset:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a strict superset of the second.",evaluate:([n,e],{engine:t})=>{let i=ur(e,n);if(i===!0)return t.False;if(i===!1)return t.True}},NotSupersetEqual:{complexity:11200,signature:"(lhs:collection, rhs: collection) -> boolean",description:"Test whether the first collection is not a superset (possibly equal) of the second.",evaluate:([n,e],{engine:t})=>{let i=ur(e,n,!0);if(i===!0)return t.False;if(i===!1)return t.True}},Complement:{wikidata:"Q242767",signature:"(set+) -> set",description:"Return the elements of the first set that are not in any of the subsequent sets.",collection:{contains:(n,e)=>{let[t,...i]=n.ops;return(t.contains(e)??!1)&&i.every(r=>!r.contains(e))},count:n=>Ha(n,e=>n.ops.slice(1).every(t=>!t.contains(e))),iterator:SE}},Intersection:{wikidata:"Q185837",signature:"(set+) -> set",description:"Return the intersection of two or more sets.",canonical:(n,{engine:e})=>{if(n.length===0||n.length===1)return e.symbol("EmptySet");let t=n.map(r=>ft(e,r)),i=ro(e,he(t,"Intersection"),F("(set+) -> set"))??t;return e._fn("Intersection",i)},evaluate:EE,collection:{contains:AE,count:n=>Ha(n,e=>n.ops.slice(1).every(t=>t.contains(e))),iterator:IE}},Union:{wikidata:"Q185359",signature:"(collection+) -> set",description:"Return the union of two or more collections as a set.",canonical:(n,{engine:e})=>{if(n.length===0)return e.symbol("EmptySet");let t=n.map(r=>ft(e,r)),i=ro(e,he(t,"Union"),F("(collection+) -> set"))??t;return e._fn("Union",i)},evaluate:bE,collection:{contains:(n,e)=>n.ops.some(t=>t.contains(e)),count:n=>wE(n,(e,t)=>t.every(i=>!i.contains(e))),isEmpty:n=>n.ops.every(e=>e.isEmptyCollection),isFinite:n=>n.ops.every(e=>e.isFiniteCollection),iterator:NE}},SetMinus:{wikidata:"Q18192442",signature:"(set, value*) -> set",description:"Return the set difference between the first set and subsequent values.",evaluate:vE,collection:{contains:(n,e)=>{let[t,...i]=n.ops;return(t.contains(e)??!1)&&!i.some(r=>r.isSame(e))},count:n=>Ha(n,e=>{let[t,...i]=n.ops;return!i.some(r=>r.isSame(e))}),iterator:TE}},SymmetricDifference:{wikidata:"Q1147242",signature:"(set, set) -> set",description:"Return the symmetric difference of two sets (elements in either set but not both).",collection:{contains:(n,e)=>{let[t,i]=n.ops,r=t.contains(e)??!1,o=i.contains(e)??!1;return r&&!o||!r&&o},count:n=>Ha(n,e=>{let[t,i]=n.ops,r=t.contains(e)??!1,o=i.contains(e)??!1;return r&&!o||!r&&o}),iterator:BE}}};function ur(n,e,t=!0){return!n.isCollection||!e.isCollection?!1:!!n.baseDefinition?.collection?.subsetOf?.(n,e,t)}function bE(n,{engine:e}){let t=n.map(o=>o.isCollection?o:e.function("Set",[o]));if(t.reduce((o,s)=>o+(s.count??0),0)>tm)return e._fn("Union",t);let r=[];for(let o of t)for(let s of o.each())r.every(a=>!a.isSame(s))&&r.push(s);return r.length===0?e.symbol("EmptySet"):e._fn("Set",r)}function EE(n,{engine:e}){let t=[...n[0].ops??[]];for(let i of n.slice(1))ke(i)?t=t.filter(r=>[...i.each()].some(o=>r.isSame(o))):t=t.filter(r=>r.isSame(i));return t.length===0?e.symbol("EmptySet"):e._fn("Set",t)}function vE(n,{engine:e}){return e.symbol("EmptySet")}function _E(n){let e=ku();return{next:()=>{let{value:t,done:i}=e.next();if(i)return{value:void 0,done:!0};let[r,o]=t;return{value:n.engine.number({re:0,im:r/o}),done:!1}}}}function Tc(n){let e=rd();return{next:()=>{let{value:t,done:i}=e.next();if(i)return{value:void 0,done:!0};let[r,o]=t;return{value:n.engine.number({re:r,im:o}),done:!1}}}}function*Mi(n,e){let t=e?.sign??"+-",i=e?.includeZero??!0,r=t==="+-"?ku():id();i||r.next();for(let o of r)if(t==="+-")yield n.engine.number(o);else{let s=t==="-"?-1:1,[a,u]=o;yield n.engine.number([s*a,u])}}function*jh(n){for(let e of od())yield n.engine.number(e)}function*Za(n,e,t){let i=e;for(;;)yield n.number(i),i+=t}function*NE(n){let e=[];for(let t of n.ops){for(let i of t.each())e.every(r=>!r.contains(i))&&(yield i);e.push(t)}}function*TE(n){let[e,...t]=n.ops;for(let i of e.each())t.some(r=>r.isSame(i))||(yield i)}function*SE(n){let[e,...t]=n.ops;for(let i of e.each())t.every(r=>!r.contains(i))&&(yield i)}function*IE(n){for(let e of n.ops[0].each())n.ops.slice(1).every(t=>t.contains(e))&&(yield e)}function*BE(n){let[e,t]=n.ops;for(let i of e.each())(t.contains(i)??!1)||(yield i);for(let i of t.each())(e.contains(i)??!1)||(yield i)}function Ha(n,e){if(n.ops.some(i=>i.count===1/0))return 1/0;let t=0;for(let i of n.ops[0].each())e(i)&&(t+=1);return t}function wE(n,e){if(n.ops.some(r=>r.count===1/0))return 1/0;let t=[],i=0;for(let r of n.ops){for(let o of r.each())e(o,t)&&(i+=1);t.push(r)}return i}function AE(n,e){return n.ops.every(t=>t.contains(e)??!1)}Oa();function hs(n){let e=0,t=0;for(let i of n)e+=i,t++;return t===0?NaN:e/t}function Gh(n,e){let t=n(0),i=0;for(let r of e)t=t.add(r),i++;return i===0?n(NaN):t.div(i)}function Dt(n){let e=[...n].sort((i,r)=>i-r),t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]}function lr(n){let e=[...n].sort((i,r)=>i.cmp(r)),t=Math.floor(e.length/2);return e.length%2===0?e[t-1].add(e[t]).div(2):e[t]}function cr(n){let e=0,t=0,i=0;for(let r of n)e+=r,t+=r*r,i++;return i===0?NaN:(t-e*e/i)/(i-1)}function Sc(n,e){let t=n(0),i=n(0),r=0;for(let o of e)t=t.add(o),i=i.add(o.mul(o)),r++;return r===0?n(NaN):i.sub(t.mul(t).div(r)).div(r-1)}function fr(n){let e=0,t=0,i=0;for(let r of n)e+=r,t+=r*r,i++;return i===0?NaN:(t-e*e/i)/i}function Ic(n,e){let t=n(0),i=n(0),r=0;for(let o of e)t=t.add(o),i=i.add(o.mul(o)),r++;return r===0?n(NaN):i.sub(t.mul(t).div(r)).div(r)}function Bc(n){return Math.sqrt(cr(n))}function wc(n){return Math.sqrt(fr(n))}function xs(n){let e=0,t=0,i=0,r=0;for(let s of n){let a=s;if(!Number.isFinite(a))return NaN;e+=a,t+=a*a,i+=a*a*a*a,r++}if(r===0)return NaN;let o=(t-e*e/r)/(r-1);return(i-4*e*t/r+6*e*e*e/r/r-3*e*e*e*e/r/r/r)/(o*o)}function zh(n,e){let t=n(0),i=n(0),r=n(0),o=0;for(let a of e){let u=a;if(!u.isFinite())return n(NaN);t=t.add(u),i=i.add(u.mul(u)),r=r.add(u.mul(u).mul(u).mul(u)),o++}if(o===0)return n(NaN);let s=i.sub(t.mul(t).div(o)).div(o-1);return r.sub(t.mul(i).mul(4).div(o)).add(t.mul(t).mul(t).mul(6).div(o).div(o)).sub(t.mul(t).mul(t).mul(t).div(o).div(o).div(o)).div(s.mul(s))}function ys(n){let e=0,t=0,i=0,r=0;for(let a of n){let u=a;if(!Number.isFinite(u))return NaN;e+=u,t+=u*u,i+=u*u*u,r++}if(r===0)return NaN;let o=(t-e*e/r)/(r-1);return(i-t*e/r)/(r-1)/Math.pow(o,3/2)*Math.sqrt(r*1)}function Zh(n,e){let t=n(0),i=n(0),r=n(0),o=0;for(let u of e){let l=u;if(!l.isFinite())return n(NaN);t=t.add(l),i=i.add(l.mul(l)),r=r.add(l.mul(l).mul(l)),o++}if(o===0)return n(NaN);let s=i.sub(t.mul(t).div(o)).div(o-1);return r.sub(i.mul(t).div(o)).div(o-1).div(s.pow(3/2)).mul(o).sqrt()}function bs(n){let e={};for(let r of n)e[r]=(e[r]??0)+1;let t=0,i=NaN;for(let r in e){let o=e[r];o>t&&(t=o,i=+r)}return i}function Hh(n,e){let t={};for(let o of e)t[o.toString()]=(t[o.toString()]??0)+1;let i=0,r=n(NaN);for(let o in t){let s=t[o];s>i&&(i=s,r=n(o))}return r}function Es(n){let e=[...n].sort((s,a)=>s-a),t=Math.floor(e.length/2),i=Dt(e.slice(0,t)),r=Dt(e),o=Dt(e.slice(t));return[i,r,o]}function Wh(n){let e=[...n].sort((s,a)=>s.cmp(a)),t=Math.floor(e.length/2),i=lr(e.slice(0,t)),r=lr(e),o=lr(e.slice(t));return[i,r,o]}function vs(n){let e=[...n].sort((o,s)=>o-s),t=Math.floor(e.length/2),i=e.slice(0,t),r=e.slice(t+1);return Dt(r)-Dt(i)}function Jh(n){let e=[...n].sort((o,s)=>o.cmp(s)),t=Math.floor(e.length/2),i=e.slice(0,t),r=e.slice(t+1);return lr(r).sub(lr(i))}me();Xe();var Yh=[{Erf:{complexity:7500,signature:"(number) -> number",evaluate:(n,{engine:e})=>{let t=n[0].re;if(Number.isFinite(t))return e.number(uc(t))}},Erfc:{complexity:7500,signature:"(number) -> number",evaluate:(n,{engine:e})=>{let t=n[0].re;if(Number.isFinite(t))return e.number(1-uc(t))}},ErfInv:{complexity:7500,signature:"(number) -> number",evaluate:(n,{engine:e})=>{let t=n[0].re;if(Number.isFinite(t))return e.number(zg(t))}}},{Mean:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",description:"The most frequently occurring value in the collection.",evaluate:(n,{engine:e})=>e.number(Ce(e)?Gh(e.bignum.bind(e),dt(n)):hs(pt(n)))},Median:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",description:"The most frequently occurring value in the collection.",examples:["Mode([1, 2, 2, 3])  // Returns 2"],evaluate:(n,{engine:e})=>e.number(Ce(e)?lr(dt(n)):Dt(pt(n)))},Variance:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(Ce(e)?Sc(e.bignum.bind(e),dt(n)):cr(pt(n)))},PopulationVariance:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(Ce(e)?Ic(e.bignum.bind(e),dt(n)):fr(pt(n)))},StandardDeviation:{complexity:1200,broadcastable:!1,description:"Sample Standard Deviation of a collection of numbers.",signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(Ce(e)?Sc(e.bignum.bind(e),dt(n)).sqrt():Math.sqrt(cr(pt(n))))},PopulationStandardDeviation:{complexity:1200,broadcastable:!1,description:"Population Standard Deviation of a collection of numbers.",signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(Ce(e)?Ic(e.bignum.bind(e),dt(n)).sqrt():Math.sqrt(fr(pt(n))))},Kurtosis:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(Ce(e)?zh(e.bignum.bind(e),dt(n)):xs(pt(n)))},Skewness:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(Ce(e)?Zh(e.bignum.bind(e),dt(n)):ys(pt(n)))},Mode:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(Ce(e)?Hh(e.bignum.bind(e),dt(n)):bs(pt(n)))},Quartiles:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> tuple<mid:number, lower:number, upper:number>",examples:["Quartiles([1, 2, 3, 4, 5])  // Returns (3, 2, 4)"],evaluate:(n,{engine:e})=>{let[t,i,r]=(Ce(e)?Wh(dt(n)):Es(pt(n))).map(o=>e.number(o));return e.tuple(t,i,r)}},InterquartileRange:{complexity:1200,broadcastable:!1,signature:"((collection|number)+) -> number",evaluate:(n,{engine:e})=>e.number(Ce(e)?Jh(dt(n)):vs(pt(n)))},Histogram:{description:"Compute a histogram of the values in a collection. Returns a list of (bin start, count) tuples.",complexity:8200,signature:"(collection, integer | list<number>) -> list<tuple<number, integer>>",examples:["Histogram([1, 2, 2, 3], 3)  // Returns [(1,1), (1.6667,2), (2.3333,1)]"],evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Array.from(n.each()).map(u=>u.re).filter(Number.isFinite);if(i.length===0)return;let r=Math.min(...i),o=Math.max(...i),s;if(e?.operator==="List")s=e.ops.map(u=>u.re);else{let u=G(e);if(u===null||u<=0)return;let l=(o-r)/u;s=Array.from({length:u+1},(c,f)=>r+f*l)}let a=Array(s.length-1).fill(0);for(let u of i)for(let l=0;l<s.length-1;l++)if(u>=s[l]&&u<s[l+1]){a[l]++;break}return t.function("List",a.map((u,l)=>t._fn("Tuple",[t.number(s[l]),t.number(u)])))}},BinCounts:{description:"Count the number of elements falling into each bin.",complexity:8200,signature:"(collection, integer | list<number>) -> list<number>",examples:["BinCounts([1, 2, 2, 3], 3)  // Returns [1, 2, 1]"],evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=Array.from(n.each()).map(u=>u.re).filter(Number.isFinite);if(i.length===0)return;let r=Math.min(...i),o=Math.max(...i),s;if(e.isCollection)s=[...e.each()].map(u=>u.re);else{let u=G(e);if(u===null||u<=0)return;let l=(o-r)/u;s=Array.from({length:u+1},(c,f)=>r+f*l)}let a=Array(s.length-1).fill(0);for(let u of i)for(let l=0;l<s.length-1;l++)if(u>=s[l]&&u<s[l+1]){a[l]++;break}return t.function("List",a.map(u=>t.number(u)))}},SlidingWindow:{description:"Return overlapping sliding windows of fixed size over the collection.",complexity:8200,signature:"(collection, integer, integer?) -> list<list>",examples:["SlidingWindow([1, 2, 3, 4], 2)  // Returns [[1,2], [2,3], [3,4]]"],evaluate:([n,e,t],{engine:i})=>{if(!n.isFiniteCollection)return;let r=G(e),o=t?G(t):1;if(r===null||r<=0||o===null||o<=0)return;let s=Array.from(n.each()),a=[];for(let u=0;u<=s.length-r;u+=o)a.push(i.function("List",s.slice(u,u+r)));return i.function("List",a)}}},{Sample:{description:"Return a random sample of k elements from the collection, without replacement.",complexity:8200,signature:"(collection, integer) -> list",evaluate:([n,e],{engine:t})=>{if(!n.isFiniteCollection)return;let i=G(e);if(i===null||i<0)return;let r=Array.from(n.each());if(i>r.length)return;for(let s=r.length-1;s>0;s--){let a=Math.floor(Math.random()*(s+1));[r[s],r[a]]=[r[a],r[s]]}let o=r.slice(0,i);return t.function("List",o)}}}];function*Qh(n){for(let e of n)e.isFiniteCollection?yield*e.each():yield e}function*pt(n){for(let e of Qh(n))yield e.re}function*dt(n){for(let e of Qh(n))yield e.bignumRe??e.engine.bignum(e.re)}_n();me();kt();_n();Wo();me();Pn();var kE={Sin:[[1,"Sin"],[1,"Cos"],[-1,"Sin"],[-1,"Cos"]],Cos:[[1,"Cos"],[-1,"Sin"],[-1,"Cos"],[1,"Sin"]],Sec:[[1,"Sec"],[-1,"Csc"],[-1,"Sec"],[1,"Csc"]],Csc:[[1,"Csc"],[1,"Sec"],[-1,"Csc"],[-1,"Sec"]],Tan:[[1,"Tan"],[-1,"Cot"],[1,"Tan"],[-1,"Cot"]],Cot:[[1,"Cot"],[-1,"Tan"],[1,"Cot"],[-1,"Tan"]]},Di=["Sqrt",2],co=["Sqrt",3],fo=["Sqrt",5],Wa=["Sqrt",6],CE=[[[0,1],{Sin:0,Cos:1,Tan:0,Cot:"ComplexInfinity",Sec:1,Csc:"ComplexInfinity"}],[[1,12],{Sin:["Divide",["Subtract",Wa,Di],4],Cos:["Divide",["Add",Wa,Di],4],Tan:["Subtract",2,co],Cot:["Add",2,co],Sec:["Subtract",Wa,Di],Csc:["Add",Wa,Di]}],[[1,10],{Sin:["Divide",["Subtract",fo,1],4],Cos:["Divide",["Sqrt",["Add",10,["Multiply",2,fo]]],4],Tan:["Divide",["Sqrt",["Subtract",25,["Multiply",10,fo]]],5],Cot:["Sqrt",["Add",5,["Multiply",2,fo]]],Sec:["Divide",["Sqrt",["Subtract",50,["Multiply",10,fo]]],5],Csc:["Add",1,fo]}],[[1,8],{Sin:"$\\frac{\\sqrt{2-\\sqrt2}}{2}$",Cos:"$\\frac{\\sqrt {2+{\\sqrt {2}}}}{2}$",Tan:"$\\sqrt{2} - 1$",Cot:"$\\sqrt{2} + 1$",Sec:"$\\sqrt{ 4 - 2\\sqrt{2}}$",Csc:"$\\sqrt{ 4 + 2\\sqrt{2}}$"}],[[1,6],{Sin:"$\\frac{1}{2}$",Cos:"$\\frac{\\sqrt{3}}{2}$",Tan:"$\\frac{\\sqrt{3}}{3}$",Cot:"$\\sqrt{3}$",Sec:"$\\frac{2\\sqrt{3}}{3}$",Csc:2}],[[1,5],{Sin:"$\\frac{\\sqrt{10- 2\\sqrt{5}}} {4}$",Cos:"$\\frac{1+ \\sqrt{5}} {4}$",Tan:"$\\sqrt{5-2\\sqrt5}$",Cot:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Sec:"$\\sqrt{5} - 1$",Csc:"$\\frac{\\sqrt{50+10\\sqrt{5}}} {5}$"}],[[1,4],{Sin:["Divide",Di,2],Cos:["Divide",Di,2],Tan:1,Cot:1,Sec:Di,Csc:Di}],[[3,10],{Sin:"$\\frac{1+ \\sqrt5} {4}$",Cos:"$\\frac{\\sqrt{10- 2\\sqrt5}} {4}$",Tan:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Cot:"$\\sqrt{5-2\\sqrt5}$",Sec:"$\\frac{\\sqrt{50+10\\sqrt5}} {5}$",Csc:"$\\sqrt5-1$"}],[[1,3],{Sin:["Divide",co,2],Cos:"Half",Tan:co,Cot:["Divide",co,3],Sec:2,Csc:["Divide",["Multiply",2,co],3]}],[[3,8],{Sin:"$\\frac{ \\sqrt{2 + \\sqrt{2}} } {2}$",Cos:"$\\frac{ \\sqrt{2 - \\sqrt{2}} } {2}$",Tan:"$\\sqrt{2} + 1$",Cot:"$\\sqrt{2} - 1$",Sec:"$\\sqrt{ 4 + 2 \\sqrt{2} }$",Csc:"$\\sqrt{ 4 - 2 \\sqrt{2} }$"}],[[2,5],{Sin:"$\\frac{\\sqrt{10+ 2\\sqrt{5}}} {4}$",Cos:"$\\frac{\\sqrt{5}-1} {4}$",Tan:"$\\sqrt{5+2\\sqrt{5}}$",Cot:"$\\frac{\\sqrt{25-10\\sqrt{5}}} {5}$",Sec:"$1 + \\sqrt{5}$",Csc:"$\\frac{\\sqrt{50-10\\sqrt{5}}} {5}$"}],[[5,12],{Sin:"$\\frac{\\sqrt{6} + \\sqrt{2}} {4}$",Cos:"$\\frac{ \\sqrt{6} - \\sqrt{2}} {4}$",Tan:"$2+\\sqrt{3}$",Cot:"$2-\\sqrt{3}$",Sec:"$\\sqrt{6}+\\sqrt{2}$",Csc:"$\\sqrt{6} - \\sqrt{2}$"}],[[1,2],{Sin:1,Cos:0,Tan:"ComplexInfinity",Cot:0,Sec:"ComplexInfinity",Csc:1}]];function et(n,e,t,i){let r=Ea(n)?.N();if(r!==void 0)return Ee(r,e,t,i)}function nt(n){if(!n)return n;let e=n.engine,t=e.angularUnit;if(t==="rad")return n;let i=n.N().re;return Number.isNaN(i)?n:t==="deg"?e.number(i*(180/Math.PI)):t==="grad"?e.number(i*(200/Math.PI)):t==="turn"?e.number(i/(2*Math.PI)):n}function _s(n,e){if(!e)return;let t=e.engine;switch(n){case"Arccos":return nt(Ee(e,Math.acos,i=>i.acos(),i=>i.acos()));case"Arccot":return nt(Ee(e,i=>Math.atan2(1,i),i=>U.atan2(t._BIGNUM_ONE,i),i=>i.inverse().atan()));case"Arccsc":return nt(Ee(e,i=>Math.asin(1/i),i=>t._BIGNUM_ONE.div(i).asin(),i=>i.inverse().asin()));case"Arcosh":return nt(Ee(e,Math.acosh,i=>i.acosh(),i=>i.acosh()));case"Arcoth":return nt(Ee(e,i=>Math.log((1+i)/(i-1))/2,i=>t._BIGNUM_ONE.add(i).div(i.sub(t._BIGNUM_ONE)).log().div(2),i=>t.complex(1).add(i).div(i.sub(1)).log().div(2)));case"Arcsch":return nt(Ee(e,i=>Math.log(1/i+Math.sqrt(1/(i*i)+1)),i=>t._BIGNUM_ONE.div(i.mul(i)).add(t._BIGNUM_ONE).sqrt().add(t._BIGNUM_ONE.div(i)).log(),i=>i.mul(i).inverse().add(1).sqrt().add(i.inverse()).log()));case"Arcsec":return nt(Ee(e,i=>Math.acos(1/i),i=>t._BIGNUM_ONE.div(i).acos(),i=>i.inverse().acos()));case"Arcsin":return nt(Ee(e,Math.asin,i=>i.asin(),i=>i.asin()));case"Arsech":return nt(Ee(e,i=>Math.log((1+Math.sqrt(1-i*i))/i),i=>t._BIGNUM_ONE.sub(i.mul(i).add(t._BIGNUM_ONE).div(i)).log(),i=>t.complex(1).sub(i.mul(i)).add(1).div(i).log()));case"Arsinh":return nt(Ee(e,Math.asinh,i=>i.asinh(),i=>i.asinh()));case"Arctan":return nt(Ee(e,Math.atan,i=>i.atan(),i=>i.atan()));case"Artanh":return nt(Ee(e,Math.atanh,i=>i.atanh(),i=>i.atanh()));case"Cos":return et(e,Math.cos,i=>t.chop(i.cos()),i=>i.cos());case"Cosh":return et(e,Math.cosh,i=>i.cosh(),i=>i.cosh());case"Cot":return et(e,i=>1/Math.tan(i),i=>t._BIGNUM_ONE.div(i.tan()),i=>i.tan().inverse());case"Coth":return et(e,i=>1/Math.tanh(i),i=>t._BIGNUM_ONE.div(i.tanh()),i=>i.tanh().inverse());case"Csc":return et(e,i=>1/Math.sin(i),i=>t._BIGNUM_ONE.div(i.sin()),i=>i.sin().inverse());case"Csch":return et(e,i=>1/Math.sinh(i),i=>t._BIGNUM_ONE.div(i.sinh()),i=>i.sinh().inverse());case"Sec":return et(e,i=>1/Math.cos(i),i=>t._BIGNUM_ONE.div(i.cos()),i=>i.cos().inverse());case"Sech":return et(e,i=>1/Math.cosh(i),i=>t._BIGNUM_ONE.div(i.cosh()),i=>i.cosh().inverse());case"Sin":return et(e,Math.sin,i=>t.chop(i.sin()),i=>i.sin());case"Sinh":return et(e,Math.sinh,i=>i.sinh(),i=>i.sinh());case"Tan":return et(e,r=>{let o=Math.tan(r);return o>1e6||o<-1e6?t.ComplexInfinity:o},r=>{let o=r.tan();return o.greaterThan(1e6)||o.lessThan(-1e6)?t.ComplexInfinity:o},r=>r.tan());case"Tanh":return et(e,Math.tanh,i=>i.tanh(),i=>i.tanh())}}function RE(n){return!!(n.startsWith("Ar")&&Ac(n))}function Ac(n){return{Sin:"Arcsin",Cos:"Arccos",Tan:"Arctan",Sec:"Arcsec",Csc:" Arccsc",Sinh:"Arsinh",Cosh:"Arcosh",Tanh:"Artanh",Sech:"Arsech",Csch:"Arcsch",Arcosh:"Cosh",Arccos:"Cos",Arccsc:"Csc",Arcsch:"Csch",Arcsec:"Sec",Arcsin:"Sin",Arsinh:"Sinh",Arctan:"Tan",Artanh:"Tanh"}[n]}function Ns(n,e){if(e.length!==1||!e[0].isValid)return;let t=e[0];if(t.operator==="InverseFunction")return t.op1.canonical;let i=t.symbol;if(typeof i!="string")return;let r=Ac(i);return r?n.symbol(r):void 0}function Xh(n){return n!=="Cos"&&n!=="Sec"?-1:1}function ME(n,e,t,i){if(!t)return;let r=t.N().re;if(Number.isNaN(r))return;let o=Ac(e),s=n._cache("constructible-inverse-trigonometric-values-"+e,()=>{let u=[];for(let[[l,c],f]of i){let p=f[o];if(p===void 0)continue;let d=p.N().re;Number.isNaN(d)||u.push([[p,d],[l,c]])}return u},u=>{for(let[[l,c],[f,p]]of u)l.reset();return u}),a=0;r<0&&(a=Xh(o)==-1?-1:1,r=-r,t=t.neg());for(let[[u,l],[c,f]]of s)if(n.chop(r-l)===0){let p=n.Pi.mul(c).div(f);return a==-1?p=p.neg():a==1&&(p=n.Pi.sub(p)),p.evaluate()}}function kc(n,e){let[t,i]=DE(e);if(t!==void 0)return i!==void 0&&((n==="Sin"||n==="Tan")&&(i===0||i===2)||(n==="Cos"||n==="Cot")&&(i===1||i===3))?"zero":{Sin:["positive","positive","negative","negative"],Cos:["positive","negative","negative","positive"],Sec:["positive","negative","negative","positive"],Csc:["positive","positive","negative","negative"],Tan:["positive","negative","positive","negative"],Cot:["positive","negative","positive","negative"]}[n]?.[t]}function Cc(n){return["Sin","Cos","Tan","Csc","Sec","Cot"].includes(typeof n=="string"?n:n.operator)}function Ts(n,e){if(!e||!Cc(n))return;let t=e.engine;if(e=e.N(),e.im!==0)return;let i=e.re;if(Number.isNaN(i))return;let r=t._cache("constructible-trigonometric-values",()=>CE.map(([l,c])=>[l,Object.fromEntries(Object.entries(c).map(([f,p])=>[f,(t.parse(vi(p))??t.box(p)).simplify()]))]),l=>{for(let[c,f]of l)for(let p of Object.values(f))p.reset();return l});if(RE(n))return ME(t,n,e,r);let o=t.angularUnit;o!=="rad"&&(o==="deg"&&(i*=Math.PI/180),o==="grad"&&(i*=Math.PI/200),o==="turn"&&(i*=2*Math.PI));let s=Xh(n)==-1?Math.sign(i):1;i=Math.abs(i%(2*Math.PI));let a=Math.floor(i*2/Math.PI);i=i%(Math.PI/2);let u;[u,n]=kE[n]?.[a]??[1,n];for(let[[l,c],f]of r){let p=f[n];if(p&&Math.abs(i-Math.PI*l/c)<=1e-12)return p.symbol==="ComplexInfinity"?p:s*u<0?p.neg():p}}function DE(n){if(!n.isValid||!n.isNumberLiteral)return[void 0,void 0];if(n.im!==0)return[void 0,void 0];let e=n.re;if(isNaN(e))return[void 0,void 0];let t=(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI);return Math.abs(t)<1e-12?[1,0]:Math.abs(t-Math.PI/2)<1e-12?[2,1]:Math.abs(t-Math.PI)<1e-12?[3,2]:Math.abs(t-3*Math.PI/2)<1e-12?[4,3]:[Math.floor(t/(Math.PI/2))+1,void 0]}Wo();St();var Kh=[{Pi:{type:"finite_real",isConstant:!0,holdUntil:"N",wikidata:"Q167",value:n=>n.number(Ce(n)?n._BIGNUM_PI:Math.PI)}},{Degrees:{signature:"(real) -> real",canonical:(n,{engine:e})=>{let t=e;if(t.angularUnit==="deg")return n[0];if(n.length!==1)return t._fn("Degrees",n);let i=n[0];if(i.numericValue===null||!i.isValid)return t._fn("Degrees",n);let r=i.re;if(Number.isNaN(r))return i.mul(t.Pi).div(180);if(r=r%360,r<0&&(r+=360),Number.isInteger(r)){let o=Lr([r,180]);return o[0]===0?t.Zero:o[0]===1&&o[1]===1?t.Pi:o[0]===1?t.Pi.div(o[1]):t.number(o).mul(t.Pi)}return t.number(r).div(180).mul(t.Pi)},evaluate:(n,e)=>e.engine.angularUnit==="deg"?n[0]:n[0].mul(e.engine.Pi.div(180)).evaluate(e)},Hypot:{broadcastable:!0,signature:"(real, real) -> real",sgn:()=>"non-negative",evaluate:([n,e],{engine:t})=>t.box(["Sqrt",["Add",["Square",n],["Square",e]]])},Sin:Be("Sin",5e3)},{Arctan:{wikidata:"Q2257242",complexity:5200,broadcastable:!0,signature:"(number) -> finite_real",sgn:([n])=>kc("Arctan",n),evaluate:([n],{numericApproximation:e})=>e?_s("Arctan",n):Ts("Arctan",n)??_s("Arctan",n)},Arctan2:{wikidata:"Q776598",complexity:5200,broadcastable:!0,signature:"(y:number, x: number) -> real",evaluate:([n,e],{engine:t,numericApproximation:i})=>i?wt(n,e,Math.atan2,(r,o)=>U.atan2(r,o)):n.isFinite===!1&&e.isFinite===!1?t.NaN:n.is(0)&&e.is(0)?t.Zero:e.isFinite===!1?e.isPositive?t.Zero:t.Pi:n.isFinite===!1?n.isPositive?t.Pi.div(2):t.Pi.div(-2):n.is(0)?e.isPositive?t.Zero:t.Pi:t.function("Arctan",[n.div(e)]).evaluate()},Cos:Be("Cos",5050),Tan:Be("Tan",5100)},{Arcosh:Be("Arcosh",6200),Arcsin:Be("Arcsin",5500),Arsinh:Be("Arsinh",6100),Artanh:Be("Artanh",6300),Cosh:Be("Cosh",6050),Cot:Be("Cot",5600),Csc:Be("Csc",5600,"Cosecant"),Sec:Be("Sec",5600,"Secant, inverse of cosine"),Sinh:Be("Sinh",6e3),Haversine:{wikidata:"Q2528380",broadcastable:!0,signature:"(real) -> number",evaluate:([n],{engine:e})=>e.box(["Divide",["Subtract",1,["Cos",n]],2])},InverseHaversine:{broadcastable:!0,signature:"(real) -> real",evaluate:([n],{engine:e})=>e.box(["Multiply",2,["Arcsin",["Sqrt",n]]])}},{Csch:Be("Csch",6200,"Hyperbolic cosecant"),Sech:Be("Sech",6200,"Hyperbolic secant"),Tanh:Be("Tanh",6200,"Hyperbolic tangent")},{Arccos:Be("Arccos",5550),Arccot:Be("Arccot",5650),Arcoth:Be("Arcoth",6350),Arcsch:Be("Arcsch",6250),Arcsec:Be("Arcsec",5650),Arsech:Be("Arsech",6250),Arccsc:Be("Arccsc",5650),Coth:Be("Coth",6300),InverseFunction:{lazy:!0,signature:"(function) -> function",canonical:(n,{engine:e})=>(n=Vn(e,n,1),Ns(e,n)??e._fn("InverseFunction",n)),evaluate:(n,{engine:e})=>Ns(e,n)}}];function Be(n,e,t){return{complexity:e,description:t,broadcastable:!0,signature:"(number) -> number",sgn:([i])=>kc(n,i),evaluate:([i],{numericApproximation:r})=>r?_s(n,i):Ts(n,i)??_s(n,i)}}Da();di();me();ac();function Rc(n){if(n==="all")return Rc(["core","control-structures","logic","collections","relop","numeric","arithmetic","trigonometry","algebra","calculus","polynomials","combinatorics","number-theory","linear-algebra","statistics","dimensions","units","physics","other"]);typeof n=="string"&&(n=[n]);let e=[];for(let t of n){let i=PE[t];if(!i)throw Error(`Unknown library category ${t}`);Array.isArray(i)?e.push(...i):e.push(i)}return Object.freeze(e)}var PE={algebra:[],arithmetic:[...Hg,...uh],calculus:rh,collections:[Uh,rg],combinatorics:ah,"control-structures":sh,core:Th,dimensions:[],domains:[],"linear-algebra":Ih,logic:[Rh,Dh],"number-theory":Ph,numeric:[],other:[],relop:Vh,polynomials:qh,physics:{Mu0:{description:"Vaccum permeability",isConstant:!0,wikidata:"Q1515261",type:"real",value:125663706212e-17}},statistics:Yh,trigonometry:Kh,units:[]};function OE(n){if(n=n.normalize(),ze(n))return n;throw new Error(`Invalid definition name "${n}": ${jn(n)}`)}function Mc(n,e){let t=n.context.lexicalScope.bindings;n.strict;for(let[i,r]of Object.entries(e))try{if(i=OE(i),ls(r))try{if(t.has(i))throw new Error(`Duplicate operator definition: "${i}"
${JSON.stringify(t.get(i),void 0,4)}
`);t.set(i,{operator:new rr(n,i,r)})}catch(o){console.error([`
Error in operator definition`,JSON.stringify(r,void 0,4),"",o.message].join(`
|   `)+`
`)}else if(cs(r))try{if(t.has(i))throw new Error(`The symbol "${i}" is already defined`);t.set(i,{value:new ct(n,i,r)})}catch(o){console.error([`
Error in value definition of "${i}"`,"",JSON.stringify(r,void 0,4),"",o.message].join(`
|   `))}else{let o=new ct(n,i,{value:n.box(r)});t.set(i,{value:o})}}catch(o){console.error([`
Error in definition of "${i}"`,"",JSON.stringify(r,void 0,4),"",o.message].join(`
|   `)+`
`)}}function Ja(n){return typeof n=="number"?n===0?1:Number.isInteger(n)?Math.floor(Math.log2(Math.abs(n))/Math.log2(10))+(n>0?1:2):2:n.isZero?1:n.im!==0?Ja(n.re)+Ja(n.im)+1:Ja(n.re)}function tt(n){let e=(()=>{if(n.operator!=="Multiply"||!n.ops||n.ops.length!==2)return null;let r=(u,l)=>{if(l.operator!=="Power"||l.op1?.symbol!=="ExponentialE"||!l.op2||u.operator!=="Power"||!u.op1||!u.op2)return null;let c=u.op2;if(c.operator!=="Divide"||c.op1?.is(1)!==!0)return null;let f=c.op2;return f?.operator!=="Ln"||f.op1?.is(10)!==!0?null:{xBase:u.op1,eExp:l.op2}},[o,s]=n.ops,a=r(o,s)??r(s,o);return a?12+tt(a.xBase)+tt(a.eExp):null})();if(e!==null)return e;if(n.symbol)return 1;if(n.isNumberLiteral)return Ja(n.numericValue);let t=n.operator,i=2;if(["Add"].includes(t))i=3;else if(["Subtract","Negate"].includes(t))i=4;else if(t==="Sqrt"){let r=n.ops?.[0];if(r?.operator==="Multiply"&&r.ops){for(let o of r.ops)if(o.operator==="Power"&&o.op2?.isEven===!0)return 5+tt(r)+6}if(r?.operator==="Power"&&r.op2?.isEven===!0)return 5+tt(r)+6;if(r?.operator==="Power"&&r.op2?.isOdd===!0&&r.op2?.isInteger===!0){let s=r.op2.numericValue;if(typeof s=="number"&&s>1)return 5+tt(r)+10}i=5}else if(["Square","Abs"].includes(t))i=5;else if(t==="Power"){let r=n.ops[0],o=n.ops[1],s=tt(o);return r.operator==="Negate"?s+4:r.operator==="Multiply"&&r.ops?r.ops.some(u=>u.isNumberLiteral&&u.isNegative===!0)&&o.isRational===!0&&!o.isInteger?s+tt(r)+15:s+tt(r):s}else if(t==="Root")i=5;else if(["Multiply"].includes(t)){let r=n.ops??[];if(r.length===2&&r[0].isNumberLiteral){let o=r[0].numericValue,s=!1;if(typeof o=="number")s=Number.isInteger(o)&&Math.abs(o)<=10;else if(o){let a=o.type;(a==="finite_integer"&&Math.abs(o.re)<=10||a==="finite_rational")&&(s=!0)}if(s){let a=r[1].operator;return["Ln","Log","Lb"].includes(a)?2+tt(r[1]):3+tt(r[1])}}i=7}else["Divide"].includes(t)?i=8:["Ln","Exp","Log","Lb"].includes(t)?i=9:["Cos","Sin","Tan"].includes(t)?i=10:i=11;return i+(n.ops?.reduce((r,o)=>r+tt(o),0)??0)}var Dc=tt;St();kn();Xt();bl();El();Fi();_n();Ye();di();St();Xe();$o();tn();cn();kn();ii();lt();Yt();Yr();In();Tn();Nn();an();kn();to();Ki();to();function Oc(n,e){let t=r=>{let o=0;for(let s of e){if(r.symbol===s)return 1;r.has(s)&&o++}return o},i=r=>{let o=t(r);if(o===0||r.symbol&&e.includes(r.symbol))return!0;if(r.operator==="Multiply"){let s=0;for(let a of r.ops)if(t(a)>0){if(s++,t(a)>1)return!1;if(!a.symbol&&a.has(e[0])){for(let u of e)if(a.has(u)&&ge(a,u)>1)return!1}}return s<=1}return r.operator==="Add"?r.ops.every(s=>i(s)):r.operator==="Negate"?i(r.op1):r.operator==="Subtract"?i(r.op1)&&i(r.op2):o<=1};return i(n)}function tx(n,e){if(n.length===0||e.length===0)return null;let t=n[0].engine,i=e.length,r=n.length,o=qE(n,e,t);if(!o)return null;let{A:s,b:a}=o;if(r<i)return VE(s,a,e,t);let u=FE(s,a,i,t);if(!u)return null;let l={};for(let c=0;c<i;c++)l[e[c]]=u[c].simplify();return l}function LE(n,e){let t=n.engine,i;if(n.operator==="Equal"){let s=n.op1,a=n.op2;i=s.sub(a).expand()}else i=n.expand();for(let s of e){let a=ge(i,s);if(a<0||a>1)return null}if(!Oc(i,e))return null;let r=[];for(let s of e){let a=Pt(i,s,t);if(a===null)return null;r.push(a)}let o=po(i,e,t).neg();return{coefficients:r,constant:o}}function Pt(n,e,t){if(!n.has(e))return t.Zero;if(n.symbol===e)return t.One;if(n.operator==="Negate")return Pt(n.op1,e,t)?.neg()??null;if(n.operator==="Multiply"){let i=n.ops,r=t.One,o=!1;for(let s of i)if(s.symbol===e){if(o)return null;o=!0}else{if(s.has(e))return null;r=r.mul(s)}return o?r:t.Zero}if(n.operator==="Add"){let i=t.Zero;for(let r of n.ops){let o=Pt(r,e,t);if(o===null)return null;i=i.add(o)}return i}if(n.operator==="Subtract"){let i=Pt(n.op1,e,t),r=Pt(n.op2,e,t);return i===null||r===null?null:i.sub(r)}return n.has(e)?null:t.Zero}function po(n,e,t){if(!e.some(r=>n.has(r)))return n;if(n.operator==="Add"){let r=t.Zero;for(let o of n.ops)e.some(a=>o.has(a))||(r=r.add(o));return r}if(n.operator==="Negate")return po(n.op1,e,t).neg();if(n.operator==="Subtract"){let r=po(n.op1,e,t),o=po(n.op2,e,t);return r.sub(o)}return t.Zero}function qE(n,e,t){let i=n.length,r=e.length,o=[],s=[];for(let a=0;a<i;a++){let u=LE(n[a],e);if(!u)return null;o.push(u.coefficients),s.push(u.constant)}return{A:o,b:s}}function FE(n,e,t,i){let r=n.length,o=[];for(let a=0;a<r;a++)o.push([...n[a],e[a]]);for(let a=0;a<t;a++){let u=a;for(let c=a+1;c<r;c++)ix(o[c]?.[a],o[u]?.[a])===1&&(u=c);if(Pi(o[u]?.[a]))return null;u!==a&&([o[a],o[u]]=[o[u],o[a]]);let l=o[a][a];for(let c=a+1;c<r;c++){let f=o[c][a].div(l);o[c][a]=i.Zero;for(let p=a+1;p<=t;p++)o[c][p]=o[c][p].sub(f.mul(o[a][p]))}}for(let a=t;a<r;a++){let u=o[a][t];if(!Pi(u)){let l=!0;for(let c=0;c<t;c++)if(!Pi(o[a][c])){l=!1;break}if(l)return null}}let s=new Array(t);for(let a=t-1;a>=0;a--){let u=o[a][t];for(let l=a+1;l<t;l++)u=u.sub(o[a][l].mul(s[l]));s[a]=u.div(o[a][a])}return s}function VE(n,e,t,i){let r=n.length,o=t.length,s=[];for(let m=0;m<r;m++)s.push([...n[m],e[m]]);let a=[],u=new Array(o).fill(!1),l=0;for(let m=0;m<o&&l<r;m++){let g=l;for(let x=l+1;x<r;x++)ix(s[x]?.[m],s[g]?.[m])===1&&(g=x);if(Pi(s[g]?.[m]))continue;g!==l&&([s[l],s[g]]=[s[g],s[l]]),a[l]=m,u[m]=!0;let h=s[l][m];for(let x=l+1;x<r;x++)if(!Pi(s[x][m])){let y=s[x][m].div(h);s[x][m]=i.Zero;for(let v=m+1;v<=o;v++)s[x][v]=s[x][v].sub(y.mul(s[l][v]))}l++}let c=l;for(let m=0;m<r;m++){let g=!0;for(let h=0;h<o;h++)if(!Pi(s[m][h])){g=!1;break}if(g&&!Pi(s[m][o]))return null}let f=[];for(let m=0;m<o;m++)u[m]||f.push(m);let p=new Array(o);for(let m=0;m<o;m++)u[m]||(p[m]=i.symbol(t[m]));for(let m=c-1;m>=0;m--){let g=a[m];if(g===void 0)continue;let h=s[m][o];for(let x=g+1;x<o;x++)Pi(s[m][x])||(h=h.sub(s[m][x].mul(p[x])));p[g]=h.div(s[m][g]).simplify()}let d={};for(let m=0;m<o;m++)d[t[m]]=p[m];return d}function ix(n,e){if(!n||!e)return;let t=n.abs(),i=e.abs(),r=t.numericValue,o=i.numericValue;if(r!==null&&o!==null){if(typeof r=="number"&&typeof o=="number")return r===o?0:r>o?1:-1;if(typeof r=="object"&&"re"in r){let c=r.re,f=typeof o=="number"?o:o.re;return c===f?0:c>f?1:-1}if(typeof o=="object"&&"re"in o){let c=typeof r=="number"?r:r.re,f=o.re;return c===f?0:c>f?1:-1}}let s=t.N().numericValue,a=i.N().numericValue;if(s===null||a===null)return;let u=typeof s=="number"?s:s.re??s,l=typeof a=="number"?a:a.re??a;if(!(typeof u!="number"||typeof l!="number")&&!(isNaN(u)||isNaN(l)))return u===l?0:u>l?1:-1}function Pi(n){if(!n||n.is(0)||n.simplify().is(0))return!0;let t=n.N().numericValue;if(t===null)return!1;let i=typeof t=="number"?t:t.re;return typeof i=="number"&&Math.abs(i)<1e-14}function rx(n,e){if(n.length!==2||e.length!==2)return null;let t=n[0].engine,[i,r]=e,o=n.map(u=>u.operator==="Equal"?u.op1.sub(u.op2).expand().simplify():u.expand().simplify()),s=$E(o,i,r,t);if(s)return s;let a=zE(o,i,r,t);return a||null}function $E(n,e,t,i){let r=null,o=null,s=null,a=null;for(let d of n){let m=jE(d,e,t,i);if(m){r=d,s=m.product;continue}let g=GE(d,e,t,i);if(g){o=d,a=g.sum;continue}}if(!r||!o||!s||!a)return null;let u="_t",l=i.box(["Add",["Square",u],["Negate",["Multiply",a,u]],s]).simplify(),c=Kn(l,u);if(c.length===0)return null;let f=Pc(c);if(f.length===0)return null;let p=[];if(f.length===1){let d=f[0].simplify();p.push({[e]:d,[t]:d})}else if(f.length>=2){let d=f[0].simplify(),m=f[1].simplify();p.push({[e]:d,[t]:m}),d.isSame(m)||p.push({[e]:m,[t]:d})}return p.length>0?p:null}function jE(n,e,t,i){if(!n.has(e)||!n.has(t))return null;let r=ge(n,e),o=ge(n,t);if(r!==1||o!==1)return null;let s=UE(n,e,t,i);return!s||s.coef.is(0)?null:{product:s.constant.neg().div(s.coef).simplify()}}function UE(n,e,t,i){let r=i.Zero,o=i.Zero;if(n.operator==="Add"){for(let a of n.ops){let u=ex(a,e,t,i);if(u===null)return null;r=r.add(u.coef),o=o.add(u.constant)}return{coef:r,constant:o}}let s=ex(n,e,t,i);return s===null?null:s}function ex(n,e,t,i){let r=n.has(e),o=n.has(t);if(!r&&!o)return{coef:i.Zero,constant:n};if(r!==o)return null;if(n.operator==="Multiply"){let s=i.One,a=!1,u=!1;for(let l of n.ops)if(l.symbol===e){if(a)return null;a=!0}else if(l.symbol===t){if(u)return null;u=!0}else{if(l.has(e)||l.has(t))return null;s=s.mul(l)}return a&&u?{coef:s,constant:i.Zero}:null}return n.symbol===e||n.symbol===t,null}function GE(n,e,t,i){if(!n.has(e)||!n.has(t))return null;let r=ge(n,e),o=ge(n,t);if(r!==1||o!==1||!Oc(n,[e,t]))return null;let s=Pt(n,e,i),a=Pt(n,t,i),u=po(n,[e,t],i);if(s===null||a===null)return null;let l=s.div(a).simplify();return!l.is(1)&&!l.is(-1)?null:l.is(1)?{sum:u.neg().div(s).simplify()}:null}function Ss(n){let e=n.simplify();if(e.operator==="Complex")return!1;let t=e.im;return!(t!==void 0&&t!==0)}function Pc(n){return n.filter(e=>Ss(e))}function zE(n,e,t,i){for(let r=0;r<n.length;r++){let o=n[r],s=n[1-r],a=nx(o,e,t,i);if(a){let l=s.subs({[e]:a},{canonical:!0}).simplify(),c=Pc(Kn(l,t));if(c.length>0){let f=[];for(let p of c){let d=p.simplify(),m=a.subs({[t]:d},{canonical:!0}).simplify();Ss(m)&&Ss(d)&&f.push({[e]:m,[t]:d})}if(f.length>0)return f}}let u=nx(o,t,e,i);if(u){let l=s.subs({[t]:u},{canonical:!0}).simplify(),c=Pc(Kn(l,e));if(c.length>0){let f=[];for(let p of c){let d=p.simplify(),m=u.subs({[e]:d},{canonical:!0}).simplify();Ss(d)&&Ss(m)&&f.push({[e]:d,[t]:m})}if(f.length>0)return f}}}return null}function nx(n,e,t,i){if(ge(n,e)!==1)return null;let o=Pt(n,e,i);return o===null||o.is(0)?null:n.sub(o.mul(i.symbol(e))).simplify().neg().div(o).simplify()}var ZE=["Less","LessEqual","Greater","GreaterEqual"];function HE(n){return n!==null&&ZE.includes(n)}function ox(n,e){if(e.length!==2||n.length<2)return null;let t=n[0].engine,[i,r]=e,o=[];for(let c of n){let f=WE(c,i,r,t);if(!f)return null;o.push(f)}let s=[];for(let c=0;c<o.length;c++)for(let f=c+1;f<o.length;f++){let p=JE(o[c],o[f]);p&&s.push(p)}let a=s.filter(c=>o.every(f=>YE(c,f)));if(a.length===0)return null;let u=QE(a);return u.length===0?null:XE(u).map(c=>({[i]:t.number(c.x).simplify(),[r]:t.number(c.y).simplify()}))}function WE(n,e,t,i){let r=n.operator;if(!HE(r))return null;let o=n.op1,s=n.op2;if(!o||!s)return null;let a,u;r==="Less"||r==="LessEqual"?(a=o.sub(s).expand().simplify(),u=r==="Less"):(a=s.sub(o).expand().simplify(),u=r==="Greater");let l=ge(a,e),c=ge(a,t);if(l>1||c>1||!Oc(a,[e,t]))return null;let f=Pt(a,e,i),p=Pt(a,t,i),d=po(a,[e,t],i);if(f===null||p===null)return null;let m=f.N().numericValue,g=p.N().numericValue,h=d.N().numericValue,x=_=>{if(typeof _=="number")return _;if(_&&typeof _=="object"&&"re"in _){let N=_.re;if(typeof N=="number")return N}return null},y=x(m),v=x(g),E=x(h);return y===null||v===null||E===null||!Number.isFinite(y)||!Number.isFinite(v)||!Number.isFinite(E)?null:{a:y,b:v,c:E,strict:u}}function JE(n,e){let t=n.a*e.b-e.a*n.b;if(Math.abs(t)<1e-14)return null;let i=(n.b*e.c-e.b*n.c)/t,r=(e.a*n.c-n.a*e.c)/t;return!Number.isFinite(i)||!Number.isFinite(r)?null:{x:i,y:r}}function YE(n,e){let t=e.a*n.x+e.b*n.y+e.c;return e.strict?t<1e-10:t<=1e-10}function QE(n){let t=[];for(let i of n)t.some(o=>Math.abs(o.x-i.x)<1e-10&&Math.abs(o.y-i.y)<1e-10)||t.push(i);return t}function XE(n){if(n.length<=2)return n;let e=n.reduce((i,r)=>i+r.x,0)/n.length,t=n.reduce((i,r)=>i+r.y,0)/n.length;return[...n].sort((i,r)=>{let o=Math.atan2(i.y-t,i.x-e),s=Math.atan2(r.y-t,r.x-e);return o-s})}oi();Go();Gr();oi();zn();function Ya(n,e){if(!n.ops)return[];let t=n.ops,i=n.operatorDefinition;if(!i||t.length===0)return t;let r=i?.associative?n.operator:"";if(t=_i(t,r),i.lazy)return t;let o=[];for(let s of t){let a=s.operator;if(a==="Hold")o.push(s);else{let u=a==="ReleaseHold"?s.op1:s;if(u){let l=e(u);l!==null&&o.push(l)}}}return _i(o,r)}async function sx(n,e){if(!n.ops)return[];let t=n.ops,i=n.operatorDefinition;if(!i||t.length===0)return t;let r=i?.associative?n.operator:"";if(t=_i(t,r),i.lazy)return t;let o=[];for(let s of t){let a=s.operator;if(a==="Hold")o.push(s);else{let u=a==="ReleaseHold"?s.op1:s;if(u){let l=await e(u);l!==null&&o.push(l)}}}return _i(o,r)}var KE=/^(Sin|Cos|Tan|Cot|Sec|Csc)$/;function Qa(n){return KE.test(n.operator)?!0:n.ops?n.ops.some(Qa):!1}function Oi(n,...e){return e.includes(n.operator)?!0:n.ops?n.ops.some(t=>Oi(t,...e)):!1}function Re(n,e){let t=n.engine;if(n.ops&&n.ops.length>0){let i=n.ops.map(o=>Re(o,e));i.some((o,s)=>o!==n.ops[s])&&(n=t._fn(n.operator,i))}return e(n)??n}function Lc(n,e){let t=n.op1,i=e.op1;return t!==void 0&&i!==void 0&&t.isSame(i)}function ev(n){let e=n.engine,t=n.operator,i=n.op1;if(i){if(t==="Sec")return e.One.div(e._fn("Cos",[i]));if(t==="Csc")return e.One.div(e._fn("Sin",[i]))}}function cx(n){return Re(n,ev)}function nv(n){let e=n.engine,t=n.operator,i=n.op1;if(i){if(t==="Tan")return e._fn("Sin",[i]).div(e._fn("Cos",[i]));if(t==="Cot")return e._fn("Cos",[i]).div(e._fn("Sin",[i]))}}function fx(n){return Re(n,nv)}function tv(n){let e=n.engine;if(n.operator!=="Divide")return;let t=n.op1,i=n.op2;if(!(!t||!i)){if(t.operator==="Sin"&&i.operator==="Cos"&&Lc(t,i))return e._fn("Tan",[t.op1]);if(t.operator==="Cos"&&i.operator==="Sin"&&Lc(t,i))return e._fn("Cot",[t.op1])}}function px(n){return Re(n,tv)}function iv(n){if(n.operator==="Negate"&&n.op1)return n.op1;if(n.operator==="Multiply"&&n.ops){let e=n.ops.findIndex(t=>t.is(-1));if(e>=0){let t=n.ops.filter((i,r)=>r!==e);return t.length===1?t[0]:n.engine._fn("Multiply",t)}}}function rv(n){let e=n.engine,t=n.operator,i=n.op1;if(!i)return;let r=iv(i);if(r){if(t==="Cos")return e._fn("Cos",[r]);if(t==="Sec")return e._fn("Sec",[r]);if(t==="Sin")return e._fn("Sin",[r]).neg();if(t==="Tan")return e._fn("Tan",[r]).neg();if(t==="Csc")return e._fn("Csc",[r]).neg();if(t==="Cot")return e._fn("Cot",[r]).neg()}}function dx(n){return Re(n,rv)}function ov(n){let e=n.engine;if(n.operator!=="Power")return;let t=n.op1,i=n.op2;if(!t||!i||t.operator!=="Sin"||!i.is(2))return;let r=t.op1;if(r)return e.One.sub(e._fn("Cos",[r]).pow(2))}function qc(n){return Re(n,ov)}function sv(n){let e=n.engine;if(n.operator!=="Power")return;let t=n.op1,i=n.op2;if(!t||!i||t.operator!=="Cos"||!i.is(2))return;let r=t.op1;if(r)return e.One.sub(e._fn("Sin",[r]).pow(2))}function mx(n){return Re(n,sv)}function av(n){let e=n.engine;if(n.operator!=="Power")return;let t=n.op1,i=n.op2;if(!t||!i||t.operator!=="Cos"||!i.is(2))return;let r=t.op1;if(r)return e.One.add(e._fn("Cos",[r.mul(2)])).div(2)}function gx(n){return Re(n,av)}function uv(n){let e=n.engine;if(n.operator==="Divide"){let i=n.op1,r=n.op2;if(!i||!r||!r.is(2))return;if(i.operator==="Add"&&i.ops&&i.ops.length===2)return ax(e,i.ops)}let t=i=>!!(i.re===.5&&i.im===0||i.isSame(e.Half));if(n.operator==="Multiply"&&n.ops){let i=n.ops.findIndex(r=>t(r));if(i>=0){let r=n.ops.filter((o,s)=>s!==i);if(r.length===1&&r[0].operator==="Add"){let o=r[0].ops;if(o&&o.length===2)return ax(e,o)}}}if(n.operator==="Add"&&n.ops&&n.ops.length===2){let i,r,o=!1,s=a=>a.re===-.5&&a.im===0;for(let a of n.ops){if(t(a)){i=a;continue}let u=a,l=!1;if(a.operator==="Negate"&&a.op1&&(l=!0,u=a.op1),u.operator==="Divide"&&u.op2?.is(2)){let c=u.op1;if(c?.operator==="Cos"){r=c,o=l;continue}}if(u.operator==="Multiply"&&u.ops){let c=u.ops.findIndex(p=>t(p));if(c>=0){let p=u.ops.filter((d,m)=>m!==c);if(p.length===1&&p[0].operator==="Cos"){r=p[0],o=l;continue}}let f=u.ops.findIndex(p=>s(p));if(f>=0){let p=u.ops.filter((d,m)=>m!==f);if(p.length===1&&p[0].operator==="Cos"){r=p[0],o=!l;continue}}}}if(i&&r){let a=r.op1;if(!a)return;let u;if(a.operator==="Multiply"&&a.ops){let l=a.ops.findIndex(c=>c.is(2));if(l>=0){let c=a.ops.filter((f,p)=>p!==l);u=c.length===1?c[0]:e._fn("Multiply",c)}}return u?o?e._fn("Sin",[u]).pow(2):e._fn("Cos",[u]).pow(2):void 0}}}function ax(n,e){let t=-1,i=-1,r=!1;for(let u=0;u<e.length;u++)e[u].is(1)?t=u:e[u].operator==="Cos"?(i=u,r=!1):e[u].operator==="Negate"&&e[u].op1?.operator==="Cos"&&(i=u,r=!0);if(t<0||i<0)return;let s=(r?e[i].op1:e[i]).op1;if(!s)return;let a;if(s.operator==="Multiply"&&s.ops){let u=s.ops.findIndex(l=>l.is(2));if(u>=0){let l=s.ops.filter((c,f)=>f!==u);a=l.length===1?l[0]:n._fn("Multiply",l)}}if(a)return r?n._fn("Sin",[a]).pow(2):n._fn("Cos",[a]).pow(2)}function Fc(n){return Re(n,uv)}function lv(n){let e=n.engine;if(n.operator!=="Multiply")return;let t=n.ops;if(!(!t||t.length<2))for(let i=0;i<t.length;i++)for(let r=i+1;r<t.length;r++){let o=t[i],s=t[r],a=o.op1,u=s.op1;if(!a||!u)continue;let l;if(o.operator==="Sin"&&s.operator==="Cos"?l=e._fn("Sin",[a.add(u)]).add(e._fn("Sin",[a.sub(u)])).div(2):o.operator==="Cos"&&s.operator==="Sin"?l=e._fn("Sin",[a.add(u)]).sub(e._fn("Sin",[a.sub(u)])).div(2):o.operator==="Cos"&&s.operator==="Cos"?l=e._fn("Cos",[a.add(u)]).add(e._fn("Cos",[a.sub(u)])).div(2):o.operator==="Sin"&&s.operator==="Sin"&&(l=e._fn("Cos",[a.sub(u)]).sub(e._fn("Cos",[a.add(u)])).div(2)),l){let c=t.filter((f,p)=>p!==i&&p!==r);return c.length===0?l:l.mul(c.length===1?c[0]:e._fn("Multiply",c))}}}function hx(n){return Re(n,lv)}function cv(n){let e=n.engine;if(n.operator!=="Add")return;let t=n.ops;if(!(!t||t.length<2))for(let i=0;i<t.length;i++)for(let r=i+1;r<t.length;r++){let o=t[i],s=t[r],a;if(o.operator==="Sin"&&s.operator==="Sin"){let u=o.op1,l=s.op1;if(u&&l){let c=u.add(l).div(2),f=u.sub(l).div(2);a=e._fn("Sin",[c]).mul(e._fn("Cos",[f])).mul(2)}}else if(o.operator==="Cos"&&s.operator==="Cos"){let u=o.op1,l=s.op1;if(u&&l){let c=u.add(l).div(2),f=u.sub(l).div(2);a=e._fn("Cos",[c]).mul(e._fn("Cos",[f])).mul(2)}}else if(o.operator==="Sin"&&s.operator==="Negate"&&s.op1?.operator==="Sin"){let u=o.op1,l=s.op1.op1;if(u&&l){let c=u.add(l).div(2),f=u.sub(l).div(2);a=e._fn("Cos",[c]).mul(e._fn("Sin",[f])).mul(2)}}else if(o.operator==="Cos"&&s.operator==="Negate"&&s.op1?.operator==="Cos"){let u=o.op1,l=s.op1.op1;if(u&&l){let c=u.add(l).div(2),f=u.sub(l).div(2);a=e._fn("Sin",[c]).mul(e._fn("Sin",[f])).mul(-2)}}if(a){let u=t.filter((l,c)=>c!==i&&c!==r);return u.length===0?a:a.add(u.length===1?u[0]:e._fn("Add",u))}}}function Xa(n){return Re(n,cv)}function fv(n){let e=n.engine,t=n.operator;if(t!=="Sin"&&t!=="Cos")return;let i=n.op1;if(i){if(i.operator==="Add"&&i.ops&&i.ops.length===2){let[r,o]=i.ops;return t==="Sin"?e._fn("Sin",[r]).mul(e._fn("Cos",[o])).add(e._fn("Cos",[r]).mul(e._fn("Sin",[o]))):e._fn("Cos",[r]).mul(e._fn("Cos",[o])).sub(e._fn("Sin",[r]).mul(e._fn("Sin",[o])))}if(i.operator==="Subtract"){let r=i.op1,o=i.op2;return!r||!o?void 0:t==="Sin"?e._fn("Sin",[r]).mul(e._fn("Cos",[o])).sub(e._fn("Cos",[r]).mul(e._fn("Sin",[o]))):e._fn("Cos",[r]).mul(e._fn("Cos",[o])).add(e._fn("Sin",[r]).mul(e._fn("Sin",[o])))}}}function xx(n){return Re(n,fv)}function pv(n){let e=n.engine;if(n.operator!=="Add")return;let t=n.ops;if(!(!t||t.length<2))for(let i=0;i<t.length;i++)for(let r=i+1;r<t.length;r++){let o=t[i],s=t[r],a=E=>{if(E.operator!=="Multiply")return null;let _=E.ops;if(!_||_.length!==2)return null;let[N,T]=_;return N.operator==="Sin"&&T.operator==="Cos"?{sin:N,cos:T}:N.operator==="Cos"&&T.operator==="Sin"?{sin:T,cos:N}:null},u=E=>{if(E.operator!=="Multiply")return null;let _=E.ops;if(!_||_.length!==2)return null;let[N,T]=_;return N.operator==="Cos"&&T.operator==="Cos"?{cos1:N,cos2:T}:null},l=E=>{if(E.operator!=="Multiply")return null;let _=E.ops;if(!_||_.length!==2)return null;let[N,T]=_;return N.operator==="Sin"&&T.operator==="Sin"?{sin1:N,sin2:T}:null},c=a(o),f=a(s),p=o.operator==="Negate"&&o.op1?a(o.op1):null,d=s.operator==="Negate"&&s.op1?a(s.op1):null;if(c&&f){let E=c.sin.op1,_=c.cos.op1,N=f.sin.op1,T=f.cos.op1;if(E&&_&&N&&T&&E.isSame(T)&&_.isSame(N)){let B=t.filter((Y,H)=>H!==i&&H!==r),O=e._fn("Sin",[E.add(_)]);return B.length===0?O:O.add(B.length===1?B[0]:e._fn("Add",B))}}if(c&&d){let E=c.sin.op1,_=c.cos.op1,N=d.sin.op1,T=d.cos.op1;if(E&&_&&N&&T&&E.isSame(T)&&_.isSame(N)){let B=t.filter((Y,H)=>H!==i&&H!==r),O=e._fn("Sin",[E.sub(_)]);return B.length===0?O:O.add(B.length===1?B[0]:e._fn("Add",B))}}if(p&&f){let E=p.sin.op1,_=p.cos.op1,N=f.sin.op1,T=f.cos.op1;if(E&&_&&N&&T&&N.isSame(_)&&T.isSame(E)){let B=t.filter((Y,H)=>H!==i&&H!==r),O=e._fn("Sin",[N.sub(T)]);return B.length===0?O:O.add(B.length===1?B[0]:e._fn("Add",B))}}let m=u(o),g=u(s),h=l(o),x=l(s),y=o.operator==="Negate"&&o.op1?l(o.op1):null,v=s.operator==="Negate"&&s.op1?l(s.op1):null;if(m&&v){let E=m.cos1.op1,_=m.cos2.op1,N=v.sin1.op1,T=v.sin2.op1;if(E&&_&&N&&T&&(E.isSame(N)&&_.isSame(T)||E.isSame(T)&&_.isSame(N))){let B=t.filter((Y,H)=>H!==i&&H!==r),O=e._fn("Cos",[E.add(_)]);return B.length===0?O:O.add(B.length===1?B[0]:e._fn("Add",B))}}if(y&&g){let E=g.cos1.op1,_=g.cos2.op1,N=y.sin1.op1,T=y.sin2.op1;if(E&&_&&N&&T&&(E.isSame(N)&&_.isSame(T)||E.isSame(T)&&_.isSame(N))){let B=t.filter((Y,H)=>H!==i&&H!==r),O=e._fn("Cos",[E.add(_)]);return B.length===0?O:O.add(B.length===1?B[0]:e._fn("Add",B))}}if(m&&x){let E=m.cos1.op1,_=m.cos2.op1,N=x.sin1.op1,T=x.sin2.op1;if(E&&_&&N&&T&&(E.isSame(N)&&_.isSame(T)||E.isSame(T)&&_.isSame(N))){let B=t.filter((Y,H)=>H!==i&&H!==r),O=e._fn("Cos",[E.sub(_)]);return B.length===0?O:O.add(B.length===1?B[0]:e._fn("Add",B))}}if(h&&g){let E=g.cos1.op1,_=g.cos2.op1,N=h.sin1.op1,T=h.sin2.op1;if(E&&_&&N&&T&&(E.isSame(N)&&_.isSame(T)||E.isSame(T)&&_.isSame(N))){let B=t.filter((Y,H)=>H!==i&&H!==r),O=e._fn("Cos",[E.sub(_)]);return B.length===0?O:O.add(B.length===1?B[0]:e._fn("Add",B))}}}}function Ka(n){return Re(n,pv)}function dv(n){let e=n.engine,t=n.operator;if(t!=="Sin"&&t!=="Cos")return;let i=n.op1;if(i&&i.operator==="Multiply"&&i.ops){let r=i.ops,o=r.findIndex(s=>s.is(2));if(o>=0){let s=r.filter((u,l)=>l!==o),a=s.length===1?s[0]:e._fn("Multiply",s);return t==="Sin"?e._fn("Sin",[a]).mul(e._fn("Cos",[a])).mul(2):e._fn("Cos",[a]).pow(2).mul(2).sub(e.One)}}}function Vc(n){return Re(n,dv)}function mv(n){let e=n.engine;if(n.operator==="Multiply"&&n.ops){let t=n.ops,i=t.findIndex(r=>r.is(2));if(i>=0){let r=t.filter((a,u)=>u!==i),o,s;for(let a of r)a.operator==="Sin"&&!o?o=a:a.operator==="Cos"&&!s&&(s=a);if(o&&s&&Lc(o,s)){let a=r.filter(l=>l!==o&&l!==s),u=e._fn("Sin",[o.op1.mul(2)]);return a.length===0?u:u.mul(a.length===1?a[0]:e._fn("Multiply",a))}}}if(n.operator==="Add"&&n.ops&&n.ops.length===2){let[t,i]=n.ops;if(t.operator==="Power"&&t.op1?.operator==="Cos"&&t.op2?.is(2)&&i.operator==="Negate"&&i.op1?.operator==="Power"&&i.op1?.op1?.operator==="Sin"&&i.op1?.op2?.is(2)){let u=t.op1.op1,l=i.op1.op1.op1;if(u&&l&&u.isSame(l))return e._fn("Cos",[u.mul(2)])}let r=u=>{if(u.operator!=="Multiply"||!u.ops)return;let l=u.ops.findIndex(p=>p.is(2));if(l<0)return;let c=u.ops.filter((p,d)=>d!==l);if(c.length!==1)return;let f=c[0];if(f.operator==="Power"&&f.op1?.operator==="Cos"&&f.op2?.is(2))return f.op1.op1},o=r(t);if(o&&(i.is(-1)||i.operator==="Negate"&&i.op1?.is(1)))return e._fn("Cos",[o.mul(2)]);if(o=r(i),o&&(t.is(-1)||t.operator==="Negate"&&t.op1?.is(1)))return e._fn("Cos",[o.mul(2)]);let s=u=>{if(u.operator!=="Multiply"||!u.ops)return;let l=u.ops.findIndex(p=>p.is(2));if(l<0)return;let c=u.ops.filter((p,d)=>d!==l);if(c.length!==1)return;let f=c[0];if(f.operator==="Power"&&f.op1?.operator==="Sin"&&f.op2?.is(2))return f.op1.op1};if(t.is(1)&&i.operator==="Negate"&&i.op1){let u=s(i.op1);if(u)return e._fn("Cos",[u.mul(2)])}if(i.is(1)&&t.operator==="Negate"&&t.op1){let u=s(t.op1);if(u)return e._fn("Cos",[u.mul(2)])}let a=u=>{if(u.operator!=="Multiply"||!u.ops)return;let l=u.ops.findIndex(p=>p.is(-2));if(l<0)return;let c=u.ops.filter((p,d)=>d!==l);if(c.length!==1)return;let f=c[0];if(f.operator==="Power"&&f.op1?.operator==="Sin"&&f.op2?.is(2))return f.op1.op1};if(t.is(1)){let u=a(i);if(u)return e._fn("Cos",[u.mul(2)])}if(i.is(1)){let u=a(t);if(u)return e._fn("Cos",[u.mul(2)])}}}function yx(n){return Re(n,mv)}function gv(n){let e=n.engine;if(n.operator!=="Tan")return;let t=n.op1;if(t){if(t.operator==="Add"&&t.ops&&t.ops.length===2){let[i,r]=t.ops,o=e._fn("Tan",[i]),s=e._fn("Tan",[r]);return o.add(s).div(e.One.sub(o.mul(s)))}if(t.operator==="Subtract"){let i=t.op1,r=t.op2;if(!i||!r)return;let o=e._fn("Tan",[i]),s=e._fn("Tan",[r]);return o.sub(s).div(e.One.add(o.mul(s)))}}}function bx(n){return Re(n,gv)}var hv=[{value:0,angle:[0,1]},{value:1/Math.sqrt(3),angle:[1,6]},{value:1,angle:[1,4]},{value:Math.sqrt(3),angle:[1,3]},{value:2-Math.sqrt(3),angle:[1,12]},{value:2+Math.sqrt(3),angle:[5,12]}];function xv(n,e=1e-10){for(let t of hv)if(Math.abs(t.value-n)<e)return t.angle}function yv(n){if(n.operator!=="Multiply")return;let e=n.ops;if(!e||e.length<2)return;let t=[],i=1;for(let r of e)if(r.operator==="Tan"&&r.op1)t.push(r.op1);else if(r.operator==="Negate"&&r.op1?.operator==="Sqrt"){let o=r.op1.op1;if(o?.isNumberLiteral&&typeof o.re=="number")i*=-Math.sqrt(o.re);else return}else if(r.operator==="Sqrt"){let o=r.op1;if(o?.isNumberLiteral&&typeof o.re=="number")i*=Math.sqrt(o.re);else return}else if(r.isNumberLiteral&&typeof r.re=="number")i*=r.re;else return;if(t.length===2)return[i,t[0],t[1]]}function ux(n){if(n.operator==="Multiply"&&n.ops){let e=!1,t;for(let i of n.ops)if(i.symbol==="Pi")e=!0;else if(i.isNumberLiteral&&typeof i.re=="number"){let r=i.re;for(let o=1;o<=36;o++){let s=Math.round(r*o);if(Math.abs(s/o-r)<1e-10){t=[s,o];break}}}if(e&&t)return t}if(n.symbol==="Pi")return[1,1]}function bv(n){let e=n.engine;if(n.operator!=="Add")return;let t=n.ops;if(!t||t.length!==3)return;let i=[],r;for(let y=0;y<t.length;y++){let v=t[y];if(v.operator==="Tan"&&v.op1)i.push({arg:v.op1,index:y});else{let E=yv(v);E&&(r={coef:E[0],arg1:E[1],arg2:E[2],index:y})}}if(i.length!==2||!r)return;let[o,s]=i,a=o.arg.isSame(r.arg1)||o.arg.isSame(r.arg2),u=s.arg.isSame(r.arg1)||s.arg.isSame(r.arg2),l=o.arg.isSame(r.arg2)||o.arg.isSame(r.arg1),c=s.arg.isSame(r.arg2)||s.arg.isSame(r.arg1);if(!(a&&c||u&&l))return;let f=-r.coef;if(f<=0)return;let p=xv(f);if(!p)return;let d=ux(o.arg),m=ux(s.arg);if(!d||!m)return;let g=lx(lx(d[1],m[1]),p[1]);if(d[0]*(g/d[1])+m[0]*(g/m[1])+p[0]*(g/p[1])!==g)return;let x=e._fn("Multiply",[e.number([p[0],p[1]]),e.symbol("Pi")]);return e._fn("Tan",[x]).neg()}function lx(n,e){return Math.abs(n*e)/Ev(n,e)}function Ev(n,e){for(n=Math.abs(n),e=Math.abs(e);e;){let t=e;e=n%e,n=t}return n}function Ex(n){return Re(n,bv)}function vv(n){let e=n.engine;if(n.operator!=="Multiply")return;let t=n.ops;if(!(!t||t.length<2))for(let i=0;i<t.length;i++)for(let r=i+1;r<t.length;r++){let o=t[i],s=t[r],a=o.op1,u=s.op1;if(!(!a||!u)){if(o.operator==="Tan"&&s.operator==="Tan"){let l=o,c=s,f=e._fn("Cot",[a.add(u)]),p=e.One.sub(l.add(c).mul(f)),d=t.filter((m,g)=>g!==i&&g!==r);return d.length===0?p:p.mul(d.length===1?d[0]:e._fn("Multiply",d))}if(o.operator==="Cot"&&s.operator==="Cot"){let l=o,c=s,f=e._fn("Cot",[a.add(u)]),p=e.One.add(l.add(c).mul(f)),d=t.filter((m,g)=>g!==i&&g!==r);return d.length===0?p:p.mul(d.length===1?d[0]:e._fn("Multiply",d))}}}}function vx(n){return Re(n,vv)}function _v(n){let e=n.engine;if(n.operator!=="Power")return;let t=n.op1,i=n.op2;if(!t||!i||!i.is(2))return;let r=t.op1;if(r){if(t.operator==="Tan")return e._fn("Sec",[r]).pow(2).sub(e.One);if(t.operator==="Cot")return e._fn("Csc",[r]).pow(2).sub(e.One);if(t.operator==="Sec")return e.One.add(e._fn("Tan",[r]).pow(2));if(t.operator==="Csc")return e.One.add(e._fn("Cot",[r]).pow(2))}}function _x(n){return Re(n,_v)}function Nv(n){let e=n.engine;if(n.operator!=="Add")return;let t=n.ops;if(!t||t.length!==2)return;let i=p=>{let d=!1,m=p;if(p.operator==="Negate"&&p.op1&&(d=!0,m=p.op1),m.operator!=="Power"||!m.op2?.is(2))return null;let g=m.op1;if(!g||!g.op1)return null;let h=g.operator;return["Tan","Cot","Sec","Csc"].includes(h)?{func:h,arg:g.op1,neg:d}:null},r=i(t[0]),o=i(t[1]);if(r&&o&&r.arg.isSame(o.arg)){if(r.func==="Cot"&&!r.neg&&o.func==="Csc"&&o.neg||r.func==="Csc"&&r.neg&&o.func==="Cot"&&!o.neg)return e.number(-1);if(r.func==="Csc"&&!r.neg&&o.func==="Cot"&&o.neg||r.func==="Cot"&&r.neg&&o.func==="Csc"&&!o.neg)return e.One;if(r.func==="Tan"&&!r.neg&&o.func==="Sec"&&o.neg||r.func==="Sec"&&r.neg&&o.func==="Tan"&&!o.neg)return e.number(-1);if(r.func==="Sec"&&!r.neg&&o.func==="Tan"&&o.neg||r.func==="Tan"&&r.neg&&o.func==="Sec"&&!o.neg)return e.One}let s=-1,a=-1,u=!1;for(let p=0;p<t.length;p++){let d=t[p];d.is(1)?(s=p,u=!1):d.is(-1)||d.operator==="Negate"&&d.op1?.is(1)?(s=p,u=!0):d.operator==="Power"&&d.op2?.is(2)&&(a=p)}if(s<0||a<0)return;let c=t[a].op1;if(!c)return;let f=c.op1;if(f){if(c.operator==="Sec"&&u)return e._fn("Tan",[f]).pow(2);if(c.operator==="Csc"&&u)return e._fn("Cot",[f]).pow(2);if(c.operator==="Tan"&&!u)return e._fn("Sec",[f]).pow(2);if(c.operator==="Cot"&&!u)return e._fn("Csc",[f]).pow(2)}}function $c(n){return Re(n,Nv)}function Tv(n){let e=n.engine;if(n.operator!=="Multiply"||!n.ops)return[1,e.One,n];for(let t=0;t<n.ops.length;t++){let i=n.ops[t],r;if(i.isNumberLiteral&&typeof i.re=="number"&&i.im===0&&(r=i.re),r!==void 0){let o=n.ops.filter((a,u)=>u!==t),s=o.length===1?o[0]:e._fn("Multiply",o);return[r,i,s]}}return[1,e.One,n]}function Sv(n){let e=n.engine;if(n.operator!=="Multiply")return;let t=n.ops;if(!t||t.length<2)return;let i=[],r=[];for(let T of t)if(T.operator==="Cos"&&T.op1){let B=Tv(T.op1);B?i.push({arg:B[2],numericMult:B[0],symbolicCoeff:B[1]}):i.push({arg:T.op1,numericMult:1,symbolicCoeff:e.One})}else r.push(T);if(i.length<2)return;let o=i[0].arg,s=i.filter(T=>T.arg.isSame(o)),a=i.filter(T=>!T.arg.isSame(o));if(s.length<2)return;s.sort((T,B)=>T.numericMult-B.numericMult);let u=[],l=[],c=[...s],f=c[0].numericMult;if(f>0){u.push(c[0]);let T=new Set([0]),B=f*2;for(;;){let O=c.findIndex((Y,H)=>!T.has(H)&&Math.abs(Y.numericMult-B)<1e-10);if(O===-1)break;u.push(c[O]),T.add(O),B*=2}l=c.filter((O,Y)=>!T.has(Y))}if(u.length<2)return;let p=u[0].numericMult,d=[...r];for(let T of l){let B=T.symbolicCoeff.isSame(e.One)?T.arg:e._fn("Multiply",[T.symbolicCoeff,T.arg]);d.push(e._fn("Cos",[B]))}for(let T of a){let B=T.symbolicCoeff.isSame(e.One)?T.arg:e._fn("Multiply",[T.symbolicCoeff,T.arg]);d.push(e._fn("Cos",[B]))}let m=u.length,g=u[0].symbolicCoeff,h=Math.pow(2,m);if(o.symbol==="Pi"){let T=1/(h+1);if(Math.abs(p-T)<1e-10){let B=e.number([1,h]);return d.length===0?B:B.mul(d.length===1?d[0]:e._fn("Multiply",d))}}let x=g.mul(h),y=g.isSame(e.One)?o:e._fn("Multiply",[g,o]),v=e._fn("Multiply",[x,o]),E=e._fn("Sin",[v]),_=e._fn("Sin",[y]),N=E.div(e.number(h).mul(_));return d.length===0?N:N.mul(d.length===1?d[0]:e._fn("Multiply",d))}function Nx(n){return Re(n,Sv)}function Iv(n){if(n.operator==="Power"&&n.op2?.is(2)){let e=n.op1;if(e?.operator==="Sin"&&e.op1)return{func:"Sin",arg:e.op1,coef:1};if(e?.operator==="Cos"&&e.op1)return{func:"Cos",arg:e.op1,coef:1}}if(n.operator==="Multiply"&&n.ops){let e=1,t;for(let i of n.ops)if(i.operator==="Power"&&i.op2?.is(2)){let r=i.op1;(r?.operator==="Sin"||r?.operator==="Cos")&&(t=i)}else typeof i.re=="number"&&i.im===0&&(e*=i.re);if(t){let i=t.op1;if(i.operator==="Sin"&&i.op1)return{func:"Sin",arg:i.op1,coef:e};if(i.operator==="Cos"&&i.op1)return{func:"Cos",arg:i.op1,coef:e}}}return null}function Bv(n){let e=n.engine;if(n.operator!=="Add")return;let t=n.ops;if(!t||t.length<2)return;let i=[],r=[],o=[];for(let s=0;s<t.length;s++){let a=t[s],u=Iv(a);u?i.push({...u,index:s}):typeof a.re=="number"&&a.im===0&&a.isNumberLiteral?o.push({value:a.re,index:s}):r.push({expr:a,index:s})}for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++){let u=i[s],l=i[a];if(u.arg.isSame(l.arg)&&(u.func==="Sin"&&l.func==="Cos"||u.func==="Cos"&&l.func==="Sin")&&Math.abs(u.coef-l.coef)<1e-10){let c=u.coef,f=new Set([u.index,l.index]),p=t.filter((d,m)=>!f.has(m));return p.length===0?e.number(c):c===1?e._fn("Add",[e.One,...p]):e._fn("Add",[e.number(c),...p])}}for(let s of i)if(s.coef<0){let a=Math.abs(s.coef);for(let u of o)if(Math.abs(u.value-a)<1e-10){let l=new Set([s.index,u.index]),c=t.filter((d,m)=>!l.has(m)),f=s.func==="Sin"?"Cos":"Sin",p=e._fn(f,[s.arg]).pow(2).mul(a);return c.length===0?p:e._fn("Add",[p,...c])}}}function Tx(n){return Re(n,Bv)}var wv=new Set(["Sin","Cos","Tan","Cot","Sec","Csc"]);function jc(n){let e=0;if(wv.has(n.operator)&&(e=1),n.ops)for(let t of n.ops)e+=jc(t);return e}function Uc(n){if(n.symbol||n.isNumberLiteral)return 1;let e=1;if(n.ops)for(let t of n.ops)e+=Uc(t);return e}function Sx(n){let e=jc(n),t=Uc(n);return e*1e3+t}var Ix=Sx;function Gc(n,e){if(n.length===0)throw new Error("bestOf called with empty array");if(n.length===1)return n[0];let t=n[0],i=e(t);for(let r=1;r<n.length;r++){let o=e(n[r]);o<i&&(t=n[r],i=o)}return t}function Is(n,e){let t=e(n);return t.isSame(n)?null:t}function Bx(n,e){let t=Is(n,qc),i=Is(n,mx),r=[n];return t&&r.push(t),i&&r.push(i),Gc(r,e)}function Av(n,e){return Bx(n,e)}function kv(n,e){let t=Is(n,hx),i=[n];if(t){i.push(t);let r=Is(t,Ka);r&&i.push(r)}return Gc(i,e)}function Cv(n,e){let t=Is(n,Ka),i=[n];return t&&i.push(t),Gc(i,e)}function Rv(n,e){let t=bx(n);return t=vx(t),t}function Mv(n,e){let t=n;return t=xx(t),t=Vc(t),t=qc(t),t=gx(t),t=Vc(t),t=kv(t,e),t=Bx(t,e),t=Xa(t),t=Av(t,e),t=Xa(t),t=Cv(t,e),t}function zc(n,e){if(!Qa(n))return;let t=e?.measure??Ix,i=e?.maxIterations??100,r=n,o=0,s=n,a=t(n),u=E=>{let _=t(E);_<a&&(s=E,a=_)};r=dx(r),u(r);let l=$c(r);u(l);let c=_x(r);u(c),r=s;let f=Fc(r);if(u(f),r=s,Oi(r,"Sec","Csc")&&(r=cx(r),s=r,a=t(r)),Oi(r,"Tan","Cot")){let E=Rv(r,t);u(E),r=E}if(Oi(r,"Tan","Cot")&&(r=fx(r),u(r)),Oi(r,"Sin","Cos")){let E=Xa(r);u(E),r=s}if(Oi(r,"Sin","Cos")){let E=t(r);for(;o<i;){o++;let _=Mv(r,t),N=t(_);if(u(_),N>=E)break;r=_,E=N}}let p=px(s);u(p);let d=yx(s);u(d);let m=Nx(s);u(m);let g=Fc(s);u(g);let h=$c(s);u(h);let x=Ka(s);u(x);let y=Tx(s);u(y);let v=Ex(s);if(u(v),s.operator==="Add"||s.operator==="Multiply"){let E=n.engine.box(s.json);u(E)}if(!s.isSame(n))return{value:s,because:"fu"}}var wx=["Add","Subtract","Multiply","Divide","Negate","Power","Rational"],Dv=["Sin","Cos","Tan","Csc","Sec","Cot"];function Ax(n){return Dv.includes(n.operator)?!0:n.ops?n.ops.some(e=>Ax(e)):!1}function Zc(n){if(n.isNumberLiteral||!n.ops||n.operator==="Power"&&(n.op1?.symbol==="ExponentialE"||n.op2?.isRational===!0&&n.op2?.isInteger===!1))return n;if(n.unknowns.length===0&&wx.includes(n.operator)){let i=n.evaluate();if(i.isNumberLiteral)return i}let e=n.ops.map(i=>Zc(i));return e.some((i,r)=>i!==n.ops[r])?n.engine._fn(n.operator,e):n}function mt(n,e,t){if((a=>t&&t.some(u=>u.value.isSame(a)))(n))return t;let r=1e3;if(t&&t.length>=r)return console.warn(`Simplification exceeded ${r} steps, stopping to prevent infinite recursion`),t;if(t||(t=[{value:n,because:"initial"}]),!n.isValid)return t;if(!(n.isCanonical||n.isStructural)){let a=n.canonical;return a.isCanonical||a.isStructural?mt(a,e):t}let o=n.engine;if(e?.strategy==="fu"){let a=h=>o.costFunction(h),u=zc(n),l=u?.value??n;if(u){let h=l.simplify();h.isSame(l)||(l=h)}let c=n.simplify(),f=zc(c),p=f?.value??c;if(f){let h=p.simplify();h.isSame(p)||(p=h)}let d=a(l),m=a(p),g=d<=m?l:p;return g.isSame(n)||t.push({value:g,because:"fu"}),t}let s=e?.rules?o.rules(e.rules,{canonical:!0}):o.getRuleSet("standard-simplification");e={...e,rules:s};do{let a=Ov(n,s,e,t);if(a.length<=t.length)break;n=a.at(-1).value,t=a}while(!t.slice(0,-1).some(a=>a.value.isSame(n)));return t}function Pv(n,e,t){if(e==null||n===e||n.isSame(e))return!1;let i=n.engine;t??=s=>i.costFunction(s);let r=t(n);return t(e)<=1.3*r}function kx(n,e){if(!n.ops)return n;let t=n.operatorDefinition;if(t?.scoped===!0){let o=n.ops.map((s,a)=>a===0?s:mt(s,e).at(-1).value);return n.engine._fn(n.operator,o)}let i=Ya(n,o=>o);if(t?.lazy){let o=i.map(s=>s.operator==="Sum"||s.operator==="Product"||Ax(s)||s.operator==="Power"&&s.op2?.isRational===!0&&!s.op2.isInteger?mt(s,e).at(-1).value:Zc(s));return n.engine.function(n.operator,o)}if(n.operator==="Divide"){let o=i.map(a=>Zc(a));return o.some((a,u)=>a!==i[u])?n.engine._fn(n.operator,o):n}let r=i.map(o=>{if(!o.isNumberLiteral&&o.ops&&o.unknowns.length===0&&wx.includes(o.operator)){if(o.operator==="Power"&&(o.op1?.symbol==="ExponentialE"||o.op2?.isRational===!0&&o.op2?.isInteger===!1))return o;let s=o.evaluate();if(s.isNumberLiteral)return s}return o.ops?mt(o,e).at(-1).value:o});return n.engine._fn(n.operator,r)}function Ov(n,e,t,i){if(n.isNumberLiteral||n.string)return i;if(n.symbol){let s=ri(n,e,{recursive:!1,canonical:!0,useVariations:!1});return s.length>0?[...i,...s]:i}let r=kx(n,t);r.isSame(n)||(i=[...i,{value:r,because:"simplified operands"}],n=r);let o=Lv(n,e,t,i);return o.length>i.length?o:i}function Lv(n,e,t,i){let r=ri(n,e,{recursive:!1,canonical:!0,useVariations:t.useVariations??!1});if(r.length===0)return i;let o=r.at(-1).value;return o.isSame(n)||(o=kx(o),!Pv(n,o,t?.costFunction))?i:(r.at(-1).value=o,[...i,...r])}cn();tn();ii();Xe();lt();ut();me();Jr();me();function Bs(n){return typeof n=="string"?n.startsWith("_"):He(n)?!0:n.ops?Bs(n.operator)||n.ops.some(Bs):!1}function gt(n,e,t){return n.startsWith("_"),n==="_"||n==="__"||n==="___"?t:n in t?e.isSame(t[n])?t:null:Bs(e)?null:{...t,[n]:e}}function ai(n,e,t,i){if(He(e))return gt(pn(e),n,t);let r=i.acceptVariants??!0;if(i={...i,acceptVariants:!0},e.numericValue!==null)return n.numericValue===null?null:e.isEqual(n)?t:r?Hc(n,e,t,i):null;let o=e.string;if(o!==null)return n.string===o?t:null;let s=e.symbol;if(s!==null)return s===n.symbol?t:r?Hc(n,e,t,i):null;if(e.ops){let a=i.useVariations??!1,u=n.engine,l=null,c=e.operator;if(c==="Divide"&&n.numericValue!==null&&!n.denominator.is(1)){let f=u.function("Divide",[n.numerator,n.denominator],{canonical:!1,structural:!0});return pr(f,e.ops,t,i)}if(c==="Divide"&&n.operator==="Multiply"){let f=n.ops;for(let p=0;p<f.length;p++){let d=f[p];if(d.numericValue!==null&&d.numerator.is(1)&&!d.denominator.is(1)){let m=f.filter((y,v)=>v!==p),g=m.length===1?m[0]:u.function("Multiply",m,{canonical:!1}),h=u.function("Divide",[g,d.denominator],{canonical:!1,structural:!0}),x=pr(h,e.ops,t,i);if(x!==null)return x}}}if(c==="Power"&&n.operator==="Divide"&&n.op1.is(1)){let f=u.function("Power",[n.op2,u.number(-1)],{canonical:!1,structural:!0}),p=pr(f,e.ops,t,i);if(p!==null)return p}if(c==="Power"&&n.operator==="Root"){let f=u.function("Power",[n.op1,u.box(["Divide",1,n.op2],{canonical:!1})],{canonical:!1,structural:!0}),p=pr(f,e.ops,t,i);if(p!==null)return p}if(c.startsWith("_"))l=gt(c,u.box(n.operator),t),l!==null&&(l=pr(n,e.ops,l,i));else if(c===n.operator){let f=i.matchPermutations??!0;l=e.operatorDefinition.commutative&&f?Fv(n,e,t,i):pr(n,e.ops,t,i)}if(l===null&&a){if(!r)return null;l=Hc(n,e,t,i)}return l!==null&&(t=l),i.recursive&&n.ops&&(l=qv(n,e,t,{...i,acceptVariants:r})??l),l}return null}function qv(n,e,t,i){n.ops;let r=null;for(let o of n.ops){let s=ai(o,e,t,i);s!==null&&(r=s,t=s)}return r}function Hc(n,e,t,i){if(!i.useVariations)return null;let r=n.engine,o={...i,acceptVariants:!1},s=(u,l)=>ai(r.function(u,l,{canonical:!1}),e,t,o),a=e.operator;if(a==="Negate"&&n.is(0))return ai(r.Zero,e.op1,t,o);if(a==="Add"){let u=s("Add",[0,n]);if(u!==null||(n.operator==="Subtract"&&(u=s("Add",[n.op1,["Negate",n.op2]])),u!==null))return u}if(a==="Subtract"){let u=s("Subtract",[n,0]);if(u!==null||(n.operator==="Negate"&&(u=s("Subtract",[0,n.op1])),u!==null))return u}if(a==="Multiply"){let u=s("Multiply",[1,n]);if(u!==null||n.operator==="Negate"&&(u=s("Multiply",[-1,n.op1]),u!==null)||n.operator==="Divide"&&(u=s("Multiply",[n.op1,["Divide",1,n.op2]]),u!==null))return u}if(a==="Divide"){let u=s("Divide",[n,1]);if(u!==null)return u}if(a==="Square"){let u=s("Power",[n,2]);if(u!==null)return u}if(a==="Exp"){let u=s("Power",[r.E,n]);if(u!==null)return u}if(a==="Power"){if(e.op2.re===2&&e.op2.im===0){let u=s("Square",[n]);if(u!==null)return u}if(e.op1.symbol==="ExponentialE"){let u=s("Exp",[n]);if(u!==null)return u}{let u=s("Power",[n,1]);if(u!==null)return u}}return null}function Fv(n,e,t,i){n.operator,e.operator;let r=e.ops,o=n.ops,s=0,a=0,u=0,l=0;for(let m of r){let g=Bt(m);g===null?l++:g==="Wildcard"?s++:g==="Sequence"?a++:u++}if(a===0&&u===0){if(o.length!==r.length)return null}else{let m=l+s+a;if(o.length<m)return null}if(l>0)if(l>=4&&o.length>=6){let m=new Map;for(let h=0;h<o.length;h++){let x=o[h].hash,y=m.get(x);y?y.push(h):m.set(x,[h])}let g=new Set;for(let h of r)if(!Bs(h)){let x=h.hash,y=m.get(x);if(!y)return null;let v=!1;for(let E of y)if(!g.has(E)&&o[E].isSame(h)){g.add(E),v=!0;break}if(!v)return null}}else{let m=[...o];for(let g of r)if(!Bs(g)){let h=m.findIndex(x=>x.isSame(g));if(h===-1)return null;m.splice(h,1)}}let c=a>0||u>0;if(l>0){let m=Vv(n,e,t,i);if(m!==null)return m}let d=_u(r,m=>!m.some((g,h)=>{if(!He(g))return!1;let x=Bt(g);if(x!=="Sequence"&&x!=="OptionalSequence")return!1;let y=m[h+1];if(!y||!He(y))return!1;let v=Bt(y);return v==="Sequence"||v==="OptionalSequence"}));for(let m of d){let g=pr(n,m,t,i);if(g!==null)return g}return null}var Cx=1e3;function Rx(n){if(n.isNumberLiteral)return 100;if(n.symbol)return 80;if(n.string!==void 0)return 90;if(n.operator){let e=n.nops??0,t=0;if(n.ops)for(let i of n.ops)Bt(i)===null&&t++;return 50+e+t*5}return 0}function Vv(n,e,t,i){let r=n.engine,o=e.ops,s=[...n.ops],a=[],u=[],l=[],c=[];for(let E of o){let _=Bt(E);_===null?a.push(E):_==="Wildcard"?u.push(E):_==="Sequence"?l.push(E):c.push(E)}let f=a.length+u.length+l.length,p=a.length+u.length+(l.length+c.length>0?1/0:0);if(s.length<f||l.length===0&&c.length===0&&s.length>p)return null;let d=[...a].sort((E,_)=>Rx(_)-Rx(E));return m(0,s,t);function m(E,_,N){if(E>=d.length)return g(_,N);let T=d.length-E,B=u.length+l.length;if(_.length<T+B)return null;let O=d[E];for(let Y=0;Y<_.length;Y++){let H=ai(_[Y],O,N,i);if(H!==null){let we=[..._];we.splice(Y,1);let qe=m(E+1,we,H);if(qe!==null)return qe}}return null}function g(E,_){let N=_,T=u.length,B=l.length,O=T+B;return E.length<O?null:h([...u,...l,...c],E,N)}function h(E,_,N){if(E.length===0)return _.length===0?N:null;let[T,...B]=E,O=Bt(T),Y=pn(T);if(O==="Wildcard"){for(let we=0;we<_.length;we++){let qe=gt(Y,_[we],N);if(qe!==null){let Fe=[..._];Fe.splice(we,1);let ce=h(B,Fe,qe);if(ce!==null)return ce}}return null}if(O==="Sequence"){let qe=_.length-x(B);for(let Fe=qe;Fe>=1;Fe--){let ce=v(_.length,Fe);for(let oe of ce){let ui=oe.map(qt=>_[qt]),Lt=y(ui),xt=gt(Y,Lt,N);if(xt!==null){let qt=_.filter((ap,ou)=>!oe.includes(ou)),xr=h(B,qt,xt);if(xr!==null)return xr}}}return null}let H=_.length-x(B);for(let we=H;we>=0;we--)if(we===0){let qe=n.operator==="Add"?r.Zero:n.operator==="Multiply"?r.One:r.Nothing,Fe=gt(Y,qe,N);if(Fe!==null){let ce=h(B,_,Fe);if(ce!==null)return ce}}else{let qe=v(_.length,we);for(let Fe of qe){let ce=Fe.map(Lt=>_[Lt]),oe=y(ce),ui=gt(Y,oe,N);if(ui!==null){let Lt=_.filter((qt,xr)=>!Fe.includes(xr)),xt=h(B,Lt,ui);if(xt!==null)return xt}}}return null}function x(E){return E.reduce((_,N)=>{let T=Bt(N);return T==="Wildcard"||T==="Sequence"?_+1:_},0)}function y(E){if(E.length===1)return E[0];let _=r.lookupDefinition(n.operator);return _&&le(_)&&_.operator.associative?r.function(n.operator,E,{canonical:!1}):r.function("Sequence",E,{canonical:!1})}function v(E,_){if(E>20&&_>2&&_<E-2){let O=1;for(let Y=0;Y<Math.min(_,E-_);Y++)if(O=O*(E-Y)/(Y+1),O>Cx)return[]}let N=[],T=[];function B(O){if(!(N.length>=Cx)){if(T.length===_){N.push([...T]);return}for(let Y=O;Y<E;Y++)T.push(Y),B(Y+1),T.pop()}}return B(0),N}}function pr(n,e,t,i){if(e.length===0)return n.ops&&n.ops.length===0?t:null;let r=e[0].engine,o=[...n.ops];return s(e,t);function s(a,u){let l={...u},c=0;for(;c<a.length;){let p=a[c],d=pn(p);if(d!==null)if(d.startsWith("__")){let m=a[c+1],g=d.startsWith("___");if(m===void 0){if(o.length===0&&!g)return null;l=gt(d,f(o.length),l)}else{let h=g?0:1;He(m)&&Bt(m);let x=m,y=c+1;for(;He(x)&&Bt(x)==="OptionalSequence"&&a[y+1];)x=a[++y];let v=!1;for(;!v&&h<o.length;)v=ai(o[h],x,l,i)!==null,v||(h+=1);if(v){if(x!==m){let _=c+1;for(;_<y&&l!==null;)l=gt(pn(a[_++]),f(0),l);if(l===null)return null}let E=l;for(;h<=o.length;){let _=o.slice(0,h);if(l=s(a.slice(y),gt(d,f(h),E)??E),l||(o.unshift(..._),h++,h>=o.length)||!ai(o[h-1],x,E,i))break}return l}else{if(!g)return null;l=gt(d,f(0),l)}}}else if(d.startsWith("_")){if(o.length===0)return null;l=gt(d,o.shift(),l)}else l=ai(o.shift(),p,l,i);else{let m=o.shift();if(!m)return null;l=ai(m,p,l,i)}if(l===null)return null;c+=1}if(o.length>0)return null;return l;function f(p){let d;if(p<1)n.operator==="Add"?d=r.Zero:n.operator==="Multiply"?d=r.One:d=r.Nothing;else if(p===1)d=o.shift();else{let m=r.lookupDefinition(n.operator),g=o.splice(0,p);m&&le(m)&&m.operator.associative?d=r.function(n.operator,g,{canonical:!1}):d=r.function("Sequence",g,{canonical:!1})}return d}}}function mo(n,e,t){e=e.structural;let i=t?.useVariations??!1,r={recursive:t?.recursive??!1,useVariations:i,acceptVariants:i,matchPermutations:t?.matchPermutations??!0},o=t?.substitution??{};return ai(n.structural,e.structural,o,r)}function Mx(n){let e=n.engine;if(n.operator==="Hold")return;let t;if(n.ops){let i=n.operatorDefinition;return i?.sgn&&(t=i.sgn(n.ops,{engine:e})),t}return n.symbol||n.isNumberLiteral?n.sgn:"unsigned"}function go(n){if(n!==void 0){if(n==="positive")return!0;if(["non-positive","zero","negative"].includes(n))return!1}}function ho(n){if(n!==void 0){if(["positive","positive-infinity","non-negative","zero"].includes(n))return!0;if(n==="negative")return!1}}function xo(n){if(n!==void 0){if(n==="negative")return!0;if(["non-negative","zero","positive"].includes(n))return!1}}function yo(n){if(n!==void 0){if(["negative","non-positive","zero"].includes(n))return!0;if(["positive","positive-infinity"].includes(n))return!1}}function Wc(n,e,t){return n.generation=e,n.value=t(),n.value}At();var $v=[5,5],Me=class extends ue{_operator;_ops;_def;_capturedContext;_localScope;_isPure;_isStructural;_hash;_value={value:null,generation:-1};_valueN={value:null,generation:-1};_sgn={value:null,generation:-1};_type={value:null,generation:-1};constructor(e,t,i,r){super(e,r?.metadata),this._operator=t,this._ops=i,this._localScope=r?.scope,this._isStructural=r?.structural??!1,(r?.canonical||this._isStructural)&&this.bind()}get hash(){if(this._hash!==void 0)return this._hash;let e=0;for(let t of this._ops)e=e<<1^t.hash|0;return e=e^Hn(this._operator)|0,this._hash=e,e}infer(e,t){let i=this.operatorDefinition;if(!i||!i.inferredSignature)return!1;if(i.signature.is("function"))i.signature=new R({kind:"signature",result:e},this.engine._typeResolver);else if(Hs(i.signature.type)){let r=i.signature.type;i.signature=new R({kind:"signature",args:r.args,optArgs:r.optArgs,variadicArg:r.variadicArg,variadicMin:r.variadicMin,result:t==="narrow"?Vi(r.result,e):ve(r.result,e)},this.engine._typeResolver)}return this.engine._generation+=1,!0}bind(){this._def=ss(this._operator,this._localScope??this.engine.context.lexicalScope)}reset(){}get value(){}get isCanonical(){return this._def!==void 0&&this._def!==null}get isPure(){if(this._isPure!==void 0)return this._isPure;let e=this.operatorDefinition?.pure??!1;return e&&(e=this._ops.every(t=>t.isPure)),this._isPure=e,e}get isConstant(){return this.isPure&&this._ops.every(e=>e.isConstant)}get constantValue(){return this.isConstant?this.value:void 0}get json(){return[this._operator,...this.structural.ops.map(e=>e.json)]}get operator(){return this._operator}get ops(){return this._ops}get nops(){return this._ops.length}get op1(){return this._ops[0]??this.engine.Nothing}get op2(){return this._ops[1]??this.engine.Nothing}get op3(){return this._ops[2]??this.engine.Nothing}get isScoped(){return this._localScope!==void 0}get localScope(){return this._localScope}get isValid(){return this._operator==="Error"?!1:this._ops.every(e=>e?.isValid)}get canonical(){return this.isCanonical||!this.isValid?this:this.engine.function(this._operator,this._ops)}get structural(){if(this.isStructural)return this;let e=this.operatorDefinition;if(e?.associative||e?.commutative){let t=this.ops.map(r=>r.structural),i=[];if(!e.associative)i=t;else for(let r of t)r.operator===this.operator?i.push(...r.ops):i.push(r);return this.engine.function(this._operator,this.isValid?Jo(this._operator,i):i,{canonical:!1,structural:!0})}return this.engine.function(this._operator,this.ops.map(t=>t.structural),{canonical:!1,structural:!0})}get isStructural(){return this._isStructural}toNumericValue(){this.isCanonical||this.isStructural;let e=this.engine;if(this.operator==="Complex")return[e._numericValue({re:this.op1.re,im:this.op2.re}),e.One];let t=this;if(t.operator==="Add"&&(t=Ri(this),t.numericValue!==null)){if(typeof t.numericValue=="number"){if(Number.isInteger(t.numericValue))return[e._numericValue(t.numericValue),e.One]}else if(t.numericValue.isExact)return[t.numericValue,e.One]}if(t.operator==="Negate"){let[i,r]=t.op1.toNumericValue();return[i.neg(),r]}if(t.operator==="Multiply"){let i=[],r=e._numericValue(1);for(let o of t.ops){let[s,a]=o.toNumericValue();r=r.mul(s),a.is(1)||i.push(a)}return i.length===0?[r,e.One]:i.length===1?[r,i[0]]:[r,$e(this.engine,i)]}if(t.operator==="Divide"){let[i,r]=t.op1.toNumericValue(),[o,s]=t.op2.toNumericValue(),a=i.div(o);return s.is(1)?[a,r]:[a,e.function("Divide",[r,s])]}if(t.operator==="Power"){if(t.op2.numericValue===null)return[e._numericValue(1),this];let[i,r]=t.op1.toNumericValue();if(i.isOne)return[i,this];let o=J(t.op2);return o!==null?[i.pow(o),e.function("Power",[r,t.op2])]:t.op2.is(.5)?[i.sqrt(),e.function("Sqrt",[r])]:[e._numericValue(1),this]}if(t.operator==="Sqrt"){let[i,r]=t.op1.toNumericValue();return r.is(1)||r.is(0)?i.isOne||i.isZero?[i,r]:[i.sqrt(),r]:[i.sqrt(),e.function("Sqrt",[r])]}if(t.operator==="Root"){let i=t.op2.re;if(isNaN(i)||t.op2.im!==0)return[e._numericValue(1),this];let[r,o]=t.op1.toNumericValue();return i===2?[r.sqrt(),e.function("Sqrt",[o])]:[r.root(i),e.function("Root",[o,t.op2])]}if(t.operator==="Abs"){let[i,r]=t.op1.toNumericValue();return[i.abs(),e.function("Abs",[r])]}return t.operator,t.operator,t.operator==="Log"||t.operator==="Ln"?[e._numericValue(1),this]:[e._numericValue(1),t]}subs(e,t){t??={canonical:void 0},t.canonical===void 0&&(t={canonical:this.isCanonical});let i=this._ops.map(r=>r.subs(e,t));return i.every(r=>r.isValid)?this.engine.function(this._operator,i,t):this.engine.function(this._operator,i,{canonical:!1})}replace(e,t){return ri(this,e,t).at(-1)?.value??null}match(e,t){return mo(this,e,t)}has(e){if(typeof e=="string"){if(this._operator===e)return!0}else if(e.includes(this._operator))return!0;return this._ops.some(t=>t.has(e))}get sgn(){let e=this.isPure&&this._ops.every(t=>t.isConstant)?void 0:this.engine._generation;return Wc(this._sgn,e,()=>{if(!(!this.isValid||this.isNumber!==!0))return Mx(this)})}get isNaN(){if(!this.isNumber)return!1}get isInfinity(){if(!this.isNumber)return!1}get isFinite(){if(this.isNumber!==!0||this.isNaN||this.isInfinity)return!1;if(!(this.isNaN===void 0||this.isInfinity===void 0))return!0}get isOne(){if(this.isNonPositive===!0||this.isReal===!1)return!1}get isNegativeOne(){if(this.isNonNegative===!0||this.isReal===!1)return!1}get isPositive(){return go(this.sgn)}get isNonNegative(){return ho(this.sgn)}get isNegative(){return xo(this.sgn)}get isNonPositive(){return yo(this.sgn)}get numerator(){return this.numeratorDenominator[0]}get denominator(){return this.numeratorDenominator[1]}get numeratorDenominator(){if(!this.isCanonical)return[this,this.engine.One];if(this.isNumber!==!0)return[this.engine.Nothing,this.engine.Nothing];let e=this.operator;if(e==="Divide")return[this.op1,this.op2];if(e==="Negate"){let[t,i]=this.op1.numeratorDenominator;return[t.neg(),i]}if(e==="Power"){let[t,i]=this.op1.numeratorDenominator;return[t.pow(this.op2),i.pow(this.op2)]}if(e==="Root"){let[t,i]=this.op1.numeratorDenominator;return[t.root(this.op2),i.root(this.op2)]}if(e==="Sqrt"){let[t,i]=this.op1.numeratorDenominator;return[t.sqrt(),i.sqrt()]}if(e==="Abs"){let[t,i]=this.op1.numeratorDenominator;return[t.abs(),i.abs()]}return e==="Multiply"?new fn(this.engine,this.ops).asNumeratorDenominator():[this,this.engine.One]}neg(){if(!this.isCanonical)throw new Error("Not canonical");return Yi(this)}inv(){if(!this.isCanonical)throw new Error("Not canonical");if(this.isOne)return this;if(this.isNegativeOne)return this;if(this.operator==="Sqrt")return this.op1.inv().sqrt();if(this.operator==="Divide")return this.op2.div(this.op1);if(this.operator==="Power"){let e=this.op2.neg();return e.operator!=="Negate"?this.op1.pow(e):this.engine.function("Power",[this.op1,e])}if(this.operator==="Root"){let e=this.op2.neg();return e.operator!=="Negate"?this.op1.root(e):this.engine.function("Root",[this.op1,e])}return this.operator==="Exp"?this.engine.E.pow(this.op1.neg()):this.operator==="Rational"?this.op2.div(this.op1):this.operator==="Negate"?this.op1.inv().neg():this.engine._fn("Divide",[this.engine.One,this])}abs(){if(!this.isCanonical)throw new Error("Not canonical");return this.operator==="Abs"||this.operator==="Negate"?this:this.isNonNegative?this:this.isNonPositive?this.neg():this.engine._fn("Abs",[this])}add(e){if(e===0)return this;if(!this.isCanonical)throw new Error("Not canonical");return X(this,this.engine.box(e))}mul(e){if(!this.isCanonical)throw new Error("Not canonical");if(e===0)return this.engine.Zero;if(e===1)return this;if(e===-1)return this.neg();if(e instanceof ae){if(e.isZero)return this.engine.Zero;if(e.isOne)return this;if(e.isNegativeOne)return this.neg()}return pe(this,this.engine.box(e))}div(e){if(!this.isCanonical)throw new Error("Not canonical");return zr(this,e)}pow(e){return Oe(this,e,{numericApproximation:!1})}root(e){if(!this.isCanonical||typeof e!="number"&&!e.isCanonical)throw new Error("Not canonical");let t=typeof e=="number"?e:e.im===0?e.re:void 0;if(t===0)return this.engine.NaN;if(t===1)return this;if(t===-1)return this.inv();if(t===2)return this.engine.function("Sqrt",[this]);if(this.operator==="Power"&&t!==void 0){let[i,r]=this.ops;return i.pow(r.div(t))}if(this.operator==="Divide"){let[i,r]=this.ops;return i.root(e).div(r.root(e))}if(this.operator==="Negate"&&t!==void 0)return t%2===0?this.op1.root(e):this.op1.root(e).neg();if(this.operator==="Sqrt"){if(t!==void 0)return this.op1.root(t*2);if(typeof e!="number")return this.op1.root(e.mul(2))}if(this.operator==="Root"){let[i,r]=this.ops;return i.root(r.mul(e))}if(this.operator==="Multiply"){let i=this.ops.map(r=>r.root(e));return pe(...i)}if(this.isNumberLiteral){let i=this.numericValue;if(typeof i=="number"){if(i<0)return this.engine.NaN;if(i===0)return this.engine.Zero;if(i===1)return this.engine.One;if(t!==void 0){let r=this.engine.number(Math.pow(i,1/t));if(!r.isFinite||r.isInteger)return r}}else{if(i.isOne)return this.engine.One;if(i.isZero)return this.engine.Zero;if(t!==void 0){let r=i.root(t);if(r.isExact)return this.engine.number(r)}}}return this.engine._fn("Root",[this,this.engine.box(e)])}sqrt(){return this.root(2)}ln(e){let t=e?this.engine.box(e):void 0;if(!this.isCanonical)throw new Error("Not canonical");if(this.is(0))return this.engine.NegativeInfinity;if(this.operator==="Exp")return t?this.op1.div(t.ln()):this.op1;if(t&&this.isSame(t))return this.engine.One;if(this.isSame(this.engine.E))return t?this.engine.One.div(t.ln()):this.engine.One;if(this.operator==="Power"){let[i,r]=this.ops;return i.isSame(this.engine.E)?t?r.div(t.ln()):r:r.mul(i.ln(t))}if(this.operator==="Root"){let[i,r]=this.ops;return r.div(i.ln(t))}return this.operator==="Sqrt"?this.op1.ln(t).div(2):this.operator==="Divide"?this.op1.ln(t).sub(this.op2.ln(t)):t&&t.type.matches("finite_integer")?t.re===10?this.engine._fn("Log",[this]):this.engine._fn("Log",[this,t]):this.engine._fn("Ln",[this])}get complexity(){if(this.isCanonical)return this.operatorDefinition?.complexity??Ti}get baseDefinition(){if(this._def)return le(this._def)?this._def.operator:this._def.value}get operatorDefinition(){if(this._def)return le(this._def)?this._def.operator:void 0}get valueDefinition(){if(this._def)return re(this._def)?this._def.value:void 0}get isNumber(){if(!this.type.isUnknown)return w(this.type.type,"number")}get isInteger(){if(!this.type.isUnknown)return w(this.type.type,"integer")}get isRational(){if(!this.type.isUnknown)return w(this.type.type,"rational")}get isReal(){if(!this.type.isUnknown)return w(this.type.type,"real")}get isFunctionExpression(){return!0}get type(){let e=this.isPure&&this._ops.every(t=>t.isConstant)?void 0:this.engine._generation;return Wc(this._type,e,()=>new R(jv(this),this.engine._typeResolver))??R.unknown}get shape(){let e=this.type.type;return typeof e=="object"&&e.kind==="list"&&e.dimensions?e.dimensions:[]}get rank(){return this.shape.length}simplify(e){return mt(this,e).at(-1)?.value??this}evaluate(e){return Uv(this.engine,this._computeValue(e))()}evaluateAsync(e){return Gv(this.engine,this._computeValueAsync(e))()}N(){return this.evaluate({numericApproximation:!0})}solve(e){let t=as(e??this.unknowns);if(this.operator==="List"){let i=this.ops;if(i&&i.every(o=>o.operator==="Equal")){let o=tx([...i],t);if(o)return o;let s=rx([...i],t);if(s)return s}let r=["Less","LessEqual","Greater","GreaterEqual"];if(i&&i.every(o=>r.includes(o.operator??""))){let o=ox([...i],t);if(o)return o}}return t.length!==1?null:Kn(this,t[0])}get isCollection(){if(!this.isValid)return!1;let e=this.baseDefinition?.collection;return!e||e.count!==void 0&&e.iterator,e!==void 0}get isIndexedCollection(){return!this.isValid||!this.baseDefinition?.collection?.at?!1:this.type.matches("indexed_collection")}get isLazyCollection(){if(!this.isValid)return!1;let e=this.baseDefinition?.collection;return e?e?.isLazy?.(this)??!1:!1}contains(e){return this.baseDefinition?.collection?.contains?.(this,e)}get count(){return this.operatorDefinition?.collection?.count?.(this)}get isEmptyCollection(){if(this.isCollection)return this.operatorDefinition?.collection?.isEmpty?.(this)}get isFiniteCollection(){if(this.isCollection)return this.operatorDefinition?.collection?.isFinite?.(this)}each(){let e=this.operatorDefinition?.collection?.iterator?.(this);return e?(function*(){let t=e.next(),i=0;for(;!t.done;)i+=1,yield t.value,t=e.next()})():(function*(){})()}at(e){return this.operatorDefinition?.collection?.at?.(this,e)}get(e){if(typeof e=="string")return this.operatorDefinition?.collection?.at?.(this,e);if(e.string)return this.operatorDefinition?.collection?.at?.(this,e.string)}indexWhere(e){if(this.operatorDefinition?.collection?.indexWhere)return this.operatorDefinition.collection.indexWhere(this,e);if(!this.isIndexedCollection||!this.isFiniteCollection)return;let t=0;for(let i of this.each()){if(e(i))return t;t+=1}}subsetOf(e,t){return this.operatorDefinition?.collection?.subsetOf?.(this,e,t)??!1}_computeValue(e){return()=>{if(!this.isValid||!this._def)return this;let t=e?.numericApproximation??!1,i=e?.materialization??!1;if(re(this._def))return Dx(this,this._def.value,e);let r=this._def.operator,s=this.ops.some(c=>Z(c))&&(this.operator==="Add"||this.operator==="Multiply");if(r.broadcastable&&this.ops.some(c=>ke(c))&&!s){let c=tl(this._ops);if(!c)return this.engine.Nothing;let f=[];for(;;){let{done:p,value:d}=c.next();if(p)break;f.push(this.engine._fn(this.operator,d).evaluate(e))}return f.length===0?this.engine.Nothing:f.length===1?f[0]:this.engine._fn("List",f)}if(i!==!1&&!r.evaluate&&this.isLazyCollection)return zv(this,r,e);let a=Ya(this,c=>c.evaluate(e)),u=this._localScope!==void 0||e?.withArguments;if(u&&(this.engine._pushEvalContext(this._localScope??{parent:this.engine.context?.lexicalScope,bindings:new Map}),e?.withArguments))for(let[c,f]of Object.entries(e.withArguments))this.engine.context.values[c]=f;let l=r.evaluate?.(a,{numericApproximation:t,engine:this.engine,materialization:i});return u&&this.engine._popEvalContext(),l??this.engine.function(this._operator,a)}}_computeValueAsync(e){return async()=>{if(!this.isValid||!this._def)return this;let t=e?.numericApproximation??!1;if(re(this._def))return Dx(this,this._def.value,e);let i=this._def.operator,o=this.ops.some(f=>Z(f))&&(this.operator==="Add"||this.operator==="Multiply");if(i?.broadcastable&&this.ops.some(f=>ke(f))&&!o){let f=tl(this._ops);if(!f)return this.engine.Nothing;let p=[];for(;;){let{done:d,value:m}=f.next();if(d)break;p.push(this.engine._fn(this.operator,m).evaluateAsync(e))}return p.length===0?this.engine.Nothing:p.length===1?p[0]:Promise.all(p).then(d=>this.engine._fn("List",d))}let s=await sx(this,async f=>await f.evaluateAsync(e)),a=this._localScope!==void 0||e?.withArguments;if(a&&(this.engine._pushEvalContext(this._localScope??{parent:this.engine.context?.lexicalScope,bindings:new Map}),e?.withArguments))for(let[f,p]of Object.entries(e.withArguments))this.engine.context.values[f]=p;let u=this.engine,l={numericApproximation:t,engine:u,signal:e?.signal,eager:e?.materialization},c=i.evaluateAsync?.(s,l)??i.evaluate?.(s,l);return a&&this.engine._popEvalContext(),Promise.resolve(c).then(f=>f??u.function(this._operator,s))}}};function jv(n){if(!n.isValid)return"error";if(n.operator==="Function"){let i=n.ops[0].type,r=n.ops.slice(1);return F(`(${r.map(o=>"unknown").join(", ")}) -> ${i}`,n.engine._typeResolver)}let e=n.operatorDefinition;if(e){let t=e.signature instanceof R?e.signature.type:typeof e.signature=="string"?F(e.signature,n.engine._typeResolver):e.signature,i=Mn(t)??"unknown";if(typeof e.type=="function"){let r=e.type(n.ops,{engine:n.engine});r&&(r instanceof R?i=r.type:i=F(r,n.engine._typeResolver)??i)}return i}return n.valueDefinition?Mn(n.valueDefinition.type.type)??"unknown":"unknown"}function Uv(n,e){return()=>{if(n._deadline===void 0){n._deadline=Date.now()+n.timeLimit;let t=e();return n._deadline=void 0,t}return e()}}function Gv(n,e){return async()=>{if(n._deadline===void 0){n._deadline=Date.now()+n.timeLimit;let t=await e();return n._deadline=void 0,t}return e()}}function Dx(n,e,t){let i=e.isConstant?e.value:n.engine._getSymbolValue(n.operator);if(i&&!i.type.matches("function"))return i.isValid?n.engine.typeError("function",i.type,i.toString()):n;let r=n.ops.map(o=>o.evaluate(t));return!i||i.type.isUnknown?n.engine.function(n.operator,r):Rt(i,r)}function zv(n,e,t){if(!n.isValid||t?.materialization===!1)return n;let i=t?.materialization??!1;typeof i=="boolean"&&(i=$v);let r=n.isIndexedCollection,o=n.isFiniteCollection,s=[];if(!n.isEmptyCollection)if(!r||!o){let u=typeof i=="number"?i:i[0],l=n.each();for(let c of l){if(s.length===u){l.next().done||s.push(n.engine.symbol("ContinuationPlaceholder"));break}s.push(c.evaluate(t))}}else{let[u,l]=typeof i=="number"?[Math.ceil(i/2),i-Math.ceil(i/2)]:i,c=1,f=n.each();for(let d of f)if(s.push(d.evaluate(t)),c+=1,c>u)break;let p=n.count;if(p===void 0||p<=u)(p===void 0||s.length<p)&&s.push(n.engine.symbol("ContinuationPlaceholder"));else{let d=Math.max(u+1,p-l+1);for(p>u+l&&s.push(n.engine.symbol("ContinuationPlaceholder")),c=d;c<=p;){let m=n.at(c);if(!m)break;s.push(m.evaluate(t)),c+=1}}}let a=e.collection?.elttype?.(n);return a&&w(a,"tuple<string, any>")?n.engine.function("Dictionary",s):r?n.engine._fn("List",s):n.engine.function("Set",[...s])}lt();me();Jr();In();Ye();var Li=class n extends ue{[Symbol.toStringTag]="[BoxedString]";_string;_utf8Buffer;_unicodeScalarValues;constructor(e,t,i){super(e,i),this._string=t.normalize()}get json(){return Bn(this._string)&&!Un(this._string)?this._string:`'${this._string}'`}get hash(){return Hn("String"+this._string)}get operator(){return"String"}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(e){}get value(){return this}get type(){return R.string}get complexity(){return 19}get string(){return this._string}get buffer(){if(this._utf8Buffer===void 0){let e=new TextEncoder;this._utf8Buffer=e.encode(this._string)}return this._utf8Buffer}get unicodeScalars(){return this._unicodeScalarValues===void 0&&(this._unicodeScalarValues=Zv(this._string)),this._unicodeScalarValues}match(e,t){return ei(e)||(e=this.engine.box(e,{canonical:!1})),He(e)?{[pn(e)]:this}:e instanceof n&&this._string===e._string?{}:null}};function Zv(n){let e=[];for(let t=0;t<n.length;t++){let i=n.codePointAt(t);e.push(i),i>65535&&t++}return e}Yr();lt();me();Jr();an();var bo=class n extends ue{[Symbol.toStringTag]="[BoxedDictionary]";_keyValues={};_type;constructor(e,t,i){super(e,i?.metadata),t instanceof ue?this._initFromExpression(t,i):this._initFromRecord(t,i)}_initFromRecord(e,t){for(let i in e){if(typeof i!="string")throw new Error(`Dictionary keys must be strings, but got ${typeof i}`);if(i.length===0)throw new Error("Dictionary keys must not be empty strings");this._keyValues[i]=Ox(this.engine,e[i],t)}}_initFromExpression(e,t){if(e instanceof n){Object.assign(this._keyValues,e._keyValues);return}if(e.operator==="Tuple"||e.operator==="Pair"||e.operator==="KeyValuePair"){if(e.nops!==2)throw new Error(`Expected a key/value pair, got ${e.nops} elements`);let[i,r]=e.ops,o;if(i.string)o=i.string;else if(i.symbol)o=i.symbol;else throw new Error(`Expected a string key, got ${i.type}`);this._keyValues[o]=r.canonical;return}if(e.operator==="Dictionary"){for(let i of e.ops)if(i.operator==="KeyValuePair"||i.operator==="Pair"||i.operator==="Tuple"){let[r,o]=i.ops,s;if(r.string)s=r.string;else if(r.symbol)s=r.symbol;else return;this._keyValues[s]=o.canonical}else throw new Error(`Expected a key/value pair, got ${i.type}`);return}}get json(){return{dict:Object.fromEntries(Object.entries(this._keyValues).map(([e,t])=>[e,Px(t)]))}}toMathJson(e){if(e.shorthands.includes("dictionary"))return this.json;if(this.isEmptyCollection)return{dict:{}};let t={};for(let[i,r]of this.entries)t[i]=r.toMathJson(e);return{dict:t}}get hash(){return Hn("Dictionary"+JSON.stringify(this._keyValues))}get operator(){return"Dictionary"}get type(){if(this._type)return this._type;let e=ve(...Object.values(this._keyValues).map(t=>t.type.type));return this._type=this.engine.type(`dictionary<${e}>`),this._type}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(e){}get value(){}get complexity(){return 1e3}get isCollection(){return!0}get isIndexedCollection(){return!1}get isLazyCollection(){return!1}contains(e){}get count(){return Object.keys(this._keyValues).length}get isEmptyCollection(){return Object.keys(this._keyValues).length===0}get isFiniteCollection(){return!0}each(){let e=this.engine;return(function*(t){for(let[i,r]of Object.entries(t._keyValues))yield e.tuple(e.string(i),r)})(this)}get(e){return this._keyValues[e]}has(e){return this._keyValues.hasOwnProperty(e)}get keys(){return Object.keys(this._keyValues)}get entries(){return Object.entries(this._keyValues)}get values(){return Object.values(this._keyValues)}match(e,t){if(He(e))return{[pn(e)]:this};if(!(e instanceof n))return null;let i=null,r=Object.keys(e._keyValues);for(let o of r){if(!this._keyValues.hasOwnProperty(o))return null;let s=this._keyValues[o],a=e._keyValues[o];if(!s.match(a))return null;if(He(e._keyValues[o])){let u=pn(e._keyValues[o]);u&&(i={...i??{},[u]:s})}}return i}};function Px(n){return n.string?n.string:n.symbol==="True"?!0:n.symbol==="False"?!1:n.symbol?{sym:n.symbol}:n.numericValue!==null&&n.type.matches("real")?n.re:n.operator==="List"?n.ops.map(Px):n.toMathJson({shorthands:[]})}function Ox(n,e,t){if(e==null)return n.Nothing;if(e instanceof ue)return e;if(typeof e=="string")return n.string(e);if(typeof e=="number")return n.number(e,t);if(typeof e=="boolean")return e?n.True:n.False;if(Array.isArray(e))return n.function("List",e.map(i=>Ox(n,i,t)));if(typeof e=="object"){if("num"in e)return n.number(e.num,t);if("str"in e)return n.string(e.str);if("sym"in e)return n.symbol(e.sym,t);if("fn"in e)return n.box(e,t);if("dict"in e)return new bo(n,e.dict,t)}return n.Nothing}ut();kt();zn();me();Go();Yo();function Jc(n,e,t){if(e instanceof ue)return e;if(e=ne(e),typeof e=="string")return ht(n,e,t);if(Array.isArray(e)){let[i,...r]=e;return new Me(n,i,r.map(o=>Jc(n,o,t)),{canonical:!1})}if(typeof e=="object"){if("fn"in e)return Jc(n,e.fn,t);if("str"in e)return new Li(n,e.str);if("sym"in e)return ht(n,e.sym,t);if("num"in e)return ht(n,e.num,t)}return ht(n,e,t)}function eu(n,e,t,i){if(i=i?{...i}:{},"canonical"in i||(i.canonical=!0),!ze(e))throw new Error(`Unexpected operator: "${e}" is not a valid symbol: ${jn(e)}`);let r=i.structural??!1;if(e==="Hold")return new Me(n,"Hold",[Jc(n,t[0],i)],{...i,canonical:!0,structural:r});if(e==="Error"||e==="ErrorCode")return new Me(n,e,t.map(s=>n.box(s,{canonical:!1})),{metadata:i?.metadata,canonical:!0});if(e==="Number"&&t.length===1)return ht(n,t[0],i);if(r===!1&&i.canonical===!0){if((e==="Divide"||e==="Rational")&&t.length===2){let s=Kt(t[0]);if(s!==null){let a=Kt(t[1]);if(a!==null)return a===0n?s===0n?n.NaN:n.ComplexInfinity:n.number([s,a],i)}e="Divide"}if(e==="Complex"){if(t.length===1){let s=t[0];if(s instanceof ue&&s.isNumberLiteral)return n.number(n.complex(0,s.re),i);let a=z(t[0]);return a!==null&&a!==0?n.number(n.complex(0,a),i):n.box(s).mul(n.I)}if(t.length===2){let s=t[0]instanceof ue?t[0].re:z(t[0]),a=t[1]instanceof ue?t[1].re:z(t[1]);return a!==null&&s!==null&&!isNaN(a)&&!isNaN(s)?a===0&&s===0?n.Zero:a!==0?n.number(n._numericValue({re:s,im:a}),i):ht(n,t[0],i):ht(n,t[0],i).add(ht(n,t[1],i).mul(n.I))}throw new Error("Expected one or two arguments with Complex expression")}if(e==="Negate"&&t.length===1){let s=t[0];if(typeof s=="number")return n.number(-s,i);if(s instanceof U)return n.number(s.neg(),i);let a=n.box(s,i),u=a.numericValue;if(u!==null)return n.number(typeof u=="number"?-u:u.neg(),i);t=[a]}}return i.canonical===!0?Hv(n,e,t,i.metadata,i.scope):ar(new Me(n,e,t.map(s=>ht(n,s,{canonical:i.canonical,structural:r,scope:i.scope})),{metadata:i.metadata,canonical:!1,structural:r,scope:i.scope}),i.canonical??!1,i.scope)}function ht(n,e,t){if(e==null)return n.error("missing");if(e instanceof ae)return Jv(n,e);if(e instanceof ue)return ar(e,t?.canonical??!0,t?.scope);t=t?{...t}:{},"canonical"in t||(t.canonical=!0);let i=t.canonical===!0,r=t.structural??!1;if(Array.isArray(e)){if(typeof e[0]!="string")throw new Error(`The first element of an array should be a string (the function name): ${JSON.stringify(e,void 0,4)}`);return ar(eu(n,e[0],e.slice(1),{canonical:i,structural:r,scope:t?.scope}),t?.canonical??!0,t?.scope)}if(typeof e=="number"||e instanceof U||e instanceof ie)return n.number(e);if(typeof e=="string"){if(Bn(e)){let o=M(e);if(!o||!ze(o))return n.error("invalid-symbol",e);let s=i||t.canonical!==!1;return n.symbol(o,{canonical:s})}return Un(e)?n.number(e):(Qs(e),new Li(n,se(e)))}if(typeof e=="object"){let o=ud(e)?{latex:e.latex,wikidata:e.wikidata}:void 0;if("fn"in e){let[s,...a]=e.fn;return ar(eu(n,s,a,{canonical:i,structural:r,metadata:o}),t.canonical,t.scope)}if("str"in e)return new Li(n,e.str,o);if("sym"in e)return n.symbol(e.sym,{canonical:i,metadata:o});if("num"in e)return n.number(e,{canonical:i,metadata:o});if("dict"in e)return new bo(n,e.dict,{canonical:i});throw new Error(`Unexpected MathJSON object: ${JSON.stringify(e,void 0,4)}`)}return n.symbol("Undefined")}function Hv(n,e,t,i,r){let o=Wv(n,e,t,i,r);if(o)return o;if(e==="List"){let f=t.map(d=>n.box(d,{canonical:!1})),p=Om("List",f);return p&&p.dtype?new Zo(n,{ops:Fn(n,f,r),shape:p.shape,dtype:p.dtype},{metadata:i}):new Me(n,"List",Fn(n,f,r),{canonical:!0})}if(e==="Dictionary"){let f=t.map(p=>n.box(p,{canonical:!1}));return new bo(n,n._fn("Dictionary",f),{canonical:!0})}let s=n.lookupDefinition(e);if(!s)return n.declare(e,{type:"function",inferred:!0}),new Me(n,e,he(dr(n,t)),{metadata:i,canonical:!0});if(re(s))return new Me(n,e,he(dr(n,t)),{metadata:i,canonical:!0});let a=s.operator;if(r??=a.scoped?{parent:n.context.lexicalScope,bindings:new Map}:void 0,a.lazy){let f=t.map(p=>n.box(p,{canonical:!1}));if(a.canonical){try{if(o=a.canonical(f,{engine:n,scope:r}),o)return o}catch(p){console.error(p.message)}return o=new Me(n,e,f,{metadata:i,canonical:!1}),o}return o=new Me(n,e,a.inferredSignature?f:ro(n,f,a.signature.type,a.lazy,a.broadcastable)??f,{metadata:i,canonical:!0,scope:r}),o}let u=t.map(f=>n.box(f));if(a.canonical){try{let p=a.canonical(u,{engine:n,scope:r});if(p)return p}catch(p){console.error(p.message)}return new Me(n,e,u,{metadata:i,canonical:!1})}let l=he(u,a.associative?e:void 0),c=a.inferredSignature?null:ro(n,l,a.signature.type,a.lazy,a.broadcastable);if(c)return new Me(n,e,c,{metadata:i,canonical:!0,scope:r});if(l.length===1&&l[0].operator===e){if(a.involution)return l[0].op1;if(a.idempotent)return new Me(n,e,u[0].ops,{metadata:i,canonical:!0,scope:r})}return new Me(n,e,Jo(e,l),{metadata:i,canonical:!0,scope:r})}function Wv(n,e,t,i,r){let o=[];if(e==="Add"||e==="Multiply")o=Rn(n,dr(n,t,r),{flatten:e});else if(e==="Negate"||e==="Square"||e==="Sqrt"||e==="Exp")o=Rn(n,dr(n,t,r),1);else if(e==="Ln"||e==="Log")o=Rn(n,dr(n,t,r)),o.length===0&&(o=[n.error("missing")]);else if(e==="Power"||e==="Root")o=Rn(n,dr(n,t,r),2);else if(e==="Divide")o=Rn(n,dr(n,t,r)),o.length===0&&(o=[n.error("missing"),n.error("missing")]),o.length===1&&(o=[o[0],n.error("missing")]);else return null;if(!o.every(s=>s.isValid))return new Me(n,e,o,{metadata:i,canonical:!0});if(e==="Add")return qn(n,o);if(e==="Negate")return Am(o[0]);if(e==="Multiply")return $e(n,o);if(e==="Divide")return o.length===2?Zn(...o):o.slice(1).reduce((s,a)=>Zn(s,a),o[0]);if(e==="Exp")return ti(n.E,o[0]);if(e==="Square")return ti(o[0],n.number(2));if(e==="Power")return ti(o[0],o[1]);if(e==="Root")return er(o[0],o[1]);if(e==="Sqrt")return er(o[0],2);if(e==="Ln"||e==="Log"){if(o.length>0){if(o[0].is(1))return n.Zero;if(o.length===1)return new Me(n,e,o,{metadata:i,canonical:!0})}return new Me(n,"Log",o,{metadata:i,canonical:!0})}return null}function Jv(n,e){if(e.isZero)return n.Zero;if(e.isOne)return n.One;if(e.isNegativeOne)return n.NegativeOne;if(e.isNaN)return n.NaN;if(e.isNegativeInfinity)return n.NegativeInfinity;if(e.isPositiveInfinity)return n.PositiveInfinity;if(e=e.asExact??e,!e.isExact){let o=e.im;return o===0?n.number(e.bignumRe??e.re):e.re===0?n.number(n.complex(0,o)):e.bignumRe!==void 0&&!Wi(e.bignumRe)?qn(n,[n.number(e.bignumRe),n.number(n.complex(0,o))]):n.number(n.complex(e.re,e.im))}let t=[],i=e;if(i.sign!==0)if(i.radical===1)t.push(n.number(i.rational));else{let o=i.rational,s=n.function("Sqrt",[n.number(i.radical)]);if(nn(o))t.push(s);else{let[a,u]=o;u===1?a===1?t.push(s):t.push(n.function("Multiply",[n.number(a),s])):a===1?t.push(n.function("Divide",[s,n.number(u)])):t.push(n.function("Divide",[n.function("Multiply",[n.number(a),s]),n.number(u)]))}}let r;return e.im===0?t.length===0?n.Zero:(r=t.length===1?t[0]:$e(n,t),r):t.length===0?n.number(n.complex(0,e.im)):(r=t.length===1?t[0]:$e(n,t),qn(n,[r,n.number(n.complex(0,e.im))]))}function dr(n,e,t){return e.every(i=>i instanceof ue&&i.isCanonical)?e:e.map(i=>n.box(i,{scope:t}))}var ws=class n{_items;constructor(e){e?e instanceof n?this._items=new Map(e._items):this._items=new Map(e):this._items=new Map}has(e){for(let t of this._items.keys())if(t.isSame(e))return!0;return!1}get(e){for(let[t,i]of this._items)if(t.isSame(e))return i}clear(){this._items.clear()}set(e,t){for(let i of this._items.keys())if(i.isSame(e)){this._items.set(i,t);return}this._items.set(e,t)}delete(e){this._items.delete(e)}[Symbol.iterator](){return this._items.entries()}entries(){return this._items.entries()}};me();oi();Jr();Fi();_n();cn();en();Vt();kn();Xt();oi();lt();me();tn();ii();Nn();In();var En=class extends ue{_value;_hash;constructor(e,t,i){super(e,i?.metadata),t instanceof ae||typeof t=="number"?this._value=t:this._value=e._numericValue(t)}get hash(){return this._hash??=Hn(this._value.toString()),this._hash}get json(){let e=this._value;return typeof e=="number"?Number.isNaN(e)?"NaN":Number.isFinite(e)?e:e>0?"PositiveInfinity":"NegativeInfinity":e.toJSON()}get operator(){return"Number"}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(e){}get complexity(){return 1}valueOf(){return typeof this._value=="number"?this._value:this._value.N().valueOf()}get numericValue(){return this._value}get isNumberLiteral(){return!0}get re(){return typeof this._value=="number"?this._value:this._value.re}get im(){return typeof this._value=="number"?0:this._value.im}get bignumRe(){if(typeof this._value!="number")return this._value.bignumRe}get bignumIm(){return typeof this._value=="number"?this.engine._BIGNUM_ZERO:this.engine.bignum(this._value.im)}neg(){let e=this._value;return e===0?this:typeof e=="number"?this.engine.number(-e):this.engine.number(e.neg())}inv(){return typeof this._value=="number"?Math.abs(this._value)===1?this:Number.isInteger(this._value)?this.engine.number(this.engine._numericValue({rational:[1,this._value]})):this.engine.number(1/this._value):Math.abs(this.re)===1&&this.im===0?this:this.engine.number(this._value.inv())}abs(){return this.isPositive?this:typeof this._value=="number"?this.engine.number(-this._value):this.engine.number(this._value.abs())}add(e){let t=this.engine;return this.is(0)?t.box(e):typeof e=="number"?e===0?this:typeof this._value=="number"?t.number(this._value+e):t.number(this._value.add(e)):e.numericValue!==null?typeof this._value=="number"?typeof e.numericValue=="number"?t.number(this._value+e.numericValue):t.number(e.numericValue.add(this._value)):t.number(this._value.add(e.numericValue)):X(this,e.canonical)}mul(e){if(this.is(1))return this.engine.box(e);if(this.is(-1))return this.engine.box(e).neg();let t=this.engine;return typeof e=="number"?e===1?this:e===0||this.is(0)?this.engine.Zero:e===-1?this.neg():t.number(typeof this._value=="number"?this._value*e:this._value.mul(e)):typeof this._value=="number"&&typeof e=="number"?t.number(this._value*e):e instanceof ae?this.is(1)?t.number(e):this.is(-1)?t.number(e.neg()):t.number(e.mul(this._value)):e.numericValue!==null?t.number(t._numericValue(this._value).mul(e.numericValue)):pe(this,e)}div(e){return zr(this,e)}pow(e){return Oe(this,e,{numericApproximation:!1})}root(e){if(typeof e=="number"){if(e===0)return this.engine.NaN;if(e===1)return this;if(e===-1)return this.inv();if(e===2)return this.sqrt();if(this.isNegative){if(e%2===1)return this.neg().root(e).neg();if(e%2===0)return this.neg().root(e)}}else{if(e=e.canonical,e.is(0))return this.engine.NaN;if(e.is(1))return this;if(e.is(-1))return this.inv();if(e.is(2))return this.sqrt();if(this.isNegative){if(e.isOdd)return this.neg().root(e).neg();if(e.isEven)return this.neg().root(e)}}let t=typeof e=="number"?e:e.re;if(Number.isInteger(t))if(typeof this._value=="number"){let i=this._value**(1/t);if(Number.isInteger(i))return this.engine.number(i)}else{let i=this._value.root(t);if(w(i.type,"integer"))return this.engine.number(i)}return this.engine._fn("Root",[this,this.engine.box(e)])}sqrt(){return typeof this._value=="number"?this._value===0||this._value===1?this:this._value===-1?this.engine.I:this._value>0&&Number.isInteger(this._value)&&this._value<K?this.engine.number(this.engine._numericValue({radical:this._value})):this.engine.number(this.engine._numericValue(this._value).sqrt()):this.is(0)||this.is(1)?this:this.engine.number(this._value.sqrt())}ln(e){let t=e?this.engine.box(e):void 0;if(this.is(0))return this.engine.NegativeInfinity;if(t&&this.isSame(t))return this.engine.One;if((!t||t.symbol==="ExponentialE")&&this.symbol==="ExponentialE")return this.engine.One;let i=this.re;if(Number.isInteger(i)&&i>0){let r=this.engine,[o,s]=Ir(i,3);if(o!==1)return r.number(o).ln(t).mul(3).add(r.number(s).ln(t));if([o,s]=Ir(i,2),o!==1)return r.number(o).ln(t).mul(2).add(r.number(s).ln(t))}return t&&t.isInteger?typeof this._value=="number"?this.engine.number(Math.log(this._value)/Math.log(t.re)):this.engine.number(this._value.ln(t.re)):t===void 0?typeof this._value=="number"?this.engine.number(Math.log(this._value)):this.engine.number(this._value.ln()):this.engine._fn("Ln",[this])}get value(){return this}get type(){return typeof this._value=="number"?Number.isNaN(this._value)?R.number:Number.isFinite(this._value)?Number.isInteger(this._value)?R.finite_integer:R.finite_real:R.non_finite_number:new R(this._value.type,this.engine._typeResolver)}get sgn(){if(this._value===0)return"zero";let e;return typeof this._value=="number"?e=Math.sign(this._value):e=this._value.sgn(),e===void 0||Number.isNaN(e)?"unsigned":e===0?"zero":e>0?"positive":"negative"}get numerator(){return typeof this._value=="number"?this:this.engine.number(this._value.numerator)}get denominator(){return typeof this._value=="number"?this.engine.One:this.engine.number(this._value.denominator)}get numeratorDenominator(){if(typeof this._value=="number")return[this,this.engine.One];let e=this.engine;return[e.number(this._value.numerator),e.number(this._value.denominator)]}subs(e,t){return this.isStructural?this:this.structural.subs(e,t)}replace(e,t){return ri(this.structural,e,t).at(-1)?.value??null}match(e,t){return mo(this.structural,e,t)}get isPositive(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value>0:go(this.sgn)}get isNonNegative(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value>=0:ho(this.sgn)}get isNegative(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value<0:xo(this.sgn)}get isNonPositive(){return typeof this._value=="number"?!Number.isNaN(this._value)&&this._value<=0:yo(this.sgn)}get isOdd(){if(this.is(1)||this.is(-1))return!0;if(this.is(0))return!1;if(!this.isFinite||!this.isInteger)return;if(typeof this._value=="number")return this._value%2!==0;let[e,t]=[this._value.numerator,this._value.denominator];return t.isOne?e.re%2!==0:e.re%2!==0&&t.re%2===0}get isEven(){let e=this.isOdd;return e!==void 0?!e:void 0}get isInfinity(){return typeof this._value=="number"?!Number.isFinite(this._value)&&!Number.isNaN(this._value):Number.isFinite(this._value.im)?this._value.isPositiveInfinity||this._value.isNegativeInfinity:!0}get isNaN(){return typeof this._value=="number"?Number.isNaN(this._value):this._value.isNaN}get isFinite(){return this.isInfinity===!1&&this.isNaN===!1}get isNumber(){return!0}get isInteger(){return typeof this._value=="number"?Number.isInteger(this._value):w(this._value.type,"integer")}get isRational(){return typeof this._value=="number"?Number.isInteger(this._value):w(this._value.type,"rational")}get isReal(){return typeof this._value=="number"?!0:w(this._value.type,"real")}is(e){return typeof e=="number"?typeof this._value=="number"?Object.is(this._value,e):this._value.isNaN?Object.is(e,NaN):this._value.eq(e):typeof e=="bigint"?typeof this._value=="number"?be(this._value)===e:this._value.eq(this.engine._numericValue(e)):typeof e=="boolean"?!1:this.isSame(e)}get canonical(){return this}get isStructural(){return typeof this._value=="number"||this.type.matches("rational")?!0:!(this._value instanceof ye)}get structural(){return this.isStructural?this:this.engine.box(this.json,{canonical:!1,structural:!0})}toNumericValue(){let e=this._value;return typeof e=="number"?[this.engine._numericValue(e),this.engine.One]:[e,this.engine.One]}simplify(e){return mt(this.structural,e).at(-1).value??this}evaluate(e){return e?.numericApproximation?this.N():this}N(){let e=this._value;if(typeof e=="number")return this;let t=e.N();return e===t?this:this.engine.number(t)}};function nu(n,e){if(e==null)return NaN;if(e instanceof ae)return e;if(typeof e=="number")return Number.isInteger(e)&&e>=-K&&e<=K||!Number.isFinite(e)?e:n._numericValue(e);if(e instanceof U){let t=e.toNumber();return e.isInteger()&&Math.abs(t)<=K?t:e.isNaN()?NaN:e.isFinite()?n._numericValue(e):t>0?1/0:-1/0}if(typeof e=="bigint")return e>=-K&&e<=K?Number(e):n._numericValue(e);if(e instanceof ie)return e.im===0?nu(n,e.re):e.isNaN()?NaN:!e.isFinite()&&e.im===0?e.re>0?1/0:-1/0:n._numericValue({re:e.re,im:e.im});if(typeof e=="object"&&"num"in e){if(typeof e.num=="number")return nu(n,e.num);if(typeof e.num!="string")throw new Error("MathJSON `num` property should be a string of digits");return Lx(n,e.num)}if(typeof e=="string")return Lx(n,e);if(e[1]==0)return NaN;if(typeof e[1]=="number"&&!Number.isFinite(e[1]))return Number.isFinite(e[0])?0:NaN;if(typeof e[0]=="number"&&!Number.isFinite(e[0])){let t=e[0]>0?1:-1;return e[0]>0?t>0?1/0:-1/0:e[0]<0?t>0?-1/0:1/0:NaN}return n._numericValue(e)}function Lx(n,e){if(e=e.toLowerCase(),/[0-9][nd]$/.test(e)&&(e=e.slice(0,-1)),e=e.replace(/[\u0009-\u000d\u0020\u00a0]/g,""),e==="nan")return NaN;if(e==="infinity"||e==="+infinity"||e==="oo"||e==="+oo")return Number.POSITIVE_INFINITY;if(e==="-infinity"||e==="-oo")return Number.NEGATIVE_INFINITY;if(e==="0")return 0;if(e==="1")return 1;if(e==="-1")return-1;if(/\([0-9]+\)/.test(e)){let[i,r,o,s]=e.match(/(.+)\(([0-9]+)\)(.+)?$/)??[];e=r+o.repeat(Math.ceil(n.precision/o.length))+(s??"")}let t=be(e);return t!==null?t>=-K&&t<=K?Number(t):n._numericValue(t):n._numericValue(n.bignum(e))}Da();di();an();In();Tn();kn();cn();oi();Go();lt();me();ii();tn();Ye();io();var mr=class extends ue{_hash;_id;_def;constructor(e,t,i){super(e,i?.metadata),ze(t),`${t}${jn(t)}`,this._id=t,this._def=i?.def}get json(){return Bn(this._id)?this._id:{sym:this._id}}get hash(){return this._hash??=Hn(this._id),this._hash}get isPure(){return!0}get isConstant(){let e=this._def;return(re(e)&&e?.value.isConstant)??!1}bind(){}reset(){}get isCanonical(){return this._def!==void 0}set isCanonical(e){throw new Error("Setting the isCanonical property is not allowed. Use the canonical() method instead.")}get canonical(){return this._def?this:this.engine.symbol(this._id)}is(e){return e===!0?this.symbol==="True"||this.value?.symbol==="True":e===!1?this.symbol==="False"||this.value?.symbol==="False":e instanceof ue&&e.symbol?this.symbol===e.symbol:this.value?.is(e instanceof ue?e.value:e)??!1}toNumericValue(){this.isCanonical;let e=this.engine;return this.symbol==="ImaginaryUnit"?[e._numericValue({re:0,im:1}),e.One]:this.symbol==="PositiveInfinity"||this.isInfinity&&this.isPositive?[e._numericValue(1/0),e.One]:this.symbol==="NegativeInfinity"||this.isInfinity&&this.isNegative?[e._numericValue(-1/0),e.One]:this.symbol==="NaN"?[e._numericValue(NaN),e.One]:[e._numericValue(1),this]}neg(){return Yi(this)}inv(){return this.engine._fn("Divide",[this.engine.One,this])}abs(){return this.isNonNegative?this:this.isNonPositive?this.neg():this.engine._fn("Abs",[this])}add(e){return e===0?this:X(this,this.engine.box(e))}mul(e){if(e===1)return this;if(e===-1)return this.neg();if(e===0&&!this.isNaN)return this.engine.Zero;if(e instanceof ae){if(e.isOne)return this;if(e.isNegativeOne)return this.neg();if(e.isZero&&!this.isNaN)return this.engine.Zero}return pe(this,this.engine.box(e))}div(e){return zr(this,e)}pow(e){return Oe(this,e,{numericApproximation:!1})}root(e){let t=typeof e=="number"?e:e.im===0?e.re:void 0,i=this.engine;return this.symbol==="ComplexInfinity"||t===0?i.NaN:t===1?this:t===2?this.sqrt():t===-1?this.inv():i._fn("Root",[this,i.box(e)])}sqrt(){let e=this.engine;return this.symbol==="ComplexInfinity"?e.NaN:this.is(0)?this:this.is(1)?this.engine.One:this.is(-1)?e.I:e._fn("Sqrt",[this])}ln(e){let t=e?this.engine.box(e):void 0;return this.is(0)?this.engine.NegativeInfinity:this.symbol==="ExponentialE"?!t||t.symbol==="ExponentialE"?this.engine.One:this.engine.One.div(t.ln()):t?t.re===10?this.engine._fn("Log",[this]):this.engine._fn("Log",[this,t]):this.engine._fn("Ln",[this])}solve(e){let t=as(e);return t.length!==1?null:t.includes(this.symbol)?[this.engine.Zero]:null}get complexity(){return 7}get operator(){return"Symbol"}get symbol(){return this._id}get baseDefinition(){return this.valueDefinition??this.operatorDefinition}get valueDefinition(){if(re(this._def))return this._def.value}get operatorDefinition(){if(le(this._def))return this._def.operator}infer(e,t="narrow"){if(!this._def)return!1;let i=this._def;if(re(i))return i.value.inferredType||i.value.type.isUnknown?(i.value.isConstant,i.value.type=this.engine.type(t==="widen"?ve(i.value.type.type,e):Vi(i.value.type.type,e)),!0):!1;if(le(i)){let r=this.engine.type(t==="widen"?ve(i.operator.signature.type,e):Vi(i.operator.signature.type,e));return r.matches("function")?(i.operator.signature=r,!0):(delete i.operator,i.value={value:{type:r}},!0)}return!1}get _value(){if(!(!this._def||le(this._def)))return this._def.value.isConstant?this._def.value.value:this.engine._getSymbolValue(this._id)}get value(){return le(this._def)?this.engine._fn("Operator",[this.engine.string(this._id)]):this._value}set value(e){if(!this._def)throw new Error(`Cannot set value of non-canonical ${this._id}`);let t=this.engine;t.forget(this._id);let i;if(typeof e=="boolean"&&(e=e?t.True:t.False),typeof e=="string"&&(e=t.string(e)),typeof e=="object")if("re"in e&&"im"in e)e=t.complex(e.re??0,e.im);else if("num"in e&&"denom"in e)e=t.number([e.num,e.denom]);else if(Array.isArray(e))e=t._fn("List",e.map(r=>t.box(r)));else throw new Error(`Invalid value for symbol ${this._id}: ${e}`);if(e!==void 0&&(i=t.box(e).evaluate()),i?.type.matches("function")){delete this._def.value,this._def.operator={signature:i.type,evaluate:i};return}if(re(this._def)&&this._def.value.isConstant)throw new Error(`The value of the constant "${this._id}" cannot be changed`);t._setSymbolValue(this._id,i)}get type(){let e=this._def;return re(e)?e.value.type:le(e)?e.operator.signature:R.unknown}set type(e){if(!this._def)throw new Error(`Cannot set type of non-canonical symbol "${this._id}"`);if(this._id[0]==="_")throw new Error(`The type of the wildcard "${this._id}" cannot be changed`);this.engine.forget(this._id),typeof e=="string"?e=F(e):e instanceof R&&(e=e.type),e==="function"||Hs(e)?le(this._def)?this._def.operator.signature=e:(delete this._def.value,this._def.operator={signature:e}):le(this._def)?(delete this._def.operator,this._def.value={type:e}):this._def.value.type=e}has(e){return typeof e=="string"?this._id===e:e.includes(this._id)}match(e,t){return mo(this,e,t)}get shape(){let e=this.type.type;return typeof e=="object"&&e.kind==="list"&&e.dimensions?e.dimensions:[]}get rank(){return this.shape.length}get sgn(){return this.value?this.value.sgn:sc(this.engine,this.symbol)}get isOdd(){return this.value?.isOdd}get isEven(){return this.value?.isEven}get isFinite(){return this.value?.isFinite}get isInfinity(){return this.value?.isInfinity}get isNaN(){return this.value?.isNaN}get isPositive(){return go(this.sgn)}get isNonPositive(){return yo(this.sgn)}get isNegative(){return xo(this.sgn)}get isNonNegative(){return ho(this.sgn)}get isFunction(){if(!this.type.isUnknown)return this.type.matches("function")}get isNumber(){let e=this.type;if(!e.isUnknown)return e.matches("number")}get isInteger(){let e=this.type;if(!e.isUnknown)return e.matches("integer")}get isRational(){let e=this.type;if(!e.isUnknown)return e.matches("rational")}get isReal(){let e=this.type;if(!e.isUnknown)return e.matches("real")}get re(){return this.value?.re??NaN}get im(){return this.value?.im??NaN}get bignumRe(){return this.value?.bignumRe}get bignumIm(){return this.value?.bignumIm}simplify(e){return mt(this,e).at(-1)?.value??this}evaluate(e){let t=this.valueDefinition;if(!t)return this;let i=t.holdUntil;if(t.isConstant){if(e?.numericApproximation){if(i==="never"||i==="evaluate"||i==="N")return t.value?.N()??this}else if(i==="never"||i==="evaluate")return t.value?.evaluate(e)??this}else if(i==="never"||i==="evaluate"||i==="N"&&e?.numericApproximation){let r=this.engine._getSymbolValue(this._id)??this;return r.operator==="Unevaluated"&&(r=r.evaluate(e)??this),r}return this}N(){let e=this.valueDefinition;if(e&&e.holdUntil==="never")return this;if(e&&!e.isConstant){let t=this.engine._getSymbolValue(this._id);if(t)return t.N()}return e?.value?.N()??this}replace(e,t){return ri(this,e,t).at(-1)?.value??null}subs(e,t){let i=t?.canonical??this.isCanonical;return e[this._id]===void 0?i?this.canonical:this:this.engine.box(e[this._id],{canonical:i})}get _asCollection(){if(re(this._def))return this._def.value.collection}get isCollection(){return this._asCollection?.iterator!==void 0||(this._value?.isCollection??!1)}get isIndexedCollection(){return this._asCollection?.at!==void 0||(this._value?.isIndexedCollection??!1)}get isLazyCollection(){return this._asCollection?.isLazy?.(this._value??this)??this._value?.isLazyCollection??!1}contains(e){return this._asCollection?.contains?.(this._value??this,e)??this._value?.contains?.(e)}get count(){return this._asCollection?.count(this._value??this)??this._value?.count??0}get isEmptyCollection(){return this._asCollection?.isEmpty?.(this._value??this)??this._value?.isEmptyCollection??this.count===0}get isFiniteCollection(){return this._asCollection?.isFinite?.(this._value??this)??this._value?.isFiniteCollection??isFinite(this.count)}each(){let e=this._asCollection?.iterator?.(this._value??this);return e?(function*(){let t=e.next();for(;!t.done;)yield t.value,t=e.next()})():this._value?.each()??(function*(){})()}at(e){return this._asCollection?.at?.(this._value??this,e)??this._value?.at?.(e)}get(e){return this._value?.get?.(e)}indexWhere(e){return this._asCollection?.indexWhere?this._asCollection.indexWhere(this._value??this,e):this._value?.indexWhere(e)}subsetOf(e,t){return this._asCollection?.subsetOf?.(this._value??this,e,t)??this._value?.subsetOf?.(e,t)??!1}};to();Dl();cn();Ni();tn();en();Pn();Ki();function qx(n){if(n.operator!=="Sum")return;let e=n.op1,t=n.op2;if(!e||!t||t.operator!=="Limits")return;let i=t.op1?.symbol,r=t.op2,o=t.op3;if(!i||!r||!o)return;let s=n.engine;if(e.operator==="Sum"||e.operator==="Product"){let u=e.simplify();if(!u.isSame(e))return{value:s.function("Sum",[u,t]),because:"simplified nested sum/product"}}if(r.isNumberLiteral&&o.isNumberLiteral){let u=r.numericValue,l=o.numericValue;if(typeof u=="number"&&typeof l=="number"&&Number.isInteger(u)&&Number.isInteger(l)){if(l<u)return{value:s.Zero,because:"empty sum"};if(l===u)return{value:e.subs({[i]:r}).simplify(),because:"single term sum"}}}if(!new Set(e.unknowns).has(i)){let u=o.sub(r).add(s.One).simplify();return u.isNumberLiteral&&u.numericValue!==null&&(typeof u.numericValue=="number"?u.numericValue:u.numericValue.re)<=0?{value:s.Zero,because:"empty sum"}:{value:u.mul(e.simplify()),because:"sum of constant"}}if(e.symbol===i){let u=r,l=o;return{value:l.mul(l.add(s.One)).sub(u.mul(u.sub(s.One))).div(2).simplify(),because:"triangular number"}}if(e.operator==="Power"&&e.op1?.symbol===i&&e.op2?.is(2)&&r.is(1)){let u=o;return{value:u.mul(u.add(s.One)).mul(u.mul(2).add(s.One)).div(6),because:"sum of squares"}}if(e.operator==="Power"&&e.op1?.symbol===i&&e.op2?.is(3)&&r.is(1)){let u=o;return{value:u.mul(u.add(s.One)).div(2).pow(2),because:"sum of cubes"}}if(e.operator==="Power"&&e.op1?.is(-1)&&e.op2?.symbol===i&&r.is(0)){let u=o;return{value:s.One.add(s.number(-1).pow(u)).div(2),because:"alternating unit series"}}if(e.operator==="Multiply"&&e.ops&&r.is(0)){let u=!1,l=!1;for(let c of e.ops)c.operator==="Power"&&c.op1?.is(-1)&&c.op2?.symbol===i?u=!0:c.symbol===i&&(l=!0);if(u&&l&&e.ops.length===2){let c=o;return{value:s.function("Multiply",[s.function("Power",[s.number(-1),c]),s.function("Floor",[s.function("Divide",[s.function("Add",[c,s.One]),s.number(2)])])]),because:"alternating linear series"}}}if(e.operator==="Add"&&e.ops){let u=null,l=null;for(let c of e.ops)if(!new Set(c.unknowns).has(i))u=u?u.add(c):c;else if(c.symbol===i)l=l?l.add(s.One):s.One;else if(c.operator==="Multiply"&&c.ops?.some(p=>p.symbol===i)){let p=c.ops.filter(d=>d.symbol!==i);if(p.length===c.ops.length-1){let d=p.length===1?p[0]:s.function("Multiply",p);l=l?l.add(d):d}}else{u=null,l=null;break}if(u!==null&&l!==null){let c=r,f=o;if(r.is(0)){let p=s.function("Add",[f,s.One]),d=s.function("Add",[u,s.function("Divide",[s.function("Multiply",[l,f]),s.number(2)])]);return{value:s.function("Multiply",[p,d]),because:"arithmetic progression"}}else{let p=s.function("Add",[s.function("Subtract",[f,c]),s.One]),d=s.function("Divide",[s.function("Add",[c,f]),s.number(2)]),m=s.function("Add",[u,s.function("Multiply",[l,d])]);return{value:s.function("Multiply",[p,m]),because:"arithmetic progression"}}}}if(e.operator==="Power"&&e.op2?.symbol===i&&!new Set(e.op1?.unknowns??[]).has(i)){let u=e.op1,l=o;if(r.is(0)){let c=s.One.sub(u.pow(l.add(s.One))),f=s.One.sub(u);return{value:c.div(f),because:"geometric series"}}else if(r.is(1)){let c=u.sub(u.pow(l.add(s.One))),f=s.One.sub(u);return{value:c.div(f),because:"geometric series"}}}if(e.operator==="Binomial"&&r.is(0)&&e.op2?.symbol===i){let u=e.op1;if(u&&o.isSame(u))return{value:s.function("Power",[s.number(2),u]),because:"sum of binomial coefficients"}}if(e.operator==="Multiply"&&e.ops&&r.is(0)){let u=!1,l=!1,c=null;for(let h of e.ops)h.operator==="Binomial"&&h.op2?.symbol===i?(u=!0,c=h.op1??null):h.operator==="Power"&&h.op1?.is(-1)&&h.op2?.symbol===i&&(l=!0);if(u&&l&&c&&o.isSame(c))return{value:s.Zero,because:"alternating binomial sum"};let f=!1;c=null,u=!1;for(let h of e.ops)h.symbol===i?f=!0:h.operator==="Binomial"&&h.op2?.symbol===i&&(u=!0,c=h.op1??null);if(f&&u&&c&&o.isSame(c)&&e.ops.length===2){let h=c;return{value:s.function("Multiply",[h,s.function("Power",[s.number(2),h.sub(s.One)])]),because:"weighted binomial sum"}}let p=!1;c=null,u=!1;for(let h of e.ops)h.operator==="Power"&&h.op1?.symbol===i&&h.op2?.is(2)?p=!0:h.operator==="Binomial"&&h.op2?.symbol===i&&(u=!0,c=h.op1??null);if(p&&u&&c&&o.isSame(c)&&e.ops.length===2){let h=c;return{value:s.function("Multiply",[h,h.add(s.One),s.function("Power",[s.number(2),h.sub(s.number(2))])]),because:"weighted squared binomial sum"}}let d=!1;c=null,u=!1;for(let h of e.ops)h.operator==="Power"&&h.op1?.symbol===i&&h.op2?.is(3)?d=!0:h.operator==="Binomial"&&h.op2?.symbol===i&&(u=!0,c=h.op1??null);if(d&&u&&c&&o.isSame(c)&&e.ops.length===2){let h=c;return{value:s.function("Multiply",[s.function("Power",[h,s.number(2)]),h.add(s.number(3)),s.function("Power",[s.number(2),h.sub(s.number(3))])]),because:"weighted cubed binomial sum"}}let m=!1,g=!1;c=null,u=!1;for(let h of e.ops)h.operator==="Power"&&h.op1?.is(-1)&&h.op2?.symbol===i?m=!0:h.symbol===i?g=!0:h.operator==="Binomial"&&h.op2?.symbol===i&&(u=!0,c=h.op1??null);if(m&&g&&u&&c&&o.isSame(c)&&e.ops.length===3)return{value:s.Zero,because:"alternating weighted binomial sum"}}if(e.operator==="Power"&&e.op1?.operator==="Binomial"&&e.op2?.is(2)&&r.is(0)){let u=e.op1,l=u.op1,c=u.op2;if(l&&c?.symbol===i&&o.isSame(l))return{value:s.function("Binomial",[s.function("Multiply",[s.number(2),l]),l]),because:"sum of binomial squares"}}if(e.operator==="Multiply"&&e.ops?.length===2&&r.is(1)){let[u,l]=e.ops;if(u.symbol===i&&l.operator==="Add"&&l.ops?.length===2&&l.ops.some(f=>f.symbol===i)&&l.ops.some(f=>f.is(1))||l.symbol===i&&u.operator==="Add"&&u.ops?.length===2&&u.ops.some(f=>f.symbol===i)&&u.ops.some(f=>f.is(1))){let f=o;return{value:s.function("Divide",[s.function("Multiply",[f,s.function("Add",[f,s.One]),s.function("Add",[f,s.number(2)])]),s.number(3)]),because:"sum of k*(k+1)"}}}if(e.operator==="Divide"&&e.op1?.is(1)&&e.op2?.operator==="Multiply"){let u=e.op2;if(u.ops?.length===2){let[l,c]=u.ops;if(r.is(1)&&(l.symbol===i&&c.operator==="Add"&&c.ops?.length===2&&c.ops.some(p=>p.symbol===i)&&c.ops.some(p=>p.is(1))||c.symbol===i&&l.operator==="Add"&&l.ops?.length===2&&l.ops.some(p=>p.symbol===i)&&l.ops.some(p=>p.is(1)))){let p=o;return{value:p.div(p.add(s.One)),because:"partial fractions (telescoping)"}}if(r.is(2)&&(l.symbol===i&&c.operator==="Add"&&c.ops?.length===2&&c.ops.some(p=>p.symbol===i)&&c.ops.some(p=>p.is(-1))||c.symbol===i&&l.operator==="Add"&&l.ops?.length===2&&l.ops.some(p=>p.symbol===i)&&l.ops.some(p=>p.is(-1)))){let p=o;return{value:p.sub(s.One).div(p),because:"partial fractions (telescoping k*(k-1))"}}}}if(e.operator==="Multiply"&&e.ops){let u=[],l=[];for(let c of e.ops)new Set(c.unknowns).has(i)?l.push(c):u.push(c);if(u.length>0&&l.length>0){let c=u.length===1?u[0]:s.function("Multiply",u),f=l.length===1?l[0]:s.function("Multiply",l),p=s.function("Sum",[f,t]);return{value:c.mul(p),because:"factor out constant from sum"}}}}function Fx(n){if(n.operator!=="Product")return;let e=n.op1,t=n.op2;if(!e||!t||t.operator!=="Limits")return;let i=t.op1?.symbol,r=t.op2,o=t.op3;if(!i||!r||!o)return;let s=n.engine;if(e.operator==="Sum"||e.operator==="Product"){let u=e.simplify();if(!u.isSame(e))return{value:s.function("Product",[u,t]),because:"simplified nested sum/product"}}if(r.isNumberLiteral&&o.isNumberLiteral){let u=r.numericValue,l=o.numericValue;if(typeof u=="number"&&typeof l=="number"&&Number.isInteger(u)&&Number.isInteger(l)){if(l<u)return{value:s.One,because:"empty product"};if(l===u)return{value:e.subs({[i]:r}).simplify(),because:"single term product"}}}if(!new Set(e.unknowns).has(i)){let u=o.sub(r).add(s.One).simplify();return u.isNumberLiteral&&u.numericValue!==null&&(typeof u.numericValue=="number"?u.numericValue:u.numericValue.re)<=0?{value:s.One,because:"empty product"}:{value:e.simplify().pow(u),because:"product of constant"}}if(e.symbol===i&&r.is(1))return{value:s.function("Factorial",[o]),because:"factorial"};if(e.operator==="Add"&&e.ops?.length===2&&r.is(1)){let[u,l]=e.ops,c=null,f=null;if(u.symbol===i&&!new Set(l.unknowns).has(i)?(c=u,f=l):l.symbol===i&&!new Set(u.unknowns).has(i)&&(c=l,f=u),c&&f){let p=o,d=f;return{value:s.function("Divide",[s.function("Factorial",[s.function("Add",[p,d])]),s.function("Factorial",[d])]),because:"shifted factorial"}}}if(e.operator==="Divide"&&r.is(1)){let u=e.op1;if(e.op2?.symbol===i&&u?.operator==="Add"&&u.ops?.length===2&&u.ops.some(c=>c.symbol===i)&&u.ops.some(c=>c.is(1)))return{value:o.add(s.One),because:"telescoping product"}}if(e.operator==="Add"&&e.ops?.length===2&&r.is(2)){let u=!1,l=!1;for(let c of e.ops)c.is(1)?u=!0:c.operator==="Negate"&&c.op1?.operator==="Power"&&c.op1.op1?.symbol===i&&c.op1.op2?.is(-2)?l=!0:c.operator==="Power"&&c.op1?.symbol===i&&c.op2?.is(-2)||c.operator==="Multiply"&&c.ops?.some(f=>f.is(-1))&&c.ops?.some(f=>f.operator==="Power"&&f.op1?.symbol===i&&f.op2?.is(-2))&&(l=!0);if(u&&l){let c=o;return{value:s.function("Divide",[s.function("Add",[c,s.One]),s.function("Multiply",[s.number(2),c])]),because:"Wallis-like product"}}}if(e.operator==="Add"&&e.ops?.length===2&&r.is(1)){let[u,l]=e.ops,c=!1,f=0,p=0;for(let d of e.ops)if(d.isNumberLiteral&&typeof d.numericValue=="number")p=d.numericValue;else if(d.operator==="Multiply"&&d.ops?.length===2){let[m,g]=d.ops;m.isNumberLiteral&&typeof m.numericValue=="number"&&g.symbol===i?(f=m.numericValue,c=!0):g.isNumberLiteral&&typeof g.numericValue=="number"&&m.symbol===i&&(f=g.numericValue,c=!0)}if(c&&f===2&&p===-1){let d=o;return{value:s.function("Factorial2",[s.function("Subtract",[s.function("Multiply",[s.number(2),d]),s.One])]),because:"odd double factorial"}}}if(e.operator==="Multiply"&&e.ops?.length===2&&r.is(1)){let[u,l]=e.ops;if(u.is(2)&&l.symbol===i||l.is(2)&&u.symbol===i){let c=o;return{value:s.function("Multiply",[s.function("Power",[s.number(2),c]),s.function("Factorial",[c])]),because:"even double factorial"}}}if(e.operator==="Add"&&e.ops?.length===2&&r.is(0)){let u=null,l=!1;for(let c of e.ops)c.symbol===i?l=!0:new Set(c.unknowns).has(i)||(u=c);if(l&&u){let c=o.add(s.One).simplify();return{value:s.function("Pochhammer",[u,c]),because:"rising factorial (Pochhammer)"}}}if(r.is(0)){let u=null,l=!1;if(e.operator==="Subtract"&&e.ops?.length===2){let[c,f]=e.ops;f.symbol===i&&!new Set(c.unknowns).has(i)&&(u=c,l=!0)}else if(e.operator==="Add"&&e.ops?.length===2)for(let c of e.ops)c.operator==="Negate"&&c.op1?.symbol===i?l=!0:new Set(c.unknowns).has(i)||(u=c);if(l&&u){let c=o.add(s.One).simplify();return{value:s.function("Divide",[s.function("Factorial",[u]),s.function("Factorial",[u.sub(c)])]),because:"falling factorial"}}}if(e.operator==="Multiply"&&e.ops){let u=[],l=[];for(let c of e.ops)new Set(c.unknowns).has(i)?l.push(c):u.push(c);if(u.length>0&&l.length>0){let c=u.length===1?u[0]:s.function("Multiply",u),f=l.length===1?l[0]:s.function("Multiply",l),p=o.sub(r).add(s.One).simplify(),d=s.function("Product",[f,t]);return{value:c.pow(p).mul(d),because:"factor out constant from product"}}}}var Yv=new Set(["Sin","Tan","Cot","Csc","Arcsin","Arctan","Arccot","Arccsc"]),Qv=new Set(["Sinh","Tanh","Coth","Csch","Arsinh","Artanh","Arcoth","Arcsch"]),Xv=new Set(["Cos","Sec","Cosh","Sech"]);function Vx(n){if(n.operator!=="Abs")return;let e=n.op1;if(!e)return;let t=n.engine;if(e.isNonNegative===!0)return{value:e,because:"|x| -> x"};if(e.isNonPositive===!0)return{value:e.neg(),because:"|x| -> -x"};let i=e.operator;if(i==="Negate")return{value:t._fn("Abs",[e.op1]),because:"|-x| -> |x|"};if(i==="Multiply"&&e.ops){let r=e.ops;for(let o=0;o<r.length;o++){let s=r[o];if(s.isNonNegative===!0){let a=r.filter((l,c)=>c!==o),u=a.length===1?a[0]:t._fn("Multiply",a);return{value:s.mul(t._fn("Abs",[u])),because:"|xy| -> x|y| when x >= 0"}}if(s.isNonPositive===!0){let a=r.filter((l,c)=>c!==o),u=a.length===1?a[0]:t._fn("Multiply",a);return{value:s.neg().mul(t._fn("Abs",[u])),because:"|xy| -> -x|y| when x <= 0"}}}if(r.length===2)return{value:t._fn("Abs",[r[0]]).mul(t._fn("Abs",[r[1]])),because:"|xy| -> |x||y|"}}if(i==="Divide"){let r=e.op1,o=e.op2;if(r&&o)return r.isNonNegative===!0?{value:r.div(t._fn("Abs",[o])),because:"|x/y| -> x/|y| when x >= 0"}:r.isNonPositive===!0?{value:r.neg().div(t._fn("Abs",[o])),because:"|x/y| -> -x/|y| when x <= 0"}:o.isNonNegative===!0?{value:t._fn("Abs",[r]).div(o),because:"|x/y| -> |x|/y when y >= 0"}:o.isNonPositive===!0?{value:t._fn("Abs",[r]).neg().div(o),because:"|x/y| -> -|x|/y when y <= 0"}:{value:t._fn("Abs",[r]).div(t._fn("Abs",[o])),because:"|x/y| -> |x|/|y|"}}if(i==="Power"){let r=e.op1,o=e.op2;if(r&&o){if(o.isEven===!0)return{value:r.pow(o),because:"|x^n| -> x^n when n is even"};if(o.isOdd===!0)return{value:t._fn("Abs",[r]).pow(o),because:"|x^n| -> |x|^n when n is odd"};if(o.isRational===!1)return{value:t._fn("Abs",[r]).pow(o),because:"|x^n| -> |x|^n when n is irrational"};if(o.isRational===!0&&o.isInteger===!1){let s=o.numerator;if(s){if(s.isEven===!0)return{value:r.pow(o),because:"|x^(p/q)| -> x^(p/q) when p is even"};if(s.isOdd===!0)return{value:t._fn("Abs",[r]).pow(o),because:"|x^(p/q)| -> |x|^(p/q) when p is odd"}}}}}if(Yv.has(i)||Qv.has(i)){let r=e.op1;if(r)return{value:t._fn(i,[t._fn("Abs",[r])]),because:`|${i}(x)| -> ${i}(|x|) (odd function)`}}}function $x(n){if(n.operator!=="Power")return;let e=n.op1,t=n.op2;if(!e||!t||e.operator!=="Abs")return;let i=e.op1;if(i){if(t.isEven===!0)return{value:i.pow(t),because:"|x|^n -> x^n when n is even"};if(t.operator==="Divide"){let r=t.op1,o=t.op2;if(r&&o&&r.isEven===!0&&o.isOdd===!0)return{value:i.pow(t),because:"|x|^(n/m) -> x^(n/m) when n even, m odd"}}}}function jx(n){let e=n.operator;if(!Xv.has(e))return;let t=n.op1;if(!t||t.operator!=="Abs")return;let i=t.op1;if(i)return{value:n.engine._fn(e,[i]),because:`${e}(|x|) -> ${e}(x) (even function)`}}function Ux(n){let e=n.operator,t=n.engine;if(e==="Multiply"&&n.ops&&n.ops.length===2){let[i,r]=n.ops,o=i.isInfinity===!0,s=r.isInfinity===!0,a=o&&i.isPositive===!0,u=o&&i.isNegative===!0,l=s&&r.isPositive===!0,c=s&&r.isNegative===!0;if(i.is(0)&&s)return{value:t.NaN,because:"0 * infinity -> NaN"};if(r.is(0)&&o)return{value:t.NaN,because:"infinity * 0 -> NaN"};if(i.is(0)&&r.isFinite===!0)return{value:t.Zero,because:"0 * finite -> 0"};if(r.is(0)&&i.isFinite===!0)return{value:t.Zero,because:"finite * 0 -> 0"};if(a){if(r.isPositive===!0)return{value:t.PositiveInfinity,because:"+inf * positive -> +inf"};if(r.isNegative===!0)return{value:t.NegativeInfinity,because:"+inf * negative -> -inf"}}if(c){if(i.isPositive===!0)return{value:t.NegativeInfinity,because:"positive * -inf -> -inf"};if(i.isNegative===!0)return{value:t.PositiveInfinity,because:"negative * -inf -> +inf"}}if(u){if(r.isPositive===!0)return{value:t.NegativeInfinity,because:"-inf * positive -> -inf"};if(r.isNegative===!0)return{value:t.PositiveInfinity,because:"-inf * negative -> +inf"}}if(l){if(i.isPositive===!0)return{value:t.PositiveInfinity,because:"positive * +inf -> +inf"};if(i.isNegative===!0)return{value:t.NegativeInfinity,because:"negative * +inf -> -inf"}}}if(e==="Divide"){let i=n.op1,r=n.op2;if(i&&r){let o=i.isInfinity===!0,s=r.isInfinity===!0,a=o&&i.isPositive===!0,u=o&&i.isNegative===!0;if(o&&s)return{value:t.NaN,because:"inf / inf -> NaN"};if(a){if(r.isPositive===!0&&r.isFinite===!0)return{value:t.PositiveInfinity,because:"+inf / positive -> +inf"};if(r.isNegative===!0&&r.isFinite===!0)return{value:t.NegativeInfinity,because:"+inf / negative -> -inf"}}if(u){if(r.isPositive===!0&&r.isFinite===!0)return{value:t.NegativeInfinity,because:"-inf / positive -> -inf"};if(r.isNegative===!0&&r.isFinite===!0)return{value:t.PositiveInfinity,because:"-inf / negative -> +inf"}}}}if(e==="Exp"){let i=n.op1;if(i){if(i.symbol==="PositiveInfinity")return{value:t.PositiveInfinity,because:"exp(+inf) -> +inf"};if(i.symbol==="NegativeInfinity")return{value:t.Zero,because:"exp(-inf) -> 0"}}}if(e==="Power"){let i=n.op1,r=n.op2;if(i&&r){let o=i.isInfinity===!0,s=r.isInfinity===!0,a=o&&i.isPositive===!0,u=o&&i.isNegative===!0,l=s&&r.isPositive===!0,c=s&&r.isNegative===!0;if(i.symbol==="ExponentialE"&&l)return{value:t.PositiveInfinity,because:"e^(+inf) -> +inf"};if(i.symbol==="ExponentialE"&&c)return{value:t.Zero,because:"e^(-inf) -> 0"};if(i.is(1)&&r.isFinite===!0)return{value:t.One,because:"1^finite -> 1"};if(r.is(0)&&o)return{value:t.NaN,because:"inf^0 -> NaN"};if(r.is(0)&&i.is(0)===!1&&i.isFinite===!0)return{value:t.One,because:"x^0 -> 1"};if(l){if(i.isGreater(1)===!0)return{value:t.PositiveInfinity,because:"a^+inf -> +inf when a > 1"};if(i.isPositive===!0&&i.isLess(1)===!0)return{value:t.Zero,because:"a^+inf -> 0 when 0 < a < 1"}}if(c){if(i.isGreater(1)===!0)return{value:t.Zero,because:"a^-inf -> 0 when a > 1"};if(i.isPositive===!0&&i.isLess(1)===!0)return{value:t.PositiveInfinity,because:"a^-inf -> +inf when 0 < a < 1"}}if(a&&r.isNegative===!0)return{value:t.Zero,because:"+inf^negative -> 0"};if(u){if(r.isNegative===!0)return{value:t.Zero,because:"-inf^negative -> 0"};if(r.isInteger===!0&&r.isEven===!0)return{value:t.PositiveInfinity,because:"(-inf)^(even integer) -> +inf"};if(r.isInteger===!0&&r.isOdd===!0)return{value:t.NegativeInfinity,because:"(-inf)^(odd integer) -> -inf"};if(r.isRational===!0){let[f,p]=r.numeratorDenominator,d=f.re,m=p.re;if(typeof d=="number"&&typeof m=="number"&&Number.isInteger(d)&&Number.isInteger(m)){let g=d%2===0,h=d%2!==0,x=m%2!==0;if(g&&x)return{value:t.PositiveInfinity,because:"(-inf)^(even/odd) -> +inf"};if(h&&x)return{value:t.NegativeInfinity,because:"(-inf)^(odd/odd) -> -inf (real)"}}}}}}}function Gx(n){let e=n.operator,t=n.engine;if(e==="Ln"){let i=n.op1;if(!i)return;if(i.is(0))return{value:t.NaN,because:"ln(0) -> NaN"};if(i.symbol==="PositiveInfinity")return{value:t.PositiveInfinity,because:"ln(+inf) -> +inf"};if(i.operator==="Power"){let r=i.op1,o=i.op2;if(r&&o){if(r.isNonNegative===!0||o.isOdd===!0||o.isRational===!1)return{value:o.mul(t._fn("Ln",[r])),because:"ln(x^n) -> n*ln(x)"};if(o.isEven===!0)return{value:o.mul(t._fn("Ln",[t._fn("Abs",[r])])),because:"ln(x^n) -> n*ln(|x|) when n even"}}}if(i.operator==="Power"&&i.op1?.symbol==="ExponentialE")return{value:i.op2,because:"ln(e^x) -> x"};if(i.operator==="Multiply"&&i.ops)for(let r=0;r<i.ops.length;r++){let o=i.ops[r];if(o.operator==="Power"&&o.op1?.symbol==="ExponentialE"){let s=o.op2,a=i.ops.filter((l,c)=>c!==r),u=a.length===1?a[0]:t._fn("Multiply",a);return{value:s.add(t._fn("Ln",[u])),because:"ln(e^x * y) -> x + ln(y)"}}}if(i.operator==="Divide"&&i.op1?.operator==="Power"&&i.op1.op1?.symbol==="ExponentialE")return{value:i.op1.op2.sub(t._fn("Ln",[i.op2])),because:"ln(e^x / y) -> x - ln(y)"};if(i.operator==="Divide"&&i.op1&&i.op2){let r=i.op1,o=i.op2;if(r.isPositive===!0&&o.isPositive===!0)return{value:t._fn("Ln",[r]).sub(t._fn("Ln",[o])),because:"ln(x/y) -> ln(x) - ln(y)"}}if(i.operator==="Divide"&&i.op2?.operator==="Power"&&i.op2.op1?.symbol==="ExponentialE")return{value:t._fn("Ln",[i.op1]).sub(i.op2.op2),because:"ln(y / e^x) -> ln(y) - x"}}if(e==="Log"){let i=n.op1,r=n.op2;if(!i)return;let o=!r||r.symbol==="Nothing"?t.number(10):r;if(o.is(0)||o.is(1))return{value:t.NaN,because:"log base 0 or 1 -> NaN"};if(i.is(0))return{value:t.NaN,because:"log(0) -> NaN"};if(i.isSame(o))return{value:t.One,because:"log_c(c) -> 1"};if(i.symbol==="ExponentialE"&&o.symbol!=="ExponentialE")return{value:t.One.div(t._fn("Ln",[o])),because:"log_c(e) -> 1/ln(c)"};if(i.symbol==="PositiveInfinity"){if(o.isGreater(1)===!0)return{value:t.PositiveInfinity,because:"log_c(+inf) -> +inf when c > 1"};if(o.isLess(1)===!0&&o.isPositive===!0)return{value:t.NegativeInfinity,because:"log_c(+inf) -> -inf when 0 < c < 1"}}if(o.symbol==="PositiveInfinity"&&i.isPositive===!0&&i.is(1)===!1&&i.isFinite===!0)return{value:t.Zero,because:"log_inf(x) -> 0"};if(i.operator==="Power"&&i.op1?.isSame(o))return{value:i.op2,because:"log_c(c^x) -> x"};if(i.operator==="Power"&&i.op1?.symbol==="ExponentialE"&&!o.symbol?.match(/ExponentialE/))return{value:i.op2.div(t._fn("Ln",[o])),because:"log_c(e^x) -> x/ln(c)"};if(i.operator==="Exp"&&i.op1&&!o.symbol?.match(/ExponentialE/))return{value:i.op1.div(t._fn("Ln",[o])),because:"log_c(exp(x)) -> x/ln(c)"};if(i.operator==="Power"){let s=i.op1,a=i.op2;if(s&&a){if(s.isNonNegative===!0||a.isOdd===!0||a.isRational===!1)return{value:a.mul(t._fn("Log",[s,o])),because:"log_c(x^n) -> n*log_c(x)"};if(a.isEven===!0)return{value:a.mul(t._fn("Log",[t._fn("Abs",[s]),o])),because:"log_c(x^n) -> n*log_c(|x|) when n even"}}}if(i.operator==="Multiply"&&i.ops)for(let s=0;s<i.ops.length;s++){let a=i.ops[s];if(a.operator==="Power"&&a.op1?.isSame(o)){let u=a.op2,l=i.ops.filter((f,p)=>p!==s),c=l.length===1?l[0]:t._fn("Multiply",l);return{value:u.add(t._fn("Log",[c,o])),because:"log_c(c^x * y) -> x + log_c(y)"}}}if(i.operator==="Divide"&&i.op1?.operator==="Power"&&i.op1.op1?.isSame(o))return{value:i.op1.op2.sub(t._fn("Log",[i.op2,o])),because:"log_c(c^x / y) -> x - log_c(y)"};if(i.operator==="Divide"&&i.op2?.operator==="Power"&&i.op2.op1?.isSame(o))return{value:t._fn("Log",[i.op1,o]).sub(i.op2.op2),because:"log_c(y / c^x) -> log_c(y) - x"};if(i.operator==="Divide"&&i.op1&&i.op2){let s=i.op1,a=i.op2;if(s.isPositive===!0&&a.isPositive===!0){let u=o.symbol==="Nothing",l=u?t._fn("Log",[s]):t._fn("Log",[s,o]),c=u?t._fn("Log",[a]):t._fn("Log",[a,o]);return{value:l.sub(c),because:"log_c(x/y) -> log_c(x) - log_c(y)"}}}if(o.operator==="Divide"&&o.op1?.is(1))return{value:t._fn("Log",[i,o.op2]).neg(),because:"log_{1/c}(a) -> -log_c(a)"}}if(e==="Power"){let i=n.op1,r=n.op2;if(!i||!r)return;if(i.symbol==="ExponentialE"&&r.operator==="Ln")return{value:r.op1,because:"e^ln(x) -> x"};if(i.symbol==="ExponentialE"&&r.operator==="Log"&&r.op1){let o=r.op2;if(!o||o.symbol==="Nothing"||o.is(10))return{value:r.op1.pow(t.One.div(t._fn("Ln",[t.number(10)]))),because:"e^log(x) -> x^{1/ln(10)}"};if(o&&o.symbol!=="ExponentialE")return{value:r.op1.pow(t.One.div(t._fn("Ln",[o]))),because:"e^log_c(x) -> x^{1/ln(c)}"}}if(i.symbol==="ExponentialE"&&r.operator==="Add"&&r.ops){for(let o=0;o<r.ops.length;o++){let s=r.ops[o];if(s.operator==="Ln"){let a=r.ops.filter((l,c)=>c!==o),u=a.length===0?t.Zero:a.length===1?a[0]:t._fn("Add",a);return{value:s.op1.mul(t._fn("Exp",[u])),because:"e^(ln(x) + y) -> x * e^y"}}}for(let o=0;o<r.ops.length;o++){let s=r.ops[o];if(s.operator!=="Log"||!s.op1)continue;let a=r.ops.filter((p,d)=>d!==o),u=a.length===0?t.Zero:a.length===1?a[0]:t._fn("Add",a),l=s.op2;return{value:(!l||l.symbol==="Nothing"||l.is(10)?s.op1.pow(t.One.div(t._fn("Ln",[t.number(10)]))):l.symbol==="ExponentialE"?s.op1:s.op1.pow(t.One.div(t._fn("Ln",[l])))).mul(i.pow(u)),because:"e^(log_c(x) + y) -> x^{1/ln(c)} * e^y"}}}if(i.symbol==="ExponentialE"&&r.operator==="Multiply"&&r.ops)for(let o=0;o<r.ops.length;o++){let s=r.ops[o];if(s.operator==="Ln"){let a=r.ops.filter((l,c)=>c!==o),u=a.length===1?a[0]:t._fn("Multiply",a);return{value:s.op1.pow(u),because:"e^(ln(x) * y) -> x^y"}}}if(i.symbol==="ExponentialE"&&r.operator==="Divide"&&r.op1?.operator==="Ln")return{value:r.op1.op1.pow(t.One.div(r.op2)),because:"e^(ln(x) / y) -> x^(1/y)"};if(r.operator==="Log"&&r.op2?.isSame(i))return{value:r.op1,because:"c^log_c(x) -> x"};if(r.operator==="Add"&&r.ops)for(let o=0;o<r.ops.length;o++){let s=r.ops[o];if(s.operator==="Log"&&s.op2?.isSame(i)){let a=r.ops.filter((l,c)=>c!==o),u=a.length===0?t.Zero:a.length===1?a[0]:t._fn("Add",a);return{value:s.op1.mul(i.pow(u)),because:"c^(log_c(x) + y) -> x * c^y"}}}if(r.operator==="Multiply"&&r.ops)for(let o=0;o<r.ops.length;o++){let s=r.ops[o];if(s.operator==="Log"&&s.op2?.isSame(i)){let a=r.ops.filter((l,c)=>c!==o),u=a.length===1?a[0]:t._fn("Multiply",a);return{value:s.op1.pow(u),because:"c^(log_c(x) * y) -> x^y"}}}if(r.operator==="Divide"&&r.op1?.operator==="Log"&&r.op1.op2?.isSame(i))return{value:r.op1.op1.pow(t.One.div(r.op2)),because:"c^(log_c(x) / y) -> x^(1/y)"}}if(e==="Add"&&n.ops&&n.ops.length>=2){let i=[],r=new Map;for(let o=0;o<n.ops.length;o++){let s=n.ops[o];if(s.operator==="Ln"&&s.op1)i.push({index:o,arg:s.op1,positive:!0});else if(s.operator==="Negate"&&s.op1?.operator==="Ln"&&s.op1.op1)i.push({index:o,arg:s.op1.op1,positive:!1});else if(s.operator==="Log"&&s.op1&&s.op2){let a=JSON.stringify(s.op2.json);r.has(a)||r.set(a,[]),r.get(a).push({index:o,arg:s.op1,base:s.op2,positive:!0})}else if(s.operator==="Negate"&&s.op1?.operator==="Log"&&s.op1.op1&&s.op1.op2){let a=JSON.stringify(s.op1.op2.json);r.has(a)||r.set(a,[]),r.get(a).push({index:o,arg:s.op1.op1,base:s.op1.op2,positive:!1})}}if(i.length>=2){let o=t.One,s=t.One;for(let c of i)c.positive?o=o.mul(c.arg):s=s.mul(c.arg);let a=o.div(s),u=new Set(i.map(c=>c.index)),l=n.ops.filter((c,f)=>!u.has(f));return l.length===0?{value:t._fn("Ln",[a]),because:"combine ln terms"}:{value:t._fn("Add",[t._fn("Ln",[a]),...l]),because:"combine ln terms"}}for(let[,o]of r)if(o.length>=2){let s=t.One,a=t.One;for(let m of o)m.positive?s=s.mul(m.arg):a=a.mul(m.arg);let u=s.div(a),l=new Set(o.map(m=>m.index)),c=n.ops.filter((m,g)=>!l.has(g)),f=o[0].base,d=f.symbol==="Nothing"?t._fn("Log",[u]):t._fn("Log",[u,f]);return c.length===0?{value:d,because:"combine log terms"}:{value:t._fn("Add",[d,...c]),because:"combine log terms"}}}if(e==="Divide"){let i=n.op1,r=n.op2;if(i&&r){if(i.operator==="Log"&&r.operator==="Log"&&i.op2?.isSame(r.op2))return{value:t._fn("Ln",[i.op1]).div(t._fn("Ln",[r.op1])),because:"log_c(a) / log_c(b) -> ln(a) / ln(b)"};if(i.operator==="Log"&&r.operator==="Ln"&&i.op1?.isSame(r.op1))return{value:t.One.div(t._fn("Ln",[i.op2])),because:"log_c(a) / ln(a) -> 1/ln(c)"};if(i.operator==="Ln"&&r.operator==="Log"&&i.op1?.isSame(r.op1))return{value:t._fn("Ln",[r.op2]),because:"ln(a) / log_c(a) -> ln(c)"}}}}Xe();function zx(n){let e=n.operator,t=n.engine;if(e==="Root"){let i=n.op1,r=n.op2;if(!i||!r)return;if(i.operator==="Sqrt"&&i.op1)return{value:i.op1.pow(t.One.div(t.number(2).mul(r))),because:"root(sqrt(x), n) -> x^{1/(2n)}"};if(i.operator==="Root"&&i.op1&&i.op2){let o=i.op1,s=i.op2;return{value:o.pow(t.One.div(s.mul(r))),because:"root(root(x, m), n) -> x^{1/(m*n)}"}}if(i.operator==="Power"){let o=i.op1,s=i.op2;if(o&&s?.isSame(r)){if(r.isEven===!0)return{value:t._fn("Abs",[o]),because:"root(x^n, n) -> |x| when n even"};if(r.isOdd===!0||o.isNonNegative===!0)return{value:o,because:"root(x^n, n) -> x when n odd"}}if(o&&s){let a=s.div(r);if(r.isEven===!0){if(a.isInteger===!0)return{value:t._fn("Abs",[o]).pow(a),because:"root(x^m, n) -> |x|^{m/n} when m/n is integer"};let u=Qe(a);if(u){let[,l]=u,c=Qe(r);if(c&&Number(l)<Number(c[0]))return{value:t._fn("Abs",[o]).pow(a),because:"root(x^m, n) -> |x|^{m/n}"}}}if(r.isOdd===!0&&s.isInteger===!0)return{value:o.pow(a),because:"root(x^m, n) -> x^{m/n} when n is odd"};if(o.isNonNegative===!0&&a.isInteger===!0)return{value:o.pow(a),because:"root(x^m, n) -> x^{m/n} when x >= 0"}}}}if(e==="Sqrt"){let i=n.op1;if(!i)return;if(i.operator==="Add"){let r=Ua(i);if(r!==null){let s=r.op1;return{value:t._fn("Abs",[s]),because:"sqrt(perfect square trinomial) -> |factor|"}}let o=Ga(i);if(o!==null)return{value:t._fn("Sqrt",[o]),because:"sqrt(a\xB2-b\xB2) -> sqrt((a-b)(a+b))"}}if(i.operator==="Sqrt"&&i.op1)return{value:i.op1.pow(t.number([1,4])),because:"sqrt(sqrt(x)) -> x^{1/4}"};if(i.operator==="Root"&&i.op1&&i.op2){let r=i.op1,o=i.op2;return{value:r.pow(t.One.div(t.number(2).mul(o))),because:"sqrt(root(x, n)) -> x^{1/(2n)}"}}if(i.operator==="Power"){let r=i.op1,o=i.op2;if(r&&o){if(o.is(2)&&r.isNonNegative===!0)return{value:r,because:"sqrt(x^2) -> x when x >= 0"};if(o.is(2))return{value:t._fn("Abs",[r]),because:"sqrt(x^2) -> |x|"};if(o.isEven===!0&&o.isPositive===!0)return{value:t._fn("Abs",[r]).pow(o.div(2)),because:"sqrt(x^{2n}) -> |x|^n"};if(o.isOdd===!0&&o.isInteger===!0&&o.isPositive===!0){let s=o.sub(t.One).div(2);if(s.isPositive===!0)return{value:t._fn("Abs",[r]).pow(s).mul(t._fn("Sqrt",[r])),because:"sqrt(x^{2n+1}) -> |x|^n * sqrt(x)"}}}}if(i.operator==="Multiply"&&i.ops){let r=[],o=[];for(let s of i.ops)if(s.operator==="Power"&&s.op1&&s.op2){let a=s.op1,u=s.op2;if(u.is(2))r.push(t._fn("Abs",[a]));else if(u.isEven===!0&&u.isPositive===!0)r.push(t._fn("Abs",[a]).pow(u.div(2)));else if(u.isInteger===!0&&u.isPositive===!0&&u.isOdd===!0){let l=u.sub(t.One).div(2);l.isPositive===!0&&r.push(t._fn("Abs",[a]).pow(l)),o.push(a)}else o.push(s)}else o.push(s);if(r.length>0){let s=r.length===1?r[0]:t._fn("Multiply",r);if(o.length===0)return{value:s,because:"sqrt(a^2 * ...) -> |a| * ..."};let a=o.length===1?o[0]:t._fn("Multiply",o);return{value:s.mul(t._fn("Sqrt",[a])),because:"sqrt(a^2 * b) -> |a| * sqrt(b)"}}}}if(e==="Power"){let i=n.op1,r=n.op2;if(!i||!r)return;if(i.is(0)&&r.isPositive===!0)return{value:t.Zero,because:"0^x -> 0 when x > 0"};if(i.is(-1)){let o=Qe(r);if(o){let[s,a]=o,u=Number(s),l=Number(a);if(u%2!==0&&l%2!==0)return{value:t.number(-1),because:"(-1)^{p/q} -> -1 when p,q odd"}}}if(i.operator==="Multiply"&&i.ops){let o=Qe(r);if(o){let[s,a]=o,u=Number(s),l=Number(a),c=u%2!==0,f=l%2!==0;if(c&&f){let p=-1;for(let d=0;d<i.ops.length;d++){let m=i.ops[d];if(m.isNumberLiteral&&m.isNegative===!0){p=d;break}}if(p>=0){let m=i.ops[p].neg(),g=i.ops.map((x,y)=>y===p?m:x);return{value:(g.length===1?g[0]:t._fn("Multiply",g)).pow(r).neg(),because:"(-a*b)^{p/q} -> -(a*b)^{p/q} when p,q odd"}}}}}if(i.operator==="Multiply"&&i.ops&&r.isInteger===!0){let o=i.ops.map(s=>s.pow(r));return{value:t._fn("Multiply",o),because:"(a*b)^n -> a^n * b^n"}}if(i.operator==="Negate"&&i.op1){let o=i.op1;if(r.isEven===!0)return{value:o.pow(r),because:"(-x)^n -> x^n when n is even"};if(r.isOdd===!0)return{value:o.pow(r).neg(),because:"(-x)^n -> -x^n when n is odd"};let s=Qe(r);if(s){let[a,u]=s,l=Number(a),c=Number(u),f=l%2===0,p=l%2!==0,d=c%2!==0;if(f&&d)return{value:o.pow(r),because:"(-x)^{n/m} -> x^{n/m} when n is even and m is odd"};if(p&&d)return{value:o.pow(r).neg(),because:"(-x)^{n/m} -> -x^{n/m} when n and m are odd"}}}if(i.operator==="Sqrt"&&i.op1){let o=i.op1;if(r.isEven===!0)return{value:o.pow(r.div(2)),because:"sqrt(x)^n -> x^{n/2} when n is even"};if(o.isNonNegative===!0)return{value:o.pow(r.div(2)),because:"sqrt(x)^n -> x^{n/2} when x >= 0"}}if(i.operator==="Root"&&i.op1&&i.op2){let o=i.op1,s=i.op2,a=r.div(s);if(a.isInteger===!0||o.isNonNegative===!0)return{value:o.pow(a),because:"root(x, k)^n -> x^{n/k}"}}if(i.operator==="Power"){let o=i.op1,s=i.op2;if(o&&s){let a=s.isInteger===!0&&r.isInteger===!0,u=o.isNonNegative===!0,l=s.mul(r).isRational===!1,c=s.isPositive===!0||r.isPositive===!0;if((a||u||l)&&c)return{value:o.pow(s.mul(r)),because:"(x^n)^m -> x^{n*m}"}}}if(i.operator==="Divide"&&i.op2?.is(0)===!1){let o=i.op1,s=i.op2;if(r.operator==="Negate")return{value:s.div(o).pow(r.op1),because:"(a/b)^{-n} -> (b/a)^n"};if(r.is(-1))return{value:s.div(o),because:"(a/b)^{-1} -> b/a"};if(r.isNegative===!0&&r.isNumberLiteral)return{value:s.div(o).pow(r.neg()),because:"(a/b)^{-n} -> (b/a)^n"}}}if(e==="Divide"){let i=n.op1,r=n.op2;if(!i||!r)return;if(i.operator==="Power"&&r.operator==="Power"){let o=i.op1,s=i.op2,a=r.op1,u=r.op2;if(o?.isSame(a)&&s&&u)return{value:o.pow(s.sub(u)),because:"a^m / a^n -> a^{m-n}"}}if(i.operator==="Power"&&i.op1?.isSame(r))return{value:r.pow(i.op2.sub(t.One)),because:"a^m / a -> a^{m-1}"};if(r.operator==="Power"&&r.op1?.isSame(i))return{value:i.pow(t.One.sub(r.op2)),because:"a / a^n -> a^{1-n}"};if(r.operator==="Power"&&r.op1?.is(0)===!1){let o=r.op1,s=r.op2;if(s?.operator==="Negate")return{value:i.mul(o.pow(s.op1)),because:"a / b^{-n} -> a * b^n"}}if(r.operator==="Multiply"&&r.ops)for(let o=0;o<r.ops.length;o++){let s=r.ops[o];if(s.operator==="Power"&&s.op1?.is(0)===!1&&s.op2?.operator==="Negate"){let a=s.op1,u=s.op2.op1,l=r.ops.filter((f,p)=>p!==o),c=l.length===1?l[0]:t._fn("Multiply",l);return{value:i.div(c).mul(a.pow(u)),because:"a / (d * b^{-n}) -> (a/d) * b^n"}}}if(r.operator==="Power"&&r.op1?.operator==="Divide"&&r.op1.op2?.is(0)===!1){let o=r.op1.op1,s=r.op1.op2,a=r.op2;return{value:i.mul(s.div(o).pow(a)),because:"a / (b/c)^d -> a * (c/b)^d"}}}if(e==="Multiply"&&n.ops&&n.ops.length>=2&&n.ops.length===2){let[i,r]=n.ops;if(i.operator==="Power"&&r.operator==="Power"){let o=i.op1,s=i.op2,a=r.op1,u=r.op2;if(o?.isSame(a)&&s&&u&&(o.isPositive===!0||o.isNegative===!0||s.add(u).isNonNegative===!0))return{value:o.pow(s.add(u)),because:"x^n * x^m -> x^{n+m}"}}if(r.operator==="Power"&&i.isSame(r.op1)&&(i.isPositive===!0||i.isNegative===!0||i.isNumberLiteral===!0))return{value:i.pow(r.op2.add(t.One)),because:"x * x^n -> x^{n+1}"};if(i.operator==="Power"&&r.isSame(i.op1)&&(r.isPositive===!0||r.isNegative===!0||r.isNumberLiteral===!0))return{value:r.pow(i.op2.add(t.One)),because:"x^n * x -> x^{n+1}"}}}tn();var Kv=new Set(["Sin","Cos","Tan","Cot","Sec","Csc"]),e_=new Set(["Sin","Tan","Cot","Csc"]),n_=new Set(["Cos","Sec"]),Zx={Sin:"Cos",Cos:"Sin",Tan:"Cot",Cot:"Tan",Sec:"Csc",Csc:"Sec"},t_={Sin:-1,Cos:-1,Tan:1,Cot:1,Sec:-1,Csc:-1},i_={Sin:1,Cos:-1,Tan:-1,Cot:-1,Sec:-1,Csc:1},r_=new Set(["Arcsin","Arccos","Arctan","Arccot","Arcsec","Arccsc"]);function o_(n,e,t){if(e.operator!=="Add"||!e.ops)return null;let i=e.ops,r=null,o=-1;for(let c=0;c<i.length;c++){let f=i[c];if(f.symbol==="Pi"){r=1,o=c;break}if(f.operator==="Multiply"&&f.ops){let p=f.ops,d=p.findIndex(m=>m.symbol==="Pi");if(d>=0){let m=p.filter((g,h)=>h!==d);if(m.length===1){let g=m[0].numericValue;if(typeof g=="number"&&Number.isInteger(g)){r=g,o=c;break}}else if(m.length===0){r=1,o=c;break}}}if(f.operator==="Negate"&&f.op1?.symbol==="Pi"){r=-1,o=c;break}}if(r===null||o<0)return null;let s=n==="Tan"||n==="Cot"?1:2,a=r%s;a<0&&(a+=s);let u=i.filter((c,f)=>f!==o);if(a!==0&&(a===1?u.push(t.Pi):u.push(t.box(["Multiply",a,"Pi"]))),a===r%s&&a===r)return null;let l;return u.length===0?l=t.Zero:u.length===1?l=u[0]:l=X(...u),t.box([n,l])}function Hx(n){let e=n.operator,t=n.engine;if(Kv.has(e)){let i=n.op1;if(!i)return;if(i.isInfinity===!0)return{value:t.NaN,because:`${e}(infinity) -> NaN`};if(i.operator==="Negate"){let r=i.op1;if(r){if(e_.has(e))return{value:t._fn(e,[r]).neg(),because:`${e}(-x) -> -${e}(x)`};if(n_.has(e))return{value:t._fn(e,[r]),because:`${e}(-x) -> ${e}(x)`}}}if(i.operator==="Subtract"){let r=i.op1,o=i.op2;if(r?.symbol==="Pi"&&o){let s=i_[e];if(s!==void 0){let a=t._fn(e,[o]);return{value:s===1?a:a.neg(),because:`${e}(\u03C0 - x) -> ${s===1?"":"-"}${e}(x)`}}}}if(i.operator==="Add"&&i.ops){let r=i.ops.findIndex(o=>o.symbol==="Pi");if(r>=0){let o=i.ops.filter((s,a)=>a!==r);if(o.length===i.ops.length-1){let s=o.length===1?o[0]:t._fn("Add",o),a=t_[e];if(a!==void 0){let u=t._fn(e,[s]);return{value:a===1?u:u.neg(),because:`${e}(\u03C0 + x) -> ${a===1?"":"-"}${e}(x)`}}}}}if(i.operator==="Subtract"){let r=i.op1,o=i.op2,s=!1;if(r?.operator==="Divide"&&r.op1?.symbol==="Pi"&&r.op2?.is(2)&&(s=!0),s&&o){let a=Zx[e];if(a)return{value:t._fn(a,[o]),because:`${e}(\u03C0/2 - x) -> ${a}(x)`}}}if(i.operator==="Add"&&i.nops===2){let r=i.ops,o=null,s=null;for(let a of r){if(a.operator==="Multiply"&&a.nops===2){let[u,l]=[a.op1,a.op2];if(l?.symbol==="Pi"){let c=u?.re;typeof c=="number"&&Math.abs(c-.5)<1e-10&&(o=a)}}a.operator==="Negate"&&a.op1&&(s=a.op1)}if(o&&s){let a=Zx[e];if(a)return{value:t._fn(a,[s]),because:`${e}(\u03C0/2 - x) -> ${a}(x)`}}}if(i.operator==="Add"){let r=o_(e,i,t);if(r)return{value:r,because:`${e} periodicity reduction`}}}if(r_.has(e)){let i=n.op1;if(!i)return;if((e==="Arcsin"||e==="Arccos")&&i.isInfinity===!0)return{value:t.NaN,because:`${e}(infinity) -> NaN`};if(e==="Arctan"){if(i.symbol==="PositiveInfinity")return{value:t.Pi.div(2),because:"arctan(+inf) -> \u03C0/2"};if(i.symbol==="NegativeInfinity")return{value:t.Pi.div(-2),because:"arctan(-inf) -> -\u03C0/2"}}if(e==="Arccot"){if(i.symbol==="PositiveInfinity")return{value:t.Zero,because:"arccot(+inf) -> 0"};if(i.symbol==="NegativeInfinity")return{value:t.Pi,because:"arccot(-inf) -> \u03C0"}}if(e==="Arcsec"&&i.isInfinity===!0)return{value:t.Pi.div(2),because:"arcsec(\xB1inf) -> \u03C0/2"};if(e==="Arccsc"&&i.isInfinity===!0)return{value:t.Zero,because:"arccsc(\xB1inf) -> 0"}}if(e==="Multiply"&&n.ops){if(n.ops.length>=2){let i=null,r=null,o=[];for(let s of n.ops)s.operator==="Sin"&&!i?i=s:s.operator==="Cos"&&!r?r=s:o.push(s);if(i&&r){let s=i.op1,a=r.op1;if(s?.isSame(a)){let u=t._fn("Sin",[s.mul(2)]);if(o.length===0)return{value:u.div(2),because:"sin(x)*cos(x) -> sin(2x)/2"};{let l=o.length===1?o[0]:t._fn("Multiply",o);return l.is(2)?{value:u,because:"2*sin(x)*cos(x) -> sin(2x)"}:{value:l.mul(u).div(2),because:"c*sin(x)*cos(x) -> c*sin(2x)/2"}}}}}if(n.ops.length===2){let[i,r]=n.ops;if(i.operator==="Sin"&&r.operator==="Sin"){let o=i.op1,s=r.op1;if(o&&s)return{value:t._fn("Cos",[o.sub(s)]).sub(t._fn("Cos",[o.add(s)])).div(2),because:"sin(x)*sin(y) -> (cos(x-y)-cos(x+y))/2"}}if(i.operator==="Cos"&&r.operator==="Cos"){let o=i.op1,s=r.op1;if(o&&s)return{value:t._fn("Cos",[o.sub(s)]).add(t._fn("Cos",[o.add(s)])).div(2),because:"cos(x)*cos(y) -> (cos(x-y)+cos(x+y))/2"}}if(i.operator==="Tan"&&r.operator==="Cot"){let o=i.op1,s=r.op1;if(o?.isSame(s))return{value:t.One,because:"tan(x)*cot(x) -> 1"}}if(i.operator==="Cot"&&r.operator==="Tan"){let o=i.op1,s=r.op1;if(o?.isSame(s))return{value:t.One,because:"cot(x)*tan(x) -> 1"}}if(i.is(2)&&r.operator==="Power"&&r.op2?.is(2)){let o=r.op1;if(o?.operator==="Sin"&&o.op1){let s=t._fn("Cos",[o.op1.mul(2)]);return{value:t.One.sub(s),because:"2sin\xB2(x) -> 1 - cos(2x)"}}if(o?.operator==="Cos"&&o.op1){let s=t._fn("Cos",[o.op1.mul(2)]);return{value:t.One.add(s),because:"2cos\xB2(x) -> 1 + cos(2x)"}}}if(r.is(2)&&i.operator==="Power"&&i.op2?.is(2)){let o=i.op1;if(o?.operator==="Sin"&&o.op1){let s=t._fn("Cos",[o.op1.mul(2)]);return{value:t.One.sub(s),because:"2sin\xB2(x) -> 1 - cos(2x)"}}if(o?.operator==="Cos"&&o.op1){let s=t._fn("Cos",[o.op1.mul(2)]);return{value:t.One.add(s),because:"2cos\xB2(x) -> 1 + cos(2x)"}}}}}if(e==="Add"&&n.ops&&n.ops.length===2){let[i,r]=n.ops;if(i.operator==="Power"&&r.operator==="Power"&&i.op2?.is(2)&&r.op2?.is(2)){let o=i.op1?.operator==="Sin"?i.op1.op1:null,s=r.op1?.operator==="Cos"?r.op1.op1:null;if(o&&s&&o.isSame(s))return{value:t.One,because:"sin\xB2(x) + cos\xB2(x) -> 1"};let a=r.op1?.operator==="Sin"?r.op1.op1:null,u=i.op1?.operator==="Cos"?i.op1.op1:null;if(a&&u&&a.isSame(u))return{value:t.One,because:"cos\xB2(x) + sin\xB2(x) -> 1"}}if(i.operator==="Power"&&i.op2?.is(2)&&r.is(1)&&i.op1?.operator==="Tan")return{value:t._fn("Sec",[i.op1.op1]).pow(2),because:"tan\xB2(x) + 1 -> sec\xB2(x)"};if(r.operator==="Power"&&r.op2?.is(2)&&i.is(1)&&r.op1?.operator==="Tan")return{value:t._fn("Sec",[r.op1.op1]).pow(2),because:"1 + tan\xB2(x) -> sec\xB2(x)"};if(i.operator==="Power"&&i.op2?.is(2)&&r.is(1)&&i.op1?.operator==="Cot")return{value:t._fn("Csc",[i.op1.op1]).pow(2),because:"cot\xB2(x) + 1 -> csc\xB2(x)"};if(r.operator==="Power"&&r.op2?.is(2)&&i.is(1)&&r.op1?.operator==="Cot")return{value:t._fn("Csc",[r.op1.op1]).pow(2),because:"1 + cot\xB2(x) -> csc\xB2(x)"};if(i.operator==="Multiply"&&r.operator==="Multiply"){let o=u=>{if(u.operator!=="Multiply"||!u.ops||u.ops.length!==2)return null;let[l,c]=u.ops;return c.operator==="Power"&&c.op2?.is(2)&&(c.op1?.operator==="Sin"||c.op1?.operator==="Cos")?{coeff:l,trigFunc:c.op1.operator,trigArg:c.op1.op1}:l.operator==="Power"&&l.op2?.is(2)&&(l.op1?.operator==="Sin"||l.op1?.operator==="Cos")?{coeff:c,trigFunc:l.op1.operator,trigArg:l.op1.op1}:null},s=o(i),a=o(r);if(s&&a&&s.coeff.isSame(a.coeff)&&s.trigArg?.isSame(a.trigArg)&&(s.trigFunc==="Sin"&&a.trigFunc==="Cos"||s.trigFunc==="Cos"&&a.trigFunc==="Sin"))return{value:s.coeff,because:"a*sin\xB2(x) + a*cos\xB2(x) -> a"}}}if(e==="Add"&&n.ops&&n.ops.length===2){let[i,r]=n.ops,o=null,s=null;if(i.is(1)&&r.operator==="Negate"?(o=i,s=r.op1):r.is(1)&&i.operator==="Negate"&&(o=r,s=i.op1),o&&s&&s.operator==="Power"&&s.op2?.is(2)){let f=s.op1;if(f?.operator==="Sin")return{value:t._fn("Cos",[f.op1]).pow(2),because:"1 - sin\xB2(x) -> cos\xB2(x)"};if(f?.operator==="Cos")return{value:t._fn("Sin",[f.op1]).pow(2),because:"1 - cos\xB2(x) -> sin\xB2(x)"}}let a=null,u=null;if(i.is(-1)&&r.operator==="Power"&&r.op2?.is(2)?(a=i,u=r):r.is(-1)&&i.operator==="Power"&&i.op2?.is(2)&&(a=r,u=i),a&&u){let f=u.op1;if(f?.operator==="Sin")return{value:t._fn("Cos",[f.op1]).pow(2).neg(),because:"sin\xB2(x) - 1 -> -cos\xB2(x)"};if(f?.operator==="Cos")return{value:t._fn("Sin",[f.op1]).pow(2).neg(),because:"cos\xB2(x) - 1 -> -sin\xB2(x)"};if(f?.operator==="Sec")return{value:t._fn("Tan",[f.op1]).pow(2),because:"sec\xB2(x) - 1 -> tan\xB2(x)"};if(f?.operator==="Csc")return{value:t._fn("Cot",[f.op1]).pow(2),because:"csc\xB2(x) - 1 -> cot\xB2(x)"}}let l=null,c=null;if(i.operator==="Negate"&&i.op1?.is(1)&&r.operator==="Power"&&r.op2?.is(2)?(l=i,c=r):r.operator==="Negate"&&r.op1?.is(1)&&i.operator==="Power"&&i.op2?.is(2)&&(l=r,c=i),l&&c){let f=c.op1;if(f?.operator==="Sec")return{value:t._fn("Tan",[f.op1]).pow(2),because:"sec\xB2(x) - 1 -> tan\xB2(x)"};if(f?.operator==="Csc")return{value:t._fn("Cot",[f.op1]).pow(2),because:"csc\xB2(x) - 1 -> cot\xB2(x)"}}if(i.operator==="Negate"&&r.operator==="Negate"){let f=i.op1,p=r.op1;if(f?.operator==="Power"&&f.op2?.is(2)&&p?.operator==="Power"&&p.op2?.is(2)){let d=f.op1,m=p.op1;if((d?.operator==="Sin"&&m?.operator==="Cos"||d?.operator==="Cos"&&m?.operator==="Sin")&&d?.op1?.isSame(m?.op1))return{value:t.NegativeOne,because:"-sin\xB2(x) - cos\xB2(x) -> -1"}}}}if(e==="Arcsin"){let i=n.op1;if(i)return{value:t._fn("Arctan2",[i,t.One.add(t._fn("Sqrt",[t.One.sub(i.pow(2))]))]).mul(2),because:"arcsin(x) -> 2*arctan2(x, 1+sqrt(1-x\xB2))"}}}var s_=new Set(["Sinh","Cosh","Tanh","Coth","Sech","Csch"]),a_=new Set(["Sinh","Tanh","Coth","Csch"]),u_=new Set(["Cosh","Sech"]),l_=new Set(["Arsinh","Arcosh","Artanh","Arcoth","Arsech","Arcsch"]);function Wx(n){let e=n.operator,t=n.engine;if(s_.has(e)){let i=n.op1;if(!i)return;if(i.symbol==="PositiveInfinity")switch(e){case"Sinh":return{value:t.PositiveInfinity,because:"sinh(+inf) -> +inf"};case"Cosh":return{value:t.PositiveInfinity,because:"cosh(+inf) -> +inf"};case"Tanh":return{value:t.One,because:"tanh(+inf) -> 1"};case"Coth":return{value:t.One,because:"coth(+inf) -> 1"};case"Sech":return{value:t.Zero,because:"sech(+inf) -> 0"};case"Csch":return{value:t.Zero,because:"csch(+inf) -> 0"}}if(i.symbol==="NegativeInfinity")switch(e){case"Sinh":return{value:t.NegativeInfinity,because:"sinh(-inf) -> -inf"};case"Cosh":return{value:t.PositiveInfinity,because:"cosh(-inf) -> +inf"};case"Tanh":return{value:t.NegativeOne,because:"tanh(-inf) -> -1"};case"Coth":return{value:t.NegativeOne,because:"coth(-inf) -> -1"};case"Sech":return{value:t.Zero,because:"sech(-inf) -> 0"};case"Csch":return{value:t.Zero,because:"csch(-inf) -> 0"}}if(i.isInfinity,i.operator==="Negate"){let r=i.op1;if(r){if(a_.has(e))return{value:t._fn(e,[r]).neg(),because:`${e}(-x) -> -${e}(x)`};if(u_.has(e))return{value:t._fn(e,[r]),because:`${e}(-x) -> ${e}(x)`}}}if(e==="Sinh")return{value:t._fn("Exp",[i]).sub(t._fn("Exp",[i.neg()])).div(2),because:"sinh(x) -> (e^x - e^{-x})/2"};if(e==="Cosh")return{value:t._fn("Exp",[i]).add(t._fn("Exp",[i.neg()])).div(2),because:"cosh(x) -> (e^x + e^{-x})/2"}}if(l_.has(e)){let i=n.op1;if(!i)return;if(e==="Arsinh")return i.symbol==="PositiveInfinity"?{value:t.PositiveInfinity,because:"arsinh(+inf) -> +inf"}:i.symbol==="NegativeInfinity"?{value:t.NegativeInfinity,because:"arsinh(-inf) -> -inf"}:{value:t._fn("Ln",[i.add(t._fn("Sqrt",[i.pow(2).add(t.One)]))]),because:"arsinh(x) -> ln(x + sqrt(x^2 + 1))"};if(e==="Arcosh"){if(i.symbol==="PositiveInfinity")return{value:t.PositiveInfinity,because:"arcosh(+inf) -> +inf"};if(i.symbol==="NegativeInfinity")return{value:t.NaN,because:"arcosh(-inf) -> NaN"};if(i.isGreater(1)===!0)return{value:t._fn("Ln",[i.add(t._fn("Sqrt",[i.pow(2).sub(t.One)]))]),because:"arcosh(x) -> ln(x + sqrt(x^2 - 1))"}}if(e==="Artanh")return i.isInfinity===!0?{value:t.NaN,because:"artanh(\xB1inf) -> NaN"}:{value:t.Half.mul(t._fn("Ln",[t.One.add(i).div(t.One.sub(i))])),because:"artanh(x) -> (1/2)*ln((1+x)/(1-x))"};if(e==="Arcoth"&&i.isInfinity===!0)return{value:t.NaN,because:"arcoth(\xB1inf) -> NaN"};if(e==="Arsech"&&i.isInfinity===!0)return{value:t.NaN,because:"arsech(\xB1inf) -> NaN"};if(e==="Arcsch"&&i.isInfinity===!0)return{value:t.Zero,because:"arcsch(\xB1inf) -> 0"}}}function Jx(n){if(n.operator!=="Divide")return;let e=n.op1,t=n.op2;if(!e||!t)return;let i=n.engine;if(e.is(0)&&t.is(0))return{value:i.NaN,because:"0/0 -> NaN"};if(e.is(0)&&t.is(0)===!1&&(t.isNumberLiteral||t.symbols.length!==0))return{value:i.Zero,because:"0/a -> 0"};if(e.isSame(t)&&e.is(0)===!1&&e.isInfinity!==!0&&(e.isNumberLiteral||e.symbols.length!==0))return{value:i.One,because:"a/a -> 1"};if(e.isInfinity&&t.isInfinity)return{value:i.NaN,because:"inf/inf -> NaN"};if(t.operator==="Divide"){let r=t.op1,o=t.op2;if(!r||!o)return;if(e.is(1)&&r.is(1)&&o.is(0)===!1)return{value:o,because:"1/(1/a) -> a"};if(r.is(1)&&o.is(0)===!1)return{value:e.mul(o),because:"a/(1/b) -> a*b"};if(o.is(0)===!1)return{value:e.mul(o).div(r),because:"a/(b/c) -> a*c/b"}}}var Qx=[{match:{sym:"GoldenRatio"},replace:["Divide",["Add",1,["Sqrt",5]],2]},c_,f_,n=>{if(n.operator!=="Divide")return;let e=n.unknowns;if(e.length!==1)return;let t=e[0],i=Xr(n,t);if(!i.isSame(n))return{value:i,because:"cancel common polynomial factors"}},n=>{if(n.operator==="Multiply"&&n.ops){let t=new Map;for(let i of n.ops){let r=null;i.operator==="Power"&&i.op1?r=JSON.stringify(i.op1.json):i.symbol&&(r=JSON.stringify(i.json)),r&&t.set(r,(t.get(r)||0)+1)}for(let i of t.values())if(i>1)return}let e=Ln(n);return e?{value:e,because:"expand"}:void 0},n=>{if(n.operator==="Add")return{value:X(...n.ops.map(e=>{let t=e.canonical;if(t.unknowns.length===0&&t.ops){let i=t.evaluate();if(i.isNumberLiteral)return i}return t})),because:"addition"}},n=>{if(n.operator==="Negate")return{value:n.op1.neg(),because:"negation"}},n=>{if(n.operator!=="Multiply")return;let e=n.ops,t=new Map;for(let i of e){let r=null,o=null;if(i.operator==="Power"&&i.op1?(r=JSON.stringify(i.op1.json),o=i):i.symbol&&(r=JSON.stringify(i.json),o=i),r&&o){let s=t.get(r)||[];s.push(o),t.set(r,s)}}for(let i of t.values())if(i.length>1)return;if(e.length===2){let[i,r]=e,o=i.operator==="Power"&&i.op2?.is(2)&&["Sin","Cos"].includes(i.op1?.operator||"")||r.operator==="Power"&&r.op2?.is(2)&&["Sin","Cos"].includes(r.op1?.operator||""),s=i.isNumberLiteral||r.isNumberLiteral;if(o&&s)return;let a=i.operator==="Sin"||r.operator==="Sin",u=i.operator==="Cos"||r.operator==="Cos";if(a&&u)return;let l=i.operator==="Tan"||r.operator==="Tan",c=i.operator==="Cot"||r.operator==="Cot";if(l&&c)return}return{value:pe(...e.map(i=>{let r=i.canonical;if(r.unknowns.length===0&&r.ops){if(r.operator==="Power"&&(r.op1?.symbol==="ExponentialE"||r.op2?.isRational===!0&&r.op2?.isInteger===!1))return r;let o=r.evaluate();if(o.isNumberLiteral)return o}return r})),because:"multiplication"}},n=>{if(n.operator==="Divide"){let e=n.op1,t=n.op2;return e&&t&&t.isNumberLiteral!==!0&&t.symbols.length===0&&(e.is(0)||e.isSame(t))||e.operator==="Power"&&t.operator==="Power"&&e.op1?.isSame(t.op1)||e.operator==="Power"&&e.op1?.isSame(t)||t.operator==="Power"&&t.op1?.isSame(e)?void 0:{value:e.div(t),because:"division"}}if(n.operator==="Rational"&&n.nops===2)return{value:n.op1.div(n.op2),because:"rational"}},n=>{if(!n.op1?.isNumberLiteral)return;if(n.operator==="Sqrt"){if(n.op1.isNegative)return{value:n.engine.box(["Multiply",["Sqrt",n.op1.neg()],"ImaginaryUnit"]).simplify(),because:"sqrt"};let i=n.op1.sqrt();return Yx(i.numericValue)?{value:i,because:"sqrt"}:void 0}let e=n.op1,t=n.op2;if(t?.isNumberLiteral&&e.isInteger&&t.isInteger&&e.re<K&&t.re<K){if(n.operator==="Power")return{value:n.op1.pow(n.op2),because:"power"};if(n.operator==="Root"){let i=n.op1.root(n.op2);if(Yx(i.numericValue))return{value:n.op1.root(n.op2),because:"root"}}}},n=>{if(n.operator!=="Sign")return;let e=n.sgn,t=n.engine;if(e!==void 0){if(e==="positive")return{value:t.One,because:"sign positive"};if(e==="negative")return{value:t.NegativeOne,because:"sign negative"};if(e==="zero")return{value:t.Zero,because:"sign zero"};if(e==="unsigned")return{value:t.NaN,because:"sign unsinged"}}},n=>{if(n.operator==="Ln")return{value:n.op1.ln(n.ops[1]),because:"ln"};if(n.operator==="Log")return{value:n.op1.ln(n.ops[1]??10),because:"log"}},n=>{if(n.operator==="Max"){if(n.nops===0)return{value:n.engine.NegativeInfinity,because:"max"};if(n.nops===1)return{value:n.op1,because:"max"}}else if(n.operator==="Min"){if(n.nops===0)return{value:n.engine.PositiveInfinity,because:"min"};if(n.nops===1)return{value:n.op1,because:"min"}}else if(n.operator==="Supremum"){if(n.nops===0)return{value:n.engine.NegativeInfinity,because:"sup"};if(n.nops===1)return{value:n.op1,because:"sup"}}else if(n.operator==="Infimum"){if(n.nops===0)return{value:n.engine.PositiveInfinity,because:"inf"};if(n.nops===1)return{value:n.op1,because:"inf"}}},n=>{if(n.operator!=="Derivative")return;let e=n.engine,[t,i]=n.ops;if(n.nops===2)return{value:e._fn("Derivative",[t.simplify(),i]),because:"derivative"};if(n.nops===1)return{value:e._fn("Derivative",[t.simplify()]),because:"derivative"}},n=>n.operator!=="Hypot"?void 0:{value:n.engine.box(["Sqrt",["Add",["Square",n.op1],["Square",n.op2]]]).simplify(),because:"hypot(x,y) -> sqrt(x^2+y^2)"},n=>{if(n.operator!=="Congruent"||n.nops<3)return;let e=n.engine;return{value:e._fn("Equal",[e.function("Mod",[n.ops[0],n.ops[2]]).simplify(),e.function("Mod",[n.ops[1],n.ops[2]]).simplify()]).simplify(),because:"congruent"}},qx,Fx,n=>{if(!Cc(n))return;let e=Ts(n.operator,n.op1);if(e)return{value:e,because:"constructible value"}},n=>{if(n.operator!=="InverseFunction")return;let e=Ns(n.engine,n.ops);if(e)return{value:e,because:"inverse function"}},n=>{if(n.operator!=="Arctan2")return;let[e,t]=n.ops,i=n.engine;return e.isFinite===!1&&t.isFinite===!1?{value:i.NaN,because:"arctan2"}:e.is(0)&&t.is(0)?{value:i.Zero,because:"arctan2"}:t.isFinite===!1?{value:t.isPositive?i.Zero:i.Pi,because:"arctan2"}:e.isFinite===!1?{value:e.isPositive?i.Pi.div(2):i.Pi.div(-2),because:"arctan2"}:e.is(0)?{value:t.isPositive?i.Zero:i.Pi,because:"arctan2"}:{value:i.function("Arctan",[e.div(t)]).simplify(),because:"arctan2"}},Mh,Vx,$x,jx,Ux,Gx,zx,Hx,Wx,Jx,n=>{if(n.operator!=="Multiply"||!n.ops||n.ops.length<2)return;let e=n.engine,t=new Map,i=[];for(let s of n.ops){let a,u;if(s.operator==="Power")a=s.op1,u=s.op2;else if(s.symbol)a=s,u=e.One;else{i.push(s);continue}let l=JSON.stringify(a.json),c=t.get(l);c||(c={base:a,terms:[]},t.set(l,c)),c.terms.push({term:s,exp:u})}let r=!1;for(let s of t.values())if(s.terms.length>1){let a=s.base;if(a.isPositive===!0||a.isNegative===!0||a.isNumberLiteral===!0)r=!0;else if(s.terms.map(f=>f.exp).reduce((f,p)=>f.add(p)).isPositive===!0)r=!0;else{for(let f of s.terms)i.push(f.term);s.terms.length=0}}if(!r)return;let o=[...i];for(let s of t.values())if(s.terms.length===1)o.push(s.terms[0].term);else{let u=s.terms.map(l=>l.exp).reduce((l,c)=>l.add(c));u.is(0)?o.push(e.One):u.is(1)?o.push(s.base):o.push(e._fn("Power",[s.base,u]))}return o.length===0?{value:e.One,because:"combined powers"}:o.length===1?{value:o[0],because:"combined powers"}:{value:e._fn("Multiply",o),because:"combined powers with same base"}}];function Yx(n){return n===null?!1:typeof n=="number"?Number.isInteger(n):n.isExact}function c_(n){let e=n.operator;if(!st(e)&&!Mr(e))return;let t=n,i=n.engine,r=n.op1.simplify(),o=n.op2.simplify();if(n=i._fn(n.operator,[r,o]),n=Ri(n)??n,Dn(n.operator),n.nops===2&&!n.op2.is(0)){let s=Ri(i._fn(n.operator,[n.op1.sub(n.op2),i.Zero]));i.costFunction(s)<i.costFunction(n)&&(n=s)}if(!n.isSame(t))return{value:n,because:"simplify-relational-operator"}}function f_(n){return n.operator!=="List"||!n.ops.every(t=>Mr(t.operator)||st(t.operator))?void 0:{value:n.engine.function("List",n.ops.map(t=>t.simplify())),because:"simplify-system-of-equations"}}Vt();At();io();var Xx="https://oeis.org";function p_(n){let e;if(Array.isArray(n))e=n;else if(n&&n.results&&Array.isArray(n.results))e=n.results;else return[];return e.map(t=>{let i=t.data?t.data.split(",").map(o=>parseInt(o.trim(),10)):[],r=t.formula?.[0];return{id:t.number?`A${String(t.number).padStart(6,"0")}`:"",name:t.name||"",terms:i,formula:r,comments:t.comment,url:t.number?`${Xx}/A${String(t.number).padStart(6,"0")}`:""}})}async function Kx(n,e={}){let t=e.timeout??1e4,i=e.maxResults??5,r=n.join(","),o=`${Xx}/search?fmt=json&q=${encodeURIComponent(r)}&start=0&count=${i}`;try{let s=new AbortController,a=setTimeout(()=>s.abort(),t),u=await fetch(o,{signal:s.signal,headers:{Accept:"application/json"}});if(clearTimeout(a),!u.ok)throw new Error(`OEIS request failed: ${u.status}`);let l=await u.json();return p_(l).slice(0,i)}catch(s){throw s instanceof Error&&s.name==="AbortError"?new Error("OEIS request timed out"):s}}async function ey(n,e,t={}){let i=e.map(r=>{if(typeof r=="number"){if(!Number.isInteger(r))throw new Error("OEIS lookup requires integer terms");return r}let o=r.re;if(!Number.isInteger(o))throw new Error("OEIS lookup requires integer terms");return o});return Kx(i,t)}async function ny(n,e,t=10,i={}){let r=n.getSequenceTerms(e,0,t-1);if(!r)throw new Error(`'${e}' is not a defined sequence`);let o=r.map(a=>a.re);return{matches:await Kx(o,i),terms:o}}Pl();en();Oa();ns();Ct();var Yc={Add:["+",11],Negate:["-",14],Subtract:["-",11],Multiply:["*",12],Divide:["/",13],Equal:["===",8],NotEqual:["!==",8],LessEqual:["<=",9],GreaterEqual:[">=",9],Less:["<",9],Greater:[">",9],And:["&&",4],Or:["||",3],Not:["!",14]},Qc={Abs:"Math.abs",Add:(n,e)=>n.length===1?e(n[0]):`(${n.map(t=>e(t)).join(" + ")})`,Arccos:"Math.acos",Arcosh:"Math.acosh",Arccot:([n],e)=>{if(n===null)throw new Error("Arccot: no argument");return`Math.atan(1 / (${e(n)}))`},Arcoth:([n],e)=>{if(n===null)throw new Error("Arcoth: no argument");return`Math.atanh(1 / (${e(n)}))`},Arccsc:([n],e)=>{if(n===null)throw new Error("Arccsc: no argument");return`Math.asin(1 / (${e(n)}))`},Arcsch:([n],e)=>{if(n===null)throw new Error("Arcsch: no argument");return`Math.asinh(1 / (${e(n)}))`},Arcsec:([n],e)=>{if(n===null)throw new Error("Arcsec: no argument");return`Math.acos(1 / (${e(n)}))`},Arsech:([n],e)=>{if(n===null)throw new Error("Arsech: no argument");return`Math.acosh(1 / (${e(n)}))`},Arcsin:"Math.asin",Arsinh:"Math.asinh",Arctan:"Math.atan",Artanh:"Math.atanh",Ceiling:"Math.ceil",Chop:"_SYS.chop",Cos:"Math.cos",Cosh:"Math.cosh",Cot:([n],e)=>{if(n===null)throw new Error("Cot: no argument");return Je.inlineExpression("Math.cos(${x}) / Math.sin(${x})",e(n))},Coth:([n],e)=>{if(n===null)throw new Error("Coth: no argument");return Je.inlineExpression("(Math.cosh(${x}) / Math.sinh(${x}))",e(n))},Csc:([n],e)=>{if(n===null)throw new Error("Csc: no argument");return`1 / Math.sin(${e(n)})`},Csch:([n],e)=>{if(n===null)throw new Error("Csch: no argument");return`1 / Math.sinh(${e(n)})`},Exp:"Math.exp",Floor:"Math.floor",Gamma:"_SYS.gamma",GCD:"_SYS.gcd",Integrate:(n,e,t)=>m_(n,e,t),LCM:"_SYS.lcm",Limit:(n,e)=>`_SYS.limit(${e(n[0])}, ${e(n[1])})`,Ln:"Math.log",List:(n,e)=>`[${n.map(t=>e(t)).join(", ")}]`,Log:(n,e)=>n.length===1?`Math.log10(${e(n[0])})`:`(Math.log(${e(n[0])}) / Math.log(${e(n[1])}))`,LogGamma:"_SYS.lngamma",Lb:"Math.log2",Max:"Math.max",Mean:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.mean(${e(n[0])})`:`_SYS.mean([${n.map(t=>e(t)).join(", ")}])`,Median:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.median(${e(n[0])})`:`_SYS.median([${n.map(t=>e(t)).join(", ")}])`,Variance:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.variance(${e(n[0])})`:`_SYS.variance([${n.map(t=>e(t)).join(", ")}])`,PopulationVariance:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.populationVariance(${e(n[0])})`:`_SYS.populationVariance([${n.map(t=>e(t)).join(", ")}])`,StandardDeviation:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.standardDeviation(${e(n[0])})`:`_SYS.standardDeviation([${n.map(t=>e(t)).join(", ")}])`,PopulationStandardDeviation:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.populationStandardDeviation(${e(n[0])})`:`_SYS.populationStandardDeviation([${n.map(t=>e(t)).join(", ")}])`,Kurtosis:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.kurtosis(${e(n[0])})`:`_SYS.kurtosis([${n.map(t=>e(t)).join(", ")}])`,Skewness:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.skewness(${e(n[0])})`:`_SYS.skewness([${n.map(t=>e(t)).join(", ")}])`,Mode:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.mode(${e(n[0])})`:`_SYS.mode([${n.map(t=>e(t)).join(", ")}])`,Quartiles:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.quartiles(${e(n[0])})`:`_SYS.quartiles([${n.map(t=>e(t)).join(", ")}])`,InterquartileRange:(n,e)=>n.length===0?"NaN":n.length===1?`_SYS.interquartileRange(${e(n[0])})`:`_SYS.interquartileRange([${n.map(t=>e(t)).join(", ")}])`,Min:"Math.min",Power:(n,e)=>{let t=n[0];if(t===null)throw new Error("Power: no argument");let i=n[1].re;return i===.5?`Math.sqrt(${e(t)})`:i===1/3?`Math.cbrt(${e(t)})`:i===1?e(t):i===-1?`(1 / (${e(t)}))`:i===-.5?`(1 / Math.sqrt(${e(t)}))`:`Math.pow(${e(t)}, ${e(n[1])})`},Range:(n,e)=>{if(n.length===0)return"[]";if(n.length===1)return`Array.from({length: ${e(n[0])}}, (_, i) => i)`;let t=e(n[0]),i=e(n[1]),r=n[2]?e(n[2]):"1";if(t===null)throw new Error("Range: no start");if(i===null&&(i=t,t="1"),r==="0")throw new Error("Range: step cannot be zero");if(parseFloat(r)===1){let o=parseFloat(i),s=parseFloat(t);return o!==null&&s!==null?o-s<50?`[${Array.from({length:o-s+1},(a,u)=>s+u).join(", ")}]`:`Array.from({length: ${o-s+1} 
        }, (_, i) => ${t} + i)`:`Array.from({length: ${i} - ${t} + 1
      }, (_, i) => ${t} + i)`}return`Array.from({length: Math.floor((${i} - ${t}) / ${r}) + 1}, (_, i) => ${t} + i * ${r})`},Root:([n,e],t)=>{if(n===null)throw new Error("Root: no argument");return e===null?`Math.sqrt(${t(n)})`:e?.re===2?`Math.sqrt(${t(n)})`:e?.re===3?`Math.cbrt(${t(n)})`:isNaN(e?.re)?`Math.pow(${t(n)}, 1 / (${t(e)}))`:`Math.pow(${t(n)},  ${1/e.re})`},Random:"Math.random",Round:"Math.round",Square:(n,e)=>{let t=n[0];if(t===null)throw new Error("Square: no argument");return`Math.pow(${e(t)}, 2)`},Sec:(n,e)=>{let t=n[0];if(t===null)throw new Error("Sec: no argument");return`1 / Math.cos(${e(t)})`},Sech:(n,e)=>{let t=n[0];if(t===null)throw new Error("Sech: no argument");return`1 / Math.cosh(${e(t)})`},Sgn:"Math.sign",Sin:"Math.sin",Sinh:"Math.sinh",Sqrt:"Math.sqrt",Tan:"Math.tan",Tanh:"Math.tanh"},Xc=class extends Function{SYS={chop:Au,factorial:wu,gamma:Ci,gcd:un,integrate:(e,t,i)=>ao(e,t,i,1e7).estimate,lcm:ji,lngamma:oo,limit:xi,mean:hs,median:Dt,variance:cr,populationVariance:fr,standardDeviation:Bc,populationStandardDeviation:wc,kurtosis:xs,skewness:ys,mode:bs,quartiles:Es,interquartileRange:vs};constructor(e,t=""){return super("_SYS","_",t?`${t};return ${e}`:`return ${e}`),new Proxy(this,{apply:(i,r,o)=>super.apply(r,[this.SYS,...o]),get:(i,r)=>r==="toString"?()=>e:r==="isCompiled"?!0:i[r]})}},tu=class extends Function{SYS={chop:Au,factorial:wu,gamma:Ci,gcd:un,integrate:(e,t,i)=>ao(e,t,i,1e7).estimate,lcm:ji,lngamma:oo,limit:xi,mean:hs,median:Dt,variance:cr,populationVariance:fr,standardDeviation:Bc,populationStandardDeviation:wc,kurtosis:xs,skewness:ys,mode:bs,quartiles:Es,interquartileRange:vs};constructor(e,t){return super("_SYS",...t,`return ${e}`),new Proxy(this,{apply:(i,r,o)=>super.apply(r,[this.SYS,...o]),get:(i,r)=>r==="toString"?()=>`(${t.join(", ")}) => ${e}`:r==="isCompiled"?!0:i[r]})}},gr=class{getOperators(){return Yc}getFunctions(){return Qc}createTarget(e={}){return{language:"javascript",operators:t=>Yc[t],functions:t=>Qc[t],var:t=>({Pi:"Math.PI",ExponentialE:"Math.E",NaN:"Number.NaN",ImaginaryUnit:"Number.NaN",Half:"0.5",MachineEpsilon:"Number.EPSILON",GoldenRatio:"((1 + Math.sqrt(5)) / 2)",CatalanConstant:"0.91596559417721901",EulerGamma:"0.57721566490153286"})[t],string:t=>JSON.stringify(t),number:t=>t.toString(),indent:0,ws:t=>t??"",preamble:"",...e}}compileToExecutable(e,t={}){let{operators:i,functions:r,vars:o,imports:s=[],preamble:a}=t,u=e.unknowns,l=s.map(d=>{if(typeof d=="function")return d.toString();throw new Error(`Unsupported import \`${d}\``)}).join(`
`),c={};if(r)for(let[d,m]of Object.entries(r))typeof m=="function"?g_(m)?(l+=`${m.toString()};
`,c[d]=m.name):(l+=`const ${d} = ${m.toString()};
`,c[d]=d):typeof m=="string"&&(c[d]=m);let f=d=>{if(i){let m=typeof i=="function"?i(d):i[d];if(m)return m}return Yc[d]},p=this.createTarget({operators:f,functions:d=>c?.[d]?c[d]:Qc[d],var:d=>{if(o&&d in o)return JSON.stringify(o[d]);let m={Pi:"Math.PI",ExponentialE:"Math.E",NaN:"Number.NaN",ImaginaryUnit:"Number.NaN",Half:"0.5",MachineEpsilon:"Number.EPSILON",GoldenRatio:"((1 + Math.sqrt(5)) / 2)",CatalanConstant:"0.91596559417721901",EulerGamma:"0.57721566490153286"}[d];if(m!==void 0)return m;if(u.includes(d))return`_.${d}`},preamble:(a??"")+l});return d_(e,p)}};function d_(n,e){if(n.operator==="Function"){let i=n.ops,r=i.slice(1).map(s=>s.symbol??"_"),o=Je.compile(i[0].canonical,{...e,var:s=>r.includes(s)?s:e.var(s)});return new tu(o,r)}if(n.symbol){let i=e.operators?.(n.symbol);if(i)return new tu(`a ${i[0]} b`,["a","b"])}let t=Je.compile(n,e);return new Xc(t,e.preamble)}function m_(n,e,t){let{index:i,lower:r,upper:o}=Kr(n[1]),s=Je.compile(n[0],{...t,var:a=>a===i?a:t.var(a)});return`_SYS.integrate((${i}) => (${s}), ${r}, ${o})`}function g_(n){let e=n.toString();return e.includes("=>")?!1:e.startsWith("function ")&&e.includes(n.name)}var ty={Add:["+",11],Negate:["-",14],Subtract:["-",11],Multiply:["*",12],Divide:["/",13],Equal:["==",8],NotEqual:["!=",8],LessEqual:["<=",9],GreaterEqual:[">=",9],Less:["<",9],Greater:[">",9],And:["&&",4],Or:["||",3],Not:["!",14]},Kc={Add:(n,e)=>n.length===0?"0.0":n.length===1?e(n[0]):n.map(t=>e(t)).join(" + "),Multiply:(n,e)=>n.length===0?"1.0":n.length===1?e(n[0]):n.map(t=>e(t)).join(" * "),Subtract:(n,e)=>{if(n.length===0)return"0.0";if(n.length===1)return e(n[0]);if(n.length===2)return`${e(n[0])} - ${e(n[1])}`;let t=e(n[0]);for(let i=1;i<n.length;i++)t=`${t} - ${e(n[i])}`;return t},Divide:(n,e)=>{if(n.length===0)return"1.0";if(n.length===1)return e(n[0]);if(n.length===2)return`${e(n[0])} / ${e(n[1])}`;let t=e(n[0]);for(let i=1;i<n.length;i++)t=`${t} / ${e(n[i])}`;return t},Abs:"abs",Arccos:"acos",Arcsin:"asin",Arctan:"atan",Ceiling:"ceil",Clamp:"clamp",Cos:"cos",Degrees:"degrees",Exp:"exp",Exp2:"exp2",Floor:"floor",Fract:"fract",Inversesqrt:"inversesqrt",Ln:"log",Log2:"log2",Max:"max",Min:"min",Mix:"mix",Mod:"mod",Power:"pow",Radians:"radians",Round:"round",Sign:"sign",Sin:"sin",Smoothstep:"smoothstep",Sqrt:"sqrt",Step:"step",Tan:"tan",Cross:"cross",Distance:"distance",Dot:"dot",Length:"length",Normalize:"normalize",Reflect:"reflect",Refract:"refract",List:(n,e)=>n.length===2?`vec2(${n.map(t=>e(t)).join(", ")})`:n.length===3?`vec3(${n.map(t=>e(t)).join(", ")})`:n.length===4?`vec4(${n.map(t=>e(t)).join(", ")})`:`float[${n.length}](${n.map(t=>e(t)).join(", ")})`},hr=class{getOperators(){return ty}getFunctions(){return Kc}createTarget(e={}){return{language:"glsl",operators:t=>ty[t],functions:t=>Kc[t],var:t=>{let i={Pi:"3.14159265359",ExponentialE:"2.71828182846",GoldenRatio:"1.61803398875",CatalanConstant:"0.91596559417",EulerGamma:"0.57721566490"};return t in i?i[t]:t},string:t=>JSON.stringify(t),number:t=>{let i=t.toString();return!i.includes(".")&&!i.includes("e")&&!i.includes("E")?`${i}.0`:i},indent:0,ws:t=>t??"",preamble:"",...e}}compileToExecutable(e,t={}){let{functions:i,vars:r}=t,{BaseCompiler:o}=(Ct(),it(ts)),s=this.createTarget({functions:l=>{if(i&&l in i){let c=i[l];if(typeof c=="string")return c;if(typeof c=="function")return c.name||l}return Kc[l]},var:l=>{if(r&&l in r)return r[l];let c={Pi:"3.14159265359",ExponentialE:"2.71828182846",GoldenRatio:"1.61803398875",CatalanConstant:"0.91596559417",EulerGamma:"0.57721566490"};return l in c?c[l]:l}}),a=o.compile(e,s),u=function(){return a};return Object.defineProperty(u,"toString",{value:()=>a}),Object.defineProperty(u,"isCompiled",{value:!0}),u}compile(e,t={}){let{BaseCompiler:i}=(Ct(),it(ts)),r=this.createTarget();return i.compile(e,r)}compileFunction(e,t,i,r){let{BaseCompiler:o}=(Ct(),it(ts)),s=this.createTarget(),a=o.compile(e,s),u=r.map(([l,c])=>`${c} ${l}`).join(", ");return`${i} ${t}(${u}) {
  return ${a};
}`}compileShader(e){let{type:t,version:i="300 es",inputs:r=[],outputs:o=[],uniforms:s=[],body:a}=e,u=`#version ${i}

`;t==="fragment"&&(u+=`precision highp float;

`);let l=i.startsWith("300")||i.startsWith("3")?"in":t==="vertex"?"attribute":"varying";for(let f of r)u+=`${l} ${f.type} ${f.name};
`;r.length>0&&(u+=`
`);let c=i.startsWith("300")||i.startsWith("3")?"out":"varying";for(let f of o)u+=`${c} ${f.type} ${f.name};
`;o.length>0&&(u+=`
`);for(let f of s)u+=`uniform ${f.type} ${f.name};
`;s.length>0&&(u+=`
`),u+=`void main() {
`;for(let f of a){let p=this.compile(f.expression);u+=`  ${f.variable} = ${p};
`}return u+=`}
`,u}};Ct();function D(n){return{kind:"interval",value:n}}function ef(n){return{lo:n,hi:n}}function dn(n,e,t){let i=Math.ceil((n.lo-e)/t),r=e+i*t,o=1e-15;return r>=n.lo-o&&r<=n.hi+o}function Eo(n,e){if(n.kind==="empty")return e;if(e.kind==="empty")return n;if(n.kind==="singular"||e.kind==="singular")return{kind:"singular"};if(n.kind==="entire"||e.kind==="entire")return{kind:"entire"};let t=n.value,i=e.value,r=n.kind==="partial"?n.domainClipped:null,o=e.kind==="partial"?e.domainClipped:null,s={lo:Math.min(t.lo,i.lo),hi:Math.max(t.hi,i.hi)};if(r||o){let a=iu(r,o);return{kind:"partial",value:s,domainClipped:a}}return{kind:"interval",value:s}}function iu(n,e){return n==="both"||e==="both"?"both":n===null?e:e===null||n===e?n:"both"}function nf(n){return n.lo===n.hi}function vo(n){return n.lo<=0&&n.hi>=0}function tf(n){return n.lo>0}function As(n){return n.hi<0}function rf(n){return n.lo>=0}function of(n){return n.hi<=0}function sf(n){return n.hi-n.lo}function af(n){return(n.lo+n.hi)/2}function uf(n){if(n.kind==="interval"||n.kind==="partial")return n.value}function lf(n){return"kind"in n?n.kind==="interval"||n.kind==="partial"?n.value:void 0:n}function $(...n){let e=[];for(let t of n)if("kind"in t){if(t.kind==="empty")return{kind:"empty"};if(t.kind==="entire")return{kind:"entire"};if(t.kind==="singular")return t;e.push(t.value)}else e.push(t);return e}function cf(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;return D({lo:i.lo+r.lo,hi:i.hi+r.hi})}function ff(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;return D({lo:i.lo-r.hi,hi:i.hi-r.lo})}function pf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:-t.hi,hi:-t.lo})}function df(n,e){let t=[n.lo*e.lo,n.lo*e.hi,n.hi*e.lo,n.hi*e.hi];return{lo:Math.min(...t),hi:Math.max(...t)}}function mf(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;return D(df(i,r))}function gf(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;return h_(i,r)}function h_(n,e){return e.lo>0||e.hi<0?D(df(n,{lo:1/e.hi,hi:1/e.lo})):e.lo<0&&e.hi>0?{kind:"singular"}:e.lo===0&&e.hi>0?n.lo>=0?{kind:"partial",value:{lo:n.lo/e.hi,hi:1/0},domainClipped:"hi"}:n.hi<=0?{kind:"partial",value:{lo:-1/0,hi:n.hi/e.hi},domainClipped:"lo"}:{kind:"entire"}:e.hi===0&&e.lo<0?n.lo>=0?{kind:"partial",value:{lo:-1/0,hi:n.lo/e.lo},domainClipped:"lo"}:n.hi<=0?{kind:"partial",value:{lo:n.hi/e.lo,hi:1/0},domainClipped:"hi"}:{kind:"entire"}:{kind:"empty"}}function hf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return x_(t)}function x_(n){return n.hi<0?{kind:"empty"}:n.lo>=0?D({lo:Math.sqrt(n.lo),hi:Math.sqrt(n.hi)}):{kind:"partial",value:{lo:0,hi:Math.sqrt(n.hi)},domainClipped:"lo"}}function xf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return t.lo>=0?D({lo:t.lo*t.lo,hi:t.hi*t.hi}):t.hi<=0?D({lo:t.hi*t.hi,hi:t.lo*t.lo}):D({lo:0,hi:Math.max(t.lo*t.lo,t.hi*t.hi)})}function iy(n,e){return e===0?{lo:1,hi:1}:e===1?n:e%2===0?n.lo>=0?{lo:Math.pow(n.lo,e),hi:Math.pow(n.hi,e)}:n.hi<=0?{lo:Math.pow(n.hi,e),hi:Math.pow(n.lo,e)}:{lo:0,hi:Math.max(Math.pow(n.lo,e),Math.pow(n.hi,e))}:{lo:Math.pow(n.lo,e),hi:Math.pow(n.hi,e)}}function yf(n,e){let t=$(n);if(!Array.isArray(t))return t;let[i]=t;if(Number.isInteger(e)){if(e>=0)return D(iy(i,e));{if(vo(i))return{kind:"singular"};let r=iy(i,-e);return D({lo:1/r.hi,hi:1/r.lo})}}else return As(i)?{kind:"empty"}:i.lo<0?{kind:"partial",value:e>0?{lo:0,hi:Math.pow(i.hi,e)}:{lo:Math.pow(i.hi,e),hi:1/0},domainClipped:"lo"}:e>0?D({lo:Math.pow(i.lo,e),hi:Math.pow(i.hi,e)}):i.lo===0?{kind:"partial",value:{lo:Math.pow(i.hi,e),hi:1/0},domainClipped:"hi"}:D({lo:Math.pow(i.hi,e),hi:Math.pow(i.lo,e)})}function bf(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;if(i.hi<=0)return{kind:"empty"};if(i.lo<=0){let s={lo:Math.max(i.lo,Number.EPSILON),hi:i.hi},a=[Math.pow(s.lo,r.lo),Math.pow(s.lo,r.hi),Math.pow(s.hi,r.lo),Math.pow(s.hi,r.hi)];return{kind:"partial",value:{lo:Math.min(...a),hi:Math.max(...a)},domainClipped:"lo"}}let o=[Math.pow(i.lo,r.lo),Math.pow(i.lo,r.hi),Math.pow(i.hi,r.lo),Math.pow(i.hi,r.hi)];return D({lo:Math.min(...o),hi:Math.max(...o)})}function Ef(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:Math.exp(t.lo),hi:Math.exp(t.hi)})}function vf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return t.hi<=0?{kind:"empty"}:t.lo>0?D({lo:Math.log(t.lo),hi:Math.log(t.hi)}):{kind:"partial",value:{lo:-1/0,hi:Math.log(t.hi)},domainClipped:"lo"}}function _f(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return t.hi<=0?{kind:"empty"}:t.lo>0?D({lo:Math.log10(t.lo),hi:Math.log10(t.hi)}):{kind:"partial",value:{lo:-1/0,hi:Math.log10(t.hi)},domainClipped:"lo"}}function Nf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return t.hi<=0?{kind:"empty"}:t.lo>0?D({lo:Math.log2(t.lo),hi:Math.log2(t.hi)}):{kind:"partial",value:{lo:-1/0,hi:Math.log2(t.hi)},domainClipped:"lo"}}function Tf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return t.lo>=0?D(t):t.hi<=0?D({lo:-t.hi,hi:-t.lo}):D({lo:0,hi:Math.max(-t.lo,t.hi)})}function Sf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:Math.floor(t.lo),hi:Math.floor(t.hi)})}function If(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:Math.ceil(t.lo),hi:Math.ceil(t.hi)})}function Bf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:Math.round(t.lo),hi:Math.round(t.hi)})}function wf(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;return D({lo:Math.min(i.lo,r.lo),hi:Math.min(i.hi,r.hi)})}function Af(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;return D({lo:Math.max(i.lo,r.lo),hi:Math.max(i.hi,r.hi)})}function kf(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;if(vo(r))return{kind:"singular"};let o=Math.max(Math.abs(r.lo),Math.abs(r.hi));if(i.hi-i.lo>=o)return D({lo:0,hi:o});let a=(i.lo%o+o)%o,u=(i.hi%o+o)%o;return a<=u?D({lo:a,hi:u}):D({lo:0,hi:o})}function Cf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return t.lo>0?D({lo:1,hi:1}):t.hi<0?D({lo:-1,hi:-1}):t.lo===0&&t.hi===0?D({lo:0,hi:0}):t.lo<0&&t.hi>0?D({lo:-1,hi:1}):t.lo===0?D({lo:0,hi:1}):D({lo:-1,hi:0})}var Ot=2*Math.PI,Ue=Math.PI,qi=Math.PI/2,ry=3*Math.PI/2;function Rf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.hi-t.lo>=Ot)return D({lo:-1,hi:1});let i=Math.sin(t.lo),r=Math.sin(t.hi),o=Math.min(i,r),s=Math.max(i,r);return dn(t,qi,Ot)&&(s=1),dn(t,ry,Ot)&&(o=-1),D({lo:o,hi:s})}function Mf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.hi-t.lo>=Ot)return D({lo:-1,hi:1});let i=Math.cos(t.lo),r=Math.cos(t.hi),o=Math.min(i,r),s=Math.max(i,r);return dn(t,0,Ot)&&(s=1),dn(t,Ue,Ot)&&(o=-1),D({lo:o,hi:s})}function Df(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.hi-t.lo>=Ue)return{kind:"singular"};if(dn(t,qi,Ue)){let o=Math.ceil((t.lo-qi)/Ue);return{kind:"singular",at:qi+o*Ue}}let i=Math.tan(t.lo),r=Math.tan(t.hi);return i>1e10&&r<-1e10||i<-1e10&&r>1e10?{kind:"singular"}:D({lo:i,hi:r})}function Pf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.hi-t.lo>=Ue)return{kind:"singular"};if(dn(t,0,Ue))return{kind:"singular",at:Math.ceil(t.lo/Ue)*Ue};let i=1/Math.tan(t.lo),r=1/Math.tan(t.hi);return D({lo:Math.min(i,r),hi:Math.max(i,r)})}function Of(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.hi-t.lo>=Ue)return{kind:"singular"};if(dn(t,qi,Ue)){let a=Math.ceil((t.lo-qi)/Ue);return{kind:"singular",at:qi+a*Ue}}let i=1/Math.cos(t.lo),r=1/Math.cos(t.hi),o=Math.min(i,r),s=Math.max(i,r);return dn(t,0,Ot)&&(o=Math.min(o,1),s=Math.max(s,1)),dn(t,Ue,Ot)&&(o=Math.min(o,-1),s=Math.max(s,-1)),D({lo:o,hi:s})}function Lf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.hi-t.lo>=Ue)return{kind:"singular"};if(dn(t,0,Ue))return{kind:"singular",at:Math.ceil(t.lo/Ue)*Ue};let i=1/Math.sin(t.lo),r=1/Math.sin(t.hi),o=Math.min(i,r),s=Math.max(i,r);return dn(t,qi,Ot)&&(o=Math.min(o,1),s=Math.max(s,1)),dn(t,ry,Ot)&&(o=Math.min(o,-1),s=Math.max(s,-1)),D({lo:o,hi:s})}function qf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.lo>1||t.hi<-1)return{kind:"empty"};if(t.lo<-1||t.hi>1){let i=Math.max(t.lo,-1),r=Math.min(t.hi,1);return{kind:"partial",value:{lo:Math.asin(i),hi:Math.asin(r)},domainClipped:t.lo<-1&&t.hi>1?"both":t.lo<-1?"lo":"hi"}}return D({lo:Math.asin(t.lo),hi:Math.asin(t.hi)})}function Ff(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.lo>1||t.hi<-1)return{kind:"empty"};if(t.lo<-1||t.hi>1){let i=Math.max(t.lo,-1),r=Math.min(t.hi,1);return{kind:"partial",value:{lo:Math.acos(r),hi:Math.acos(i)},domainClipped:t.lo<-1&&t.hi>1?"both":t.lo<-1?"lo":"hi"}}return D({lo:Math.acos(t.hi),hi:Math.acos(t.lo)})}function Vf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:Math.atan(t.lo),hi:Math.atan(t.hi)})}function $f(n,e){let t=$(n,e);if(!Array.isArray(t))return t;let[i,r]=t;if(i.lo===i.hi&&r.lo===r.hi){let s=Math.atan2(i.lo,r.lo);return D({lo:s,hi:s})}let o=[];return o.push(Math.atan2(i.lo,r.lo)),o.push(Math.atan2(i.lo,r.hi)),o.push(Math.atan2(i.hi,r.lo)),o.push(Math.atan2(i.hi,r.hi)),r.lo<0&&i.lo<0&&i.hi>0?D({lo:-Ue,hi:Ue}):D({lo:Math.min(...o),hi:Math.max(...o)})}function jf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:Math.sinh(t.lo),hi:Math.sinh(t.hi)})}function Uf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return t.lo>=0?D({lo:Math.cosh(t.lo),hi:Math.cosh(t.hi)}):t.hi<=0?D({lo:Math.cosh(t.hi),hi:Math.cosh(t.lo)}):D({lo:1,hi:Math.max(Math.cosh(t.lo),Math.cosh(t.hi))})}function Gf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:Math.tanh(t.lo),hi:Math.tanh(t.hi)})}function zf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return D({lo:Math.asinh(t.lo),hi:Math.asinh(t.hi)})}function Zf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;return t.hi<1?{kind:"empty"}:t.lo<1?{kind:"partial",value:{lo:0,hi:Math.acosh(t.hi)},domainClipped:"lo"}:D({lo:Math.acosh(t.lo),hi:Math.acosh(t.hi)})}function Hf(n){let e=$(n);if(!Array.isArray(e))return e;let[t]=e;if(t.lo>=1||t.hi<=-1)return{kind:"empty"};if(t.lo<=-1||t.hi>=1){let i=Math.max(t.lo,-1+Number.EPSILON),r=Math.min(t.hi,1-Number.EPSILON);return{kind:"partial",value:{lo:Math.atanh(i),hi:Math.atanh(r)},domainClipped:t.lo<=-1&&t.hi>=1?"both":t.lo<=-1?"lo":"hi"}}return D({lo:Math.atanh(t.lo),hi:Math.atanh(t.hi)})}function Wf(n,e){let t=$(n,e);if(!Array.isArray(t))return"maybe";let[i,r]=t;return i.hi<r.lo?"true":i.lo>=r.hi?"false":"maybe"}function Jf(n,e){let t=$(n,e);if(!Array.isArray(t))return"maybe";let[i,r]=t;return i.hi<=r.lo?"true":i.lo>r.hi?"false":"maybe"}function Yf(n,e){let t=$(n,e);if(!Array.isArray(t))return"maybe";let[i,r]=t;return i.lo>r.hi?"true":i.hi<=r.lo?"false":"maybe"}function Qf(n,e){let t=$(n,e);if(!Array.isArray(t))return"maybe";let[i,r]=t;return i.lo>=r.hi?"true":i.hi<r.lo?"false":"maybe"}function ru(n,e){let t=$(n,e);if(!Array.isArray(t))return"maybe";let[i,r]=t;return i.lo===i.hi&&r.lo===r.hi&&i.lo===r.lo?"true":i.hi<r.lo||r.hi<i.lo?"false":"maybe"}function Xf(n,e){let t=ru(n,e);return t==="true"?"false":t==="false"?"true":"maybe"}function Kf(n,e){return n==="false"||e==="false"?"false":n==="true"&&e==="true"?"true":"maybe"}function ep(n,e){return n==="true"||e==="true"?"true":n==="false"&&e==="false"?"false":"maybe"}function np(n){return n==="true"?"false":n==="false"?"true":"maybe"}function tp(n,e,t,i){if(n==="true"||n==="false"||n==="maybe"){let f=n,p=e,d=t;switch(f){case"true":return p();case"false":return d();case"maybe":return Eo(p(),d())}}let r=n,o=e,s=t,a=i,u=$(r);if(!Array.isArray(u))return u;let[l]=u;switch(o(l)){case"true":return s(l);case"false":return a(l);case"maybe":let f=s(l),p=a(l);return Eo(f,p)}}function ip(n,e,t){let i=$(n,e,t);if(!Array.isArray(i))return i;let[r,o,s]=i,a=Math.max(r.lo,o.lo),u=Math.min(r.hi,s.hi);return a>u?{kind:"empty"}:{kind:"interval",value:{lo:a,hi:u}}}var oy={ok:D,point:ef,containsExtremum:dn,unionResults:Eo,mergeDomainClip:iu,isPoint:nf,containsZero:vo,isPositive:tf,isNegative:As,isNonNegative:rf,isNonPositive:of,width:sf,midpoint:af,getValue:uf,unwrap:lf,unwrapOrPropagate:$,add:cf,sub:ff,mul:mf,div:gf,negate:pf,sqrt:hf,square:xf,pow:yf,powInterval:bf,exp:Ef,ln:vf,log10:_f,log2:Nf,abs:Tf,floor:Sf,ceil:If,round:Bf,min:wf,max:Af,mod:kf,sign:Cf,sin:Rf,cos:Mf,tan:Df,cot:Pf,sec:Of,csc:Lf,asin:qf,acos:Ff,atan:Vf,atan2:$f,sinh:jf,cosh:Uf,tanh:Gf,asinh:zf,acosh:Zf,atanh:Hf,less:Wf,lessEqual:Jf,greater:Yf,greaterEqual:Qf,equal:ru,notEqual:Xf,and:Kf,or:ep,not:np,piecewise:tp,clamp:ip};var y_={Add:["_IA.add",20],Negate:["_IA.negate",20],Subtract:["_IA.sub",20],Multiply:["_IA.mul",20],Divide:["_IA.div",20],Equal:["_IA.equal",20],NotEqual:["_IA.notEqual",20],LessEqual:["_IA.lessEqual",20],GreaterEqual:["_IA.greaterEqual",20],Less:["_IA.less",20],Greater:["_IA.greater",20],And:["_IA.and",20],Or:["_IA.or",20],Not:["_IA.not",20]},rp={Add:(n,e)=>{if(n.length===0)return"_IA.point(0)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`_IA.add(${t}, ${e(n[i])})`;return t},Subtract:(n,e)=>{if(n.length===0)return"_IA.point(0)";if(n.length===1)return`_IA.negate(${e(n[0])})`;if(n.length===2)return`_IA.sub(${e(n[0])}, ${e(n[1])})`;let t=e(n[0]);for(let i=1;i<n.length;i++)t=`_IA.sub(${t}, ${e(n[i])})`;return t},Multiply:(n,e)=>{if(n.length===0)return"_IA.point(1)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`_IA.mul(${t}, ${e(n[i])})`;return t},Divide:(n,e)=>{if(n.length===0)return"_IA.point(1)";if(n.length===1)return e(n[0]);if(n.length===2)return`_IA.div(${e(n[0])}, ${e(n[1])})`;let t=e(n[0]);for(let i=1;i<n.length;i++)t=`_IA.div(${t}, ${e(n[i])})`;return t},Negate:(n,e)=>`_IA.negate(${e(n[0])})`,Abs:(n,e)=>`_IA.abs(${e(n[0])})`,Ceiling:(n,e)=>`_IA.ceil(${e(n[0])})`,Exp:(n,e)=>`_IA.exp(${e(n[0])})`,Floor:(n,e)=>`_IA.floor(${e(n[0])})`,Ln:(n,e)=>`_IA.ln(${e(n[0])})`,Log:(n,e)=>n.length===1?`_IA.log10(${e(n[0])})`:`_IA.div(_IA.ln(${e(n[0])}), _IA.ln(${e(n[1])}))`,Lb:(n,e)=>`_IA.log2(${e(n[0])})`,Max:(n,e)=>{if(n.length===0)return"_IA.point(-Infinity)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`_IA.max(${t}, ${e(n[i])})`;return t},Min:(n,e)=>{if(n.length===0)return"_IA.point(Infinity)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`_IA.min(${t}, ${e(n[i])})`;return t},Power:(n,e)=>{let t=n[0],i=n[1];if(t===null)throw new Error("Power: no argument");if(t.symbol==="ExponentialE")return`_IA.exp(${e(i)})`;if(i?.isNumberLiteral&&i.im===0){let r=i.re;return r===.5?`_IA.sqrt(${e(t)})`:r===2?`_IA.square(${e(t)})`:`_IA.pow(${e(t)}, ${r})`}return`_IA.powInterval(${e(t)}, ${e(i)})`},Root:(n,e)=>{let[t,i]=n;if(t===null)throw new Error("Root: no argument");return i===null?`_IA.sqrt(${e(t)})`:i?.re===2?`_IA.sqrt(${e(t)})`:i?.isNumberLiteral&&i.im===0?`_IA.pow(${e(t)}, ${1/i.re})`:`_IA.powInterval(${e(t)}, _IA.div(_IA.point(1), ${e(i)}))`},Round:(n,e)=>`_IA.round(${e(n[0])})`,Sgn:(n,e)=>`_IA.sign(${e(n[0])})`,Sqrt:(n,e)=>`_IA.sqrt(${e(n[0])})`,Square:(n,e)=>`_IA.square(${e(n[0])})`,Sin:(n,e)=>`_IA.sin(${e(n[0])})`,Cos:(n,e)=>`_IA.cos(${e(n[0])})`,Tan:(n,e)=>`_IA.tan(${e(n[0])})`,Cot:(n,e)=>`_IA.cot(${e(n[0])})`,Sec:(n,e)=>`_IA.sec(${e(n[0])})`,Csc:(n,e)=>`_IA.csc(${e(n[0])})`,Arcsin:(n,e)=>`_IA.asin(${e(n[0])})`,Arccos:(n,e)=>`_IA.acos(${e(n[0])})`,Arctan:(n,e)=>`_IA.atan(${e(n[0])})`,Sinh:(n,e)=>`_IA.sinh(${e(n[0])})`,Cosh:(n,e)=>`_IA.cosh(${e(n[0])})`,Tanh:(n,e)=>`_IA.tanh(${e(n[0])})`,Arsinh:(n,e)=>`_IA.asinh(${e(n[0])})`,Arcosh:(n,e)=>`_IA.acosh(${e(n[0])})`,Artanh:(n,e)=>`_IA.atanh(${e(n[0])})`,Asin:(n,e)=>`_IA.asin(${e(n[0])})`,Acos:(n,e)=>`_IA.acos(${e(n[0])})`,Atan:(n,e)=>`_IA.atan(${e(n[0])})`,Mod:(n,e)=>`_IA.mod(${e(n[0])}, ${e(n[1])})`,If:(n,e)=>{if(n.length!==3)throw new Error("If: wrong number of arguments");return`_IA.piecewise(
      ${e(n[0])},
      () => ${e(n[1])},
      () => ${e(n[2])}
    )`},Equal:(n,e)=>`_IA.equal(${e(n[0])}, ${e(n[1])})`,NotEqual:(n,e)=>`_IA.notEqual(${e(n[0])}, ${e(n[1])})`,LessEqual:(n,e)=>`_IA.lessEqual(${e(n[0])}, ${e(n[1])})`,GreaterEqual:(n,e)=>`_IA.greaterEqual(${e(n[0])}, ${e(n[1])})`,Less:(n,e)=>`_IA.less(${e(n[0])}, ${e(n[1])})`,Greater:(n,e)=>`_IA.greater(${e(n[0])}, ${e(n[1])})`,And:(n,e)=>`_IA.and(${e(n[0])}, ${e(n[1])})`,Or:(n,e)=>`_IA.or(${e(n[0])}, ${e(n[1])})`,Not:(n,e)=>`_IA.not(${e(n[0])})`},op=class extends Function{IA=oy;constructor(e,t=""){return super("_IA","_",t?`${t};return ${e}`:`return ${e}`),new Proxy(this,{apply:(i,r,o)=>{let s=o.map(sy);return super.apply(r,[this.IA,...s])},get:(i,r)=>r==="toString"?()=>e:r==="isCompiled"?!0:i[r]})}};function sy(n){if(n==null||typeof n=="object"&&"lo"in n&&"hi"in n)return n;if(typeof n=="object"){let e={};for(let[t,i]of Object.entries(n))e[t]=sy(i);return e}return typeof n=="number"?{lo:n,hi:n}:n}var ks=class{getOperators(){return y_}getFunctions(){return rp}createTarget(e={}){return{language:"interval-javascript",operators:()=>{},functions:t=>rp[t],var:t=>({Pi:"_IA.point(Math.PI)",ExponentialE:"_IA.point(Math.E)",NaN:"{ lo: NaN, hi: NaN }",ImaginaryUnit:"{ lo: NaN, hi: NaN }",Half:"_IA.point(0.5)",MachineEpsilon:"_IA.point(Number.EPSILON)",GoldenRatio:"_IA.point((1 + Math.sqrt(5)) / 2)",CatalanConstant:"_IA.point(0.91596559417721901)",EulerGamma:"_IA.point(0.57721566490153286)"})[t],string:t=>JSON.stringify(t),number:t=>`_IA.point(${t})`,indent:0,ws:t=>t??"",preamble:"",...e}}compileToExecutable(e,t={}){let{functions:i,vars:r,preamble:o}=t,s=e.unknowns,a={},u="";if(i)for(let[c,f]of Object.entries(i))typeof f=="function"?(u+=`const ${c} = ${f.toString()};
`,a[c]=c):typeof f=="string"&&(a[c]=f);let l=this.createTarget({functions:c=>a?.[c]?a[c]:rp[c],var:c=>{if(r&&c in r)return r[c];let f={Pi:"_IA.point(Math.PI)",ExponentialE:"_IA.point(Math.E)",NaN:"{ lo: NaN, hi: NaN }",ImaginaryUnit:"{ lo: NaN, hi: NaN }",Half:"_IA.point(0.5)",MachineEpsilon:"_IA.point(Number.EPSILON)",GoldenRatio:"_IA.point((1 + Math.sqrt(5)) / 2)",CatalanConstant:"_IA.point(0.91596559417721901)",EulerGamma:"_IA.point(0.57721566490153286)"};if(c in f)return f[c];if(s.includes(c))return`_.${c}`},preamble:(o??"")+u});return b_(e,l)}};function b_(n,e){let t=Je.compile(n,e);return new op(t,e.preamble)}Ct();var ay=`
// Interval Arithmetic Library for GLSL
// Intervals are represented as vec2(lo, hi)
// Results use IntervalResult struct with status flags

// Status constants
const float IA_NORMAL = 0.0;
const float IA_EMPTY = 1.0;
const float IA_ENTIRE = 2.0;
const float IA_SINGULAR = 3.0;
const float IA_PARTIAL_LO = 4.0;
const float IA_PARTIAL_HI = 5.0;
const float IA_PARTIAL_BOTH = 6.0;

// Interval result struct
struct IntervalResult {
  vec2 value;      // (lo, hi)
  float status;    // Status flag
};

// Epsilon for conservative bounds
const float IA_EPS = 1e-6;
const float IA_HUGE = 1e38;

// Create a point interval
vec2 ia_point(float x) {
  return vec2(x, x);
}

// Create interval result
IntervalResult ia_ok(vec2 v) {
  return IntervalResult(v, IA_NORMAL);
}

IntervalResult ia_empty() {
  return IntervalResult(vec2(0.0), IA_EMPTY);
}

IntervalResult ia_entire() {
  return IntervalResult(vec2(-IA_HUGE, IA_HUGE), IA_ENTIRE);
}

IntervalResult ia_singular(float at) {
  return IntervalResult(vec2(at, at), IA_SINGULAR);
}

IntervalResult ia_partial(vec2 v, float clip) {
  return IntervalResult(v, clip);
}

bool ia_is_error(float status) {
  return status == IA_EMPTY || status == IA_ENTIRE || status == IA_SINGULAR;
}

// Addition
IntervalResult ia_add(vec2 a, vec2 b) {
  return ia_ok(vec2(a.x + b.x - IA_EPS, a.y + b.y + IA_EPS));
}

// Subtraction
IntervalResult ia_sub(vec2 a, vec2 b) {
  return ia_ok(vec2(a.x - b.y - IA_EPS, a.y - b.x + IA_EPS));
}

// Negation
IntervalResult ia_negate(vec2 x) {
  return ia_ok(vec2(-x.y, -x.x));
}

// Multiplication helper (returns vec2)
vec2 ia_mul_raw(vec2 a, vec2 b) {
  float p1 = a.x * b.x;
  float p2 = a.x * b.y;
  float p3 = a.y * b.x;
  float p4 = a.y * b.y;
  return vec2(
    min(min(p1, p2), min(p3, p4)) - IA_EPS,
    max(max(p1, p2), max(p3, p4)) + IA_EPS
  );
}

// Multiplication
IntervalResult ia_mul(vec2 a, vec2 b) {
  return ia_ok(ia_mul_raw(a, b));
}

// Division
IntervalResult ia_div(vec2 a, vec2 b) {
  // Case 1: Divisor entirely positive or negative
  if (b.x > 0.0 || b.y < 0.0) {
    return ia_ok(ia_mul_raw(a, vec2(1.0 / b.y, 1.0 / b.x)));
  }

  // Case 2: Divisor strictly contains zero
  if (b.x < 0.0 && b.y > 0.0) {
    return ia_singular(0.0);
  }

  // Case 3: Divisor touches zero at lower bound [0, c]
  if (b.x == 0.0 && b.y > 0.0) {
    if (a.x >= 0.0) {
      return ia_partial(vec2(a.x / b.y, IA_HUGE), IA_PARTIAL_HI);
    } else if (a.y <= 0.0) {
      return ia_partial(vec2(-IA_HUGE, a.y / b.y), IA_PARTIAL_LO);
    } else {
      return ia_entire();
    }
  }

  // Case 4: Divisor touches zero at upper bound [c, 0]
  if (b.y == 0.0 && b.x < 0.0) {
    if (a.x >= 0.0) {
      return ia_partial(vec2(-IA_HUGE, a.x / b.x), IA_PARTIAL_LO);
    } else if (a.y <= 0.0) {
      return ia_partial(vec2(a.y / b.x, IA_HUGE), IA_PARTIAL_HI);
    } else {
      return ia_entire();
    }
  }

  // Case 5: Divisor is [0, 0]
  return ia_empty();
}

// Square root
IntervalResult ia_sqrt(vec2 x) {
  if (x.y < 0.0) {
    return ia_empty();
  }
  if (x.x >= 0.0) {
    return ia_ok(vec2(sqrt(x.x), sqrt(x.y) + IA_EPS));
  }
  return ia_partial(vec2(0.0, sqrt(x.y) + IA_EPS), IA_PARTIAL_LO);
}

// Square
IntervalResult ia_square(vec2 x) {
  if (x.x >= 0.0) {
    return ia_ok(vec2(x.x * x.x - IA_EPS, x.y * x.y + IA_EPS));
  } else if (x.y <= 0.0) {
    return ia_ok(vec2(x.y * x.y - IA_EPS, x.x * x.x + IA_EPS));
  } else {
    float m = max(-x.x, x.y);
    return ia_ok(vec2(0.0, m * m + IA_EPS));
  }
}

// Exponential
IntervalResult ia_exp(vec2 x) {
  return ia_ok(vec2(exp(x.x) - IA_EPS, exp(x.y) + IA_EPS));
}

// Natural logarithm
IntervalResult ia_ln(vec2 x) {
  if (x.y <= 0.0) {
    return ia_empty();
  }
  if (x.x > 0.0) {
    return ia_ok(vec2(log(x.x) - IA_EPS, log(x.y) + IA_EPS));
  }
  return ia_partial(vec2(-IA_HUGE, log(x.y) + IA_EPS), IA_PARTIAL_LO);
}

// Absolute value
IntervalResult ia_abs(vec2 x) {
  if (x.x >= 0.0) {
    return ia_ok(x);
  }
  if (x.y <= 0.0) {
    return ia_ok(vec2(-x.y, -x.x));
  }
  return ia_ok(vec2(0.0, max(-x.x, x.y)));
}

// Sign function
IntervalResult ia_sign(vec2 x) {
  if (x.x > 0.0) return ia_ok(vec2(1.0, 1.0));
  if (x.y < 0.0) return ia_ok(vec2(-1.0, -1.0));
  if (x.x == 0.0 && x.y == 0.0) return ia_ok(vec2(0.0, 0.0));
  if (x.x < 0.0 && x.y > 0.0) return ia_ok(vec2(-1.0, 1.0));
  if (x.x == 0.0) return ia_ok(vec2(0.0, 1.0));
  return ia_ok(vec2(-1.0, 0.0));
}

// Floor
IntervalResult ia_floor(vec2 x) {
  return ia_ok(vec2(floor(x.x), floor(x.y)));
}

// Ceiling
IntervalResult ia_ceil(vec2 x) {
  return ia_ok(vec2(ceil(x.x), ceil(x.y)));
}

// Min of two intervals
IntervalResult ia_min(vec2 a, vec2 b) {
  return ia_ok(vec2(min(a.x, b.x), min(a.y, b.y)));
}

// Max of two intervals
IntervalResult ia_max(vec2 a, vec2 b) {
  return ia_ok(vec2(max(a.x, b.x), max(a.y, b.y)));
}

// Power with constant exponent
IntervalResult ia_pow(vec2 base, float exp) {
  if (exp == 0.0) return ia_ok(vec2(1.0, 1.0));
  if (exp == 1.0) return ia_ok(base);
  if (exp == 2.0) return ia_square(base);
  if (exp == 0.5) return ia_sqrt(base);

  // General case - requires positive base for non-integer exponents
  if (base.y < 0.0) {
    return ia_empty();
  }
  if (base.x < 0.0) {
    // Partial domain
    if (exp > 0.0) {
      return ia_partial(vec2(0.0, pow(base.y, exp) + IA_EPS), IA_PARTIAL_LO);
    } else {
      return ia_partial(vec2(pow(base.y, exp) - IA_EPS, IA_HUGE), IA_PARTIAL_LO);
    }
  }

  // Entirely non-negative
  if (exp > 0.0) {
    return ia_ok(vec2(pow(base.x, exp) - IA_EPS, pow(base.y, exp) + IA_EPS));
  } else {
    if (base.x == 0.0) {
      return ia_partial(vec2(pow(base.y, exp) - IA_EPS, IA_HUGE), IA_PARTIAL_HI);
    }
    return ia_ok(vec2(pow(base.y, exp) - IA_EPS, pow(base.x, exp) + IA_EPS));
  }
}

// Check if interval contains extremum at (extremum + n * period)
bool ia_contains_extremum(vec2 x, float extremum, float period) {
  float n = ceil((x.x - extremum) / period);
  float candidate = extremum + n * period;
  return candidate >= x.x - 1e-7 && candidate <= x.y + 1e-7;
}

// Sine
IntervalResult ia_sin(vec2 x) {
  const float TWO_PI = 6.28318530718;
  const float HALF_PI = 1.57079632679;
  const float THREE_HALF_PI = 4.71238898038;

  if (x.y - x.x >= TWO_PI) {
    return ia_ok(vec2(-1.0, 1.0));
  }

  float sinLo = sin(x.x);
  float sinHi = sin(x.y);
  float lo = min(sinLo, sinHi);
  float hi = max(sinLo, sinHi);

  if (ia_contains_extremum(x, HALF_PI, TWO_PI)) hi = 1.0;
  if (ia_contains_extremum(x, THREE_HALF_PI, TWO_PI)) lo = -1.0;

  return ia_ok(vec2(lo - IA_EPS, hi + IA_EPS));
}

// Cosine
IntervalResult ia_cos(vec2 x) {
  const float TWO_PI = 6.28318530718;
  const float PI = 3.14159265359;

  if (x.y - x.x >= TWO_PI) {
    return ia_ok(vec2(-1.0, 1.0));
  }

  float cosLo = cos(x.x);
  float cosHi = cos(x.y);
  float lo = min(cosLo, cosHi);
  float hi = max(cosLo, cosHi);

  if (ia_contains_extremum(x, 0.0, TWO_PI)) hi = 1.0;
  if (ia_contains_extremum(x, PI, TWO_PI)) lo = -1.0;

  return ia_ok(vec2(lo - IA_EPS, hi + IA_EPS));
}

// Tangent
IntervalResult ia_tan(vec2 x) {
  const float PI = 3.14159265359;
  const float HALF_PI = 1.57079632679;

  if (x.y - x.x >= PI) {
    return ia_singular(0.0);
  }

  if (ia_contains_extremum(x, HALF_PI, PI)) {
    float n = ceil((x.x - HALF_PI) / PI);
    float poleAt = HALF_PI + n * PI;
    return ia_singular(poleAt);
  }

  float tanLo = tan(x.x);
  float tanHi = tan(x.y);

  if ((tanLo > 1e10 && tanHi < -1e10) || (tanLo < -1e10 && tanHi > 1e10)) {
    return ia_singular(0.0);
  }

  return ia_ok(vec2(tanLo - IA_EPS, tanHi + IA_EPS));
}

// Arc sine
IntervalResult ia_asin(vec2 x) {
  if (x.x > 1.0 || x.y < -1.0) {
    return ia_empty();
  }

  vec2 clipped = vec2(max(x.x, -1.0), min(x.y, 1.0));

  if (x.x < -1.0 || x.y > 1.0) {
    float clip = (x.x < -1.0 && x.y > 1.0) ? IA_PARTIAL_BOTH :
                 (x.x < -1.0) ? IA_PARTIAL_LO : IA_PARTIAL_HI;
    return ia_partial(vec2(asin(clipped.x) - IA_EPS, asin(clipped.y) + IA_EPS), clip);
  }

  return ia_ok(vec2(asin(x.x) - IA_EPS, asin(x.y) + IA_EPS));
}

// Arc cosine
IntervalResult ia_acos(vec2 x) {
  if (x.x > 1.0 || x.y < -1.0) {
    return ia_empty();
  }

  vec2 clipped = vec2(max(x.x, -1.0), min(x.y, 1.0));

  if (x.x < -1.0 || x.y > 1.0) {
    float clip = (x.x < -1.0 && x.y > 1.0) ? IA_PARTIAL_BOTH :
                 (x.x < -1.0) ? IA_PARTIAL_LO : IA_PARTIAL_HI;
    // acos is decreasing, so bounds swap
    return ia_partial(vec2(acos(clipped.y) - IA_EPS, acos(clipped.x) + IA_EPS), clip);
  }

  // acos is decreasing
  return ia_ok(vec2(acos(x.y) - IA_EPS, acos(x.x) + IA_EPS));
}

// Arc tangent
IntervalResult ia_atan(vec2 x) {
  return ia_ok(vec2(atan(x.x) - IA_EPS, atan(x.y) + IA_EPS));
}

// Hyperbolic sine
IntervalResult ia_sinh(vec2 x) {
  return ia_ok(vec2(sinh(x.x) - IA_EPS, sinh(x.y) + IA_EPS));
}

// Hyperbolic cosine
IntervalResult ia_cosh(vec2 x) {
  if (x.x >= 0.0) {
    return ia_ok(vec2(cosh(x.x) - IA_EPS, cosh(x.y) + IA_EPS));
  } else if (x.y <= 0.0) {
    return ia_ok(vec2(cosh(x.y) - IA_EPS, cosh(x.x) + IA_EPS));
  } else {
    return ia_ok(vec2(1.0 - IA_EPS, max(cosh(x.x), cosh(x.y)) + IA_EPS));
  }
}

// Hyperbolic tangent
IntervalResult ia_tanh(vec2 x) {
  return ia_ok(vec2(tanh(x.x) - IA_EPS, tanh(x.y) + IA_EPS));
}

// IntervalResult overloads for propagation
IntervalResult ia_add(IntervalResult a, IntervalResult b) {
  if (ia_is_error(a.status)) return a;
  if (ia_is_error(b.status)) return b;
  return ia_add(a.value, b.value);
}

IntervalResult ia_add(IntervalResult a, vec2 b) {
  if (ia_is_error(a.status)) return a;
  return ia_add(a.value, b);
}

IntervalResult ia_add(vec2 a, IntervalResult b) {
  if (ia_is_error(b.status)) return b;
  return ia_add(a, b.value);
}

IntervalResult ia_sub(IntervalResult a, IntervalResult b) {
  if (ia_is_error(a.status)) return a;
  if (ia_is_error(b.status)) return b;
  return ia_sub(a.value, b.value);
}

IntervalResult ia_sub(IntervalResult a, vec2 b) {
  if (ia_is_error(a.status)) return a;
  return ia_sub(a.value, b);
}

IntervalResult ia_sub(vec2 a, IntervalResult b) {
  if (ia_is_error(b.status)) return b;
  return ia_sub(a, b.value);
}

IntervalResult ia_mul(IntervalResult a, IntervalResult b) {
  if (ia_is_error(a.status)) return a;
  if (ia_is_error(b.status)) return b;
  return ia_mul(a.value, b.value);
}

IntervalResult ia_mul(IntervalResult a, vec2 b) {
  if (ia_is_error(a.status)) return a;
  return ia_mul(a.value, b);
}

IntervalResult ia_mul(vec2 a, IntervalResult b) {
  if (ia_is_error(b.status)) return b;
  return ia_mul(a, b.value);
}

IntervalResult ia_div(IntervalResult a, IntervalResult b) {
  if (ia_is_error(a.status)) return a;
  if (ia_is_error(b.status)) return b;
  return ia_div(a.value, b.value);
}

IntervalResult ia_div(IntervalResult a, vec2 b) {
  if (ia_is_error(a.status)) return a;
  return ia_div(a.value, b);
}

IntervalResult ia_div(vec2 a, IntervalResult b) {
  if (ia_is_error(b.status)) return b;
  return ia_div(a, b.value);
}

IntervalResult ia_negate(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_negate(x.value);
}

IntervalResult ia_sqrt(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_sqrt(x.value);
}

IntervalResult ia_square(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_square(x.value);
}

IntervalResult ia_exp(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_exp(x.value);
}

IntervalResult ia_ln(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_ln(x.value);
}

IntervalResult ia_abs(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_abs(x.value);
}

IntervalResult ia_sign(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_sign(x.value);
}

IntervalResult ia_floor(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_floor(x.value);
}

IntervalResult ia_ceil(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_ceil(x.value);
}

IntervalResult ia_min(IntervalResult a, IntervalResult b) {
  if (ia_is_error(a.status)) return a;
  if (ia_is_error(b.status)) return b;
  return ia_min(a.value, b.value);
}

IntervalResult ia_min(IntervalResult a, vec2 b) {
  if (ia_is_error(a.status)) return a;
  return ia_min(a.value, b);
}

IntervalResult ia_min(vec2 a, IntervalResult b) {
  if (ia_is_error(b.status)) return b;
  return ia_min(a, b.value);
}

IntervalResult ia_max(IntervalResult a, IntervalResult b) {
  if (ia_is_error(a.status)) return a;
  if (ia_is_error(b.status)) return b;
  return ia_max(a.value, b.value);
}

IntervalResult ia_max(IntervalResult a, vec2 b) {
  if (ia_is_error(a.status)) return a;
  return ia_max(a.value, b);
}

IntervalResult ia_max(vec2 a, IntervalResult b) {
  if (ia_is_error(b.status)) return b;
  return ia_max(a, b.value);
}

IntervalResult ia_pow(IntervalResult base, float exp) {
  if (ia_is_error(base.status)) return base;
  return ia_pow(base.value, exp);
}

IntervalResult ia_sin(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_sin(x.value);
}

IntervalResult ia_cos(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_cos(x.value);
}

IntervalResult ia_tan(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_tan(x.value);
}

IntervalResult ia_asin(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_asin(x.value);
}

IntervalResult ia_acos(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_acos(x.value);
}

IntervalResult ia_atan(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_atan(x.value);
}

IntervalResult ia_sinh(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_sinh(x.value);
}

IntervalResult ia_cosh(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_cosh(x.value);
}

IntervalResult ia_tanh(IntervalResult x) {
  if (ia_is_error(x.status)) return x;
  return ia_tanh(x.value);
}
`,E_={Add:["ia_add",20],Negate:["ia_negate",20],Subtract:["ia_sub",20],Multiply:["ia_mul",20],Divide:["ia_div",20]},sp={Add:(n,e)=>{if(n.length===0)return"ia_point(0.0)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`ia_add(${t}, ${e(n[i])})`;return t},Subtract:(n,e)=>{if(n.length===0)return"ia_point(0.0)";if(n.length===1)return`ia_negate(${e(n[0])})`;let t=e(n[0]);for(let i=1;i<n.length;i++)t=`ia_sub(${t}, ${e(n[i])})`;return t},Multiply:(n,e)=>{if(n.length===0)return"ia_point(1.0)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`ia_mul(${t}, ${e(n[i])})`;return t},Divide:(n,e)=>{if(n.length===0)return"ia_point(1.0)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`ia_div(${t}, ${e(n[i])})`;return t},Negate:(n,e)=>`ia_negate(${e(n[0])})`,Abs:(n,e)=>`ia_abs(${e(n[0])})`,Ceiling:(n,e)=>`ia_ceil(${e(n[0])})`,Exp:(n,e)=>`ia_exp(${e(n[0])})`,Floor:(n,e)=>`ia_floor(${e(n[0])})`,Ln:(n,e)=>`ia_ln(${e(n[0])})`,Max:(n,e)=>{if(n.length===0)return"ia_point(-1e38)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`ia_max(${t}, ${e(n[i])})`;return t},Min:(n,e)=>{if(n.length===0)return"ia_point(1e38)";if(n.length===1)return e(n[0]);let t=e(n[0]);for(let i=1;i<n.length;i++)t=`ia_min(${t}, ${e(n[i])})`;return t},Power:(n,e)=>{let t=n[0],i=n[1];if(t===null)throw new Error("Power: no argument");if(t.symbol==="ExponentialE")return`ia_exp(${e(i)})`;if(i?.isNumberLiteral&&i.im===0){let r=i.re;return r===2?`ia_square(${e(t)})`:`ia_pow(${e(t)}, ${r})`}throw new Error("Interval GLSL does not support variable exponents")},Sgn:(n,e)=>`ia_sign(${e(n[0])})`,Sqrt:(n,e)=>`ia_sqrt(${e(n[0])})`,Square:(n,e)=>`ia_square(${e(n[0])})`,Sin:(n,e)=>`ia_sin(${e(n[0])})`,Cos:(n,e)=>`ia_cos(${e(n[0])})`,Tan:(n,e)=>`ia_tan(${e(n[0])})`,Arcsin:(n,e)=>`ia_asin(${e(n[0])})`,Arccos:(n,e)=>`ia_acos(${e(n[0])})`,Arctan:(n,e)=>`ia_atan(${e(n[0])})`,Sinh:(n,e)=>`ia_sinh(${e(n[0])})`,Cosh:(n,e)=>`ia_cosh(${e(n[0])})`,Tanh:(n,e)=>`ia_tanh(${e(n[0])})`},Cs=class{getOperators(){return E_}getFunctions(){return sp}getLibrary(){return ay}createTarget(e={}){return{language:"interval-glsl",operators:()=>{},functions:t=>sp[t],var:t=>{let i={Pi:"ia_point(3.14159265359)",ExponentialE:"ia_point(2.71828182846)",GoldenRatio:"ia_point(1.61803398875)",CatalanConstant:"ia_point(0.91596559417)",EulerGamma:"ia_point(0.57721566490)"};return t in i?i[t]:t},string:t=>JSON.stringify(t),number:t=>{let i=t.toString();return`ia_point(${!i.includes(".")&&!i.includes("e")&&!i.includes("E")?`${i}.0`:i})`},indent:0,ws:t=>t??"",preamble:"",...e}}compileToExecutable(e,t={}){let{functions:i,vars:r}=t,o=this.createTarget({functions:u=>{if(i&&u in i){let l=i[u];if(typeof l=="string")return l;if(typeof l=="function")return l.name||u}return sp[u]},var:u=>{if(r&&u in r)return r[u];let l={Pi:"ia_point(3.14159265359)",ExponentialE:"ia_point(2.71828182846)",GoldenRatio:"ia_point(1.61803398875)",CatalanConstant:"ia_point(0.91596559417)",EulerGamma:"ia_point(0.57721566490)"};return u in l?l[u]:u}}),s=Je.compile(e,o),a=function(){return s};return Object.defineProperty(a,"toString",{value:()=>s}),Object.defineProperty(a,"isCompiled",{value:!0}),a}compile(e,t={}){let i=this.createTarget();return Je.compile(e,i)}compileFunction(e,t,i){let r=this.createTarget(),o=Je.compile(e,r),s=i.map(a=>`vec2 ${a}`).join(", ");return`IntervalResult ${t}(${s}) {
  return ${o};
}`}compileShaderFunction(e,t={}){let{functionName:i="evaluateInterval",version:r="300 es",parameters:o=["x"]}=t,s=this.createTarget(),a=Je.compile(e,s),u=o.map(l=>`vec2 ${l}`).join(", ");return`#version ${r}
precision highp float;

${ay}

IntervalResult ${i}(${u}) {
  return ${a};
}
`}};Ct();var _o=class n{True;False;Pi;E;Nothing;Zero;One;Half;NegativeOne;Two;I;NaN;PositiveInfinity;NegativeInfinity;ComplexInfinity;decimalSeparator=".";_BIGNUM_NAN;_BIGNUM_ZERO;_BIGNUM_ONE;_BIGNUM_TWO;_BIGNUM_HALF;_BIGNUM_PI;_BIGNUM_NEGATIVE_ONE;_precision;_angularUnit;_tolerance;_bignumTolerance;_negBignumTolerance;__cache={};_configurationChangeTracker=new Ws;_cost;_compilationTargets=new Map;_commonSymbols={Pi:null,True:null,False:null,All:null,Nothing:null,None:null,Undefined:null,ImaginaryUnit:null,ExponentialE:null};_commonNumbers={"-5":null,"-4":null,"-3":null,"-2":null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,36:null};_evalContextStack=[];get context(){return this._evalContextStack[this._evalContextStack.length-1]}get contextStack(){return[...this._evalContextStack]}set contextStack(e){this._evalContextStack=[...e]}get _typeResolver(){let e=this;return{get names(){let t=[],i=e.context.lexicalScope;for(;i;)i.types&&t.push(...Object.keys(i.types)),i=i.parent;return t},resolve:t=>{let i=e.context.lexicalScope;for(;i;){if(i.types?.[t])return i.types[t];i=i.parent}},forward:t=>{let i={kind:"reference",name:t,alias:!1,def:void 0};return e.context.lexicalScope.types??={},e.context.lexicalScope.types[t]=i,i}}}declareType(e,t,{alias:i}={}){if(!zp(e))throw Error(`The type name "${e}" is invalid`);let r=this.context.lexicalScope;if(r.types?.[e])throw Error(`The type "${e}" is already defined in the current scope`);r.types??={},i??=!1,r.types[e]={kind:"reference",name:e,alias:i,def:void 0};let o=t instanceof R?t.type:typeof t=="string"?F(t,this._typeResolver):t;r.types[e].def=o}get trace(){return this._evalContextStack.map(e=>e.name).filter(e=>e!==void 0).reverse()}_generation=0;strict;deadline;_latexDictionaryInput;__indexedLatexDictionary;_bignum;static getStandardLibrary(e="all"){return Rc(e)}static getLatexDictionary(e="all"){return Qd(e)}constructor(e){if(e!==void 0&&typeof e!="object")throw Error("Unexpected argument");this.strict=!0;let t=e?.precision??Iu;t==="machine"&&(t=Math.floor(Et)),this._bignum=U.clone({precision:t}),this._precision=t,this.tolerance=e?.tolerance??"auto",this._angularUnit="rad",this.Zero=new En(this,0),this.One=new En(this,1),this.Half=new En(this,{rational:[1,2]}),this.NegativeOne=new En(this,-1),this.Two=new En(this,2),this.NaN=new En(this,Number.NaN),this.PositiveInfinity=new En(this,Number.POSITIVE_INFINITY),this.NegativeInfinity=new En(this,Number.NEGATIVE_INFINITY),this.I=new En(this,{im:1}),this.ComplexInfinity=new En(this,{re:1/0,im:1/0}),this._reset(),this.pushScope(void 0,"system"),this.declareType("limits","expression<Limits>");for(let r of n.getStandardLibrary("domains"))Mc(this,r);let i=e?.ids??n.getStandardLibrary();for(let r of i)Mc(this,r);for(let r of Object.keys(this._commonSymbols))this._commonSymbols[r]=new mr(this,r,{def:this.lookupDefinition(r)});this.True=this._commonSymbols.True,this.False=this._commonSymbols.False,this.Pi=this._commonSymbols.Pi,this.E=this._commonSymbols.ExponentialE,this.Nothing=this._commonSymbols.Nothing,this.pushScope(void 0,"global"),this._compilationTargets.set("javascript",new gr),this._compilationTargets.set("glsl",new hr),this._compilationTargets.set("interval-js",new ks),this._compilationTargets.set("interval-glsl",new Cs),Wp(this)}toJSON(){return"[ComputeEngine]"}[Symbol.toStringTag]="ComputeEngine";get latexDictionary(){return this._latexDictionaryInput??n.getLatexDictionary()}set latexDictionary(e){this._latexDictionaryInput=e,this.__indexedLatexDictionary=Ju(e,t=>{throw Error(typeof t.message=="string"?t.message:t.message.join(","))})}get _indexedLatexDictionary(){return this.__indexedLatexDictionary??=Ju(this.latexDictionary,e=>console.error(e)),this.__indexedLatexDictionary}_reset(){this._bignum,this._generation+=1,this._BIGNUM_NEGATIVE_ONE=this.bignum(-1),this._BIGNUM_NAN=this.bignum(NaN),this._BIGNUM_ZERO=this.bignum(0),this._BIGNUM_ONE=this.bignum(1),this._BIGNUM_TWO=this.bignum(2),this._BIGNUM_HALF=this._BIGNUM_ONE.div(this._BIGNUM_TWO),this._BIGNUM_PI=this._BIGNUM_NEGATIVE_ONE.acos();for(let e of Object.values(this._commonSymbols))e?.reset();for(let e of Object.keys(this.__cache))this.__cache[e].value&&(this.__cache[e].purge?this.__cache[e].value=this.__cache[e].purge(this.__cache[e].value):delete this.__cache[e]);this._configurationChangeTracker.notifyNow()}listenToConfigurationChange(e){return this._configurationChangeTracker.listen(e)}registerCompilationTarget(e,t){this._compilationTargets.set(e,t)}_getCompilationTarget(e){return this._compilationTargets.get(e)}get precision(){return this._precision}set precision(e){e==="machine"&&(e=Et),e==="auto"&&(e=Iu);let t=this._precision;if(e!==t){if(typeof e!="number"||e<=0)throw Error('Expected "machine" or a positive number');this._precision=Math.max(e,Et),this._bignum=this._bignum.config({precision:this._precision}),this.tolerance="auto",this._reset()}}get angularUnit(){return this._angularUnit}set angularUnit(e){if(e!==this._angularUnit){if(typeof e!="string")throw Error("Expected a string");this._angularUnit=e,this._reset()}}get timeLimit(){return this._timeLimit}set timeLimit(e){e<=0&&(e=Number.POSITIVE_INFINITY),this._timeLimit=e}_timeLimit=2e3;_deadline=void 0;get _timeRemaining(){return this.deadline===void 0?Number.POSITIVE_INFINITY:this.deadline-Date.now()}get iterationLimit(){return this._iterationLimit}set iterationLimit(e){e<=0&&(e=Number.POSITIVE_INFINITY),this._iterationLimit=e}_iterationLimit=1024;get recursionLimit(){return this._recursionLimit}set recursionLimit(e){e<=0&&(e=Number.POSITIVE_INFINITY),this._recursionLimit=e}_recursionLimit=1024;_isVerifying=!1;get isVerifying(){return this._isVerifying}get tolerance(){return this._tolerance}set tolerance(e){e==="auto"&&(e=Bu),(!Number.isFinite(e)||e<0)&&(e=Math.pow(10,-this._precision+2)),this._tolerance=e,this._bignumTolerance=this.bignum(e),this._negBignumTolerance=this.bignum(-e)}chop(e){return typeof e=="number"?Math.abs(e)<=this._tolerance?0:e:e instanceof U?e.isPositive()&&e.lte(this._bignumTolerance)||e.isNegative()&&e.gte(this._negBignumTolerance)||e.isZero()?0:e:e instanceof ie&&Math.abs(e.re)<=this._tolerance&&Math.abs(e.im)<=this._tolerance?0:e}bignum(e){if(typeof e=="bigint")return new this._bignum(e.toString());try{return new this._bignum(e)}catch(t){console.error(t.message)}return this._BIGNUM_NAN}complex(e,t){return e instanceof U&&(e=e.toNumber()),t instanceof U&&(t=t.toNumber()),new ie(e,t)}_numericValue(e){if(e instanceof ae)return e.asExact??e;let t=r=>this.bignum(r),i=this._precision>Et?r=>new Qi(r,t):r=>new Xi(r,t);if(typeof e=="number")return Number.isInteger(e)?new ye(e,i,t):i(e);if(typeof e=="bigint")return new ye(e,i,t);if(Qt(e))return new ye({rational:e},i,t);if(e instanceof U)return e.isInteger()&&e.e<=ed?new ye(be(e.toString()),i,t):i(e);if(e instanceof ie)return e.im===0?this._numericValue(e.re):i({re:e.re,im:e.im});if("im"in e||"re"in e)return e.im!==void 0&&e.im!==0?i(e):e.re instanceof U&&e.re.isInteger()?new ye({rational:[be(e.re.toString()),BigInt(1)]},i,t):typeof e.re=="number"&&Number.isInteger(e.re)?new ye({rational:[e.re,1]},i,t):i(e);if("radical"in e||"rational"in e){if(e.radical!==void 0&&(!Number.isInteger(e.radical)||e.radical>=K))throw Error("Unexpected value for radical part:"+e.radical);return e.rational&&Ne(e.rational)&&(!Number.isInteger(e.rational[0])||!Number.isInteger(e.rational[1]))?i(e):new ye(e,i,t)}throw Error("Unexpected value")}get costFunction(){return this._cost??Dc}set costFunction(e){typeof e!="function"&&(this._cost=Dc),this._cost=e}lookupDefinition(e){return ss(e,this.context.lexicalScope)}_declareSymbolValue(e,t,i){i??=this.context.lexicalScope,i.bindings.set(e,{value:new ct(this,e,{type:"unknown",inferred:!0})});let r=i.bindings.get(e);return sr(this,e,r,t),i===this.context.lexicalScope&&re(r)&&r.value.value&&!r.value.isConstant&&(this.context.values[e]=r.value.value),this._generation+=1,r}_declareSymbolOperator(e,t,i){i??=this.context.lexicalScope,i.bindings.set(e,{value:new ct(this,e,{type:"function"})});let r=i.bindings.get(e);return sr(this,e,r,t),this._generation+=1,r}pushScope(e,t){this._pushEvalContext(e??{parent:this.context?.lexicalScope,bindings:new Map},t)}popScope(){this._popEvalContext()}_pushEvalContext(e,t){if(!t){let r=this._evalContextStack.length;r===0&&(t="system"),r===1&&(t="global"),t??=`anonymous_${r-1}`}let i={};for(let[r,o]of e.bindings.entries())re(o)&&!o.value.isConstant&&(i[r]=o.value.value);this._evalContextStack.push({lexicalScope:e,name:t,assumptions:new ws(this.context?.assumptions??[]),values:i})}_popEvalContext(){this._evalContextStack.pop()}_inScope(e,t){if(!e)return t();this._evalContextStack.push({lexicalScope:e,name:"",assumptions:new ws([]),values:{}});try{return t()}finally{this._evalContextStack.pop()}}_printStack(e){e?(e={...e},e.maxDepth??=1,e.details??=!1):e={details:!1,maxDepth:-2},e.maxDepth!==void 0&&e.maxDepth<0&&(e.maxDepth=this._evalContextStack.length+e.maxDepth),e.maxDepth=Math.min(this._evalContextStack.length-1,e.maxDepth);let t=0;for(;t<=e.maxDepth;){let i=this._evalContextStack[this._evalContextStack.length-1-t];t===0?console.group(`${Vs}${mu}${i.name}${mn}`):console.groupCollapsed(`${Vs}${mu}${i.name}${mn} ${_r}(${t})${mn}`);let r=[...i.assumptions.entries()].map(([s,a])=>`${s}: ${a}`);if(r.length>0){console.groupCollapsed(`${Vs}${r.length} assumptions${mn}`);for(let s of r)console.info(s);console.groupEnd()}let o=Object.entries(i.values);if(o.length+i.lexicalScope.bindings.size===0){console.groupEnd(),t+=1;continue}for(let[s,a]of o)i.lexicalScope.bindings.has(s)?console.info(cy(s,i.lexicalScope.bindings.get(s),a)):console.info(a===void 0?`${So}${s}${mn}: ${_r}undefined${mn}`:`${So}${s}${mn}: ${_r}${a.toString()}${mn}`);for(let[s,a]of i.lexicalScope.bindings)s in i.values||console.info(cy(s,a));console.groupEnd(),t+=1}}_getSymbolValue(e){let t=this._evalContextStack.length-1;if(!(t<0))for(let i=t;i>=0;i--){let r=this._evalContextStack[i].values;if(e in r)return r[e]}}_setSymbolValue(e,t){let i=this._evalContextStack.length-1;if(i<0)throw new Error(`Unknown symbol "${e}"`);typeof t=="number"?t=this.number(t):typeof t=="boolean"&&(t=t?this.True:this.False);for(let o=i;o>=0;o--){let s=this._evalContextStack[o].values;if(e in s){s[e]=t,this._generation+=1;return}}let r=this.lookupContext(e);if(!r)throw new Error(`Unknown symbol "${e}"`);r.values[e]=t}_setCurrentContextValue(e,t){let i=this._evalContextStack.length-1;if(i<0)throw new Error("No evaluation context");typeof t=="number"?t=this.number(t):typeof t=="boolean"&&(t=t?this.True:this.False),this._evalContextStack[i].values[e]=t,this._generation+=1}declare(e,t,i){if(typeof e!="string"){for(let[a,u]of Object.entries(e))this.declare(a,u);return this}let r=e;if(r==="Nothing")return this;if(t==null)throw Error(`Expected a definition or type for "${r}"`);if(typeof r!="string"||r.length===0||!ze(r))throw new Error(`Invalid symbol "${r}": ${jn(r)}`);if(i??=this.context.lexicalScope,i.bindings.has(r))throw new Error(`The symbol "${r}" is already declared in this scope`);let s=t;if(cs(s))return this._declareSymbolValue(r,s,i),this;if(ls(s))return this._declareSymbolOperator(r,s,i),this;{let a=F(s,this._typeResolver);if(!hi(a))throw Error([`Invalid argument for "${r}"`,JSON.stringify(s,void 0,4),"Use a type, a `OperatorDefinition` or a `ValueDefinition`"].join(`
|   `));this._declareSymbolValue(r,{type:a},i)}return this}declareSequence(e,t){if(!t.base||Object.keys(t.base).length===0)throw new Error(`Sequence "${e}" requires at least one base case`);if(!t.recurrence)throw new Error(`Sequence "${e}" requires a recurrence relation`);this.declare(e,{subscriptEvaluate:()=>{}});let i=hc(this,e,t);if(!i.valid)throw new Error(i.error);let r=gc(this,e,t),o=this.lookupDefinition(e);return o&&re(o)&&(o.value.subscriptEvaluate=r),this}getSequenceStatus(e){return xh(this,e)}getSequence(e){return yh(this,e)}listSequences(){return bh(this)}isSequence(e){return Ec(this,e)}clearSequenceCache(e){Eh(this,e)}getSequenceCache(e){return vh(this,e)}getSequenceTerms(e,t,i,r){return _h(this,e,t,i,r)}lookupOEIS(e,t){return ey(this,e,t)}checkSequenceOEIS(e,t,i){return ny(this,e,t,i)}lookupContext(e){if(e.length===0||!ze(e))throw Error(`Invalid symbol "${e}": ${jn(e)}}`);let t=this._evalContextStack.length-1;if(!(t<0))for(let i=t;i>=0;i--){let r=this._evalContextStack[i];if(r.lexicalScope.bindings.has(e))return r}}_swapContext(e){for(;this._evalContextStack.length>0&&this._evalContextStack[this._evalContextStack.length-1]!==e;)this._evalContextStack.pop();this._evalContextStack.length===0&&(this._evalContextStack=[e])}assign(e,t){if(typeof e=="object"){for(let[a,u]of Object.entries(e))this.assign(a,u);return this}let i=e;if(i==="Nothing")return this;let r=this.lookupDefinition(i);if(le(r)){if(uy(this,t))throw Error(`Cannot change the operator "${i}" to a value`);let u=ly(this,t);if(!u)throw Error(`Cannot change the operator "${i}" to a value`);return sr(this,i,r,u),this}let o=uy(this,t);if(o!==void 0){if(!r)return this._declareSymbolValue(i,{value:o}),this;if(r.value.isConstant)throw Error(`Cannot assign a value to the constant "${i}"`);return r.value.inferredType&&(r.value.type=this.type(ve(r.value.type.type,o.type.type))),this._setSymbolValue(i,o),this}let s=ly(this,t);if(s===void 0)throw Error(`Invalid definition for symbol "${i}"`);return r?(re(r),sr(this,i,r,s),this._setSymbolValue(i,void 0)):this.declare(i,s),this}_shouldContinueExecution(){return this.deadline===void 0||this.deadline>=Date.now()}_checkContinueExecution(){if(!this._shouldContinueExecution())throw new Error("timeout")}_cache(e,t,i){if(this.__cache[e]===void 0)try{this.__cache[e]={build:t,purge:i,value:t()}}catch(r){console.error(`Fatal error building cache "${e}":
	 ${r.toString()}`)}return this.__cache[e]?.value}box(e,t){return ht(this,e,t)}function(e,t,i){return eu(this,e,t,i)}error(e,t){let i;typeof e=="string"?i=this.string(e):i=this.function("ErrorCode",e.map(s=>this.string(s)));let r;t&&Rr(t)?r=this.function("LatexString",[this.string(vi(t))]):typeof t=="string"&&t.length>0&&(r=this.string(t));let o=[this.box(i)];return r&&o.push(r),this.function("Error",o)}typeError(e,t,i){return t?this.error(["incompatible-type",te(e),t.toString()],i):this.error(["incompatible-type",te(e)],i)}hold(e){return this._fn("Hold",[this.box(e,{canonical:!1})])}tuple(...e){return new Me(this,"Tuple",e.map(t=>typeof t=="number"?this.number(t):t.canonical),{canonical:!0})}type(e){return e instanceof R?e:new R(e,this._typeResolver)}string(e,t){return new Li(this,e,t)}symbol(e,t){let i=t?.canonical??!0,r=t?.metadata;e=e.normalize();let o=e.toLowerCase();if(o==="infinity"||o==="+infinity")return this.PositiveInfinity;if(o==="-infinity")return this.NegativeInfinity;if(this.strict&&!ze(e))return this.error(["invalid-symbol",jn(e)],e);if(!i)return new mr(this,e,{metadata:r});let s=this._commonSymbols[e];if(s)return s;let a=this.lookupDefinition(e);return re(a)&&a.value.holdUntil==="never"?a.value.value??this.Nothing:a?new mr(this,e,{metadata:r,def:a}):(a=this._declareSymbolValue(e,{type:"unknown",inferred:!0}),new mr(this,e,{metadata:r,def:a}))}number(e,t){let i=t?.metadata,r=!1;if((!t||t.canonical===void 0||t.canonical==="Number"||t.canonical===!0||Array.isArray(t.canonical)&&t.canonical.includes("Number"))&&(r=!0),!r&&Qt(e))return this._fn("Rational",[this.number(e[0]),this.number(e[1])],{...i,canonical:!1});if(e=nu(this,e),i===void 0){if(typeof e=="number"){let o=e;if(o===1)return this.One;if(o===0)return this.Zero;if(o===-1)return this.NegativeOne;if(o===2)return this.Two;if(Number.isInteger(o)&&this._commonNumbers[o]!==void 0)return this._commonNumbers[o]??=new En(this,e),this._commonNumbers[o];if(Number.isNaN(o))return this.NaN;if(!Number.isFinite(o))return o<0?this.NegativeInfinity:this.PositiveInfinity}else if(e instanceof ae){if(e.isZero)return this.Zero;if(e.isOne)return this.One;if(e.isNegativeOne)return this.NegativeOne;if(e.isNaN)return this.NaN;if(e.isNegativeInfinity)return this.NegativeInfinity;if(e.isPositiveInfinity)return this.PositiveInfinity}}return new En(this,e,{metadata:i})}rules(e,t){return rs(this,e,t)}getRuleSet(e){if(e??="standard-simplification",e==="standard-simplification")return this._cache("standard-simplification-rules",()=>rs(this,Qx,{canonical:!0}));if(e==="solve-univariate")return this._cache("univariate-roots-rules",()=>rs(this,Pg));if(e==="harmonization")return this._cache("harmonization-rules",()=>rs(this,Og))}_fn(e,t,i){let r=i?.canonical??!0;return new Me(this,e,t,{...i,canonical:r})}parse(e,t){if(e==null)return null;if(typeof e!="string")throw Error("ce.parse(): expected a LaTeX string");let i={imaginaryUnit:"\\imaginaryI",positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalSeparator:this.decimalSeparator,digitGroup:3,digitGroupSeparator:"\\,",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",truncationMarker:"\\ldots",repeatingDecimal:"auto",strict:!0,skipSpace:!0,parseNumbers:"auto",getSymbolType:o=>{let s=this.lookupDefinition(o);return s?le(s)?s.operator.signature:re(s)?s.value.type:R.unknown:R.unknown},hasSubscriptEvaluate:o=>{let s=this.lookupDefinition(o);return!!(re(s)&&s.value.subscriptEvaluate)},parseUnexpectedToken:(o,s)=>null,preserveLatex:!1,quantifierScope:"tight",timeDerivativeVariable:"t"},r=nm(vi(e)??e,this._indexedLatexDictionary,{...i,...t});if(r===null)throw Error("Failed to parse LaTeX string");return this.box(r,{canonical:t?.canonical??!0})}ask(e){let t=this.box(e,{canonical:!1}),i=[],r=c=>c.operator?.startsWith("_")||He(c)?!0:c.ops?c.ops.some(r):!1,o=c=>{let f=Object.keys(c).sort();for(let p of i){let d=Object.keys(p).sort();if(d.length!==f.length)continue;let m=!0;for(let g=0;g<f.length;g++){if(d[g]!==f[g]){m=!1;break}let h=f[g];if(!c[h].isSame(p[h])){m=!1;break}}if(m)return}i.push(c)},s=this.context.assumptions,a=()=>{let c=new Set;for(let[f,p]of s)if(p===!0)for(let d of f.symbols)c.add(d);return[...c]},u=c=>{let f=c.operator;if(f!=="Less"&&f!=="LessEqual"&&f!=="Greater"&&f!=="GreaterEqual")return[{pattern:c}];let p=f==="Greater"||f==="GreaterEqual"?c.op2:c.op1,d=f==="Greater"||f==="GreaterEqual"?c.op1:c.op2,m=f==="Less"||f==="Greater"?"Less":"LessEqual",g=this.box(["Add",p,["Negate",d]],{canonical:!1});return[{pattern:c},{pattern:this.box([m,g,0],{canonical:!1}),matchPermutations:!1}]};if(t.operator==="Element"&&t.op1?.symbol&&He(t.op2)){let c=pn(t.op2);if(c&&!c.startsWith("__")){let f=this.box(t.op1.symbol).type;f.isUnknown||o({[c]:this.box(f.toString(),{canonical:!1})})}}if((t.operator==="Greater"||t.operator==="GreaterEqual"||t.operator==="Less"||t.operator==="LessEqual")&&He(t.op2)){let c=pn(t.op2);if(c&&!c.startsWith("__")){let f=t.operator==="Greater"||t.operator==="GreaterEqual",p=t.operator==="Greater"||t.operator==="Less";if(t.op1?.symbol){let d=os(this,t.op1.symbol),m=f?d.lowerBound:d.upperBound,g=f?d.lowerStrict:d.upperStrict;m!==void 0&&(!p||g===!0)&&o({[c]:m})}if(He(t.op1)){let d=pn(t.op1);if(d&&!d.startsWith("__"))for(let m of a()){let g=os(this,m),h=f?g.lowerBound:g.upperBound,x=f?g.lowerStrict:g.upperStrict;h===void 0||p&&x!==!0||o({[d]:this.box(m,{canonical:!0}),[c]:h})}}}}let l=u(t);for(let[c,f]of s)if(f===!0)for(let{pattern:p,matchPermutations:d}of l){let m=c.match(p,{useVariations:!0,matchPermutations:d});m!==null&&o(m)}return i.length===0&&!r(t)&&!this._isVerifying&&this.verify(this.box(e,{canonical:!0}))===!0&&o({}),i}verify(e){if(!this._isVerifying){this._isVerifying=!0;try{let i=(Rr(e)?this.parse(e,{canonical:!1}):this.box(e,{canonical:!1})).evaluate();if(i.symbol==="True")return!0;if(i.symbol==="False")return!1;let r=i.operator;if(r==="Not"){let o=this.verify(i.op1);return o===void 0?void 0:!o}if(r==="And"){let o=!1;for(let s of i.ops??[]){let a=this.verify(s);if(a===!1)return!1;a===void 0&&(o=!0)}return o?void 0:!0}if(r==="Or"){let o=!1;for(let s of i.ops??[]){let a=this.verify(s);if(a===!0)return!0;a===void 0&&(o=!0)}return o?void 0:!1}return}finally{this._isVerifying=!1}}}assume(e){try{let t=Rr(e)?this.parse(e,{canonical:!1}):this.box(e,{canonical:!1});return this._generation+=1,oc(t)}catch(t){throw console.error(t.message.toString()),t}}forget(e){if(e===void 0){this.context.assumptions?.clear(),this._generation+=1;return}if(Array.isArray(e)){for(let t of e)this.forget(t);return}if(typeof e=="string"){for(let[t,i]of this.context.assumptions)t.has(e)&&this.context.assumptions.delete(t);for(let t of this._evalContextStack)e in t.values&&delete t.values[e]}this._generation+=1}};function uy(n,e){if(e==null||typeof e=="function")return;if(typeof e=="boolean")return e?n.True:n.False;if(typeof e=="number"||typeof e=="bigint")return n.number(e);let t=n.box(e);if(t.operator!=="Function"&&!t.unknowns.some(i=>i.startsWith("_")))return t}function ly(n,e){if(typeof e=="function")return{evaluate:e,signature:"function"};if(e==null||typeof e=="boolean")return;let t=Le(n.box(e));if(t!==void 0)return{evaluate:t}}function cy(n,e,t){let i="";if(re(e)){let r=[];e.value.holdUntil==="never"&&r.push("(hold never)"),e.value.holdUntil==="N"&&r.push("(hold until N)"),e.value.inferredType&&r.push("inferred");let o=r.length>0?` ${r.join(" ")}`:"";i=`${So}${n}${mn}:${o}`,e.value.isConstant?(i+=` const ${e.value.type.toString()}`,e.value.value!==void 0&&(i+=` = ${e.value.value?.toString()}`)):i+=` ${e.value.type.toString()}`}else if(le(e)){let r=[];e.operator.inferredSignature&&r.push("(inferred)");let o=r.length>0?` (${r.join(" ")})`:"";i=`${So}${n}${mn}:${o} ${e.operator.signature.toString()}`;let s=[];e.operator.lazy&&s.push("lazy"),e.operator.scoped&&s.push("scoped"),e.operator.broadcastable&&s.push("broadcastable"),e.operator.associative&&s.push("associative"),e.operator.commutative&&s.push("commutative"),e.operator.idempotent&&s.push("idempotent"),e.operator.involution&&s.push("involution"),e.operator.pure||s.push("not pure");let a=s.map(u=>`${_r}${u}${mn}`).join(" ");a.length>0&&(i+=`
   \u2514 ${a}`)}else i="unknown";return t&&(t.isValid?t.isCanonical?i+=` = ${_r}${t.toString()}${mn}`:i+=` = ${_p}${t.toString()}${mn} (not canonical)`:i+=` = ${Np}${t.toString()}${mn} (not valid)`),i}Ol();Ct();var v_="0.35.1";globalThis[Symbol.for("io.cortexjs.compute-engine")]={ComputeEngine:_o.prototype.constructor,version:"0.35.1"};return it(__);})();
/*! Bundled license information:

complex-esm/dist/src/complex.js:
  (**
   * @license Complex.js v2.1.1 12/05/2020
   *
   * Copyright (c) 2020, Robert Eisele (robert@xarg.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **)

decimal.js/decimal.mjs:
  (*!
   *  decimal.js v10.6.0
   *  An arbitrary-precision Decimal type for JavaScript.
   *  https://github.com/MikeMcl/decimal.js
   *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
   *  MIT Licence
   *)
*/
Object.assign(exports, ComputeEngine); Object.defineProperty(exports, '__esModule', { value: true });}));
